#!/usr/bin/env node
var c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var l=c((N,S)=>{var n=require("node:fs"),p=require("node:path"),g=require("node:os"),i=p.join(g.homedir(),".supermemory-claude"),o=p.join(i,"settings.json"),a={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function _(){n.existsSync(i)||n.mkdirSync(i,{recursive:!0})}function m(){let e={...a};try{if(n.existsSync(o)){let t=n.readFileSync(o,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${o}: ${t.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function y(e){_();let t={...e};delete t.apiKey,n.writeFileSync(o,JSON.stringify(t,null,2))}function T(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function P(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function R(e,t,r){if(e.debug){let s=new Date().toISOString();console.error(r?`[${s}] ${t}: ${JSON.stringify(r)}`:`[${s}] ${t}`)}}S.exports={SETTINGS_DIR:i,SETTINGS_FILE:o,DEFAULT_SETTINGS:a,loadSettings:m,saveSettings:y,getApiKey:T,shouldCaptureTool:P,debugLog:R}});var d=c(($,f)=>{async function I(){return new Promise((e,t)=>{let r="";process.stdin.setEncoding("utf8"),process.stdin.on("data",s=>{r+=s}),process.stdin.on("end",()=>{try{e(r.trim()?JSON.parse(r):{})}catch(s){t(new Error(`Failed to parse stdin JSON: ${s.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function u(e){console.log(JSON.stringify(e))}function M(e=null){u(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function Y(e){console.error(`Supermemory: ${e}`),u({continue:!0,suppressOutput:!0})}f.exports={readStdin:I,writeOutput:u,outputSuccess:M,outputError:Y}});var{loadSettings:h,debugLog:E}=l(),{readStdin:K,outputSuccess:O}=d();async function U(){let e=h();try{let r=(await K()).session_id;E(e,"UserPromptSubmit",{sessionId:r}),O()}catch(t){E(e,"Error",{error:t.message}),O()}}U().catch(e=>{console.error(`Supermemory fatal: ${e.message}`),process.exit(1)});
