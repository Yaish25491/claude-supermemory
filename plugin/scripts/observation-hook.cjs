#!/usr/bin/env node
var u=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports);var l=u((v,S)=>{var n=require("node:fs"),p=require("node:path"),_=require("node:os"),i=p.join(_.homedir(),".supermemory-claude"),o=p.join(i,"settings.json"),a={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function g(){n.existsSync(i)||n.mkdirSync(i,{recursive:!0})}function m(){let e={...a};try{if(n.existsSync(o)){let s=n.readFileSync(o,"utf-8");Object.assign(e,JSON.parse(s))}}catch(s){console.error(`Settings: Failed to load ${o}: ${s.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(s=>s.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function T(e){g();let s={...e};delete s.apiKey,n.writeFileSync(o,JSON.stringify(s,null,2))}function y(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function P(e,s){return s.skipTools.includes(e)?!1:s.captureTools&&s.captureTools.length>0?s.captureTools.includes(e):!0}function R(e,s,t){if(e.debug){let r=new Date().toISOString();console.error(t?`[${r}] ${s}: ${JSON.stringify(t)}`:`[${r}] ${s}`)}}S.exports={SETTINGS_DIR:i,SETTINGS_FILE:o,DEFAULT_SETTINGS:a,loadSettings:m,saveSettings:T,getApiKey:y,shouldCaptureTool:P,debugLog:R}});var d=u(($,f)=>{async function I(){return new Promise((e,s)=>{let t="";process.stdin.setEncoding("utf8"),process.stdin.on("data",r=>{t+=r}),process.stdin.on("end",()=>{try{e(t.trim()?JSON.parse(t):{})}catch(r){s(new Error(`Failed to parse stdin JSON: ${r.message}`))}}),process.stdin.on("error",s),process.stdin.isTTY&&e({})})}function c(e){console.log(JSON.stringify(e))}function M(e=null){c(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function Y(e){console.error(`Supermemory: ${e}`),c({continue:!0,suppressOutput:!0})}f.exports={readStdin:I,writeOutput:c,outputSuccess:M,outputError:Y}});var{loadSettings:h,debugLog:E}=l(),{readStdin:K,outputSuccess:O}=d();async function N(){let e=h();try{let s=await K(),t=s.session_id,r=s.tool_name;E(e,"PostToolUse",{sessionId:t,toolName:r}),O()}catch(s){E(e,"Error",{error:s.message}),O()}}N().catch(e=>{console.error(`Supermemory fatal: ${e.message}`),process.exit(1)});
