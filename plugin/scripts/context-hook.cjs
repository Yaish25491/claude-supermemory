#!/usr/bin/env node
var w=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var V=w(Be=>{"use strict";Be.getBooleanOption=(e,t)=>{let r=!1;if(t in e&&typeof(r=e[t])!="boolean")throw new TypeError(`Expected the "${t}" option to be a boolean`);return r};Be.cppdb=Symbol();Be.inspect=Symbol.for("nodejs.util.inspect.custom")});var xt=w((Op,Br)=>{"use strict";var Rt={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function ne(e,t){if(new.target!==ne)return new ne(e,t);if(typeof t!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,e),Rt.value=""+e,Object.defineProperty(this,"message",Rt),Error.captureStackTrace(this,ne),this.code=t}Object.setPrototypeOf(ne,Error);Object.setPrototypeOf(ne.prototype,Error.prototype);Object.defineProperty(ne.prototype,"name",Rt);Br.exports=ne});var Ur=w((Cp,qr)=>{var qe=require("path").sep||"/";qr.exports=ma;function ma(e){if(typeof e!="string"||e.length<=7||e.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var t=decodeURI(e.substring(7)),r=t.indexOf("/"),n=t.substring(0,r),s=t.substring(r+1);return n=="localhost"&&(n=""),n&&(n=qe+qe+n),s=s.replace(/^(.+)\|/,"$1:"),qe=="\\"&&(s=s.replace(/\//g,"\\")),/^.+\:/.test(s)||(s=qe+s),n+s}});var zr=w((pe,Hr)=>{var Ft=require("fs"),Ge=require("path"),ga=Ur(),Ue=Ge.join,ya=Ge.dirname,Gr=Ft.accessSync&&function(e){try{Ft.accessSync(e)}catch{return!1}return!0}||Ft.existsSync||Ge.existsSync,Xr={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function ba(e){typeof e=="string"?e={bindings:e}:e||(e={}),Object.keys(Xr).map(function(c){c in e||(e[c]=Xr[c])}),e.module_root||(e.module_root=pe.getRoot(pe.getFileName())),Ge.extname(e.bindings)!=".node"&&(e.bindings+=".node");for(var t=typeof __webpack_require__=="function"?__non_webpack_require__:require,r=[],n=0,s=e.try.length,i,o,a;n<s;n++){i=Ue.apply(null,e.try[n].map(function(c){return e[c]||c})),r.push(i);try{return o=e.path?t.resolve(i):t(i),e.path||(o.path=i),o}catch(c){if(c.code!=="MODULE_NOT_FOUND"&&c.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(c.message))throw c}}throw a=new Error(`Could not locate the bindings file. Tried:
`+r.map(function(c){return e.arrow+c}).join(`
`)),a.tries=r,a}Hr.exports=pe=ba;pe.getFileName=function(t){var r=Error.prepareStackTrace,n=Error.stackTraceLimit,s={},i;Error.stackTraceLimit=10,Error.prepareStackTrace=function(a,c){for(var f=0,u=c.length;f<u;f++)if(i=c[f].getFileName(),i!==__filename)if(t){if(i!==t)return}else return},Error.captureStackTrace(s),s.stack,Error.prepareStackTrace=r,Error.stackTraceLimit=n;var o="file://";return i.indexOf(o)===0&&(i=ga(i)),i};pe.getRoot=function(t){for(var r=ya(t),n;;){if(r==="."&&(r=process.cwd()),Gr(Ue(r,"package.json"))||Gr(Ue(r,"node_modules")))return r;if(n===r)throw new Error('Could not find module root given file: "'+t+'". Do you have a `package.json` file? ');n=r,r=Ue(r,"..")}}});var Wr=w(ee=>{"use strict";var{cppdb:z}=V();ee.prepare=function(t){return this[z].prepare(t,this,!1)};ee.exec=function(t){return this[z].exec(t),this};ee.close=function(){return this[z].close(),this};ee.loadExtension=function(...t){return this[z].loadExtension(...t),this};ee.defaultSafeIntegers=function(...t){return this[z].defaultSafeIntegers(...t),this};ee.unsafeMode=function(...t){return this[z].unsafeMode(...t),this};ee.getters={name:{get:function(){return this[z].name},enumerable:!0},open:{get:function(){return this[z].open},enumerable:!0},inTransaction:{get:function(){return this[z].inTransaction},enumerable:!0},readonly:{get:function(){return this[z].readonly},enumerable:!0},memory:{get:function(){return this[z].memory},enumerable:!0}}});var Vr=w((xp,Jr)=>{"use strict";var{cppdb:_a}=V(),Yr=new WeakMap;Jr.exports=function(t){if(typeof t!="function")throw new TypeError("Expected first argument to be a function");let r=this[_a],n=wa(r,this),{apply:s}=Function.prototype,i={default:{value:Xe(s,t,r,n.default)},deferred:{value:Xe(s,t,r,n.deferred)},immediate:{value:Xe(s,t,r,n.immediate)},exclusive:{value:Xe(s,t,r,n.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(i.default.value,i),Object.defineProperties(i.deferred.value,i),Object.defineProperties(i.immediate.value,i),Object.defineProperties(i.exclusive.value,i),i.default.value};var wa=(e,t)=>{let r=Yr.get(e);if(!r){let n={commit:e.prepare("COMMIT",t,!1),rollback:e.prepare("ROLLBACK",t,!1),savepoint:e.prepare("SAVEPOINT `	_bs3.	`",t,!1),release:e.prepare("RELEASE `	_bs3.	`",t,!1),rollbackTo:e.prepare("ROLLBACK TO `	_bs3.	`",t,!1)};Yr.set(e,r={default:Object.assign({begin:e.prepare("BEGIN",t,!1)},n),deferred:Object.assign({begin:e.prepare("BEGIN DEFERRED",t,!1)},n),immediate:Object.assign({begin:e.prepare("BEGIN IMMEDIATE",t,!1)},n),exclusive:Object.assign({begin:e.prepare("BEGIN EXCLUSIVE",t,!1)},n)})}return r},Xe=(e,t,r,{begin:n,commit:s,rollback:i,savepoint:o,release:a,rollbackTo:c})=>function(){let u,d,m;r.inTransaction?(u=o,d=a,m=c):(u=n,d=s,m=i),u.run();try{let h=e.call(t,this,arguments);if(h&&typeof h.then=="function")throw new TypeError("Transaction function cannot return a promise");return d.run(),h}catch(h){throw r.inTransaction&&(m.run(),m!==i&&d.run()),h}}});var Qr=w((Fp,Kr)=>{"use strict";var{getBooleanOption:Ta,cppdb:va}=V();Kr.exports=function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");let n=Ta(r,"simple"),s=this[va].prepare(`PRAGMA ${t}`,this,!0);return n?s.pluck().get():s.all()}});var tn=w((Ap,en)=>{"use strict";var Ea=require("fs"),ka=require("path"),{promisify:Sa}=require("util"),{cppdb:Oa}=V(),Zr=Sa(Ea.access);en.exports=async function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");t=t.trim();let n="attached"in r?r.attached:"main",s="progress"in r?r.progress:null;if(!t)throw new TypeError("Backup filename cannot be an empty string");if(t===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof n!="string")throw new TypeError('Expected the "attached" option to be a string');if(!n)throw new TypeError('The "attached" option cannot be an empty string');if(s!=null&&typeof s!="function")throw new TypeError('Expected the "progress" option to be a function');await Zr(ka.dirname(t)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let i=await Zr(t).then(()=>!1,()=>!0);return Ca(this[Oa].backup(this,n,t,i),s||null)};var Ca=(e,t)=>{let r=0,n=!0;return new Promise((s,i)=>{setImmediate(function o(){try{let a=e.transfer(r);if(!a.remainingPages){e.close(),s(a);return}if(n&&(n=!1,r=100),t){let c=t(a);if(c!==void 0)if(typeof c=="number"&&c===c)r=Math.max(0,Math.min(2147483647,Math.round(c)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(o)}catch(a){e.close(),i(a)}})})}});var nn=w((Ip,rn)=>{"use strict";var{cppdb:Ra}=V();rn.exports=function(t){if(t==null&&(t={}),typeof t!="object")throw new TypeError("Expected first argument to be an options object");let r="attached"in t?t.attached:"main";if(typeof r!="string")throw new TypeError('Expected the "attached" option to be a string');if(!r)throw new TypeError('The "attached" option cannot be an empty string');return this[Ra].serialize(r)}});var on=w((Mp,sn)=>{"use strict";var{getBooleanOption:He,cppdb:xa}=V();sn.exports=function(t,r,n){if(r==null&&(r={}),typeof r=="function"&&(n=r,r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof n!="function")throw new TypeError("Expected last argument to be a function");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let s="safeIntegers"in r?+He(r,"safeIntegers"):2,i=He(r,"deterministic"),o=He(r,"directOnly"),a=He(r,"varargs"),c=-1;if(!a){if(c=n.length,!Number.isInteger(c)||c<0)throw new TypeError("Expected function.length to be a positive integer");if(c>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[xa].function(n,t,c,s,i,o),this}});var un=w((Np,cn)=>{"use strict";var{getBooleanOption:ze,cppdb:Fa}=V();cn.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object"||r===null)throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let n="start"in r?r.start:null,s=At(r,"step",!0),i=At(r,"inverse",!1),o=At(r,"result",!1),a="safeIntegers"in r?+ze(r,"safeIntegers"):2,c=ze(r,"deterministic"),f=ze(r,"directOnly"),u=ze(r,"varargs"),d=-1;if(!u&&(d=Math.max(an(s),i?an(i):0),d>0&&(d-=1),d>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[Fa].aggregate(n,s,i,o,t,d,a,c,f),this};var At=(e,t,r)=>{let n=t in e?e[t]:null;if(typeof n=="function")return n;if(n!=null)throw new TypeError(`Expected the "${t}" option to be a function`);if(r)throw new TypeError(`Missing required option "${t}"`);return null},an=({length:e})=>{if(Number.isInteger(e)&&e>=0)return e;throw new TypeError("Expected function.length to be a positive integer")}});var dn=w((Dp,pn)=>{"use strict";var{cppdb:Aa}=V();pn.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(!t)throw new TypeError("Virtual table module name cannot be an empty string");let n=!1;if(typeof r=="object"&&r!==null)n=!0,r=$a(fn(r,"used",t));else{if(typeof r!="function")throw new TypeError("Expected second argument to be a function or a table definition object");r=Ia(r)}return this[Aa].table(r,t,n),this};function Ia(e){return function(r,n,s,...i){let o={module:r,database:n,table:s},a=ja.call(e,o,i);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${r}" did not return a table definition object`);return fn(a,"returned",r)}}function fn(e,t,r){if(!Ee.call(e,"rows"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "rows" property`);if(!Ee.call(e,"columns"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "columns" property`);let n=e.rows;if(typeof n!="function"||Object.getPrototypeOf(n)!==La)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "rows" property (should be a generator function)`);let s=e.columns;if(!Array.isArray(s)||!(s=[...s]).every(f=>typeof f=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "columns" property (should be an array of strings)`);if(s.length!==new Set(s).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate column names`);if(!s.length)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with zero columns`);let i;if(Ee.call(e,"parameters")){if(i=e.parameters,!Array.isArray(i)||!(i=[...i]).every(f=>typeof f=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "parameters" property (should be an array of strings)`)}else i=Pa(n);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate parameter names`);if(i.length>32)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with more than the maximum number of 32 parameters`);for(let f of i)if(s.includes(f))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with column "${f}" which was ambiguously defined as both a column and parameter`);let o=2;if(Ee.call(e,"safeIntegers")){let f=e.safeIntegers;if(typeof f!="boolean")throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "safeIntegers" property (should be a boolean)`);o=+f}let a=!1;if(Ee.call(e,"directOnly")&&(a=e.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...i.map(ln).map(f=>`${f} HIDDEN`),...s.map(ln)].join(", ")});`,Ma(n,new Map(s.map((f,u)=>[f,i.length+u])),r),i,o,a]}function Ma(e,t,r){return function*(...s){let i=s.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);for(let o=0;o<t.size;++o)i.push(null);for(let o of e(...s))if(Array.isArray(o))Na(o,i,t.size,r),yield i;else if(typeof o=="object"&&o!==null)Da(o,i,t,r),yield i;else throw new TypeError(`Virtual table module "${r}" yielded something that isn't a valid row object`)}}function Na(e,t,r,n){if(e.length!==r)throw new TypeError(`Virtual table module "${n}" yielded a row with an incorrect number of columns`);let s=t.length-r;for(let i=0;i<r;++i)t[i+s]=e[i]}function Da(e,t,r,n){let s=0;for(let i of Object.keys(e)){let o=r.get(i);if(o===void 0)throw new TypeError(`Virtual table module "${n}" yielded a row with an undeclared column "${i}"`);t[o]=e[i],s+=1}if(s!==r.size)throw new TypeError(`Virtual table module "${n}" yielded a row with missing columns`)}function Pa({length:e}){if(!Number.isInteger(e)||e<0)throw new TypeError("Expected function.length to be a positive integer");let t=[];for(let r=0;r<e;++r)t.push(`$${r+1}`);return t}var{hasOwnProperty:Ee}=Object.prototype,{apply:ja}=Function.prototype,La=Object.getPrototypeOf(function*(){}),ln=e=>`"${e.replace(/"/g,'""')}"`,$a=e=>()=>e});var mn=w((Pp,hn)=>{"use strict";var Ba=function(){};hn.exports=function(t,r){return Object.assign(new Ba,this)}});var _n=w((jp,bn)=>{"use strict";var qa=require("fs"),gn=require("path"),We=V(),Ua=xt(),yn;function M(e,t){if(new.target==null)return new M(e,t);let r;if(Buffer.isBuffer(e)&&(r=e,e=":memory:"),e==null&&(e=""),t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in t)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in t)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let n=e.trim(),s=n===""||n===":memory:",i=We.getBooleanOption(t,"readonly"),o=We.getBooleanOption(t,"fileMustExist"),a="timeout"in t?t.timeout:5e3,c="verbose"in t?t.verbose:null,f="nativeBinding"in t?t.nativeBinding:null;if(i&&s&&!r)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(c!=null&&typeof c!="function")throw new TypeError('Expected the "verbose" option to be a function');if(f!=null&&typeof f!="string"&&typeof f!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let u;if(f==null?u=yn||(yn=zr()("better_sqlite3.node")):typeof f=="string"?u=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(gn.resolve(f).replace(/(\.node)?$/,".node")):u=f,u.isInitialized||(u.setErrorConstructor(Ua),u.isInitialized=!0),!s&&!qa.existsSync(gn.dirname(n)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[We.cppdb]:{value:new u.Database(n,e,s,i,o,a,c||null,r||null)},...se.getters})}var se=Wr();M.prototype.prepare=se.prepare;M.prototype.transaction=Vr();M.prototype.pragma=Qr();M.prototype.backup=tn();M.prototype.serialize=nn();M.prototype.function=on();M.prototype.aggregate=un();M.prototype.table=dn();M.prototype.loadExtension=se.loadExtension;M.prototype.exec=se.exec;M.prototype.close=se.close;M.prototype.defaultSafeIntegers=se.defaultSafeIntegers;M.prototype.unsafeMode=se.unsafeMode;M.prototype[We.inspect]=mn();bn.exports=M});var wn=w((Lp,It)=>{"use strict";It.exports=_n();It.exports.SqliteError=xt()});var En=w(($p,vn)=>{var Ga=wn(),Dt=require("node:path"),Tn=require("node:fs"),Xa=require("node:os"),Ha=Dt.join(Xa.homedir(),".claude-memory"),Mt=Dt.join(Ha,"memories.db"),Nt=class{constructor(t=Mt){t||(t=Mt);let r=Dt.dirname(t);Tn.existsSync(r)||Tn.mkdirSync(r,{recursive:!0}),this.db=new Ga(t),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(t,r,n,s={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(t,r,n,JSON.stringify(s),i,i),{id:t,createdAt:i}}getMemory(t){let n=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(t);return n?.metadata&&(n.metadata=JSON.parse(n.metadata)),n}updateMemory(t,r,n=null){let s=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,s,"pending"];n!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(n))),o.push(t),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(t){this.db.prepare("DELETE FROM memories WHERE id = ?").run(t)}listMemories(t,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(n=>(n.metadata&&(n.metadata=JSON.parse(n.metadata)),n))}markSynced(t){let r=Date.now(),n=t.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${n})
    `).run(r,...t)}searchMemories(t,r=null,n=10){let s=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[t];return r&&(s+=" AND m.container_tag = ?",i.push(r)),s+=" ORDER BY rank LIMIT ?",i.push(n),this.db.prepare(s).all(...i).map(c=>(c.metadata&&(c.metadata=JSON.parse(c.metadata)),c))}getContextMemories(t,r,n=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,Math.floor(n/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,t,Math.floor(n/2)),c=new Set(i.map(u=>u.id)),f=[...i];for(let u of a)c.has(u.id)||(f.push(u),c.add(u.id));return f.slice(0,n).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}addProfileFact(t,r,n,s="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(t,r,n,s,i)}getProfile(t,r=5){let s=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r);return{static:s.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(t){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(t)}close(){this.db.close()}};vn.exports={SqliteManager:Nt,DEFAULT_DB_PATH:Mt}});var Sn=w((Bp,kn)=>{var de=1e3,he=de*60,me=he*60,ie=me*24,za=ie*7,Wa=ie*365.25;kn.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Ya(e);if(r==="number"&&isFinite(e))return t.long?Va(e):Ja(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Ya(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Wa;case"weeks":case"week":case"w":return r*za;case"days":case"day":case"d":return r*ie;case"hours":case"hour":case"hrs":case"hr":case"h":return r*me;case"minutes":case"minute":case"mins":case"min":case"m":return r*he;case"seconds":case"second":case"secs":case"sec":case"s":return r*de;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Ja(e){var t=Math.abs(e);return t>=ie?Math.round(e/ie)+"d":t>=me?Math.round(e/me)+"h":t>=he?Math.round(e/he)+"m":t>=de?Math.round(e/de)+"s":e+"ms"}function Va(e){var t=Math.abs(e);return t>=ie?Ye(e,t,ie,"day"):t>=me?Ye(e,t,me,"hour"):t>=he?Ye(e,t,he,"minute"):t>=de?Ye(e,t,de,"second"):e+" ms"}function Ye(e,t,r,n){var s=t>=r*1.5;return Math.round(e/r)+" "+n+(s?"s":"")}});var Pt=w((qp,On)=>{function Ka(e){r.debug=r,r.default=r,r.coerce=c,r.disable=o,r.enable=s,r.enabled=a,r.humanize=Sn(),r.destroy=f,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function t(u){let d=0;for(let m=0;m<u.length;m++)d=(d<<5)-d+u.charCodeAt(m),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=t;function r(u){let d,m=null,h,A;function k(...I){if(!k.enabled)return;let X=k,Z=Number(new Date),Le=Z-(d||Z);X.diff=Le,X.prev=d,X.curr=Z,d=Z,I[0]=r.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let fe=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(ve,St)=>{if(ve==="%%")return"%";fe++;let $e=r.formatters[St];if(typeof $e=="function"){let Ot=I[fe];ve=$e.call(X,Ot),I.splice(fe,1),fe--}return ve}),r.formatArgs.call(X,I),(X.log||r.log).apply(X,I)}return k.namespace=u,k.useColors=r.useColors(),k.color=r.selectColor(u),k.extend=n,k.destroy=r.destroy,Object.defineProperty(k,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==r.namespaces&&(h=r.namespaces,A=r.enabled(u)),A),set:I=>{m=I}}),typeof r.init=="function"&&r.init(k),k}function n(u,d){let m=r(this.namespace+(typeof d>"u"?":":d)+u);return m.log=this.log,m}function s(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let m of d)m[0]==="-"?r.skips.push(m.slice(1)):r.names.push(m)}function i(u,d){let m=0,h=0,A=-1,k=0;for(;m<u.length;)if(h<d.length&&(d[h]===u[m]||d[h]==="*"))d[h]==="*"?(A=h,k=m,h++):(m++,h++);else if(A!==-1)h=A+1,k++,m=k;else return!1;for(;h<d.length&&d[h]==="*";)h++;return h===d.length}function o(){let u=[...r.names,...r.skips.map(d=>"-"+d)].join(",");return r.enable(""),u}function a(u){for(let d of r.skips)if(i(u,d))return!1;for(let d of r.names)if(i(u,d))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}On.exports=Ka});var Cn=w((j,Je)=>{j.formatArgs=Za;j.save=ec;j.load=tc;j.useColors=Qa;j.storage=rc();j.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();j.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Qa(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Za(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Je.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),e.splice(n,0,t)}j.log=console.debug||console.log||(()=>{});function ec(e){try{e?j.storage.setItem("debug",e):j.storage.removeItem("debug")}catch{}}function tc(){let e;try{e=j.storage.getItem("debug")||j.storage.getItem("DEBUG")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function rc(){try{return localStorage}catch{}}Je.exports=Pt()(j);var{formatters:nc}=Je.exports;nc.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var xn=w((x,Ke)=>{var sc=require("tty"),Ve=require("util");x.init=fc;x.log=cc;x.formatArgs=oc;x.save=uc;x.load=lc;x.useColors=ic;x.destroy=Ve.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");x.colors=[6,2,3,4,5,1];try{let e=require("supports-color");e&&(e.stderr||e).level>=2&&(x.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}x.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(s,i)=>i.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function ic(){return"colors"in x.inspectOpts?!!x.inspectOpts.colors:sc.isatty(process.stderr.fd)}function oc(e){let{namespace:t,useColors:r}=this;if(r){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),i=`  ${s};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(s+"m+"+Ke.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=ac()+t+" "+e[0]}function ac(){return x.inspectOpts.hideDate?"":new Date().toISOString()+" "}function cc(...e){return process.stderr.write(Ve.formatWithOptions(x.inspectOpts,...e)+`
`)}function uc(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function lc(){return process.env.DEBUG}function fc(e){e.inspectOpts={};let t=Object.keys(x.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=x.inspectOpts[t[r]]}Ke.exports=Pt()(x);var{formatters:Rn}=Ke.exports;Rn.o=function(e){return this.inspectOpts.colors=this.useColors,Ve.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Rn.O=function(e){return this.inspectOpts.colors=this.useColors,Ve.inspect(e,this.inspectOpts)}});var Lt=w((Up,jt)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?jt.exports=Cn():jt.exports=xn()});var Fn=w(q=>{"use strict";var pc=q&&q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(q,"__esModule",{value:!0});var dc=require("fs"),hc=pc(Lt()),ge=hc.default("@kwsites/file-exists");function mc(e,t,r){ge("checking %s",e);try{let n=dc.statSync(e);return n.isFile()&&t?(ge("[OK] path represents a file"),!0):n.isDirectory()&&r?(ge("[OK] path represents a directory"),!0):(ge("[FAIL] path represents something other than a file or directory"),!1)}catch(n){if(n.code==="ENOENT")return ge("[FAIL] path is not accessible: %o",n),!1;throw ge("[FATAL] %o",n),n}}function gc(e,t=q.READABLE){return mc(e,(t&q.FILE)>0,(t&q.FOLDER)>0)}q.exists=gc;q.FILE=1;q.FOLDER=2;q.READABLE=q.FILE+q.FOLDER});var An=w(Qe=>{"use strict";function yc(e){for(var t in e)Qe.hasOwnProperty(t)||(Qe[t]=e[t])}Object.defineProperty(Qe,"__esModule",{value:!0});yc(Fn())});var Bt=w(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.createDeferred=oe.deferred=void 0;function $t(){let e,t,r="pending";return{promise:new Promise((s,i)=>{e=s,t=i}),done(s){r==="pending"&&(r="resolved",e(s))},fail(s){r==="pending"&&(r="rejected",t(s))},get fulfilled(){return r!=="pending"},get status(){return r}}}oe.deferred=$t;oe.createDeferred=$t;oe.default=$t});var So=w((zp,ko)=>{"use strict";var bc=Object.create,lt=Object.defineProperty,_c=Object.getOwnPropertyDescriptor,cr=Object.getOwnPropertyNames,wc=Object.getPrototypeOf,Tc=Object.prototype.hasOwnProperty,l=(e,t)=>function(){return e&&(t=(0,e[cr(e)[0]])(e=0)),t},vc=(e,t)=>function(){return t||(0,e[cr(e)[0]])((t={exports:{}}).exports,t),t.exports},O=(e,t)=>{for(var r in t)lt(e,r,{get:t[r],enumerable:!0})},fs=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of cr(t))!Tc.call(e,s)&&s!==r&&lt(e,s,{get:()=>t[s],enumerable:!(n=_c(t,s))||n.enumerable});return e},Ec=(e,t,r)=>(r=e!=null?bc(wc(e)):{},fs(t||!e||!e.__esModule?lt(r,"default",{value:e,enumerable:!0}):r,e)),S=e=>fs(lt({},"__esModule",{value:!0}),e),K,re=l({"src/lib/errors/git-error.ts"(){"use strict";K=class extends Error{constructor(e,t){super(t),this.task=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),ue,_e=l({"src/lib/errors/git-response-error.ts"(){"use strict";re(),ue=class extends K{constructor(e,t){super(void 0,t||String(e)),this.git=e}}}});function ps(...e){let t=new String(e);return ft.set(t,e),t}function st(e){return e instanceof String&&ft.has(e)}function In(e){return ft.get(e)||[]}var ft,xe=l({"src/lib/args/pathspec.ts"(){"use strict";ft=new WeakMap}}),ur,kc=l({"src/lib/errors/git-construct-error.ts"(){"use strict";re(),ur=class extends K{constructor(e,t){super(void 0,t),this.config=e}}}}),W,Fe=l({"src/lib/errors/git-plugin-error.ts"(){"use strict";re(),W=class extends K{constructor(e,t,r){super(e,r),this.task=e,this.plugin=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),lr,ds=l({"src/lib/errors/task-configuration-error.ts"(){"use strict";re(),lr=class extends K{constructor(e){super(void 0,e)}}}});function hs(e){return typeof e!="function"?le:e}function ms(e){return typeof e=="function"&&e!==le}function gs(e,t){let r=e.indexOf(t);return r<=0?[e,""]:[e.substr(0,r),e.substr(r+1)]}function ys(e,t=0){return bs(e)&&e.length>t?e[t]:void 0}function ce(e,t=0){if(bs(e)&&e.length>t)return e[e.length-1-t]}function bs(e){return mt(e)}function Ae(e="",t=!0,r=`
`){return e.split(r).reduce((n,s)=>{let i=t?s.trim():s;return i&&n.push(i),n},[])}function fr(e,t){return Ae(e,!0).map(r=>t(r))}function pr(e){return(0,Yt.exists)(e,Yt.FOLDER)}function T(e,t){return Array.isArray(e)?e.includes(t)||e.push(t):e.add(t),t}function _s(e,t){return Array.isArray(e)&&!e.includes(t)&&e.push(t),e}function pt(e,t){if(Array.isArray(e)){let r=e.indexOf(t);r>=0&&e.splice(r,1)}else e.delete(t);return t}function Q(e){return Array.isArray(e)?e:[e]}function ws(e){return e.replace(/[\s-]+(.)/g,(t,r)=>r.toUpperCase())}function we(e){return Q(e).map(t=>t instanceof String?t:String(t))}function E(e,t=0){if(e==null)return t;let r=parseInt(e,10);return Number.isNaN(r)?t:r}function Ce(e,t){let r=[];for(let n=0,s=e.length;n<s;n++)r.push(t,e[n]);return r}function Re(e){return(Array.isArray(e)?vs.Buffer.concat(e):e).toString("utf-8")}function Ts(e,t){let r={};return t.forEach(n=>{e[n]!==void 0&&(r[n]=e[n])}),r}function zt(e=0){return new Promise(t=>setTimeout(t,e))}function Wt(e){if(e!==!1)return e}var vs,Yt,be,le,Ie,dt=l({"src/lib/utils/util.ts"(){"use strict";vs=require("node:buffer"),Yt=An(),dr(),be="\0",le=()=>{},Ie=Object.prototype.toString.call.bind(Object.prototype.toString)}});function G(e,t,r){return t(e)?e:arguments.length>2?r:void 0}function Jt(e,t){let r=st(e)?"string":typeof e;return/number|string|boolean/.test(r)&&(!t||!t.includes(r))}function ht(e){return!!e&&Ie(e)==="[object Object]"}function Es(e){return typeof e=="function"}var Me,ks,F,it,mt,dr=l({"src/lib/utils/argument-filters.ts"(){"use strict";xe(),dt(),Me=e=>Array.isArray(e),ks=e=>typeof e=="number",F=e=>typeof e=="string",it=e=>F(e)||Array.isArray(e)&&e.every(F),mt=e=>e==null||"number|boolean|function".includes(typeof e)?!1:typeof e.length=="number"}}),Vt,Sc=l({"src/lib/utils/exit-codes.ts"(){"use strict";Vt=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR",e[e.NOT_FOUND=-2]="NOT_FOUND",e[e.UNCLEAN=128]="UNCLEAN",e))(Vt||{})}}),ot,Oc=l({"src/lib/utils/git-output-streams.ts"(){"use strict";ot=class Ss{constructor(t,r){this.stdOut=t,this.stdErr=r}asStrings(){return new Ss(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function Cc(){throw new Error("LineParser:useMatches not implemented")}var _,te,Rc=l({"src/lib/utils/line-parser.ts"(){"use strict";_=class{constructor(e,t){this.matches=[],this.useMatches=Cc,this.parse=(r,n)=>(this.resetMatches(),this._regExp.every((s,i)=>this.addMatch(s,i,r(i)))?this.useMatches(n,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(e)?e:[e],t&&(this.useMatches=t)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(e,t,r){let n=r&&e.exec(r);return n&&this.pushMatch(t,n),!!n}pushMatch(e,t){this.matches.push(...t.slice(1))}},te=class extends _{addMatch(e,t,r){return/^remote:\s/.test(String(r))&&super.addMatch(e,t,r)}pushMatch(e,t){(e>0||t.length>1)&&super.pushMatch(e,t)}}}});function Os(...e){let t=process.cwd(),r=Object.assign({baseDir:t,...Cs},...e.filter(n=>typeof n=="object"&&n));return r.baseDir=r.baseDir||t,r.trimmed=r.trimmed===!0,r}var Cs,xc=l({"src/lib/utils/simple-git-options.ts"(){"use strict";Cs={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function hr(e,t=[]){return ht(e)?Object.keys(e).reduce((r,n)=>{let s=e[n];if(st(s))r.push(s);else if(Jt(s,["boolean"]))r.push(n+"="+s);else if(Array.isArray(s))for(let i of s)Jt(i,["string","number"])||r.push(n+"="+i);else r.push(n);return r},t):t}function L(e,t=0,r=!1){let n=[];for(let s=0,i=t<0?e.length:t;s<i;s++)"string|number".includes(typeof e[s])&&n.push(String(e[s]));return hr(mr(e),n),r||n.push(...Fc(e)),n}function Fc(e){let t=typeof ce(e)=="function";return we(G(ce(e,t?1:0),Me,[]))}function mr(e){let t=Es(ce(e));return G(ce(e,t?1:0),ht)}function C(e,t=!0){let r=hs(ce(e));return t||ms(r)?r:void 0}var Ac=l({"src/lib/utils/task-options.ts"(){"use strict";dr(),dt(),xe()}});function Kt(e,t){return e(t.stdOut,t.stdErr)}function B(e,t,r,n=!0){return Q(r).forEach(s=>{for(let i=Ae(s,n),o=0,a=i.length;o<a;o++){let c=(f=0)=>{if(!(o+f>=a))return i[o+f]};t.some(({parse:f})=>f(c,e))}}),e}var Ic=l({"src/lib/utils/task-parser.ts"(){"use strict";dt()}}),Rs={};O(Rs,{ExitCodes:()=>Vt,GitOutputStreams:()=>ot,LineParser:()=>_,NOOP:()=>le,NULL:()=>be,RemoteLineParser:()=>te,append:()=>T,appendTaskOptions:()=>hr,asArray:()=>Q,asCamelCase:()=>ws,asFunction:()=>hs,asNumber:()=>E,asStringArray:()=>we,bufferToString:()=>Re,callTaskParser:()=>Kt,createInstanceConfig:()=>Os,delay:()=>zt,filterArray:()=>Me,filterFunction:()=>Es,filterHasLength:()=>mt,filterNumber:()=>ks,filterPlainObject:()=>ht,filterPrimitives:()=>Jt,filterString:()=>F,filterStringOrStringArray:()=>it,filterType:()=>G,first:()=>ys,folderExists:()=>pr,forEachLineWithContent:()=>fr,getTrailingOptions:()=>L,including:()=>_s,isUserFunction:()=>ms,last:()=>ce,objectToString:()=>Ie,orVoid:()=>Wt,parseStringResponse:()=>B,pick:()=>Ts,prefixedArray:()=>Ce,remove:()=>pt,splitOn:()=>gs,toLinesWithContent:()=>Ae,trailingFunctionArgument:()=>C,trailingOptionsArgument:()=>mr});var b=l({"src/lib/utils/index.ts"(){"use strict";dr(),Sc(),Oc(),Rc(),xc(),Ac(),Ic(),dt()}}),xs={};O(xs,{CheckRepoActions:()=>at,checkIsBareRepoTask:()=>As,checkIsRepoRootTask:()=>Fs,checkIsRepoTask:()=>Mc});function Mc(e){switch(e){case"bare":return As();case"root":return Fs()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:gt,parser:gr}}function Fs(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:gt,parser(t){return/^\.(git)?$/.test(t.trim())}}}function As(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:gt,parser:gr}}function Nc(e){return/(Not a git repository|Kein Git-Repository)/i.test(String(e))}var at,gt,gr,Is=l({"src/lib/tasks/check-is-repo.ts"(){"use strict";b(),at=(e=>(e.BARE="bare",e.IN_TREE="tree",e.IS_REPO_ROOT="root",e))(at||{}),gt=({exitCode:e},t,r,n)=>{if(e===128&&Nc(t))return r(Buffer.from("false"));n(t)},gr=e=>e.trim()==="true"}});function Dc(e,t){let r=new Ms(e),n=e?Ds:Ns;return Ae(t).forEach(s=>{let i=s.replace(n,"");r.paths.push(i),(Ps.test(i)?r.folders:r.files).push(i)}),r}var Ms,Ns,Ds,Ps,Pc=l({"src/lib/responses/CleanSummary.ts"(){"use strict";b(),Ms=class{constructor(e){this.dryRun=e,this.paths=[],this.files=[],this.folders=[]}},Ns=/^[a-z]+\s*/i,Ds=/^[a-z]+\s+[a-z]+\s*/i,Ps=/\/$/}}),Qt={};O(Qt,{EMPTY_COMMANDS:()=>yt,adhocExecTask:()=>js,configurationErrorTask:()=>$,isBufferTask:()=>$s,isEmptyTask:()=>Bs,straightThroughBufferTask:()=>Ls,straightThroughStringTask:()=>D});function js(e){return{commands:yt,format:"empty",parser:e}}function $(e){return{commands:yt,format:"empty",parser(){throw typeof e=="string"?new lr(e):e}}}function D(e,t=!1){return{commands:e,format:"utf-8",parser(r){return t?String(r).trim():r}}}function Ls(e){return{commands:e,format:"buffer",parser(t){return t}}}function $s(e){return e.format==="buffer"}function Bs(e){return e.format==="empty"||!e.commands.length}var yt,R=l({"src/lib/tasks/task.ts"(){"use strict";ds(),yt=[]}}),qs={};O(qs,{CONFIG_ERROR_INTERACTIVE_MODE:()=>yr,CONFIG_ERROR_MODE_REQUIRED:()=>br,CONFIG_ERROR_UNKNOWN_OPTION:()=>_r,CleanOptions:()=>Se,cleanTask:()=>Us,cleanWithOptionsTask:()=>jc,isCleanOptionsArray:()=>Lc});function jc(e,t){let{cleanMode:r,options:n,valid:s}=$c(e);return r?s.options?(n.push(...t),n.some(Uc)?$(yr):Us(r,n)):$(_r+JSON.stringify(e)):$(br)}function Us(e,t){return{commands:["clean",`-${e}`,...t],format:"utf-8",parser(n){return Dc(e==="n",n)}}}function Lc(e){return Array.isArray(e)&&e.every(t=>wr.has(t))}function $c(e){let t,r=[],n={cleanMode:!1,options:!0};return e.replace(/[^a-z]i/g,"").split("").forEach(s=>{Bc(s)?(t=s,n.cleanMode=!0):n.options=n.options&&qc(r[r.length]=`-${s}`)}),{cleanMode:t,options:r,valid:n}}function Bc(e){return e==="f"||e==="n"}function qc(e){return/^-[a-z]$/i.test(e)&&wr.has(e.charAt(1))}function Uc(e){return/^-[^\-]/.test(e)?e.indexOf("i")>0:e==="--interactive"}var yr,br,_r,Se,wr,Gs=l({"src/lib/tasks/clean.ts"(){"use strict";Pc(),b(),R(),yr="Git clean interactive mode is not supported",br='Git clean mode parameter ("n" or "f") is required',_r="Git clean unknown option found in: ",Se=(e=>(e.DRY_RUN="n",e.FORCE="f",e.IGNORED_INCLUDED="x",e.IGNORED_ONLY="X",e.EXCLUDING="e",e.QUIET="q",e.RECURSIVE="d",e))(Se||{}),wr=new Set(["i",...we(Object.values(Se))])}});function Gc(e){let t=new Hs;for(let r of Xs(e))t.addValue(r.file,String(r.key),r.value);return t}function Xc(e,t){let r=null,n=[],s=new Map;for(let i of Xs(e,t))i.key===t&&(n.push(r=i.value),s.has(i.file)||s.set(i.file,[]),s.get(i.file).push(r));return{key:t,paths:Array.from(s.keys()),scopes:s,value:r,values:n}}function Hc(e){return e.replace(/^(file):/,"")}function*Xs(e,t=null){let r=e.split("\0");for(let n=0,s=r.length-1;n<s;){let i=Hc(r[n++]),o=r[n++],a=t;if(o.includes(`
`)){let c=gs(o,`
`);a=c[0],o=c[1]}yield{file:i,key:a,value:o}}}var Hs,zc=l({"src/lib/responses/ConfigList.ts"(){"use strict";b(),Hs=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((e,t)=>Object.assign(e,this.values[t]),{})),this._all}addFile(e){if(!(e in this.values)){let t=ce(this.files);this.values[e]=t?Object.create(this.values[t]):{},this.files.push(e)}return this.values[e]}addValue(e,t,r){let n=this.addFile(e);Object.hasOwn(n,t)?Array.isArray(n[t])?n[t].push(r):n[t]=[n[t],r]:n[t]=r,this._all=void 0}}}});function qt(e,t){return typeof e=="string"&&Object.hasOwn(ct,e)?e:t}function Wc(e,t,r,n){let s=["config",`--${n}`];return r&&s.push("--add"),s.push(e,t),{commands:s,format:"utf-8",parser(i){return i}}}function Yc(e,t){let r=["config","--null","--show-origin","--get-all",e];return t&&r.splice(1,0,`--${t}`),{commands:r,format:"utf-8",parser(n){return Xc(n,e)}}}function Jc(e){let t=["config","--list","--show-origin","--null"];return e&&t.push(`--${e}`),{commands:t,format:"utf-8",parser(r){return Gc(r)}}}function Vc(){return{addConfig(e,t,...r){return this._runTask(Wc(e,t,r[0]===!0,qt(r[1],"local")),C(arguments))},getConfig(e,t){return this._runTask(Yc(e,qt(t,void 0)),C(arguments))},listConfig(...e){return this._runTask(Jc(qt(e[0],void 0)),C(arguments))}}}var ct,zs=l({"src/lib/tasks/config.ts"(){"use strict";zc(),b(),ct=(e=>(e.system="system",e.global="global",e.local="local",e.worktree="worktree",e))(ct||{})}});function Kc(e){return Ws.has(e)}var et,Ws,Ys=l({"src/lib/tasks/diff-name-status.ts"(){"use strict";et=(e=>(e.ADDED="A",e.COPIED="C",e.DELETED="D",e.MODIFIED="M",e.RENAMED="R",e.CHANGED="T",e.UNMERGED="U",e.UNKNOWN="X",e.BROKEN="B",e))(et||{}),Ws=new Set(Object.values(et))}});function Js(...e){return new Ks().param(...e)}function Qc(e){let t=new Set,r={};return fr(e,n=>{let[s,i,o]=n.split(be);t.add(s),(r[s]=r[s]||[]).push({line:E(i),path:s,preview:o})}),{paths:t,results:r}}function Zc(){return{grep(e){let t=C(arguments),r=L(arguments);for(let s of Vs)if(r.includes(s))return this._runTask($(`git.grep: use of "${s}" is not supported.`),t);typeof e=="string"&&(e=Js().param(e));let n=["grep","--null","-n","--full-name",...r,...e];return this._runTask({commands:n,format:"utf-8",parser(s){return Qc(s)}},t)}}}var Vs,ke,Mn,Ks,Qs=l({"src/lib/tasks/grep.ts"(){"use strict";b(),R(),Vs=["-h"],ke=Symbol("grepQuery"),Ks=class{constructor(){this[Mn]=[]}*[(Mn=ke,Symbol.iterator)](){for(let e of this[ke])yield e}and(...e){return e.length&&this[ke].push("--and","(",...Ce(e,"-e"),")"),this}param(...e){return this[ke].push(...Ce(e,"-e")),this}}}}),Zs={};O(Zs,{ResetMode:()=>Oe,getResetMode:()=>tu,resetTask:()=>eu});function eu(e,t){let r=["reset"];return ei(e)&&r.push(`--${e}`),r.push(...t),D(r)}function tu(e){if(ei(e))return e;switch(typeof e){case"string":case"undefined":return"soft"}}function ei(e){return typeof e=="string"&&ti.includes(e)}var Oe,ti,ri=l({"src/lib/tasks/reset.ts"(){"use strict";b(),R(),Oe=(e=>(e.MIXED="mixed",e.SOFT="soft",e.HARD="hard",e.MERGE="merge",e.KEEP="keep",e))(Oe||{}),ti=we(Object.values(Oe))}}),ni={};O(ni,{CheckRepoActions:()=>at,CleanOptions:()=>Se,DiffNameStatus:()=>et,GitConfigScope:()=>ct,GitConstructError:()=>ur,GitError:()=>K,GitPluginError:()=>W,GitResponseError:()=>ue,ResetMode:()=>Oe,TaskConfigurationError:()=>lr,grepQueryBuilder:()=>Js,pathspec:()=>ps});var ru=l({"src/lib/api.ts"(){"use strict";xe(),kc(),re(),Fe(),_e(),ds(),Is(),Gs(),zs(),Ys(),Qs(),ri()}});function nu(e){return e?[{type:"spawn.before",action(n,s){e.aborted&&s.kill(new W(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(n,s){function i(){s.kill(new W(void 0,"abort","Abort signal received"))}e.addEventListener("abort",i),s.spawned.on("close",()=>e.removeEventListener("abort",i))}}]:void 0}var su=l({"src/lib/plugins/abort-plugin.ts"(){"use strict";Fe()}});function iu(e){return typeof e=="string"&&e.trim().toLowerCase()==="-c"}function ou(e,t){if(iu(e)&&/^\s*protocol(.[a-z]+)?.allow/.test(t))throw new W(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function au(e,t){if(/^\s*--(upload|receive)-pack/.test(e))throw new W(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(t==="clone"&&/^\s*-u\b/.test(e))throw new W(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(t==="push"&&/^\s*--exec\b/.test(e))throw new W(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function cu({allowUnsafeProtocolOverride:e=!1,allowUnsafePack:t=!1}={}){return{type:"spawn.args",action(r,n){return r.forEach((s,i)=>{let o=i<r.length?r[i+1]:"";e||ou(s,o),t||au(s,n.method)}),r}}}var uu=l({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";Fe()}});function lu(e){let t=Ce(e,"-c");return{type:"spawn.args",action(r){return[...t,...r]}}}var fu=l({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";b()}});function pu({onClose:e=!0,onExit:t=50}={}){function r(){let s=-1,i={close:(0,ye.deferred)(),closeTimeout:(0,ye.deferred)(),exit:(0,ye.deferred)(),exitTimeout:(0,ye.deferred)()},o=Promise.race([e===!1?Zt:i.closeTimeout.promise,t===!1?Zt:i.exitTimeout.promise]);return n(e,i.close,i.closeTimeout),n(t,i.exit,i.exitTimeout),{close(a){s=a,i.close.done()},exit(a){s=a,i.exit.done()},get exitCode(){return s},result:o}}function n(s,i,o){s!==!1&&(s===!0?i.promise:i.promise.then(()=>zt(s))).then(o.done)}return{type:"spawn.after",async action(s,{spawned:i,close:o}){let a=r(),c=!0,f=()=>void(c=!1);i.stdout?.on("data",f),i.stderr?.on("data",f),i.on("error",f),i.on("close",u=>a.close(u)),i.on("exit",u=>a.exit(u));try{await a.result,c&&await zt(50),o(a.exitCode)}catch(u){o(a.exitCode,u)}}}}var ye,Zt,du=l({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";ye=Bt(),b(),Zt=(0,ye.deferred)().promise}});function hu(e){return!e||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(e)}function Nn(e,t){if(e.length<1||e.length>2)throw new W(void 0,"binary",si);if(e.some(hu))if(t)console.warn(er);else throw new W(void 0,"binary",er);let[n,s]=e;return{binary:n,prefix:s}}function mu(e,t=["git"],r=!1){let n=Nn(Q(t),r);e.on("binary",s=>{n=Nn(Q(s),r)}),e.append("spawn.binary",()=>n.binary),e.append("spawn.args",s=>n.prefix?[n.prefix,...s]:s)}var si,er,gu=l({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";Fe(),b(),si="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",er="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function yu(e){return!!(e.exitCode&&e.stdErr.length)}function bu(e){return Buffer.concat([...e.stdOut,...e.stdErr])}function _u(e=!1,t=yu,r=bu){return(n,s)=>!e&&n||!t(s)?n:r(s)}function Dn(e){return{type:"task.error",action(t,r){let n=e(t.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(n)?{error:new K(void 0,n.toString("utf-8"))}:{error:n}}}}var wu=l({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";re()}}),Pn,ii,Tu=l({"src/lib/plugins/plugin-store.ts"(){"use strict";Pn=require("node:events"),b(),ii=class{constructor(){this.plugins=new Set,this.events=new Pn.EventEmitter}on(e,t){this.events.on(e,t)}reconfigure(e,t){this.events.emit(e,t)}append(e,t){let r=T(this.plugins,{type:e,action:t});return()=>this.plugins.delete(r)}add(e){let t=[];return Q(e).forEach(r=>r&&this.plugins.add(T(t,r))),()=>{t.forEach(r=>this.plugins.delete(r))}}exec(e,t,r){let n=t,s=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===e&&(n=i.action(n,s));return n}}}});function vu(e){let t="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?_s(i,t):i}},{type:"spawn.after",action(i,o){o.commands.includes(t)&&o.spawned.stderr?.on("data",a=>{let c=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));c&&e({method:o.method,stage:Eu(c[1]),progress:E(c[2]),processed:E(c[3]),total:E(c[4])})})}}]}function Eu(e){return String(e.toLowerCase().split(" ",1))||"unknown"}var ku=l({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";b()}}),Su=l({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function Ou(e){let t=Ts(e,["uid","gid"]);return{type:"spawn.options",action(r){return{...t,...r}}}}var Cu=l({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";b()}});function Ru({block:e,stdErr:t=!0,stdOut:r=!0}){if(e>0)return{type:"spawn.after",action(n,s){let i;function o(){i&&clearTimeout(i),i=setTimeout(c,e)}function a(){s.spawned.stdout?.off("data",o),s.spawned.stderr?.off("data",o),s.spawned.off("exit",a),s.spawned.off("close",a),i&&clearTimeout(i)}function c(){a(),s.kill(new W(void 0,"timeout","block timeout reached"))}r&&s.spawned.stdout?.on("data",o),t&&s.spawned.stderr?.on("data",o),s.spawned.on("exit",a),s.spawned.on("close",a),o()}}}var xu=l({"src/lib/plugins/timout-plugin.ts"(){"use strict";Fe()}}),Fu=l({"src/lib/plugins/index.ts"(){"use strict";su(),uu(),fu(),du(),gu(),wu(),Tu(),ku(),Su(),Cu(),xu()}});function Au(){return{type:"spawn.args",action(e){let t=[],r;function n(s){(r=r||[]).push(...s)}for(let s=0;s<e.length;s++){let i=e[s];if(st(i)){n(In(i));continue}if(i==="--"){n(e.slice(s+1).flatMap(o=>st(o)&&In(o)||o));break}t.push(i)}return r?[...t,"--",...r.map(String)]:t}}}var Iu=l({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";xe()}});function Mu(){return(0,tt.default)("simple-git")}function jn(e,t,r){return!t||!String(t).replace(/\s*/,"")?r?(n,...s)=>{e(n,...s),r(n,...s)}:e:(n,...s)=>{e(`%s ${n}`,t,...s),r&&r(n,...s)}}function Nu(e,t,{namespace:r}){if(typeof e=="string")return e;let n=t&&t.namespace||"";return n.startsWith(r)?n.substr(r.length+1):n||r}function Tr(e,t,r,n=Mu()){let s=e&&`[${e}]`||"",i=[],o=typeof t=="string"?n.extend(t):t,a=Nu(G(t,F),o,n);return f(r);function c(u,d){return T(i,Tr(e,a.replace(/^[^:]+/,u),d,n))}function f(u){let d=u&&`[${u}]`||"",m=o&&jn(o,d)||le,h=jn(n,`${s} ${d}`,m);return Object.assign(o?m:h,{label:e,sibling:c,info:h,step:f})}}var tt,oi=l({"src/lib/git-logger.ts"(){"use strict";tt=Ec(Lt()),b(),tt.default.formatters.L=e=>String(mt(e)?e.length:"-"),tt.default.formatters.B=e=>Buffer.isBuffer(e)?e.toString("utf8"):Ie(e)}}),ai,Du=l({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";re(),oi(),ai=class tr{constructor(t="GitExecutor"){this.logLabel=t,this._queue=new Map}withProgress(t){return this._queue.get(t)}createProgress(t){let r=tr.getName(t.commands[0]),n=Tr(this.logLabel,r);return{task:t,logger:n,name:r}}push(t){let r=this.createProgress(t);return r.logger("Adding task to the queue, commands = %o",t.commands),this._queue.set(t,r),r}fatal(t){for(let[r,{logger:n}]of Array.from(this._queue.entries()))r===t.task?(n.info("Failed %o",t),n("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):n.info("A fatal exception occurred in a previous task, the queue has been purged: %o",t.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(t){this.withProgress(t)&&this._queue.delete(t)}attempt(t){let r=this.withProgress(t);if(!r)throw new K(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(t="empty"){return`task:${t}:${++tr.counter}`}static{this.counter=0}}}});function ae(e,t){return{method:ys(e.commands)||"",commands:t}}function Pu(e,t){return r=>{t("[ERROR] child process exception %o",r),e.push(Buffer.from(String(r.stack),"ascii"))}}function Ln(e,t,r,n){return s=>{r("%s received %L bytes",t,s),n("%B",s),e.push(s)}}var $n,rr,ju=l({"src/lib/runners/git-executor-chain.ts"(){"use strict";$n=require("child_process"),re(),R(),b(),Du(),rr=class{constructor(e,t,r){this._executor=e,this._scheduler=t,this._plugins=r,this._chain=Promise.resolve(),this._queue=new ai}get cwd(){return this._cwd||this._executor.cwd}set cwd(e){this._cwd=e}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(e){return this._queue.push(e),this._chain=this._chain.then(()=>this.attemptTask(e))}async attemptTask(e){let t=await this._scheduler.next(),r=()=>this._queue.complete(e);try{let{logger:n}=this._queue.attempt(e);return await(Bs(e)?this.attemptEmptyTask(e,n):this.attemptRemoteTask(e,n))}catch(n){throw this.onFatalException(e,n)}finally{r(),t()}}onFatalException(e,t){let r=t instanceof K?Object.assign(t,{task:e}):new K(e,t&&String(t));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(e,t){let r=this._plugins.exec("spawn.binary","",ae(e,e.commands)),n=this._plugins.exec("spawn.args",[...e.commands],ae(e,e.commands)),s=await this.gitResponse(e,r,n,this.outputHandler,t.step("SPAWN")),i=await this.handleTaskData(e,n,s,t.step("HANDLE"));return t("passing response to task's parser as a %s",e.format),$s(e)?Kt(e.parser,i):Kt(e.parser,i.asStrings())}async attemptEmptyTask(e,t){return t("empty task bypassing child process to call to task's parser"),e.parser(this)}handleTaskData(e,t,r,n){let{exitCode:s,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((c,f)=>{n("Preparing to handle process response exitCode=%d stdOut=",s);let{error:u}=this._plugins.exec("task.error",{error:i},{...ae(e,t),...r});if(u&&e.onError)return n.info("exitCode=%s handling with custom error handler"),e.onError(r,u,d=>{n.info("custom error handler treated as success"),n("custom error returned a %s",Ie(d)),c(new ot(Array.isArray(d)?Buffer.concat(d):d,Buffer.concat(a)))},f);if(u)return n.info("handling as error: exitCode=%s stdErr=%s rejection=%o",s,a.length,i),f(u);n.info("retrieving task output complete"),c(new ot(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(e,t,r,n,s){let i=s.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},ae(e,e.commands));return new Promise(a=>{let c=[],f=[];s.info("%s %o",t,r),s("%O",o);let u=this._beforeSpawn(e,r);if(u)return a({stdOut:c,stdErr:f,exitCode:9901,rejection:u});this._plugins.exec("spawn.before",void 0,{...ae(e,r),kill(m){u=m||u}});let d=(0,$n.spawn)(t,r,o);d.stdout.on("data",Ln(c,"stdOut",s,i.step("stdOut"))),d.stderr.on("data",Ln(f,"stdErr",s,i.step("stdErr"))),d.on("error",Pu(f,s)),n&&(s("Passing child process stdOut/stdErr to custom outputHandler"),n(t,d.stdout,d.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...ae(e,r),spawned:d,close(m,h){a({stdOut:c,stdErr:f,exitCode:m,rejection:u||h})},kill(m){d.killed||(u=m,d.kill("SIGINT"))}})})}_beforeSpawn(e,t){let r;return this._plugins.exec("spawn.before",void 0,{...ae(e,t),kill(n){r=n||r}}),r}}}}),ci={};O(ci,{GitExecutor:()=>ui});var ui,Lu=l({"src/lib/runners/git-executor.ts"(){"use strict";ju(),ui=class{constructor(e,t,r){this.cwd=e,this._scheduler=t,this._plugins=r,this._chain=new rr(this,this._scheduler,this._plugins)}chain(){return new rr(this,this._scheduler,this._plugins)}push(e){return this._chain.push(e)}}}});function $u(e,t,r=le){let n=i=>{r(null,i)},s=i=>{i?.task===e&&r(i instanceof ue?Bu(i):i,void 0)};t.then(n,s)}function Bu(e){let t=n=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${n} should be GitResponseError.git.${n}, this will no longer be available in version 3`),t=le};return Object.create(e,Object.getOwnPropertyNames(e.git).reduce(r,{}));function r(n,s){return s in e||(n[s]={enumerable:!1,configurable:!1,get(){return t(s),e.git[s]}}),n}}var qu=l({"src/lib/task-callback.ts"(){"use strict";_e(),b()}});function Bn(e,t){return js(r=>{if(!pr(e))throw new Error(`Git.cwd: cannot change to non-directory "${e}"`);return(t||r).cwd=e})}var Uu=l({"src/lib/tasks/change-working-directory.ts"(){"use strict";b(),R()}});function Ut(e){let t=["checkout",...e];return t[1]==="-b"&&t.includes("-B")&&(t[1]=pt(t,"-B")),D(t)}function Gu(){return{checkout(){return this._runTask(Ut(L(arguments,1)),C(arguments))},checkoutBranch(e,t){return this._runTask(Ut(["-b",e,t,...L(arguments)]),C(arguments))},checkoutLocalBranch(e){return this._runTask(Ut(["-b",e,...L(arguments)]),C(arguments))}}}var Xu=l({"src/lib/tasks/checkout.ts"(){"use strict";b(),R()}});function Hu(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function zu(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(e){return B(Hu(),[li],e)}})}}}var li,Wu=l({"src/lib/tasks/count-objects.ts"(){"use strict";b(),li=new _(/([a-z-]+): (\d+)$/,(e,[t,r])=>{let n=ws(t);Object.hasOwn(e,n)&&(e[n]=E(r))})}});function Yu(e){return B({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},fi,e)}var fi,Ju=l({"src/lib/parsers/parse-commit.ts"(){"use strict";b(),fi=[new _(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(e,[t,r,n])=>{e.branch=t,e.commit=n,e.root=!!r}),new _(/\s*Author:\s(.+)/i,(e,[t])=>{let r=t.split("<"),n=r.pop();!n||!n.includes("@")||(e.author={email:n.substr(0,n.length-1),name:r.join("<").trim()})}),new _(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0,e.summary.insertions=parseInt(r,10)||0,e.summary.deletions=parseInt(n,10)||0}),new _(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0;let s=parseInt(r,10)||0;n==="-"?e.summary.deletions=s:n==="+"&&(e.summary.insertions=s)})]}});function Vu(e,t,r){return{commands:["-c","core.abbrev=40","commit",...Ce(e,"-m"),...t,...r],format:"utf-8",parser:Yu}}function Ku(){return{commit(t,...r){let n=C(arguments),s=e(t)||Vu(Q(t),Q(G(r[0],it,[])),[...we(G(r[1],Me,[])),...L(arguments,0,!0)]);return this._runTask(s,n)}};function e(t){return!it(t)&&$("git.commit: requires the commit message to be supplied as a string/string[]")}}var Qu=l({"src/lib/tasks/commit.ts"(){"use strict";Ju(),b(),R()}});function Zu(){return{firstCommit(){return this._runTask(D(["rev-list","--max-parents=0","HEAD"],!0),C(arguments))}}}var el=l({"src/lib/tasks/first-commit.ts"(){"use strict";b(),R()}});function tl(e,t){let r=["hash-object",e];return t&&r.push("-w"),D(r,!0)}var rl=l({"src/lib/tasks/hash-object.ts"(){"use strict";R()}});function nl(e,t,r){let n=String(r).trim(),s;if(s=pi.exec(n))return new rt(e,t,!1,s[1]);if(s=di.exec(n))return new rt(e,t,!0,s[1]);let i="",o=n.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new rt(e,t,/^re/i.test(n),i)}var rt,pi,di,sl=l({"src/lib/responses/InitSummary.ts"(){"use strict";rt=class{constructor(e,t,r,n){this.bare=e,this.path=t,this.existing=r,this.gitDir=n}},pi=/^Init.+ repository in (.+)$/,di=/^Rein.+ in (.+)$/}});function il(e){return e.includes(vr)}function ol(e=!1,t,r){let n=["init",...r];return e&&!il(n)&&n.splice(1,0,vr),{commands:n,format:"utf-8",parser(s){return nl(n.includes("--bare"),t,s)}}}var vr,al=l({"src/lib/tasks/init.ts"(){"use strict";sl(),vr="--bare"}});function Er(e){for(let t=0;t<e.length;t++){let r=kr.exec(e[t]);if(r)return`--${r[1]}`}return""}function cl(e){return kr.test(e)}var kr,Ne=l({"src/lib/args/log-format.ts"(){"use strict";kr=/^--(stat|numstat|name-only|name-status)(=|$)/}}),hi,ul=l({"src/lib/responses/DiffSummary.ts"(){"use strict";hi=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function mi(e=""){let t=gi[e];return r=>B(new hi,t,r,!1)}var Gt,qn,Un,Gn,gi,yi=l({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Ne(),ul(),Ys(),b(),Gt=[new _(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(e,[t,r,n=""])=>{e.files.push({file:t.trim(),changes:E(r),insertions:n.replace(/[^+]/g,"").length,deletions:n.replace(/[^-]/g,"").length,binary:!1})}),new _(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(e,[t,r,n])=>{e.files.push({file:t.trim(),before:E(r),after:E(n),binary:!0})}),new _(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(e,[t,r])=>{let n=/(\d+) i/.exec(r),s=/(\d+) d/.exec(r);e.changed=E(t),e.insertions=E(n?.[1]),e.deletions=E(s?.[1])})],qn=[new _(/(\d+)\t(\d+)\t(.+)$/,(e,[t,r,n])=>{let s=E(t),i=E(r);e.changed++,e.insertions+=s,e.deletions+=i,e.files.push({file:n,changes:s+i,insertions:s,deletions:i,binary:!1})}),new _(/-\t-\t(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,after:0,before:0,binary:!0})})],Un=[new _(/(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,changes:0,insertions:0,deletions:0,binary:!1})})],Gn=[new _(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(e,[t,r,n,s,i])=>{e.changed++,e.files.push({file:i??n,changes:0,insertions:0,deletions:0,binary:!1,status:Wt(Kc(t)&&t),from:Wt(!!i&&n!==i&&n),similarity:E(r)})})],gi={"":Gt,"--stat":Gt,"--numstat":qn,"--name-status":Gn,"--name-only":Un}}});function ll(e,t){return t.reduce((r,n,s)=>(r[n]=e[s]||"",r),Object.create({diff:null}))}function bi(e=Cr,t=_i,r=""){let n=mi(r);return function(s){let i=Ae(s.trim(),!1,Sr).map(function(o){let a=o.split(Or),c=ll(a[0].split(e),t);return a.length>1&&a[1].trim()&&(c.diff=n(a[1])),c});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var Sr,Or,Cr,_i,wi=l({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";b(),yi(),Ne(),Sr="\xF2\xF2\xF2\xF2\xF2\xF2 ",Or=" \xF2\xF2",Cr=" \xF2 ",_i=["hash","date","message","refs","author_name","author_email"]}}),Ti={};O(Ti,{diffSummaryTask:()=>fl,validateLogFormatConfig:()=>bt});function fl(e){let t=Er(e),r=["diff"];return t===""&&(t="--stat",r.push("--stat=4096")),r.push(...e),bt(r)||{commands:r,format:"utf-8",parser:mi(t)}}function bt(e){let t=e.filter(cl);if(t.length>1)return $(`Summary flags are mutually exclusive - pick one of ${t.join(",")}`);if(t.length&&e.includes("-z"))return $(`Summary flag ${t} parsing is not compatible with null termination option '-z'`)}var Rr=l({"src/lib/tasks/diff.ts"(){"use strict";Ne(),yi(),R()}});function pl(e,t){let r=[],n=[];return Object.keys(e).forEach(s=>{r.push(s),n.push(String(e[s]))}),[r,n.join(t)]}function dl(e){return Object.keys(e).reduce((t,r)=>(r in nr||(t[r]=e[r]),t),{})}function vi(e={},t=[]){let r=G(e.splitter,F,Cr),n=ht(e.format)?e.format:{hash:"%H",date:e.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:e.multiLine?"%B":"%b",author_name:e.mailMap!==!1?"%aN":"%an",author_email:e.mailMap!==!1?"%aE":"%ae"},[s,i]=pl(n,r),o=[],a=[`--pretty=format:${Sr}${i}${Or}`,...t],c=e.n||e["max-count"]||e.maxCount;if(c&&a.push(`--max-count=${c}`),e.from||e.to){let f=e.symmetric!==!1?"...":"..";o.push(`${e.from||""}${f}${e.to||""}`)}return F(e.file)&&a.push("--follow",ps(e.file)),hr(dl(e),a),{fields:s,splitter:r,commands:[...a,...o]}}function hl(e,t,r){let n=bi(e,t,Er(r));return{commands:["log",...r],format:"utf-8",parser:n}}function ml(){return{log(...r){let n=C(arguments),s=vi(mr(arguments),we(G(arguments[0],Me,[]))),i=t(...r)||bt(s.commands)||e(s);return this._runTask(i,n)}};function e(r){return hl(r.splitter,r.fields,r.commands)}function t(r,n){return F(r)&&F(n)&&$("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var nr,Ei=l({"src/lib/tasks/log.ts"(){"use strict";Ne(),xe(),wi(),b(),R(),Rr(),nr=(e=>(e[e["--pretty"]=0]="--pretty",e[e["max-count"]=1]="max-count",e[e.maxCount=2]="maxCount",e[e.n=3]="n",e[e.file=4]="file",e[e.format=5]="format",e[e.from=6]="from",e[e.to=7]="to",e[e.splitter=8]="splitter",e[e.symmetric=9]="symmetric",e[e.mailMap=10]="mailMap",e[e.multiLine=11]="multiLine",e[e.strictDate=12]="strictDate",e))(nr||{})}}),nt,ki,gl=l({"src/lib/responses/MergeSummary.ts"(){"use strict";nt=class{constructor(e,t=null,r){this.reason=e,this.file=t,this.meta=r}toString(){return`${this.file}:${this.reason}`}},ki=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),sr,Si,yl=l({"src/lib/responses/PullSummary.ts"(){"use strict";sr=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},Si=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function Xt(e){return e.objects=e.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function Xn(e){let t=/^\s*(\d+)/.exec(e),r=/delta (\d+)/i.exec(e);return{count:E(t&&t[1]||"0"),delta:E(r&&r[1]||"0")}}var Oi,bl=l({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";b(),Oi=[new te(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=Xt(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new te(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=Xt(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new te(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(e,[t,r,n])=>{let s=Xt(e.remoteMessages);s.total=Xn(t),s.reused=Xn(r),s.packReused=E(n)})]}});function Ci(e,t){return B({remoteMessages:new xi},Ri,t)}var Ri,xi,Fi=l({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";b(),bl(),Ri=[new te(/^remote:\s*(.+)$/,(e,[t])=>(e.remoteMessages.all.push(t.trim()),!1)),...Oi,new te([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(e,[t])=>{e.remoteMessages.pullRequestUrl=t}),new te([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(e,[t,r,n])=>{e.remoteMessages.vulnerabilities={count:E(t),summary:r,url:n}})],xi=class{constructor(){this.all=[]}}}});function _l(e,t){let r=B(new Si,Ai,[e,t]);return r.message&&r}var Hn,zn,Wn,Yn,Ai,Jn,xr,Ii=l({"src/lib/parsers/parse-pull.ts"(){"use strict";yl(),b(),Fi(),Hn=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,zn=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,Wn=/^(create|delete) mode \d+ (.+)/,Yn=[new _(Hn,(e,[t,r,n])=>{e.files.push(t),r&&(e.insertions[t]=r.length),n&&(e.deletions[t]=n.length)}),new _(zn,(e,[t,,r,,n])=>r!==void 0||n!==void 0?(e.summary.changes=+t||0,e.summary.insertions=+r||0,e.summary.deletions=+n||0,!0):!1),new _(Wn,(e,[t,r])=>{T(e.files,r),T(t==="create"?e.created:e.deleted,r)})],Ai=[new _(/^from\s(.+)$/i,(e,[t])=>void(e.remote=t)),new _(/^fatal:\s(.+)$/,(e,[t])=>void(e.message=t)),new _(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(e,[t,r,n,s])=>{e.branch.local=n,e.hash.local=t,e.branch.remote=s,e.hash.remote=r})],Jn=(e,t)=>B(new sr,Yn,[e,t]),xr=(e,t)=>Object.assign(new sr,Jn(e,t),Ci(e,t))}}),Vn,Mi,Kn,wl=l({"src/lib/parsers/parse-merge.ts"(){"use strict";gl(),b(),Ii(),Vn=[new _(/^Auto-merging\s+(.+)$/,(e,[t])=>{e.merges.push(t)}),new _(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(e,[t,r])=>{e.conflicts.push(new nt(t,r))}),new _(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(e,[t,r,n])=>{e.conflicts.push(new nt(t,r,{deleteRef:n}))}),new _(/^CONFLICT\s+\((.+)\):/,(e,[t])=>{e.conflicts.push(new nt(t,null))}),new _(/^Automatic merge failed;\s+(.+)$/,(e,[t])=>{e.result=t})],Mi=(e,t)=>Object.assign(Kn(e,t),xr(e,t)),Kn=e=>B(new ki,Vn,e)}});function Qn(e){return e.length?{commands:["merge",...e],format:"utf-8",parser(t,r){let n=Mi(t,r);if(n.failed)throw new ue(n);return n}}:$("Git.merge requires at least one option")}var Tl=l({"src/lib/tasks/merge.ts"(){"use strict";_e(),wl(),R()}});function vl(e,t,r){let n=r.includes("deleted"),s=r.includes("tag")||/^refs\/tags/.test(e),i=!r.includes("new");return{deleted:n,tag:s,branch:!s,new:!i,alreadyUpdated:i,local:e,remote:t}}var Zn,Ni,es,El=l({"src/lib/parsers/parse-push.ts"(){"use strict";b(),Fi(),Zn=[new _(/^Pushing to (.+)$/,(e,[t])=>{e.repo=t}),new _(/^updating local tracking ref '(.+)'/,(e,[t])=>{e.ref={...e.ref||{},local:t}}),new _(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(e,[t,r,n])=>{e.pushed.push(vl(t,r,n))}),new _(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(e,[t,r,n])=>{e.branch={...e.branch||{},local:t,remote:r,remoteName:n}}),new _(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(e,[t,r,n,s])=>{e.update={head:{local:t,remote:r},hash:{from:n,to:s}}})],Ni=(e,t)=>{let r=es(e,t),n=Ci(e,t);return{...r,...n}},es=(e,t)=>B({pushed:[]},Zn,[e,t])}}),Di={};O(Di,{pushTagsTask:()=>kl,pushTask:()=>Fr});function kl(e={},t){return T(t,"--tags"),Fr(e,t)}function Fr(e={},t){let r=["push",...t];return e.branch&&r.splice(1,0,e.branch),e.remote&&r.splice(1,0,e.remote),pt(r,"-v"),T(r,"--verbose"),T(r,"--porcelain"),{commands:r,format:"utf-8",parser:Ni}}var Pi=l({"src/lib/tasks/push.ts"(){"use strict";El(),b()}});function Sl(){return{showBuffer(){let e=["show",...L(arguments,1)];return e.includes("--binary")||e.splice(1,0,"--binary"),this._runTask(Ls(e),C(arguments))},show(){let e=["show",...L(arguments,1)];return this._runTask(D(e),C(arguments))}}}var Ol=l({"src/lib/tasks/show.ts"(){"use strict";b(),R()}}),ts,ji,Cl=l({"src/lib/responses/FileStatusSummary.ts"(){"use strict";ts=/^(.+)\0(.+)$/,ji=class{constructor(e,t,r){if(this.path=e,this.index=t,this.working_dir=r,t==="R"||r==="R"){let n=ts.exec(e)||[null,e,e];this.from=n[2]||"",this.path=n[1]||""}}}}});function rs(e){let[t,r]=e.split(be);return{from:r||t,to:t}}function U(e,t,r){return[`${e}${t}`,r]}function Ht(e,...t){return t.map(r=>U(e,r,(n,s)=>T(n.conflicted,s)))}function Rl(e,t){let r=t.trim();switch(" "){case r.charAt(2):return n(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return n(" ",r.charAt(0),r.substr(2));default:return}function n(s,i,o){let a=`${s}${i}`,c=Li.get(a);c&&c(e,o),a!=="##"&&a!=="!!"&&e.files.push(new ji(o,s,i))}}var ns,Li,$i,xl=l({"src/lib/responses/StatusSummary.ts"(){"use strict";b(),Cl(),ns=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},Li=new Map([U(" ","A",(e,t)=>T(e.created,t)),U(" ","D",(e,t)=>T(e.deleted,t)),U(" ","M",(e,t)=>T(e.modified,t)),U("A"," ",(e,t)=>T(e.created,t)&&T(e.staged,t)),U("A","M",(e,t)=>T(e.created,t)&&T(e.staged,t)&&T(e.modified,t)),U("D"," ",(e,t)=>T(e.deleted,t)&&T(e.staged,t)),U("M"," ",(e,t)=>T(e.modified,t)&&T(e.staged,t)),U("M","M",(e,t)=>T(e.modified,t)&&T(e.staged,t)),U("R"," ",(e,t)=>{T(e.renamed,rs(t))}),U("R","M",(e,t)=>{let r=rs(t);T(e.renamed,r),T(e.modified,r.to)}),U("!","!",(e,t)=>{T(e.ignored=e.ignored||[],t)}),U("?","?",(e,t)=>T(e.not_added,t)),...Ht("A","A","U"),...Ht("D","D","U"),...Ht("U","A","D","U"),["##",(e,t)=>{let r=/ahead (\d+)/,n=/behind (\d+)/,s=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(t);e.ahead=a&&+a[1]||0,a=n.exec(t),e.behind=a&&+a[1]||0,a=s.exec(t),e.current=G(a?.[1],F,null),a=i.exec(t),e.tracking=G(a?.[1],F,null),a=o.exec(t),a&&(e.current=G(a?.[1],F,e.current)),e.detached=/\(no branch\)/.test(t)}]]),$i=function(e){let t=e.split(be),r=new ns;for(let n=0,s=t.length;n<s;){let i=t[n++].trim();i&&(i.charAt(0)==="R"&&(i+=be+(t[n++]||"")),Rl(r,i))}return r}}});function Fl(e){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...e.filter(r=>!Bi.includes(r))],parser(r){return $i(r)}}}var Bi,Al=l({"src/lib/tasks/status.ts"(){"use strict";xl(),Bi=["--null","-z"]}});function ut(e=0,t=0,r=0,n="",s=!0){return Object.defineProperty({major:e,minor:t,patch:r,agent:n,installed:s},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function Il(){return ut(0,0,0,"",!1)}function Ml(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:Nl,onError(e,t,r,n){if(e.exitCode===-2)return r(Buffer.from(Ar));n(t)}})}}}function Nl(e){return e===Ar?Il():B(ut(0,0,0,e),qi,e)}var Ar,qi,Dl=l({"src/lib/tasks/version.ts"(){"use strict";b(),Ar="installed=false",qi=[new _(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(e,[t,r,n,s=""])=>{Object.assign(e,ut(E(t),E(r),E(n),s))}),new _(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(e,[t,r,n,s=""])=>{Object.assign(e,ut(E(t),E(r),n,s))})]}}),Ui={};O(Ui,{SimpleGitApi:()=>ir});var ir,Pl=l({"src/lib/simple-git-api.ts"(){"use strict";qu(),Uu(),Xu(),Wu(),Qu(),zs(),el(),Qs(),rl(),al(),Ei(),Tl(),Pi(),Ol(),Al(),R(),Dl(),b(),ir=class{constructor(e){this._executor=e}_runTask(e,t){let r=this._executor.chain(),n=r.push(e);return t&&$u(e,n,t),Object.create(this,{then:{value:n.then.bind(n)},catch:{value:n.catch.bind(n)},_executor:{value:r}})}add(e){return this._runTask(D(["add",...Q(e)]),C(arguments))}cwd(e){let t=C(arguments);return typeof e=="string"?this._runTask(Bn(e,this._executor),t):typeof e?.path=="string"?this._runTask(Bn(e.path,e.root&&this._executor||void 0),t):this._runTask($("Git.cwd: workingDirectory must be supplied as a string"),t)}hashObject(e,t){return this._runTask(tl(e,t===!0),C(arguments))}init(e){return this._runTask(ol(e===!0,this._executor.cwd,L(arguments)),C(arguments))}merge(){return this._runTask(Qn(L(arguments)),C(arguments))}mergeFromTo(e,t){return F(e)&&F(t)?this._runTask(Qn([e,t,...L(arguments)]),C(arguments,!1)):this._runTask($("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(e){return this._executor.outputHandler=e,this}push(){let e=Fr({remote:G(arguments[0],F),branch:G(arguments[1],F)},L(arguments));return this._runTask(e,C(arguments))}stash(){return this._runTask(D(["stash",...L(arguments)]),C(arguments))}status(){return this._runTask(Fl(L(arguments)),C(arguments))}},Object.assign(ir.prototype,Gu(),Ku(),Vc(),zu(),Zu(),Zc(),ml(),Sl(),Ml())}}),Gi={};O(Gi,{Scheduler:()=>Xi});var ss,is,Xi,jl=l({"src/lib/runners/scheduler.ts"(){"use strict";b(),ss=Bt(),oi(),is=(()=>{let e=0;return()=>{e++;let{promise:t,done:r}=(0,ss.createDeferred)();return{promise:t,done:r,id:e}}})(),Xi=class{constructor(e=2){this.concurrency=e,this.logger=Tr("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",e)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let e=T(this.running,this.pending.shift());this.logger("Attempting id=%s",e.id),e.done(()=>{this.logger("Completing id=",e.id),pt(this.running,e),this.schedule()})}next(){let{promise:e,id:t}=T(this.pending,is());return this.logger("Scheduling id=%s",t),this.schedule(),e}}}}),Hi={};O(Hi,{applyPatchTask:()=>Ll});function Ll(e,t){return D(["apply",...t,...e])}var $l=l({"src/lib/tasks/apply-patch.ts"(){"use strict";R()}});function Bl(e,t){return{branch:e,hash:t,success:!0}}function ql(e){return{branch:e,hash:null,success:!1}}var zi,Ul=l({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";zi=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Wi(e,t){return t===1&&or.test(e)}var os,or,as,_t,Gl=l({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";Ul(),b(),os=/(\S+)\s+\(\S+\s([^)]+)\)/,or=/^error[^']+'([^']+)'/m,as=[new _(os,(e,[t,r])=>{let n=Bl(t,r);e.all.push(n),e.branches[t]=n}),new _(or,(e,[t])=>{let r=ql(t);e.errors.push(r),e.all.push(r),e.branches[t]=r})],_t=(e,t)=>B(new zi,as,[e,t])}}),Yi,Xl=l({"src/lib/responses/BranchSummary.ts"(){"use strict";Yi=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(e,t,r,n,s){e==="*"&&(this.detached=t,this.current=r),this.all.push(r),this.branches[r]={current:e==="*",linkedWorkTree:e==="+",name:r,commit:n,label:s}}}}});function cs(e){return e?e.charAt(0):""}function Ji(e,t=!1){return B(new Yi,t?[Ki]:Vi,e)}var Vi,Ki,Hl=l({"src/lib/parsers/parse-branch.ts"(){"use strict";Xl(),b(),Vi=[new _(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(e,[t,r,n,s])=>{e.push(cs(t),!0,r,n,s)}),new _(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(e,[t,r,n,s])=>{e.push(cs(t),!1,r,n,s)})],Ki=new _(/^(\S+)$/s,(e,[t])=>{e.push("*",!1,t,"","")})}}),Qi={};O(Qi,{branchLocalTask:()=>Wl,branchTask:()=>zl,containsDeleteBranchCommand:()=>Zi,deleteBranchTask:()=>Jl,deleteBranchesTask:()=>Yl});function Zi(e){let t=["-d","-D","--delete"];return e.some(r=>t.includes(r))}function zl(e){let t=Zi(e),r=e.includes("--show-current"),n=["branch",...e];return n.length===1&&n.push("-a"),n.includes("-v")||n.splice(1,0,"-v"),{format:"utf-8",commands:n,parser(s,i){return t?_t(s,i).all[0]:Ji(s,r)}}}function Wl(){return{format:"utf-8",commands:["branch","-v"],parser(e){return Ji(e)}}}function Yl(e,t=!1){return{format:"utf-8",commands:["branch","-v",t?"-D":"-d",...e],parser(r,n){return _t(r,n)},onError({exitCode:r,stdOut:n},s,i,o){if(!Wi(String(s),r))return o(s);i(n)}}}function Jl(e,t=!1){let r={format:"utf-8",commands:["branch","-v",t?"-D":"-d",e],parser(n,s){return _t(n,s).branches[e]},onError({exitCode:n,stdErr:s,stdOut:i},o,a,c){if(!Wi(String(o),n))return c(o);throw new ue(r.parser(Re(i),Re(s)),String(o))}};return r}var Vl=l({"src/lib/tasks/branch.ts"(){"use strict";_e(),Gl(),Hl(),b()}});function Kl(e){let t=e.trim().replace(/^["']|["']$/g,"");return t&&(0,eo.normalize)(t)}var eo,to,Ql=l({"src/lib/responses/CheckIgnore.ts"(){"use strict";eo=require("node:path"),to=e=>e.split(/\n/g).map(Kl).filter(Boolean)}}),ro={};O(ro,{checkIgnoreTask:()=>Zl});function Zl(e){return{commands:["check-ignore",...e],format:"utf-8",parser:to}}var ef=l({"src/lib/tasks/check-ignore.ts"(){"use strict";Ql()}}),no={};O(no,{cloneMirrorTask:()=>rf,cloneTask:()=>so});function tf(e){return/^--upload-pack(=|$)/.test(e)}function so(e,t,r){let n=["clone",...r];return F(e)&&n.push(e),F(t)&&n.push(t),n.find(tf)?$("git.fetch: potential exploit argument blocked."):D(n)}function rf(e,t,r){return T(r,"--mirror"),so(e,t,r)}var nf=l({"src/lib/tasks/clone.ts"(){"use strict";R(),b()}});function sf(e,t){return B({raw:e,remote:null,branches:[],tags:[],updated:[],deleted:[]},io,[e,t])}var io,of=l({"src/lib/parsers/parse-fetch.ts"(){"use strict";b(),io=[new _(/From (.+)$/,(e,[t])=>{e.remote=t}),new _(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.branches.push({name:t,tracking:r})}),new _(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.tags.push({name:t,tracking:r})}),new _(/- \[deleted]\s+\S+\s*-> (.+)$/,(e,[t])=>{e.deleted.push({tracking:t})}),new _(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(e,[t,r,n,s])=>{e.updated.push({name:n,tracking:s,to:r,from:t})})]}}),oo={};O(oo,{fetchTask:()=>cf});function af(e){return/^--upload-pack(=|$)/.test(e)}function cf(e,t,r){let n=["fetch",...r];return e&&t&&n.push(e,t),n.find(af)?$("git.fetch: potential exploit argument blocked."):{commands:n,format:"utf-8",parser:sf}}var uf=l({"src/lib/tasks/fetch.ts"(){"use strict";of(),R()}});function lf(e){return B({moves:[]},ao,e)}var ao,ff=l({"src/lib/parsers/parse-move.ts"(){"use strict";b(),ao=[new _(/^Renaming (.+) to (.+)$/,(e,[t,r])=>{e.moves.push({from:t,to:r})})]}}),co={};O(co,{moveTask:()=>pf});function pf(e,t){return{commands:["mv","-v",...Q(e),t],format:"utf-8",parser:lf}}var df=l({"src/lib/tasks/move.ts"(){"use strict";ff(),b()}}),uo={};O(uo,{pullTask:()=>hf});function hf(e,t,r){let n=["pull",...r];return e&&t&&n.splice(1,0,e,t),{commands:n,format:"utf-8",parser(s,i){return xr(s,i)},onError(s,i,o,a){let c=_l(Re(s.stdOut),Re(s.stdErr));if(c)return a(new ue(c));a(i)}}}var mf=l({"src/lib/tasks/pull.ts"(){"use strict";_e(),Ii(),b()}});function gf(e){let t={};return lo(e,([r])=>t[r]={name:r}),Object.values(t)}function yf(e){let t={};return lo(e,([r,n,s])=>{Object.hasOwn(t,r)||(t[r]={name:r,refs:{fetch:"",push:""}}),s&&n&&(t[r].refs[s.replace(/[^a-z]/g,"")]=n)}),Object.values(t)}function lo(e,t){fr(e,r=>t(r.split(/\s+/)))}var bf=l({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";b()}}),fo={};O(fo,{addRemoteTask:()=>_f,getRemotesTask:()=>wf,listRemotesTask:()=>Tf,remoteTask:()=>vf,removeRemoteTask:()=>Ef});function _f(e,t,r){return D(["remote","add",...r,e,t])}function wf(e){let t=["remote"];return e&&t.push("-v"),{commands:t,format:"utf-8",parser:e?yf:gf}}function Tf(e){let t=[...e];return t[0]!=="ls-remote"&&t.unshift("ls-remote"),D(t)}function vf(e){let t=[...e];return t[0]!=="remote"&&t.unshift("remote"),D(t)}function Ef(e){return D(["remote","remove",e])}var kf=l({"src/lib/tasks/remote.ts"(){"use strict";bf(),R()}}),po={};O(po,{stashListTask:()=>Sf});function Sf(e={},t){let r=vi(e),n=["stash","list",...r.commands,...t],s=bi(r.splitter,r.fields,Er(n));return bt(n)||{commands:n,format:"utf-8",parser:s}}var Of=l({"src/lib/tasks/stash-list.ts"(){"use strict";Ne(),wi(),Rr(),Ei()}}),ho={};O(ho,{addSubModuleTask:()=>Cf,initSubModuleTask:()=>Rf,subModuleTask:()=>wt,updateSubModuleTask:()=>xf});function Cf(e,t){return wt(["add",e,t])}function Rf(e){return wt(["init",...e])}function wt(e){let t=[...e];return t[0]!=="submodule"&&t.unshift("submodule"),D(t)}function xf(e){return wt(["update",...e])}var Ff=l({"src/lib/tasks/sub-module.ts"(){"use strict";R()}});function Af(e,t){let r=Number.isNaN(e),n=Number.isNaN(t);return r!==n?r?1:-1:r?mo(e,t):0}function mo(e,t){return e===t?0:e>t?1:-1}function If(e){return e.trim()}function Ze(e){return typeof e=="string"&&parseInt(e.replace(/^\D+/g,""),10)||0}var us,go,Mf=l({"src/lib/responses/TagList.ts"(){"use strict";us=class{constructor(e,t){this.all=e,this.latest=t}},go=function(e,t=!1){let r=e.split(`
`).map(If).filter(Boolean);t||r.sort(function(s,i){let o=s.split("."),a=i.split(".");if(o.length===1||a.length===1)return Af(Ze(o[0]),Ze(a[0]));for(let c=0,f=Math.max(o.length,a.length);c<f;c++){let u=mo(Ze(o[c]),Ze(a[c]));if(u)return u}return 0});let n=t?r[0]:[...r].reverse().find(s=>s.indexOf(".")>=0);return new us(r,n)}}}),yo={};O(yo,{addAnnotatedTagTask:()=>Pf,addTagTask:()=>Df,tagListTask:()=>Nf});function Nf(e=[]){let t=e.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...e],parser(r){return go(r,t)}}}function Df(e){return{format:"utf-8",commands:["tag",e],parser(){return{name:e}}}}function Pf(e,t){return{format:"utf-8",commands:["tag","-a","-m",t,e],parser(){return{name:e}}}}var jf=l({"src/lib/tasks/tag.ts"(){"use strict";Mf()}}),Lf=vc({"src/git.js"(e,t){"use strict";var{GitExecutor:r}=(Lu(),S(ci)),{SimpleGitApi:n}=(Pl(),S(Ui)),{Scheduler:s}=(jl(),S(Gi)),{configurationErrorTask:i}=(R(),S(Qt)),{asArray:o,filterArray:a,filterPrimitives:c,filterString:f,filterStringOrStringArray:u,filterType:d,getTrailingOptions:m,trailingFunctionArgument:h,trailingOptionsArgument:A}=(b(),S(Rs)),{applyPatchTask:k}=($l(),S(Hi)),{branchTask:I,branchLocalTask:X,deleteBranchesTask:Z,deleteBranchTask:Le}=(Vl(),S(Qi)),{checkIgnoreTask:fe}=(ef(),S(ro)),{checkIsRepoTask:Lr}=(Is(),S(xs)),{cloneTask:ve,cloneMirrorTask:St}=(nf(),S(no)),{cleanWithOptionsTask:$e,isCleanOptionsArray:Ot}=(Gs(),S(qs)),{diffSummaryTask:Yo}=(Rr(),S(Ti)),{fetchTask:Jo}=(uf(),S(oo)),{moveTask:Vo}=(df(),S(co)),{pullTask:Ko}=(mf(),S(uo)),{pushTagsTask:Qo}=(Pi(),S(Di)),{addRemoteTask:Zo,getRemotesTask:ea,listRemotesTask:ta,remoteTask:ra,removeRemoteTask:na}=(kf(),S(fo)),{getResetMode:sa,resetTask:ia}=(ri(),S(Zs)),{stashListTask:oa}=(Of(),S(po)),{addSubModuleTask:aa,initSubModuleTask:ca,subModuleTask:ua,updateSubModuleTask:la}=(Ff(),S(ho)),{addAnnotatedTagTask:fa,addTagTask:pa,tagListTask:da}=(jf(),S(yo)),{straightThroughBufferTask:ha,straightThroughStringTask:J}=(R(),S(Qt));function y(p,g){this._plugins=g,this._executor=new r(p.baseDir,new s(p.maxConcurrentProcesses),g),this._trimmed=p.trimmed}(y.prototype=Object.create(n.prototype)).constructor=y,y.prototype.customBinary=function(p){return this._plugins.reconfigure("binary",p),this},y.prototype.env=function(p,g){return arguments.length===1&&typeof p=="object"?this._executor.env=p:(this._executor.env=this._executor.env||{})[p]=g,this},y.prototype.stashList=function(p){return this._runTask(oa(A(arguments)||{},a(p)&&p||[]),h(arguments))};function $r(p,g,v,N){return typeof v!="string"?i(`git.${p}() requires a string 'repoPath'`):g(v,d(N,f),m(arguments))}y.prototype.clone=function(){return this._runTask($r("clone",ve,...arguments),h(arguments))},y.prototype.mirror=function(){return this._runTask($r("mirror",St,...arguments),h(arguments))},y.prototype.mv=function(p,g){return this._runTask(Vo(p,g),h(arguments))},y.prototype.checkoutLatestTag=function(p){var g=this;return this.pull(function(){g.tags(function(v,N){g.checkout(N.latest,p)})})},y.prototype.pull=function(p,g,v,N){return this._runTask(Ko(d(p,f),d(g,f),m(arguments)),h(arguments))},y.prototype.fetch=function(p,g){return this._runTask(Jo(d(p,f),d(g,f),m(arguments)),h(arguments))},y.prototype.silent=function(p){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},y.prototype.tags=function(p,g){return this._runTask(da(m(arguments)),h(arguments))},y.prototype.rebase=function(){return this._runTask(J(["rebase",...m(arguments)]),h(arguments))},y.prototype.reset=function(p){return this._runTask(ia(sa(p),m(arguments)),h(arguments))},y.prototype.revert=function(p){let g=h(arguments);return typeof p!="string"?this._runTask(i("Commit must be a string"),g):this._runTask(J(["revert",...m(arguments,0,!0),p]),g)},y.prototype.addTag=function(p){let g=typeof p=="string"?pa(p):i("Git.addTag requires a tag name");return this._runTask(g,h(arguments))},y.prototype.addAnnotatedTag=function(p,g){return this._runTask(fa(p,g),h(arguments))},y.prototype.deleteLocalBranch=function(p,g,v){return this._runTask(Le(p,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.deleteLocalBranches=function(p,g,v){return this._runTask(Z(p,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.branch=function(p,g){return this._runTask(I(m(arguments)),h(arguments))},y.prototype.branchLocal=function(p){return this._runTask(X(),h(arguments))},y.prototype.raw=function(p){let g=!Array.isArray(p),v=[].slice.call(g?arguments:p,0);for(let H=0;H<v.length&&g;H++)if(!c(v[H])){v.splice(H,v.length-H);break}v.push(...m(arguments,0,!0));var N=h(arguments);return v.length?this._runTask(J(v,this._trimmed),N):this._runTask(i("Raw: must supply one or more command to execute"),N)},y.prototype.submoduleAdd=function(p,g,v){return this._runTask(aa(p,g),h(arguments))},y.prototype.submoduleUpdate=function(p,g){return this._runTask(la(m(arguments,!0)),h(arguments))},y.prototype.submoduleInit=function(p,g){return this._runTask(ca(m(arguments,!0)),h(arguments))},y.prototype.subModule=function(p,g){return this._runTask(ua(m(arguments)),h(arguments))},y.prototype.listRemote=function(){return this._runTask(ta(m(arguments)),h(arguments))},y.prototype.addRemote=function(p,g,v){return this._runTask(Zo(p,g,m(arguments)),h(arguments))},y.prototype.removeRemote=function(p,g){return this._runTask(na(p),h(arguments))},y.prototype.getRemotes=function(p,g){return this._runTask(ea(p===!0),h(arguments))},y.prototype.remote=function(p,g){return this._runTask(ra(m(arguments)),h(arguments))},y.prototype.tag=function(p,g){let v=m(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(J(v),h(arguments))},y.prototype.updateServerInfo=function(p){return this._runTask(J(["update-server-info"]),h(arguments))},y.prototype.pushTags=function(p,g){let v=Qo({remote:d(p,f)},m(arguments));return this._runTask(v,h(arguments))},y.prototype.rm=function(p){return this._runTask(J(["rm","-f",...o(p)]),h(arguments))},y.prototype.rmKeepLocal=function(p){return this._runTask(J(["rm","--cached",...o(p)]),h(arguments))},y.prototype.catFile=function(p,g){return this._catFile("utf-8",arguments)},y.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},y.prototype._catFile=function(p,g){var v=h(g),N=["cat-file"],H=g[0];if(typeof H=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(H)&&N.push.apply(N,H);let Ct=p==="buffer"?ha(N):J(N);return this._runTask(Ct,v)},y.prototype.diff=function(p,g){let v=f(p)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):J(["diff",...m(arguments)]);return this._runTask(v,h(arguments))},y.prototype.diffSummary=function(){return this._runTask(Yo(m(arguments,1)),h(arguments))},y.prototype.applyPatch=function(p){let g=u(p)?k(o(p),m([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(g,h(arguments))},y.prototype.revparse=function(){let p=["rev-parse",...m(arguments,!0)];return this._runTask(J(p,!0),h(arguments))},y.prototype.clean=function(p,g,v){let N=Ot(p),H=N&&p.join("")||d(p,f)||"",Ct=m([].slice.call(arguments,N?1:0));return this._runTask($e(H,Ct),h(arguments))},y.prototype.exec=function(p){let g={commands:[],format:"utf-8",parser(){typeof p=="function"&&p()}};return this._runTask(g)},y.prototype.clearQueue=function(){return this},y.prototype.checkIgnore=function(p,g){return this._runTask(fe(o(d(p,u,[]))),h(arguments))},y.prototype.checkIsRepo=function(p,g){return this._runTask(Lr(d(p,f)),h(arguments))},t.exports=y}}),bo={};O(bo,{esModuleFactory:()=>$f,gitExportFactory:()=>Bf,gitInstanceFactory:()=>_o});function $f(e){return Object.defineProperties(e,{__esModule:{value:!0},default:{value:e}})}function Bf(e){return Object.assign(e.bind(null),ni)}function _o(e,t){let r=new ii,n=Os(e&&(typeof e=="string"?{baseDir:e}:e)||{},t);if(!pr(n.baseDir))throw new ur(n,"Cannot use simple-git on a directory that does not exist");return Array.isArray(n.config)&&r.add(lu(n.config)),r.add(cu(n.unsafe)),r.add(Au()),r.add(pu(n.completion)),n.abort&&r.add(nu(n.abort)),n.progress&&r.add(vu(n.progress)),n.timeout&&r.add(Ru(n.timeout)),n.spawnOptions&&r.add(Ou(n.spawnOptions)),r.add(Dn(_u(!0))),n.errors&&r.add(Dn(n.errors)),mu(r,n.binary,n.unsafe?.allowUnsafeCustomBinary),new wo(n,r)}var wo,To=l({"src/lib/git-factory.ts"(){"use strict";ru(),Fu(),Iu(),b(),wo=Lf()}}),vo={};O(vo,{gitP:()=>qf});function qf(...e){let t,r=Promise.resolve();try{t=_o(...e)}catch(c){r=Promise.reject(c)}function n(){return i}function s(){return r}let i=[...Eo,...ar].reduce((c,f)=>{let u=ar.includes(f),d=u?o(f,t):a(f,t,c);return Object.defineProperty(c,f,{enumerable:!1,configurable:!1,value:t?d:u?s:n}),c},{});return i;function o(c,f){return function(...u){if(typeof u[u.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+c);return r.then(function(){return new Promise(function(d,m){let h=(A,k)=>{if(A)return m(Uf(A));d(k)};u.push(h),f[c].apply(f,u)})})}}function a(c,f,u){return(...d)=>(f[c](...d),u)}}function Uf(e){return e instanceof Error?e:typeof e=="string"?new Error(e):new ue(e)}var Eo,ar,Gf=l({"src/lib/runners/promise-wrapped.ts"(){"use strict";_e(),To(),Eo=["customBinary","env","outputHandler","silent"],ar=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:Xf}=(Gf(),S(vo)),{esModuleFactory:Hf,gitInstanceFactory:zf,gitExportFactory:Wf}=(To(),S(bo)),ls=Hf(Wf(zf));ko.exports=Object.assign(ls,{gitP:Xf,simpleGit:ls})});var Ro=w((wd,Co)=>{var Oo=So(),{execSync:Ir}=require("node:child_process"),Y=require("node:path"),P=require("node:fs"),Yf=require("node:os"),Jf=Y.join(Yf.homedir(),".claude-memory","repo"),Vf="claude-memory-storage",Mr=class{constructor(t,r=null,n=Vf){this.auth=t,this.repoOwner=r,this.repoName=n,this.syncDir=Jf,this._git=null}get git(){return this._git||(this._git=Oo(this.syncDir)),this._git}async ensureRepo(){if(P.existsSync(this.syncDir)&&P.existsSync(Y.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),n=JSON.parse(Ir(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=n.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let t=await this.auth.getToken();return Ir(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${t}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let t=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return Ir(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${t}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(t){return console.error("Failed to create repository:",t.message),!1}}async cloneRepo(){let t=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=Y.dirname(this.syncDir);P.existsSync(r)||P.mkdirSync(r,{recursive:!0}),await Oo().clone(t,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(t){let r=new Date(t.created_at),n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,s=String(r.getDate()).padStart(2,"0"),i=Y.join(this.syncDir,"memories",t.container_tag,n);P.existsSync(i)||P.mkdirSync(i,{recursive:!0});let o=`${s}-${t.id}.json`,a=Y.join(i,o),c={id:t.id,content:t.content,containerTag:t.container_tag,metadata:typeof t.metadata=="string"?JSON.parse(t.metadata):t.metadata,createdAt:t.created_at,updatedAt:t.updated_at};return P.writeFileSync(a,JSON.stringify(c,null,2)),a}exportMemories(t){let r=[];for(let n of t){let s=this.exportMemory(n);r.push(s)}return r}exportProfiles(t){let r=Y.join(this.syncDir,"profiles");P.existsSync(r)||P.mkdirSync(r,{recursive:!0});let n=Y.join(r,"user-preferences.json");return P.writeFileSync(n,JSON.stringify(t,null,2)),n}async syncToGitHub(t,r=null){try{await this.ensureRepo();let n=this.exportMemories(t);if(r){let o=this.exportProfiles(r);n.push(o)}if(n.length===0)return{success:!0,synced:0};for(let o of n){let a=Y.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(t.map(o=>o.container_tag))].join(", ")} (${t.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:t.length}}catch(n){return console.error("GitHub sync failed:",n.message),{success:!1,error:n.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(t){return t.message.includes("conflict")?{success:!1,conflict:!0,error:t.message}:{success:!1,conflict:!1,error:t.message}}}importMemories(){let t=Y.join(this.syncDir,"memories");if(!P.existsSync(t))return[];let r=[],n=s=>{let i=P.readdirSync(s,{withFileTypes:!0});for(let o of i){let a=Y.join(s,o.name);if(o.isDirectory())n(a);else if(o.name.endsWith(".json"))try{let c=JSON.parse(P.readFileSync(a,"utf8"));r.push({id:c.id,content:c.content,container_tag:c.containerTag,metadata:JSON.stringify(c.metadata||{}),created_at:c.createdAt,updated_at:c.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(c){console.error(`Failed to parse ${a}:`,c.message)}}};return n(t),r}importProfiles(){let t=Y.join(this.syncDir,"profiles","user-preferences.json");if(!P.existsSync(t))return{static:[],dynamic:[]};try{return JSON.parse(P.readFileSync(t,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};Co.exports={GitHubSync:Mr}});var Io=w((Td,Ao)=>{var{execSync:xo}=require("node:child_process"),Te=require("node:fs"),Fo=require("node:path"),Kf=require("node:os"),De=Fo.join(Kf.homedir(),".claude-memory","github-token.json"),Nr=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return xo("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return xo("gh auth token",{encoding:"utf8"}).trim()}catch(t){console.error("Failed to get gh token:",t.message)}if(Te.existsSync(De))return JSON.parse(Te.readFileSync(De,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(t){let r=Fo.dirname(De);Te.existsSync(r)||Te.mkdirSync(r,{recursive:!0}),Te.writeFileSync(De,JSON.stringify({token:t}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||Te.existsSync(De)}async initiateDeviceFlow(){let t=require("node:https");return new Promise((r,n)=>{let s=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":s.length,Accept:"application/json"}},o=t.request(i,a=>{let c="";a.on("data",f=>{c+=f}),a.on("end",()=>r(JSON.parse(c)))});o.on("error",n),o.write(s),o.end()})}async pollForToken(t,r=5){let n=require("node:https"),s=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:t,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),c={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},f=n.request(c,u=>{let d="";u.on("data",m=>{d+=m}),u.on("end",()=>{let m=JSON.parse(d);m.access_token?i(m.access_token):m.error==="authorization_pending"?i(null):o(new Error(m.error||"Unknown error"))})});f.on("error",o),f.write(a),f.end()});for(let i=0;i<120;i++){let o=await s();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let t=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${t.verification_uri}`),console.log(`Enter code: ${t.user_code}
`);let r=await this.pollForToken(t.device_code,t.interval);return this.saveToken(r),r}};Ao.exports={GitHubAuth:Nr}});var No=w((vd,Mo)=>{var{SqliteManager:Qf}=En(),{GitHubSync:Zf}=Ro(),{GitHubAuth:ep}=Io(),tp=require("node:crypto"),Dr=class{constructor(t=null){this.db=new Qf(t),this.auth=new ep,this.sync=null}async initSync(){this.sync||(this.sync=new Zf(this.auth))}generateId(t="mem"){return`${t}_${tp.randomBytes(8).toString("hex")}`}async addMemory(t,r,n={},s=null){let i=s||this.generateId("mem");return this.db.addMemory(i,t,r,n),{id:i,status:"saved",containerTag:r}}async search(t,r=null,n={}){let s=this.db.searchMemories(t,r,n.limit||10);return{results:s.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:s.length}}async getProfile(t,r=null){let n=this.db.getProfile(t),s=null;if(r){let i=this.db.searchMemories(r,t,10);s={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:n.static,dynamic:n.dynamic},searchResults:s}}async listMemories(t,r=20){return{memories:this.db.listMemories(t,r)}}async deleteMemory(t){return this.db.deleteMemory(t),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=this.db.getPendingSync();if(t.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(t);if(r.success){let n=t.map(s=>s.id);this.db.markSynced(n)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=await this.sync.pullFromGitHub();if(!t.success)return t;let r=this.sync.importMemories();for(let n of r)this.db.getMemory(n.id)||this.db.addMemory(n.id,n.content,n.container_tag,JSON.parse(n.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};Mo.exports={StorageClient:Dr}});var jo=w((Ed,Po)=>{var{execSync:Do}=require("node:child_process"),rp=require("node:crypto");function Tt(e){return rp.createHash("sha256").update(e).digest("hex").slice(0,16)}function Pr(e){try{return Do("git rev-parse --show-toplevel",{cwd:e,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function np(e){let r=Pr(e)||e;return`claudecode_project_${Tt(r)}`}function sp(e){return(Pr(e)||e).split("/").pop()||"unknown"}function ip(){try{let t=Do("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(t)return`claudecode_user_${Tt(t)}`}catch{}let e=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${Tt(e)}`}Po.exports={sha256:Tt,getGitRoot:Pr,getContainerTag:np,getProjectName:sp,getUserContainerTag:ip}});var qo=w((kd,Bo)=>{var je=require("node:fs"),Lo=require("node:path"),op=require("node:os"),vt=Lo.join(op.homedir(),".supermemory-claude"),Pe=Lo.join(vt,"settings.json"),$o={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function ap(){je.existsSync(vt)||je.mkdirSync(vt,{recursive:!0})}function cp(){let e={...$o};try{if(je.existsSync(Pe)){let t=je.readFileSync(Pe,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${Pe}: ${t.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function up(e){ap();let t={...e};delete t.apiKey,je.writeFileSync(Pe,JSON.stringify(t,null,2))}function lp(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function fp(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function pp(e,t,r){if(e.debug){let n=new Date().toISOString();console.error(r?`[${n}] ${t}: ${JSON.stringify(r)}`:`[${n}] ${t}`)}}Bo.exports={SETTINGS_DIR:vt,SETTINGS_FILE:Pe,DEFAULT_SETTINGS:$o,loadSettings:cp,saveSettings:up,getApiKey:lp,shouldCaptureTool:fp,debugLog:pp}});var Go=w((Sd,Uo)=>{async function dp(){return new Promise((e,t)=>{let r="";process.stdin.setEncoding("utf8"),process.stdin.on("data",n=>{r+=n}),process.stdin.on("end",()=>{try{e(r.trim()?JSON.parse(r):{})}catch(n){t(new Error(`Failed to parse stdin JSON: ${n.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function Et(e){console.log(JSON.stringify(e))}function hp(e=null){Et(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function mp(e){console.error(`Supermemory: ${e}`),Et({continue:!0,suppressOutput:!0})}Uo.exports={readStdin:dp,writeOutput:Et,outputSuccess:hp,outputError:mp}});var Wo=w((Od,zo)=>{function Xo(e){try{let t=new Date(e),r=new Date,n=(r.getTime()-t.getTime())/1e3,s=n/60,i=n/3600,o=n/86400;if(s<30)return"just now";if(s<60)return`${Math.floor(s)}mins ago`;if(i<24)return`${Math.floor(i)}hrs ago`;if(o<7)return`${Math.floor(o)}d ago`;let a=t.toLocaleString("en",{month:"short"});return t.getFullYear()===r.getFullYear()?`${t.getDate()} ${a}`:`${t.getDate()} ${a}, ${t.getFullYear()}`}catch{return""}}function Ho(e,t,r){let n=new Set,s=e.filter(a=>n.has(a)?!1:(n.add(a),!0)),i=t.filter(a=>n.has(a)?!1:(n.add(a),!0)),o=r.filter(a=>{let c=a.memory??"";return!c||n.has(c)?!1:(n.add(c),!0)});return{static:s,dynamic:i,searchResults:o}}function gp(e,t=!0,r=!1,n=10){if(!e)return null;let s=e.profile?.static||[],i=e.profile?.dynamic||[],o=e.searchResults?.results||[],a=Ho(t?s:[],t?i:[],r?o:[]),c=a.static.slice(0,n),f=a.dynamic.slice(0,n),u=a.searchResults.slice(0,n);if(c.length===0&&f.length===0&&u.length===0)return null;let d=[];if(c.length>0&&d.push(`## User Profile (Persistent)
`+c.map(A=>`- ${A}`).join(`
`)),f.length>0&&d.push(`## Recent Context
${f.map(A=>`- ${A}`).join(`
`)}`),u.length>0){let A=u.map(k=>{let I=k.memory??"",X=k.updatedAt?Xo(k.updatedAt):"",Z=k.similarity!=null?`[${Math.round(k.similarity*100)}%]`:"";return`- ${X?`[${X}] `:""}${I} ${Z}`.trim()});d.push(`## Relevant Memories (with relevance %)
${A.join(`
`)}`)}return`<supermemory-context>
The following is recalled context about the user. Reference it only when relevant to the conversation.

${d.join(`

`)}

Use these memories naturally when relevant \u2014 including indirect connections \u2014 but don't force them into every response or make assumptions beyond what's stated.
</supermemory-context>`}zo.exports={formatContext:gp,formatRelativeTime:Xo,deduplicateMemories:Ho}});var{StorageClient:yp}=No(),{getContainerTag:bp,getProjectName:_p}=jo(),{loadSettings:wp,debugLog:kt}=qo(),{readStdin:Tp,writeOutput:jr}=Go(),{formatContext:vp}=Wo();async function Ep(){let e=wp();try{let r=(await Tp()).cwd||process.cwd(),n=bp(r),s=_p(r);kt(e,"SessionStart",{cwd:r,containerTag:n,projectName:s});let i=new yp,o=await i.syncFromGitHub().catch(()=>({success:!1}));o.success||kt(e,"GitHub sync unavailable, working offline");let a=await i.getProfile(n,s).catch(()=>null),c=vp(a,!0,!1,e.maxProfileItems||5);if(!c){jr({hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:`<supermemory-context>
No previous memories found for this project.
Memories will be saved as you work.
${o.success?"":"\u26A0 GitHub sync unavailable - working offline"}
</supermemory-context>`}}),i.close();return}kt(e,"Context generated",{length:c.length});let f=o.success?"":`
\u26A0 GitHub sync unavailable - working offline`;jr({hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:c+f}}),i.close()}catch(t){kt(e,"Error",{error:t.message}),console.error(`Claude Memory: ${t.message}`),jr({hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:`<supermemory-status>
Failed to load memories: ${t.message}
Session will continue without memory context.
</supermemory-status>`}})}}Ep().catch(e=>{console.error(`Claude Memory fatal: ${e.message}`),process.exit(1)});
