#!/usr/bin/env node
var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var vr=A((Jl,Tr)=>{var mo=require("better-sqlite3"),me=require("node:path"),br=require("node:fs"),ho=require("node:os"),go=me.join(ho.homedir(),".claude-memory"),pe=me.join(go,"memories.db"),de=class{constructor(e=pe){e||(e=pe);let r=me.dirname(e);br.existsSync(r)||br.mkdirSync(r,{recursive:!0}),this.db=new mo(e),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(e,r,s,n={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(e,r,s,JSON.stringify(n),i,i),{id:e,createdAt:i}}getMemory(e){let s=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(e);return s?.metadata&&(s.metadata=JSON.parse(s.metadata)),s}updateMemory(e,r,s=null){let n=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,n,"pending"];s!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(s))),o.push(e),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(e){this.db.prepare("DELETE FROM memories WHERE id = ?").run(e)}listMemories(e,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(s=>(s.metadata&&(s.metadata=JSON.parse(s.metadata)),s))}markSynced(e){let r=Date.now(),s=e.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${s})
    `).run(r,...e)}searchMemories(e,r=null,s=10){let n=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[e];return r&&(n+=" AND m.container_tag = ?",i.push(r)),n+=" ORDER BY rank LIMIT ?",i.push(s),this.db.prepare(n).all(...i).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}getContextMemories(e,r,s=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,Math.floor(s/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,e,Math.floor(s/2)),u=new Set(i.map(l=>l.id)),h=[...i];for(let l of a)u.has(l.id)||(h.push(l),u.add(l.id));return h.slice(0,s).map(l=>(l.metadata&&(l.metadata=JSON.parse(l.metadata)),l))}addProfileFact(e,r,s,n="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(e,r,s,n,i)}getProfile(e,r=5){let n=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r);return{static:n.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(e){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(e)}close(){this.db.close()}};Tr.exports={SqliteManager:de,DEFAULT_DB_PATH:pe}});var wr=A((Kl,kr)=>{var ot=1e3,at=ot*60,ct=at*60,Z=ct*24,yo=Z*7,_o=Z*365.25;kr.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return bo(t);if(r==="number"&&isFinite(t))return e.long?vo(t):To(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function bo(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*_o;case"weeks":case"week":case"w":return r*yo;case"days":case"day":case"d":return r*Z;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ct;case"minutes":case"minute":case"mins":case"min":case"m":return r*at;case"seconds":case"second":case"secs":case"sec":case"s":return r*ot;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function To(t){var e=Math.abs(t);return e>=Z?Math.round(t/Z)+"d":e>=ct?Math.round(t/ct)+"h":e>=at?Math.round(t/at)+"m":e>=ot?Math.round(t/ot)+"s":t+"ms"}function vo(t){var e=Math.abs(t);return e>=Z?Mt(t,e,Z,"day"):e>=ct?Mt(t,e,ct,"hour"):e>=at?Mt(t,e,at,"minute"):e>=ot?Mt(t,e,ot,"second"):t+" ms"}function Mt(t,e,r,s){var n=e>=r*1.5;return Math.round(t/r)+" "+s+(n?"s":"")}});var he=A((Ql,Er)=>{function ko(t){r.debug=r,r.default=r,r.coerce=u,r.disable=o,r.enable=n,r.enabled=a,r.humanize=wr(),r.destroy=h,Object.keys(t).forEach(l=>{r[l]=t[l]}),r.names=[],r.skips=[],r.formatters={};function e(l){let p=0;for(let d=0;d<l.length;d++)p=(p<<5)-p+l.charCodeAt(d),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=e;function r(l){let p,d=null,m,F;function w(...M){if(!w.enabled)return;let q=w,K=Number(new Date),Ft=K-(p||K);q.diff=Ft,q.prev=p,q.curr=K,p=K,M[0]=r.coerce(M[0]),typeof M[0]!="string"&&M.unshift("%O");let it=0;M[0]=M[0].replace(/%([a-zA-Z%])/g,(ht,ue)=>{if(ht==="%%")return"%";it++;let At=r.formatters[ue];if(typeof At=="function"){let le=M[it];ht=At.call(q,le),M.splice(it,1),it--}return ht}),r.formatArgs.call(q,M),(q.log||r.log).apply(q,M)}return w.namespace=l,w.useColors=r.useColors(),w.color=r.selectColor(l),w.extend=s,w.destroy=r.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(m!==r.namespaces&&(m=r.namespaces,F=r.enabled(l)),F),set:M=>{d=M}}),typeof r.init=="function"&&r.init(w),w}function s(l,p){let d=r(this.namespace+(typeof p>"u"?":":p)+l);return d.log=this.log,d}function n(l){r.save(l),r.namespaces=l,r.names=[],r.skips=[];let p=(typeof l=="string"?l:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let d of p)d[0]==="-"?r.skips.push(d.slice(1)):r.names.push(d)}function i(l,p){let d=0,m=0,F=-1,w=0;for(;d<l.length;)if(m<p.length&&(p[m]===l[d]||p[m]==="*"))p[m]==="*"?(F=m,w=d,m++):(d++,m++);else if(F!==-1)m=F+1,w++,d=w;else return!1;for(;m<p.length&&p[m]==="*";)m++;return m===p.length}function o(){let l=[...r.names,...r.skips.map(p=>"-"+p)].join(",");return r.enable(""),l}function a(l){for(let p of r.skips)if(i(l,p))return!1;for(let p of r.names)if(i(l,p))return!0;return!1}function u(l){return l instanceof Error?l.stack||l.message:l}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Er.exports=ko});var Sr=A((D,Nt)=>{D.formatArgs=Eo;D.save=So;D.load=Co;D.useColors=wo;D.storage=Oo();D.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();D.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function wo(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Eo(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Nt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(s=r))}),t.splice(s,0,e)}D.log=console.debug||console.log||(()=>{});function So(t){try{t?D.storage.setItem("debug",t):D.storage.removeItem("debug")}catch{}}function Co(){let t;try{t=D.storage.getItem("debug")||D.storage.getItem("DEBUG")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function Oo(){try{return localStorage}catch{}}Nt.exports=he()(D);var{formatters:Ro}=Nt.exports;Ro.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Or=A((R,Pt)=>{var xo=require("tty"),It=require("util");R.init=Do;R.log=No;R.formatArgs=Ao;R.save=Io;R.load=Po;R.useColors=Fo;R.destroy=It.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");R.colors=[6,2,3,4,5,1];try{let t=require("supports-color");t&&(t.stderr||t).level>=2&&(R.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}R.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),t[r]=s,t},{});function Fo(){return"colors"in R.inspectOpts?!!R.inspectOpts.colors:xo.isatty(process.stderr.fd)}function Ao(t){let{namespace:e,useColors:r}=this;if(r){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${e} \x1B[0m`;t[0]=i+t[0].split(`
`).join(`
`+i),t.push(n+"m+"+Pt.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=Mo()+e+" "+t[0]}function Mo(){return R.inspectOpts.hideDate?"":new Date().toISOString()+" "}function No(...t){return process.stderr.write(It.formatWithOptions(R.inspectOpts,...t)+`
`)}function Io(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function Po(){return process.env.DEBUG}function Do(t){t.inspectOpts={};let e=Object.keys(R.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=R.inspectOpts[e[r]]}Pt.exports=he()(R);var{formatters:Cr}=Pt.exports;Cr.o=function(t){return this.inspectOpts.colors=this.useColors,It.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Cr.O=function(t){return this.inspectOpts.colors=this.useColors,It.inspect(t,this.inspectOpts)}});var ye=A((Vl,ge)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?ge.exports=Sr():ge.exports=Or()});var Rr=A(B=>{"use strict";var Lo=B&&B.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(B,"__esModule",{value:!0});var jo=require("fs"),$o=Lo(ye()),ut=$o.default("@kwsites/file-exists");function Bo(t,e,r){ut("checking %s",t);try{let s=jo.statSync(t);return s.isFile()&&e?(ut("[OK] path represents a file"),!0):s.isDirectory()&&r?(ut("[OK] path represents a directory"),!0):(ut("[FAIL] path represents something other than a file or directory"),!1)}catch(s){if(s.code==="ENOENT")return ut("[FAIL] path is not accessible: %o",s),!1;throw ut("[FATAL] %o",s),s}}function Go(t,e=B.READABLE){return Bo(t,(e&B.FILE)>0,(e&B.FOLDER)>0)}B.exists=Go;B.FILE=1;B.FOLDER=2;B.READABLE=B.FILE+B.FOLDER});var xr=A(Dt=>{"use strict";function Uo(t){for(var e in t)Dt.hasOwnProperty(e)||(Dt[e]=t[e])}Object.defineProperty(Dt,"__esModule",{value:!0});Uo(Rr())});var be=A(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.createDeferred=tt.deferred=void 0;function _e(){let t,e,r="pending";return{promise:new Promise((n,i)=>{t=n,e=i}),done(n){r==="pending"&&(r="resolved",t(n))},fail(n){r==="pending"&&(r="rejected",e(n))},get fulfilled(){return r!=="pending"},get status(){return r}}}tt.deferred=_e;tt.createDeferred=_e;tt.default=_e});var wi=A((rf,ki)=>{"use strict";var qo=Object.create,zt=Object.defineProperty,Xo=Object.getOwnPropertyDescriptor,Ge=Object.getOwnPropertyNames,Ho=Object.getPrototypeOf,Yo=Object.prototype.hasOwnProperty,c=(t,e)=>function(){return t&&(e=(0,t[Ge(t)[0]])(t=0)),e},Wo=(t,e)=>function(){return e||(0,t[Ge(t)[0]])((e={exports:{}}).exports,e),e.exports},S=(t,e)=>{for(var r in e)zt(t,r,{get:e[r],enumerable:!0})},us=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ge(e))!Yo.call(t,n)&&n!==r&&zt(t,n,{get:()=>e[n],enumerable:!(s=Xo(e,n))||s.enumerable});return t},zo=(t,e,r)=>(r=t!=null?qo(Ho(t)):{},us(e||!t||!t.__esModule?zt(r,"default",{value:t,enumerable:!0}):r,t)),E=t=>us(zt({},"__esModule",{value:!0}),t),z,V=c({"src/lib/errors/git-error.ts"(){"use strict";z=class extends Error{constructor(t,e){super(e),this.task=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),st,pt=c({"src/lib/errors/git-response-error.ts"(){"use strict";V(),st=class extends z{constructor(t,e){super(void 0,e||String(t)),this.git=t}}}});function ls(...t){let e=new String(t);return Jt.set(e,t),e}function Ut(t){return t instanceof String&&Jt.has(t)}function Fr(t){return Jt.get(t)||[]}var Jt,vt=c({"src/lib/args/pathspec.ts"(){"use strict";Jt=new WeakMap}}),Ue,Jo=c({"src/lib/errors/git-construct-error.ts"(){"use strict";V(),Ue=class extends z{constructor(t,e){super(void 0,e),this.config=t}}}}),H,kt=c({"src/lib/errors/git-plugin-error.ts"(){"use strict";V(),H=class extends z{constructor(t,e,r){super(t,r),this.task=t,this.plugin=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),qe,fs=c({"src/lib/errors/task-configuration-error.ts"(){"use strict";V(),qe=class extends z{constructor(t){super(void 0,t)}}}});function ps(t){return typeof t!="function"?nt:t}function ds(t){return typeof t=="function"&&t!==nt}function ms(t,e){let r=t.indexOf(e);return r<=0?[t,""]:[t.substr(0,r),t.substr(r+1)]}function hs(t,e=0){return gs(t)&&t.length>e?t[e]:void 0}function rt(t,e=0){if(gs(t)&&t.length>e)return t[t.length-1-e]}function gs(t){return Zt(t)}function wt(t="",e=!0,r=`
`){return t.split(r).reduce((s,n)=>{let i=e?n.trim():n;return i&&s.push(i),s},[])}function Xe(t,e){return wt(t,!0).map(r=>e(r))}function He(t){return(0,Oe.exists)(t,Oe.FOLDER)}function T(t,e){return Array.isArray(t)?t.includes(e)||t.push(e):t.add(e),e}function ys(t,e){return Array.isArray(t)&&!t.includes(e)&&t.push(e),t}function Kt(t,e){if(Array.isArray(t)){let r=t.indexOf(e);r>=0&&t.splice(r,1)}else t.delete(e);return e}function J(t){return Array.isArray(t)?t:[t]}function _s(t){return t.replace(/[\s-]+(.)/g,(e,r)=>r.toUpperCase())}function dt(t){return J(t).map(e=>e instanceof String?e:String(e))}function k(t,e=0){if(t==null)return e;let r=parseInt(t,10);return Number.isNaN(r)?e:r}function bt(t,e){let r=[];for(let s=0,n=t.length;s<n;s++)r.push(e,t[s]);return r}function Tt(t){return(Array.isArray(t)?Ts.Buffer.concat(t):t).toString("utf-8")}function bs(t,e){let r={};return e.forEach(s=>{t[s]!==void 0&&(r[s]=t[s])}),r}function Se(t=0){return new Promise(e=>setTimeout(e,t))}function Ce(t){if(t!==!1)return t}var Ts,Oe,ft,nt,Et,Qt=c({"src/lib/utils/util.ts"(){"use strict";Ts=require("node:buffer"),Oe=xr(),Ye(),ft="\0",nt=()=>{},Et=Object.prototype.toString.call.bind(Object.prototype.toString)}});function U(t,e,r){return e(t)?t:arguments.length>2?r:void 0}function Re(t,e){let r=Ut(t)?"string":typeof t;return/number|string|boolean/.test(r)&&(!e||!e.includes(r))}function Vt(t){return!!t&&Et(t)==="[object Object]"}function vs(t){return typeof t=="function"}var St,ks,x,qt,Zt,Ye=c({"src/lib/utils/argument-filters.ts"(){"use strict";vt(),Qt(),St=t=>Array.isArray(t),ks=t=>typeof t=="number",x=t=>typeof t=="string",qt=t=>x(t)||Array.isArray(t)&&t.every(x),Zt=t=>t==null||"number|boolean|function".includes(typeof t)?!1:typeof t.length=="number"}}),xe,Ko=c({"src/lib/utils/exit-codes.ts"(){"use strict";xe=(t=>(t[t.SUCCESS=0]="SUCCESS",t[t.ERROR=1]="ERROR",t[t.NOT_FOUND=-2]="NOT_FOUND",t[t.UNCLEAN=128]="UNCLEAN",t))(xe||{})}}),Xt,Qo=c({"src/lib/utils/git-output-streams.ts"(){"use strict";Xt=class ws{constructor(e,r){this.stdOut=e,this.stdErr=r}asStrings(){return new ws(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function Vo(){throw new Error("LineParser:useMatches not implemented")}var b,Q,Zo=c({"src/lib/utils/line-parser.ts"(){"use strict";b=class{constructor(t,e){this.matches=[],this.useMatches=Vo,this.parse=(r,s)=>(this.resetMatches(),this._regExp.every((n,i)=>this.addMatch(n,i,r(i)))?this.useMatches(s,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(t)?t:[t],e&&(this.useMatches=e)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(t,e,r){let s=r&&t.exec(r);return s&&this.pushMatch(e,s),!!s}pushMatch(t,e){this.matches.push(...e.slice(1))}},Q=class extends b{addMatch(t,e,r){return/^remote:\s/.test(String(r))&&super.addMatch(t,e,r)}pushMatch(t,e){(t>0||e.length>1)&&super.pushMatch(t,e)}}}});function Es(...t){let e=process.cwd(),r=Object.assign({baseDir:e,...Ss},...t.filter(s=>typeof s=="object"&&s));return r.baseDir=r.baseDir||e,r.trimmed=r.trimmed===!0,r}var Ss,ta=c({"src/lib/utils/simple-git-options.ts"(){"use strict";Ss={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function We(t,e=[]){return Vt(t)?Object.keys(t).reduce((r,s)=>{let n=t[s];if(Ut(n))r.push(n);else if(Re(n,["boolean"]))r.push(s+"="+n);else if(Array.isArray(n))for(let i of n)Re(i,["string","number"])||r.push(s+"="+i);else r.push(s);return r},e):e}function L(t,e=0,r=!1){let s=[];for(let n=0,i=e<0?t.length:e;n<i;n++)"string|number".includes(typeof t[n])&&s.push(String(t[n]));return We(ze(t),s),r||s.push(...ea(t)),s}function ea(t){let e=typeof rt(t)=="function";return dt(U(rt(t,e?1:0),St,[]))}function ze(t){let e=vs(rt(t));return U(rt(t,e?1:0),Vt)}function C(t,e=!0){let r=ps(rt(t));return e||ds(r)?r:void 0}var ra=c({"src/lib/utils/task-options.ts"(){"use strict";Ye(),Qt(),vt()}});function Fe(t,e){return t(e.stdOut,e.stdErr)}function $(t,e,r,s=!0){return J(r).forEach(n=>{for(let i=wt(n,s),o=0,a=i.length;o<a;o++){let u=(h=0)=>{if(!(o+h>=a))return i[o+h]};e.some(({parse:h})=>h(u,t))}}),t}var sa=c({"src/lib/utils/task-parser.ts"(){"use strict";Qt()}}),Cs={};S(Cs,{ExitCodes:()=>xe,GitOutputStreams:()=>Xt,LineParser:()=>b,NOOP:()=>nt,NULL:()=>ft,RemoteLineParser:()=>Q,append:()=>T,appendTaskOptions:()=>We,asArray:()=>J,asCamelCase:()=>_s,asFunction:()=>ps,asNumber:()=>k,asStringArray:()=>dt,bufferToString:()=>Tt,callTaskParser:()=>Fe,createInstanceConfig:()=>Es,delay:()=>Se,filterArray:()=>St,filterFunction:()=>vs,filterHasLength:()=>Zt,filterNumber:()=>ks,filterPlainObject:()=>Vt,filterPrimitives:()=>Re,filterString:()=>x,filterStringOrStringArray:()=>qt,filterType:()=>U,first:()=>hs,folderExists:()=>He,forEachLineWithContent:()=>Xe,getTrailingOptions:()=>L,including:()=>ys,isUserFunction:()=>ds,last:()=>rt,objectToString:()=>Et,orVoid:()=>Ce,parseStringResponse:()=>$,pick:()=>bs,prefixedArray:()=>bt,remove:()=>Kt,splitOn:()=>ms,toLinesWithContent:()=>wt,trailingFunctionArgument:()=>C,trailingOptionsArgument:()=>ze});var _=c({"src/lib/utils/index.ts"(){"use strict";Ye(),Ko(),Qo(),Zo(),ta(),ra(),sa(),Qt()}}),Os={};S(Os,{CheckRepoActions:()=>Ht,checkIsBareRepoTask:()=>xs,checkIsRepoRootTask:()=>Rs,checkIsRepoTask:()=>na});function na(t){switch(t){case"bare":return xs();case"root":return Rs()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:te,parser:Je}}function Rs(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:te,parser(e){return/^\.(git)?$/.test(e.trim())}}}function xs(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:te,parser:Je}}function ia(t){return/(Not a git repository|Kein Git-Repository)/i.test(String(t))}var Ht,te,Je,Fs=c({"src/lib/tasks/check-is-repo.ts"(){"use strict";_(),Ht=(t=>(t.BARE="bare",t.IN_TREE="tree",t.IS_REPO_ROOT="root",t))(Ht||{}),te=({exitCode:t},e,r,s)=>{if(t===128&&ia(e))return r(Buffer.from("false"));s(e)},Je=t=>t.trim()==="true"}});function oa(t,e){let r=new As(t),s=t?Ns:Ms;return wt(e).forEach(n=>{let i=n.replace(s,"");r.paths.push(i),(Is.test(i)?r.folders:r.files).push(i)}),r}var As,Ms,Ns,Is,aa=c({"src/lib/responses/CleanSummary.ts"(){"use strict";_(),As=class{constructor(t){this.dryRun=t,this.paths=[],this.files=[],this.folders=[]}},Ms=/^[a-z]+\s*/i,Ns=/^[a-z]+\s+[a-z]+\s*/i,Is=/\/$/}}),Ae={};S(Ae,{EMPTY_COMMANDS:()=>ee,adhocExecTask:()=>Ps,configurationErrorTask:()=>j,isBufferTask:()=>Ls,isEmptyTask:()=>js,straightThroughBufferTask:()=>Ds,straightThroughStringTask:()=>I});function Ps(t){return{commands:ee,format:"empty",parser:t}}function j(t){return{commands:ee,format:"empty",parser(){throw typeof t=="string"?new qe(t):t}}}function I(t,e=!1){return{commands:t,format:"utf-8",parser(r){return e?String(r).trim():r}}}function Ds(t){return{commands:t,format:"buffer",parser(e){return e}}}function Ls(t){return t.format==="buffer"}function js(t){return t.format==="empty"||!t.commands.length}var ee,O=c({"src/lib/tasks/task.ts"(){"use strict";fs(),ee=[]}}),$s={};S($s,{CONFIG_ERROR_INTERACTIVE_MODE:()=>Ke,CONFIG_ERROR_MODE_REQUIRED:()=>Qe,CONFIG_ERROR_UNKNOWN_OPTION:()=>Ve,CleanOptions:()=>yt,cleanTask:()=>Bs,cleanWithOptionsTask:()=>ca,isCleanOptionsArray:()=>ua});function ca(t,e){let{cleanMode:r,options:s,valid:n}=la(t);return r?n.options?(s.push(...e),s.some(da)?j(Ke):Bs(r,s)):j(Ve+JSON.stringify(t)):j(Qe)}function Bs(t,e){return{commands:["clean",`-${t}`,...e],format:"utf-8",parser(s){return oa(t==="n",s)}}}function ua(t){return Array.isArray(t)&&t.every(e=>Ze.has(e))}function la(t){let e,r=[],s={cleanMode:!1,options:!0};return t.replace(/[^a-z]i/g,"").split("").forEach(n=>{fa(n)?(e=n,s.cleanMode=!0):s.options=s.options&&pa(r[r.length]=`-${n}`)}),{cleanMode:e,options:r,valid:s}}function fa(t){return t==="f"||t==="n"}function pa(t){return/^-[a-z]$/i.test(t)&&Ze.has(t.charAt(1))}function da(t){return/^-[^\-]/.test(t)?t.indexOf("i")>0:t==="--interactive"}var Ke,Qe,Ve,yt,Ze,Gs=c({"src/lib/tasks/clean.ts"(){"use strict";aa(),_(),O(),Ke="Git clean interactive mode is not supported",Qe='Git clean mode parameter ("n" or "f") is required',Ve="Git clean unknown option found in: ",yt=(t=>(t.DRY_RUN="n",t.FORCE="f",t.IGNORED_INCLUDED="x",t.IGNORED_ONLY="X",t.EXCLUDING="e",t.QUIET="q",t.RECURSIVE="d",t))(yt||{}),Ze=new Set(["i",...dt(Object.values(yt))])}});function ma(t){let e=new qs;for(let r of Us(t))e.addValue(r.file,String(r.key),r.value);return e}function ha(t,e){let r=null,s=[],n=new Map;for(let i of Us(t,e))i.key===e&&(s.push(r=i.value),n.has(i.file)||n.set(i.file,[]),n.get(i.file).push(r));return{key:e,paths:Array.from(n.keys()),scopes:n,value:r,values:s}}function ga(t){return t.replace(/^(file):/,"")}function*Us(t,e=null){let r=t.split("\0");for(let s=0,n=r.length-1;s<n;){let i=ga(r[s++]),o=r[s++],a=e;if(o.includes(`
`)){let u=ms(o,`
`);a=u[0],o=u[1]}yield{file:i,key:a,value:o}}}var qs,ya=c({"src/lib/responses/ConfigList.ts"(){"use strict";_(),qs=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((t,e)=>Object.assign(t,this.values[e]),{})),this._all}addFile(t){if(!(t in this.values)){let e=rt(this.files);this.values[t]=e?Object.create(this.values[e]):{},this.files.push(t)}return this.values[t]}addValue(t,e,r){let s=this.addFile(t);Object.hasOwn(s,e)?Array.isArray(s[e])?s[e].push(r):s[e]=[s[e],r]:s[e]=r,this._all=void 0}}}});function Te(t,e){return typeof t=="string"&&Object.hasOwn(Yt,t)?t:e}function _a(t,e,r,s){let n=["config",`--${s}`];return r&&n.push("--add"),n.push(t,e),{commands:n,format:"utf-8",parser(i){return i}}}function ba(t,e){let r=["config","--null","--show-origin","--get-all",t];return e&&r.splice(1,0,`--${e}`),{commands:r,format:"utf-8",parser(s){return ha(s,t)}}}function Ta(t){let e=["config","--list","--show-origin","--null"];return t&&e.push(`--${t}`),{commands:e,format:"utf-8",parser(r){return ma(r)}}}function va(){return{addConfig(t,e,...r){return this._runTask(_a(t,e,r[0]===!0,Te(r[1],"local")),C(arguments))},getConfig(t,e){return this._runTask(ba(t,Te(e,void 0)),C(arguments))},listConfig(...t){return this._runTask(Ta(Te(t[0],void 0)),C(arguments))}}}var Yt,Xs=c({"src/lib/tasks/config.ts"(){"use strict";ya(),_(),Yt=(t=>(t.system="system",t.global="global",t.local="local",t.worktree="worktree",t))(Yt||{})}});function ka(t){return Hs.has(t)}var jt,Hs,Ys=c({"src/lib/tasks/diff-name-status.ts"(){"use strict";jt=(t=>(t.ADDED="A",t.COPIED="C",t.DELETED="D",t.MODIFIED="M",t.RENAMED="R",t.CHANGED="T",t.UNMERGED="U",t.UNKNOWN="X",t.BROKEN="B",t))(jt||{}),Hs=new Set(Object.values(jt))}});function Ws(...t){return new Js().param(...t)}function wa(t){let e=new Set,r={};return Xe(t,s=>{let[n,i,o]=s.split(ft);e.add(n),(r[n]=r[n]||[]).push({line:k(i),path:n,preview:o})}),{paths:e,results:r}}function Ea(){return{grep(t){let e=C(arguments),r=L(arguments);for(let n of zs)if(r.includes(n))return this._runTask(j(`git.grep: use of "${n}" is not supported.`),e);typeof t=="string"&&(t=Ws().param(t));let s=["grep","--null","-n","--full-name",...r,...t];return this._runTask({commands:s,format:"utf-8",parser(n){return wa(n)}},e)}}}var zs,gt,Ar,Js,Ks=c({"src/lib/tasks/grep.ts"(){"use strict";_(),O(),zs=["-h"],gt=Symbol("grepQuery"),Js=class{constructor(){this[Ar]=[]}*[(Ar=gt,Symbol.iterator)](){for(let t of this[gt])yield t}and(...t){return t.length&&this[gt].push("--and","(",...bt(t,"-e"),")"),this}param(...t){return this[gt].push(...bt(t,"-e")),this}}}}),Qs={};S(Qs,{ResetMode:()=>_t,getResetMode:()=>Ca,resetTask:()=>Sa});function Sa(t,e){let r=["reset"];return Vs(t)&&r.push(`--${t}`),r.push(...e),I(r)}function Ca(t){if(Vs(t))return t;switch(typeof t){case"string":case"undefined":return"soft"}}function Vs(t){return typeof t=="string"&&Zs.includes(t)}var _t,Zs,tn=c({"src/lib/tasks/reset.ts"(){"use strict";_(),O(),_t=(t=>(t.MIXED="mixed",t.SOFT="soft",t.HARD="hard",t.MERGE="merge",t.KEEP="keep",t))(_t||{}),Zs=dt(Object.values(_t))}}),en={};S(en,{CheckRepoActions:()=>Ht,CleanOptions:()=>yt,DiffNameStatus:()=>jt,GitConfigScope:()=>Yt,GitConstructError:()=>Ue,GitError:()=>z,GitPluginError:()=>H,GitResponseError:()=>st,ResetMode:()=>_t,TaskConfigurationError:()=>qe,grepQueryBuilder:()=>Ws,pathspec:()=>ls});var Oa=c({"src/lib/api.ts"(){"use strict";vt(),Jo(),V(),kt(),pt(),fs(),Fs(),Gs(),Xs(),Ys(),Ks(),tn()}});function Ra(t){return t?[{type:"spawn.before",action(s,n){t.aborted&&n.kill(new H(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(s,n){function i(){n.kill(new H(void 0,"abort","Abort signal received"))}t.addEventListener("abort",i),n.spawned.on("close",()=>t.removeEventListener("abort",i))}}]:void 0}var xa=c({"src/lib/plugins/abort-plugin.ts"(){"use strict";kt()}});function Fa(t){return typeof t=="string"&&t.trim().toLowerCase()==="-c"}function Aa(t,e){if(Fa(t)&&/^\s*protocol(.[a-z]+)?.allow/.test(e))throw new H(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function Ma(t,e){if(/^\s*--(upload|receive)-pack/.test(t))throw new H(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(e==="clone"&&/^\s*-u\b/.test(t))throw new H(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(e==="push"&&/^\s*--exec\b/.test(t))throw new H(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function Na({allowUnsafeProtocolOverride:t=!1,allowUnsafePack:e=!1}={}){return{type:"spawn.args",action(r,s){return r.forEach((n,i)=>{let o=i<r.length?r[i+1]:"";t||Aa(n,o),e||Ma(n,s.method)}),r}}}var Ia=c({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";kt()}});function Pa(t){let e=bt(t,"-c");return{type:"spawn.args",action(r){return[...e,...r]}}}var Da=c({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";_()}});function La({onClose:t=!0,onExit:e=50}={}){function r(){let n=-1,i={close:(0,lt.deferred)(),closeTimeout:(0,lt.deferred)(),exit:(0,lt.deferred)(),exitTimeout:(0,lt.deferred)()},o=Promise.race([t===!1?Me:i.closeTimeout.promise,e===!1?Me:i.exitTimeout.promise]);return s(t,i.close,i.closeTimeout),s(e,i.exit,i.exitTimeout),{close(a){n=a,i.close.done()},exit(a){n=a,i.exit.done()},get exitCode(){return n},result:o}}function s(n,i,o){n!==!1&&(n===!0?i.promise:i.promise.then(()=>Se(n))).then(o.done)}return{type:"spawn.after",async action(n,{spawned:i,close:o}){let a=r(),u=!0,h=()=>void(u=!1);i.stdout?.on("data",h),i.stderr?.on("data",h),i.on("error",h),i.on("close",l=>a.close(l)),i.on("exit",l=>a.exit(l));try{await a.result,u&&await Se(50),o(a.exitCode)}catch(l){o(a.exitCode,l)}}}}var lt,Me,ja=c({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";lt=be(),_(),Me=(0,lt.deferred)().promise}});function $a(t){return!t||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(t)}function Mr(t,e){if(t.length<1||t.length>2)throw new H(void 0,"binary",rn);if(t.some($a))if(e)console.warn(Ne);else throw new H(void 0,"binary",Ne);let[s,n]=t;return{binary:s,prefix:n}}function Ba(t,e=["git"],r=!1){let s=Mr(J(e),r);t.on("binary",n=>{s=Mr(J(n),r)}),t.append("spawn.binary",()=>s.binary),t.append("spawn.args",n=>s.prefix?[s.prefix,...n]:n)}var rn,Ne,Ga=c({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";kt(),_(),rn="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",Ne="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function Ua(t){return!!(t.exitCode&&t.stdErr.length)}function qa(t){return Buffer.concat([...t.stdOut,...t.stdErr])}function Xa(t=!1,e=Ua,r=qa){return(s,n)=>!t&&s||!e(n)?s:r(n)}function Nr(t){return{type:"task.error",action(e,r){let s=t(e.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(s)?{error:new z(void 0,s.toString("utf-8"))}:{error:s}}}}var Ha=c({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";V()}}),Ir,sn,Ya=c({"src/lib/plugins/plugin-store.ts"(){"use strict";Ir=require("node:events"),_(),sn=class{constructor(){this.plugins=new Set,this.events=new Ir.EventEmitter}on(t,e){this.events.on(t,e)}reconfigure(t,e){this.events.emit(t,e)}append(t,e){let r=T(this.plugins,{type:t,action:e});return()=>this.plugins.delete(r)}add(t){let e=[];return J(t).forEach(r=>r&&this.plugins.add(T(e,r))),()=>{e.forEach(r=>this.plugins.delete(r))}}exec(t,e,r){let s=e,n=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===t&&(s=i.action(s,n));return s}}}});function Wa(t){let e="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?ys(i,e):i}},{type:"spawn.after",action(i,o){o.commands.includes(e)&&o.spawned.stderr?.on("data",a=>{let u=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));u&&t({method:o.method,stage:za(u[1]),progress:k(u[2]),processed:k(u[3]),total:k(u[4])})})}}]}function za(t){return String(t.toLowerCase().split(" ",1))||"unknown"}var Ja=c({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";_()}}),Ka=c({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function Qa(t){let e=bs(t,["uid","gid"]);return{type:"spawn.options",action(r){return{...e,...r}}}}var Va=c({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";_()}});function Za({block:t,stdErr:e=!0,stdOut:r=!0}){if(t>0)return{type:"spawn.after",action(s,n){let i;function o(){i&&clearTimeout(i),i=setTimeout(u,t)}function a(){n.spawned.stdout?.off("data",o),n.spawned.stderr?.off("data",o),n.spawned.off("exit",a),n.spawned.off("close",a),i&&clearTimeout(i)}function u(){a(),n.kill(new H(void 0,"timeout","block timeout reached"))}r&&n.spawned.stdout?.on("data",o),e&&n.spawned.stderr?.on("data",o),n.spawned.on("exit",a),n.spawned.on("close",a),o()}}}var tc=c({"src/lib/plugins/timout-plugin.ts"(){"use strict";kt()}}),ec=c({"src/lib/plugins/index.ts"(){"use strict";xa(),Ia(),Da(),ja(),Ga(),Ha(),Ya(),Ja(),Ka(),Va(),tc()}});function rc(){return{type:"spawn.args",action(t){let e=[],r;function s(n){(r=r||[]).push(...n)}for(let n=0;n<t.length;n++){let i=t[n];if(Ut(i)){s(Fr(i));continue}if(i==="--"){s(t.slice(n+1).flatMap(o=>Ut(o)&&Fr(o)||o));break}e.push(i)}return r?[...e,"--",...r.map(String)]:e}}}var sc=c({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";vt()}});function nc(){return(0,$t.default)("simple-git")}function Pr(t,e,r){return!e||!String(e).replace(/\s*/,"")?r?(s,...n)=>{t(s,...n),r(s,...n)}:t:(s,...n)=>{t(`%s ${s}`,e,...n),r&&r(s,...n)}}function ic(t,e,{namespace:r}){if(typeof t=="string")return t;let s=e&&e.namespace||"";return s.startsWith(r)?s.substr(r.length+1):s||r}function tr(t,e,r,s=nc()){let n=t&&`[${t}]`||"",i=[],o=typeof e=="string"?s.extend(e):e,a=ic(U(e,x),o,s);return h(r);function u(l,p){return T(i,tr(t,a.replace(/^[^:]+/,l),p,s))}function h(l){let p=l&&`[${l}]`||"",d=o&&Pr(o,p)||nt,m=Pr(s,`${n} ${p}`,d);return Object.assign(o?d:m,{label:t,sibling:u,info:m,step:h})}}var $t,nn=c({"src/lib/git-logger.ts"(){"use strict";$t=zo(ye()),_(),$t.default.formatters.L=t=>String(Zt(t)?t.length:"-"),$t.default.formatters.B=t=>Buffer.isBuffer(t)?t.toString("utf8"):Et(t)}}),on,oc=c({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";V(),nn(),on=class Ie{constructor(e="GitExecutor"){this.logLabel=e,this._queue=new Map}withProgress(e){return this._queue.get(e)}createProgress(e){let r=Ie.getName(e.commands[0]),s=tr(this.logLabel,r);return{task:e,logger:s,name:r}}push(e){let r=this.createProgress(e);return r.logger("Adding task to the queue, commands = %o",e.commands),this._queue.set(e,r),r}fatal(e){for(let[r,{logger:s}]of Array.from(this._queue.entries()))r===e.task?(s.info("Failed %o",e),s("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):s.info("A fatal exception occurred in a previous task, the queue has been purged: %o",e.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(e){this.withProgress(e)&&this._queue.delete(e)}attempt(e){let r=this.withProgress(e);if(!r)throw new z(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(e="empty"){return`task:${e}:${++Ie.counter}`}static{this.counter=0}}}});function et(t,e){return{method:hs(t.commands)||"",commands:e}}function ac(t,e){return r=>{e("[ERROR] child process exception %o",r),t.push(Buffer.from(String(r.stack),"ascii"))}}function Dr(t,e,r,s){return n=>{r("%s received %L bytes",e,n),s("%B",n),t.push(n)}}var Lr,Pe,cc=c({"src/lib/runners/git-executor-chain.ts"(){"use strict";Lr=require("child_process"),V(),O(),_(),oc(),Pe=class{constructor(t,e,r){this._executor=t,this._scheduler=e,this._plugins=r,this._chain=Promise.resolve(),this._queue=new on}get cwd(){return this._cwd||this._executor.cwd}set cwd(t){this._cwd=t}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(t){return this._queue.push(t),this._chain=this._chain.then(()=>this.attemptTask(t))}async attemptTask(t){let e=await this._scheduler.next(),r=()=>this._queue.complete(t);try{let{logger:s}=this._queue.attempt(t);return await(js(t)?this.attemptEmptyTask(t,s):this.attemptRemoteTask(t,s))}catch(s){throw this.onFatalException(t,s)}finally{r(),e()}}onFatalException(t,e){let r=e instanceof z?Object.assign(e,{task:t}):new z(t,e&&String(e));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(t,e){let r=this._plugins.exec("spawn.binary","",et(t,t.commands)),s=this._plugins.exec("spawn.args",[...t.commands],et(t,t.commands)),n=await this.gitResponse(t,r,s,this.outputHandler,e.step("SPAWN")),i=await this.handleTaskData(t,s,n,e.step("HANDLE"));return e("passing response to task's parser as a %s",t.format),Ls(t)?Fe(t.parser,i):Fe(t.parser,i.asStrings())}async attemptEmptyTask(t,e){return e("empty task bypassing child process to call to task's parser"),t.parser(this)}handleTaskData(t,e,r,s){let{exitCode:n,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((u,h)=>{s("Preparing to handle process response exitCode=%d stdOut=",n);let{error:l}=this._plugins.exec("task.error",{error:i},{...et(t,e),...r});if(l&&t.onError)return s.info("exitCode=%s handling with custom error handler"),t.onError(r,l,p=>{s.info("custom error handler treated as success"),s("custom error returned a %s",Et(p)),u(new Xt(Array.isArray(p)?Buffer.concat(p):p,Buffer.concat(a)))},h);if(l)return s.info("handling as error: exitCode=%s stdErr=%s rejection=%o",n,a.length,i),h(l);s.info("retrieving task output complete"),u(new Xt(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(t,e,r,s,n){let i=n.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},et(t,t.commands));return new Promise(a=>{let u=[],h=[];n.info("%s %o",e,r),n("%O",o);let l=this._beforeSpawn(t,r);if(l)return a({stdOut:u,stdErr:h,exitCode:9901,rejection:l});this._plugins.exec("spawn.before",void 0,{...et(t,r),kill(d){l=d||l}});let p=(0,Lr.spawn)(e,r,o);p.stdout.on("data",Dr(u,"stdOut",n,i.step("stdOut"))),p.stderr.on("data",Dr(h,"stdErr",n,i.step("stdErr"))),p.on("error",ac(h,n)),s&&(n("Passing child process stdOut/stdErr to custom outputHandler"),s(e,p.stdout,p.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...et(t,r),spawned:p,close(d,m){a({stdOut:u,stdErr:h,exitCode:d,rejection:l||m})},kill(d){p.killed||(l=d,p.kill("SIGINT"))}})})}_beforeSpawn(t,e){let r;return this._plugins.exec("spawn.before",void 0,{...et(t,e),kill(s){r=s||r}}),r}}}}),an={};S(an,{GitExecutor:()=>cn});var cn,uc=c({"src/lib/runners/git-executor.ts"(){"use strict";cc(),cn=class{constructor(t,e,r){this.cwd=t,this._scheduler=e,this._plugins=r,this._chain=new Pe(this,this._scheduler,this._plugins)}chain(){return new Pe(this,this._scheduler,this._plugins)}push(t){return this._chain.push(t)}}}});function lc(t,e,r=nt){let s=i=>{r(null,i)},n=i=>{i?.task===t&&r(i instanceof st?fc(i):i,void 0)};e.then(s,n)}function fc(t){let e=s=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${s} should be GitResponseError.git.${s}, this will no longer be available in version 3`),e=nt};return Object.create(t,Object.getOwnPropertyNames(t.git).reduce(r,{}));function r(s,n){return n in t||(s[n]={enumerable:!1,configurable:!1,get(){return e(n),t.git[n]}}),s}}var pc=c({"src/lib/task-callback.ts"(){"use strict";pt(),_()}});function jr(t,e){return Ps(r=>{if(!He(t))throw new Error(`Git.cwd: cannot change to non-directory "${t}"`);return(e||r).cwd=t})}var dc=c({"src/lib/tasks/change-working-directory.ts"(){"use strict";_(),O()}});function ve(t){let e=["checkout",...t];return e[1]==="-b"&&e.includes("-B")&&(e[1]=Kt(e,"-B")),I(e)}function mc(){return{checkout(){return this._runTask(ve(L(arguments,1)),C(arguments))},checkoutBranch(t,e){return this._runTask(ve(["-b",t,e,...L(arguments)]),C(arguments))},checkoutLocalBranch(t){return this._runTask(ve(["-b",t,...L(arguments)]),C(arguments))}}}var hc=c({"src/lib/tasks/checkout.ts"(){"use strict";_(),O()}});function gc(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function yc(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(t){return $(gc(),[un],t)}})}}}var un,_c=c({"src/lib/tasks/count-objects.ts"(){"use strict";_(),un=new b(/([a-z-]+): (\d+)$/,(t,[e,r])=>{let s=_s(e);Object.hasOwn(t,s)&&(t[s]=k(r))})}});function bc(t){return $({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},ln,t)}var ln,Tc=c({"src/lib/parsers/parse-commit.ts"(){"use strict";_(),ln=[new b(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(t,[e,r,s])=>{t.branch=e,t.commit=s,t.root=!!r}),new b(/\s*Author:\s(.+)/i,(t,[e])=>{let r=e.split("<"),s=r.pop();!s||!s.includes("@")||(t.author={email:s.substr(0,s.length-1),name:r.join("<").trim()})}),new b(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0,t.summary.insertions=parseInt(r,10)||0,t.summary.deletions=parseInt(s,10)||0}),new b(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0;let n=parseInt(r,10)||0;s==="-"?t.summary.deletions=n:s==="+"&&(t.summary.insertions=n)})]}});function vc(t,e,r){return{commands:["-c","core.abbrev=40","commit",...bt(t,"-m"),...e,...r],format:"utf-8",parser:bc}}function kc(){return{commit(e,...r){let s=C(arguments),n=t(e)||vc(J(e),J(U(r[0],qt,[])),[...dt(U(r[1],St,[])),...L(arguments,0,!0)]);return this._runTask(n,s)}};function t(e){return!qt(e)&&j("git.commit: requires the commit message to be supplied as a string/string[]")}}var wc=c({"src/lib/tasks/commit.ts"(){"use strict";Tc(),_(),O()}});function Ec(){return{firstCommit(){return this._runTask(I(["rev-list","--max-parents=0","HEAD"],!0),C(arguments))}}}var Sc=c({"src/lib/tasks/first-commit.ts"(){"use strict";_(),O()}});function Cc(t,e){let r=["hash-object",t];return e&&r.push("-w"),I(r,!0)}var Oc=c({"src/lib/tasks/hash-object.ts"(){"use strict";O()}});function Rc(t,e,r){let s=String(r).trim(),n;if(n=fn.exec(s))return new Bt(t,e,!1,n[1]);if(n=pn.exec(s))return new Bt(t,e,!0,n[1]);let i="",o=s.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new Bt(t,e,/^re/i.test(s),i)}var Bt,fn,pn,xc=c({"src/lib/responses/InitSummary.ts"(){"use strict";Bt=class{constructor(t,e,r,s){this.bare=t,this.path=e,this.existing=r,this.gitDir=s}},fn=/^Init.+ repository in (.+)$/,pn=/^Rein.+ in (.+)$/}});function Fc(t){return t.includes(er)}function Ac(t=!1,e,r){let s=["init",...r];return t&&!Fc(s)&&s.splice(1,0,er),{commands:s,format:"utf-8",parser(n){return Rc(s.includes("--bare"),e,n)}}}var er,Mc=c({"src/lib/tasks/init.ts"(){"use strict";xc(),er="--bare"}});function rr(t){for(let e=0;e<t.length;e++){let r=sr.exec(t[e]);if(r)return`--${r[1]}`}return""}function Nc(t){return sr.test(t)}var sr,Ct=c({"src/lib/args/log-format.ts"(){"use strict";sr=/^--(stat|numstat|name-only|name-status)(=|$)/}}),dn,Ic=c({"src/lib/responses/DiffSummary.ts"(){"use strict";dn=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function mn(t=""){let e=hn[t];return r=>$(new dn,e,r,!1)}var ke,$r,Br,Gr,hn,gn=c({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Ct(),Ic(),Ys(),_(),ke=[new b(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(t,[e,r,s=""])=>{t.files.push({file:e.trim(),changes:k(r),insertions:s.replace(/[^+]/g,"").length,deletions:s.replace(/[^-]/g,"").length,binary:!1})}),new b(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(t,[e,r,s])=>{t.files.push({file:e.trim(),before:k(r),after:k(s),binary:!0})}),new b(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(t,[e,r])=>{let s=/(\d+) i/.exec(r),n=/(\d+) d/.exec(r);t.changed=k(e),t.insertions=k(s?.[1]),t.deletions=k(n?.[1])})],$r=[new b(/(\d+)\t(\d+)\t(.+)$/,(t,[e,r,s])=>{let n=k(e),i=k(r);t.changed++,t.insertions+=n,t.deletions+=i,t.files.push({file:s,changes:n+i,insertions:n,deletions:i,binary:!1})}),new b(/-\t-\t(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,after:0,before:0,binary:!0})})],Br=[new b(/(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,changes:0,insertions:0,deletions:0,binary:!1})})],Gr=[new b(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(t,[e,r,s,n,i])=>{t.changed++,t.files.push({file:i??s,changes:0,insertions:0,deletions:0,binary:!1,status:Ce(ka(e)&&e),from:Ce(!!i&&s!==i&&s),similarity:k(r)})})],hn={"":ke,"--stat":ke,"--numstat":$r,"--name-status":Gr,"--name-only":Br}}});function Pc(t,e){return e.reduce((r,s,n)=>(r[s]=t[n]||"",r),Object.create({diff:null}))}function yn(t=or,e=_n,r=""){let s=mn(r);return function(n){let i=wt(n.trim(),!1,nr).map(function(o){let a=o.split(ir),u=Pc(a[0].split(t),e);return a.length>1&&a[1].trim()&&(u.diff=s(a[1])),u});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var nr,ir,or,_n,bn=c({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";_(),gn(),Ct(),nr="\xF2\xF2\xF2\xF2\xF2\xF2 ",ir=" \xF2\xF2",or=" \xF2 ",_n=["hash","date","message","refs","author_name","author_email"]}}),Tn={};S(Tn,{diffSummaryTask:()=>Dc,validateLogFormatConfig:()=>re});function Dc(t){let e=rr(t),r=["diff"];return e===""&&(e="--stat",r.push("--stat=4096")),r.push(...t),re(r)||{commands:r,format:"utf-8",parser:mn(e)}}function re(t){let e=t.filter(Nc);if(e.length>1)return j(`Summary flags are mutually exclusive - pick one of ${e.join(",")}`);if(e.length&&t.includes("-z"))return j(`Summary flag ${e} parsing is not compatible with null termination option '-z'`)}var ar=c({"src/lib/tasks/diff.ts"(){"use strict";Ct(),gn(),O()}});function Lc(t,e){let r=[],s=[];return Object.keys(t).forEach(n=>{r.push(n),s.push(String(t[n]))}),[r,s.join(e)]}function jc(t){return Object.keys(t).reduce((e,r)=>(r in De||(e[r]=t[r]),e),{})}function vn(t={},e=[]){let r=U(t.splitter,x,or),s=Vt(t.format)?t.format:{hash:"%H",date:t.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:t.multiLine?"%B":"%b",author_name:t.mailMap!==!1?"%aN":"%an",author_email:t.mailMap!==!1?"%aE":"%ae"},[n,i]=Lc(s,r),o=[],a=[`--pretty=format:${nr}${i}${ir}`,...e],u=t.n||t["max-count"]||t.maxCount;if(u&&a.push(`--max-count=${u}`),t.from||t.to){let h=t.symmetric!==!1?"...":"..";o.push(`${t.from||""}${h}${t.to||""}`)}return x(t.file)&&a.push("--follow",ls(t.file)),We(jc(t),a),{fields:n,splitter:r,commands:[...a,...o]}}function $c(t,e,r){let s=yn(t,e,rr(r));return{commands:["log",...r],format:"utf-8",parser:s}}function Bc(){return{log(...r){let s=C(arguments),n=vn(ze(arguments),dt(U(arguments[0],St,[]))),i=e(...r)||re(n.commands)||t(n);return this._runTask(i,s)}};function t(r){return $c(r.splitter,r.fields,r.commands)}function e(r,s){return x(r)&&x(s)&&j("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var De,kn=c({"src/lib/tasks/log.ts"(){"use strict";Ct(),vt(),bn(),_(),O(),ar(),De=(t=>(t[t["--pretty"]=0]="--pretty",t[t["max-count"]=1]="max-count",t[t.maxCount=2]="maxCount",t[t.n=3]="n",t[t.file=4]="file",t[t.format=5]="format",t[t.from=6]="from",t[t.to=7]="to",t[t.splitter=8]="splitter",t[t.symmetric=9]="symmetric",t[t.mailMap=10]="mailMap",t[t.multiLine=11]="multiLine",t[t.strictDate=12]="strictDate",t))(De||{})}}),Gt,wn,Gc=c({"src/lib/responses/MergeSummary.ts"(){"use strict";Gt=class{constructor(t,e=null,r){this.reason=t,this.file=e,this.meta=r}toString(){return`${this.file}:${this.reason}`}},wn=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),Le,En,Uc=c({"src/lib/responses/PullSummary.ts"(){"use strict";Le=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},En=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function we(t){return t.objects=t.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function Ur(t){let e=/^\s*(\d+)/.exec(t),r=/delta (\d+)/i.exec(t);return{count:k(e&&e[1]||"0"),delta:k(r&&r[1]||"0")}}var Sn,qc=c({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";_(),Sn=[new Q(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=we(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new Q(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=we(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new Q(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(t,[e,r,s])=>{let n=we(t.remoteMessages);n.total=Ur(e),n.reused=Ur(r),n.packReused=k(s)})]}});function Cn(t,e){return $({remoteMessages:new Rn},On,e)}var On,Rn,xn=c({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";_(),qc(),On=[new Q(/^remote:\s*(.+)$/,(t,[e])=>(t.remoteMessages.all.push(e.trim()),!1)),...Sn,new Q([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(t,[e])=>{t.remoteMessages.pullRequestUrl=e}),new Q([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(t,[e,r,s])=>{t.remoteMessages.vulnerabilities={count:k(e),summary:r,url:s}})],Rn=class{constructor(){this.all=[]}}}});function Xc(t,e){let r=$(new En,Fn,[t,e]);return r.message&&r}var qr,Xr,Hr,Yr,Fn,Wr,cr,An=c({"src/lib/parsers/parse-pull.ts"(){"use strict";Uc(),_(),xn(),qr=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,Xr=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,Hr=/^(create|delete) mode \d+ (.+)/,Yr=[new b(qr,(t,[e,r,s])=>{t.files.push(e),r&&(t.insertions[e]=r.length),s&&(t.deletions[e]=s.length)}),new b(Xr,(t,[e,,r,,s])=>r!==void 0||s!==void 0?(t.summary.changes=+e||0,t.summary.insertions=+r||0,t.summary.deletions=+s||0,!0):!1),new b(Hr,(t,[e,r])=>{T(t.files,r),T(e==="create"?t.created:t.deleted,r)})],Fn=[new b(/^from\s(.+)$/i,(t,[e])=>void(t.remote=e)),new b(/^fatal:\s(.+)$/,(t,[e])=>void(t.message=e)),new b(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(t,[e,r,s,n])=>{t.branch.local=s,t.hash.local=e,t.branch.remote=n,t.hash.remote=r})],Wr=(t,e)=>$(new Le,Yr,[t,e]),cr=(t,e)=>Object.assign(new Le,Wr(t,e),Cn(t,e))}}),zr,Mn,Jr,Hc=c({"src/lib/parsers/parse-merge.ts"(){"use strict";Gc(),_(),An(),zr=[new b(/^Auto-merging\s+(.+)$/,(t,[e])=>{t.merges.push(e)}),new b(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(t,[e,r])=>{t.conflicts.push(new Gt(e,r))}),new b(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(t,[e,r,s])=>{t.conflicts.push(new Gt(e,r,{deleteRef:s}))}),new b(/^CONFLICT\s+\((.+)\):/,(t,[e])=>{t.conflicts.push(new Gt(e,null))}),new b(/^Automatic merge failed;\s+(.+)$/,(t,[e])=>{t.result=e})],Mn=(t,e)=>Object.assign(Jr(t,e),cr(t,e)),Jr=t=>$(new wn,zr,t)}});function Kr(t){return t.length?{commands:["merge",...t],format:"utf-8",parser(e,r){let s=Mn(e,r);if(s.failed)throw new st(s);return s}}:j("Git.merge requires at least one option")}var Yc=c({"src/lib/tasks/merge.ts"(){"use strict";pt(),Hc(),O()}});function Wc(t,e,r){let s=r.includes("deleted"),n=r.includes("tag")||/^refs\/tags/.test(t),i=!r.includes("new");return{deleted:s,tag:n,branch:!n,new:!i,alreadyUpdated:i,local:t,remote:e}}var Qr,Nn,Vr,zc=c({"src/lib/parsers/parse-push.ts"(){"use strict";_(),xn(),Qr=[new b(/^Pushing to (.+)$/,(t,[e])=>{t.repo=e}),new b(/^updating local tracking ref '(.+)'/,(t,[e])=>{t.ref={...t.ref||{},local:e}}),new b(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(t,[e,r,s])=>{t.pushed.push(Wc(e,r,s))}),new b(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(t,[e,r,s])=>{t.branch={...t.branch||{},local:e,remote:r,remoteName:s}}),new b(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(t,[e,r,s,n])=>{t.update={head:{local:e,remote:r},hash:{from:s,to:n}}})],Nn=(t,e)=>{let r=Vr(t,e),s=Cn(t,e);return{...r,...s}},Vr=(t,e)=>$({pushed:[]},Qr,[t,e])}}),In={};S(In,{pushTagsTask:()=>Jc,pushTask:()=>ur});function Jc(t={},e){return T(e,"--tags"),ur(t,e)}function ur(t={},e){let r=["push",...e];return t.branch&&r.splice(1,0,t.branch),t.remote&&r.splice(1,0,t.remote),Kt(r,"-v"),T(r,"--verbose"),T(r,"--porcelain"),{commands:r,format:"utf-8",parser:Nn}}var Pn=c({"src/lib/tasks/push.ts"(){"use strict";zc(),_()}});function Kc(){return{showBuffer(){let t=["show",...L(arguments,1)];return t.includes("--binary")||t.splice(1,0,"--binary"),this._runTask(Ds(t),C(arguments))},show(){let t=["show",...L(arguments,1)];return this._runTask(I(t),C(arguments))}}}var Qc=c({"src/lib/tasks/show.ts"(){"use strict";_(),O()}}),Zr,Dn,Vc=c({"src/lib/responses/FileStatusSummary.ts"(){"use strict";Zr=/^(.+)\0(.+)$/,Dn=class{constructor(t,e,r){if(this.path=t,this.index=e,this.working_dir=r,e==="R"||r==="R"){let s=Zr.exec(t)||[null,t,t];this.from=s[2]||"",this.path=s[1]||""}}}}});function ts(t){let[e,r]=t.split(ft);return{from:r||e,to:e}}function G(t,e,r){return[`${t}${e}`,r]}function Ee(t,...e){return e.map(r=>G(t,r,(s,n)=>T(s.conflicted,n)))}function Zc(t,e){let r=e.trim();switch(" "){case r.charAt(2):return s(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return s(" ",r.charAt(0),r.substr(2));default:return}function s(n,i,o){let a=`${n}${i}`,u=Ln.get(a);u&&u(t,o),a!=="##"&&a!=="!!"&&t.files.push(new Dn(o,n,i))}}var es,Ln,jn,tu=c({"src/lib/responses/StatusSummary.ts"(){"use strict";_(),Vc(),es=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},Ln=new Map([G(" ","A",(t,e)=>T(t.created,e)),G(" ","D",(t,e)=>T(t.deleted,e)),G(" ","M",(t,e)=>T(t.modified,e)),G("A"," ",(t,e)=>T(t.created,e)&&T(t.staged,e)),G("A","M",(t,e)=>T(t.created,e)&&T(t.staged,e)&&T(t.modified,e)),G("D"," ",(t,e)=>T(t.deleted,e)&&T(t.staged,e)),G("M"," ",(t,e)=>T(t.modified,e)&&T(t.staged,e)),G("M","M",(t,e)=>T(t.modified,e)&&T(t.staged,e)),G("R"," ",(t,e)=>{T(t.renamed,ts(e))}),G("R","M",(t,e)=>{let r=ts(e);T(t.renamed,r),T(t.modified,r.to)}),G("!","!",(t,e)=>{T(t.ignored=t.ignored||[],e)}),G("?","?",(t,e)=>T(t.not_added,e)),...Ee("A","A","U"),...Ee("D","D","U"),...Ee("U","A","D","U"),["##",(t,e)=>{let r=/ahead (\d+)/,s=/behind (\d+)/,n=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(e);t.ahead=a&&+a[1]||0,a=s.exec(e),t.behind=a&&+a[1]||0,a=n.exec(e),t.current=U(a?.[1],x,null),a=i.exec(e),t.tracking=U(a?.[1],x,null),a=o.exec(e),a&&(t.current=U(a?.[1],x,t.current)),t.detached=/\(no branch\)/.test(e)}]]),jn=function(t){let e=t.split(ft),r=new es;for(let s=0,n=e.length;s<n;){let i=e[s++].trim();i&&(i.charAt(0)==="R"&&(i+=ft+(e[s++]||"")),Zc(r,i))}return r}}});function eu(t){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...t.filter(r=>!$n.includes(r))],parser(r){return jn(r)}}}var $n,ru=c({"src/lib/tasks/status.ts"(){"use strict";tu(),$n=["--null","-z"]}});function Wt(t=0,e=0,r=0,s="",n=!0){return Object.defineProperty({major:t,minor:e,patch:r,agent:s,installed:n},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function su(){return Wt(0,0,0,"",!1)}function nu(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:iu,onError(t,e,r,s){if(t.exitCode===-2)return r(Buffer.from(lr));s(e)}})}}}function iu(t){return t===lr?su():$(Wt(0,0,0,t),Bn,t)}var lr,Bn,ou=c({"src/lib/tasks/version.ts"(){"use strict";_(),lr="installed=false",Bn=[new b(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(t,[e,r,s,n=""])=>{Object.assign(t,Wt(k(e),k(r),k(s),n))}),new b(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(t,[e,r,s,n=""])=>{Object.assign(t,Wt(k(e),k(r),s,n))})]}}),Gn={};S(Gn,{SimpleGitApi:()=>je});var je,au=c({"src/lib/simple-git-api.ts"(){"use strict";pc(),dc(),hc(),_c(),wc(),Xs(),Sc(),Ks(),Oc(),Mc(),kn(),Yc(),Pn(),Qc(),ru(),O(),ou(),_(),je=class{constructor(t){this._executor=t}_runTask(t,e){let r=this._executor.chain(),s=r.push(t);return e&&lc(t,s,e),Object.create(this,{then:{value:s.then.bind(s)},catch:{value:s.catch.bind(s)},_executor:{value:r}})}add(t){return this._runTask(I(["add",...J(t)]),C(arguments))}cwd(t){let e=C(arguments);return typeof t=="string"?this._runTask(jr(t,this._executor),e):typeof t?.path=="string"?this._runTask(jr(t.path,t.root&&this._executor||void 0),e):this._runTask(j("Git.cwd: workingDirectory must be supplied as a string"),e)}hashObject(t,e){return this._runTask(Cc(t,e===!0),C(arguments))}init(t){return this._runTask(Ac(t===!0,this._executor.cwd,L(arguments)),C(arguments))}merge(){return this._runTask(Kr(L(arguments)),C(arguments))}mergeFromTo(t,e){return x(t)&&x(e)?this._runTask(Kr([t,e,...L(arguments)]),C(arguments,!1)):this._runTask(j("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(t){return this._executor.outputHandler=t,this}push(){let t=ur({remote:U(arguments[0],x),branch:U(arguments[1],x)},L(arguments));return this._runTask(t,C(arguments))}stash(){return this._runTask(I(["stash",...L(arguments)]),C(arguments))}status(){return this._runTask(eu(L(arguments)),C(arguments))}},Object.assign(je.prototype,mc(),kc(),va(),yc(),Ec(),Ea(),Bc(),Kc(),nu())}}),Un={};S(Un,{Scheduler:()=>qn});var rs,ss,qn,cu=c({"src/lib/runners/scheduler.ts"(){"use strict";_(),rs=be(),nn(),ss=(()=>{let t=0;return()=>{t++;let{promise:e,done:r}=(0,rs.createDeferred)();return{promise:e,done:r,id:t}}})(),qn=class{constructor(t=2){this.concurrency=t,this.logger=tr("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",t)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let t=T(this.running,this.pending.shift());this.logger("Attempting id=%s",t.id),t.done(()=>{this.logger("Completing id=",t.id),Kt(this.running,t),this.schedule()})}next(){let{promise:t,id:e}=T(this.pending,ss());return this.logger("Scheduling id=%s",e),this.schedule(),t}}}}),Xn={};S(Xn,{applyPatchTask:()=>uu});function uu(t,e){return I(["apply",...e,...t])}var lu=c({"src/lib/tasks/apply-patch.ts"(){"use strict";O()}});function fu(t,e){return{branch:t,hash:e,success:!0}}function pu(t){return{branch:t,hash:null,success:!1}}var Hn,du=c({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";Hn=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Yn(t,e){return e===1&&$e.test(t)}var ns,$e,is,se,mu=c({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";du(),_(),ns=/(\S+)\s+\(\S+\s([^)]+)\)/,$e=/^error[^']+'([^']+)'/m,is=[new b(ns,(t,[e,r])=>{let s=fu(e,r);t.all.push(s),t.branches[e]=s}),new b($e,(t,[e])=>{let r=pu(e);t.errors.push(r),t.all.push(r),t.branches[e]=r})],se=(t,e)=>$(new Hn,is,[t,e])}}),Wn,hu=c({"src/lib/responses/BranchSummary.ts"(){"use strict";Wn=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(t,e,r,s,n){t==="*"&&(this.detached=e,this.current=r),this.all.push(r),this.branches[r]={current:t==="*",linkedWorkTree:t==="+",name:r,commit:s,label:n}}}}});function os(t){return t?t.charAt(0):""}function zn(t,e=!1){return $(new Wn,e?[Kn]:Jn,t)}var Jn,Kn,gu=c({"src/lib/parsers/parse-branch.ts"(){"use strict";hu(),_(),Jn=[new b(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(t,[e,r,s,n])=>{t.push(os(e),!0,r,s,n)}),new b(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(t,[e,r,s,n])=>{t.push(os(e),!1,r,s,n)})],Kn=new b(/^(\S+)$/s,(t,[e])=>{t.push("*",!1,e,"","")})}}),Qn={};S(Qn,{branchLocalTask:()=>_u,branchTask:()=>yu,containsDeleteBranchCommand:()=>Vn,deleteBranchTask:()=>Tu,deleteBranchesTask:()=>bu});function Vn(t){let e=["-d","-D","--delete"];return t.some(r=>e.includes(r))}function yu(t){let e=Vn(t),r=t.includes("--show-current"),s=["branch",...t];return s.length===1&&s.push("-a"),s.includes("-v")||s.splice(1,0,"-v"),{format:"utf-8",commands:s,parser(n,i){return e?se(n,i).all[0]:zn(n,r)}}}function _u(){return{format:"utf-8",commands:["branch","-v"],parser(t){return zn(t)}}}function bu(t,e=!1){return{format:"utf-8",commands:["branch","-v",e?"-D":"-d",...t],parser(r,s){return se(r,s)},onError({exitCode:r,stdOut:s},n,i,o){if(!Yn(String(n),r))return o(n);i(s)}}}function Tu(t,e=!1){let r={format:"utf-8",commands:["branch","-v",e?"-D":"-d",t],parser(s,n){return se(s,n).branches[t]},onError({exitCode:s,stdErr:n,stdOut:i},o,a,u){if(!Yn(String(o),s))return u(o);throw new st(r.parser(Tt(i),Tt(n)),String(o))}};return r}var vu=c({"src/lib/tasks/branch.ts"(){"use strict";pt(),mu(),gu(),_()}});function ku(t){let e=t.trim().replace(/^["']|["']$/g,"");return e&&(0,Zn.normalize)(e)}var Zn,ti,wu=c({"src/lib/responses/CheckIgnore.ts"(){"use strict";Zn=require("node:path"),ti=t=>t.split(/\n/g).map(ku).filter(Boolean)}}),ei={};S(ei,{checkIgnoreTask:()=>Eu});function Eu(t){return{commands:["check-ignore",...t],format:"utf-8",parser:ti}}var Su=c({"src/lib/tasks/check-ignore.ts"(){"use strict";wu()}}),ri={};S(ri,{cloneMirrorTask:()=>Ou,cloneTask:()=>si});function Cu(t){return/^--upload-pack(=|$)/.test(t)}function si(t,e,r){let s=["clone",...r];return x(t)&&s.push(t),x(e)&&s.push(e),s.find(Cu)?j("git.fetch: potential exploit argument blocked."):I(s)}function Ou(t,e,r){return T(r,"--mirror"),si(t,e,r)}var Ru=c({"src/lib/tasks/clone.ts"(){"use strict";O(),_()}});function xu(t,e){return $({raw:t,remote:null,branches:[],tags:[],updated:[],deleted:[]},ni,[t,e])}var ni,Fu=c({"src/lib/parsers/parse-fetch.ts"(){"use strict";_(),ni=[new b(/From (.+)$/,(t,[e])=>{t.remote=e}),new b(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.branches.push({name:e,tracking:r})}),new b(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.tags.push({name:e,tracking:r})}),new b(/- \[deleted]\s+\S+\s*-> (.+)$/,(t,[e])=>{t.deleted.push({tracking:e})}),new b(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(t,[e,r,s,n])=>{t.updated.push({name:s,tracking:n,to:r,from:e})})]}}),ii={};S(ii,{fetchTask:()=>Mu});function Au(t){return/^--upload-pack(=|$)/.test(t)}function Mu(t,e,r){let s=["fetch",...r];return t&&e&&s.push(t,e),s.find(Au)?j("git.fetch: potential exploit argument blocked."):{commands:s,format:"utf-8",parser:xu}}var Nu=c({"src/lib/tasks/fetch.ts"(){"use strict";Fu(),O()}});function Iu(t){return $({moves:[]},oi,t)}var oi,Pu=c({"src/lib/parsers/parse-move.ts"(){"use strict";_(),oi=[new b(/^Renaming (.+) to (.+)$/,(t,[e,r])=>{t.moves.push({from:e,to:r})})]}}),ai={};S(ai,{moveTask:()=>Du});function Du(t,e){return{commands:["mv","-v",...J(t),e],format:"utf-8",parser:Iu}}var Lu=c({"src/lib/tasks/move.ts"(){"use strict";Pu(),_()}}),ci={};S(ci,{pullTask:()=>ju});function ju(t,e,r){let s=["pull",...r];return t&&e&&s.splice(1,0,t,e),{commands:s,format:"utf-8",parser(n,i){return cr(n,i)},onError(n,i,o,a){let u=Xc(Tt(n.stdOut),Tt(n.stdErr));if(u)return a(new st(u));a(i)}}}var $u=c({"src/lib/tasks/pull.ts"(){"use strict";pt(),An(),_()}});function Bu(t){let e={};return ui(t,([r])=>e[r]={name:r}),Object.values(e)}function Gu(t){let e={};return ui(t,([r,s,n])=>{Object.hasOwn(e,r)||(e[r]={name:r,refs:{fetch:"",push:""}}),n&&s&&(e[r].refs[n.replace(/[^a-z]/g,"")]=s)}),Object.values(e)}function ui(t,e){Xe(t,r=>e(r.split(/\s+/)))}var Uu=c({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";_()}}),li={};S(li,{addRemoteTask:()=>qu,getRemotesTask:()=>Xu,listRemotesTask:()=>Hu,remoteTask:()=>Yu,removeRemoteTask:()=>Wu});function qu(t,e,r){return I(["remote","add",...r,t,e])}function Xu(t){let e=["remote"];return t&&e.push("-v"),{commands:e,format:"utf-8",parser:t?Gu:Bu}}function Hu(t){let e=[...t];return e[0]!=="ls-remote"&&e.unshift("ls-remote"),I(e)}function Yu(t){let e=[...t];return e[0]!=="remote"&&e.unshift("remote"),I(e)}function Wu(t){return I(["remote","remove",t])}var zu=c({"src/lib/tasks/remote.ts"(){"use strict";Uu(),O()}}),fi={};S(fi,{stashListTask:()=>Ju});function Ju(t={},e){let r=vn(t),s=["stash","list",...r.commands,...e],n=yn(r.splitter,r.fields,rr(s));return re(s)||{commands:s,format:"utf-8",parser:n}}var Ku=c({"src/lib/tasks/stash-list.ts"(){"use strict";Ct(),bn(),ar(),kn()}}),pi={};S(pi,{addSubModuleTask:()=>Qu,initSubModuleTask:()=>Vu,subModuleTask:()=>ne,updateSubModuleTask:()=>Zu});function Qu(t,e){return ne(["add",t,e])}function Vu(t){return ne(["init",...t])}function ne(t){let e=[...t];return e[0]!=="submodule"&&e.unshift("submodule"),I(e)}function Zu(t){return ne(["update",...t])}var tl=c({"src/lib/tasks/sub-module.ts"(){"use strict";O()}});function el(t,e){let r=Number.isNaN(t),s=Number.isNaN(e);return r!==s?r?1:-1:r?di(t,e):0}function di(t,e){return t===e?0:t>e?1:-1}function rl(t){return t.trim()}function Lt(t){return typeof t=="string"&&parseInt(t.replace(/^\D+/g,""),10)||0}var as,mi,sl=c({"src/lib/responses/TagList.ts"(){"use strict";as=class{constructor(t,e){this.all=t,this.latest=e}},mi=function(t,e=!1){let r=t.split(`
`).map(rl).filter(Boolean);e||r.sort(function(n,i){let o=n.split("."),a=i.split(".");if(o.length===1||a.length===1)return el(Lt(o[0]),Lt(a[0]));for(let u=0,h=Math.max(o.length,a.length);u<h;u++){let l=di(Lt(o[u]),Lt(a[u]));if(l)return l}return 0});let s=e?r[0]:[...r].reverse().find(n=>n.indexOf(".")>=0);return new as(r,s)}}}),hi={};S(hi,{addAnnotatedTagTask:()=>ol,addTagTask:()=>il,tagListTask:()=>nl});function nl(t=[]){let e=t.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...t],parser(r){return mi(r,e)}}}function il(t){return{format:"utf-8",commands:["tag",t],parser(){return{name:t}}}}function ol(t,e){return{format:"utf-8",commands:["tag","-a","-m",e,t],parser(){return{name:t}}}}var al=c({"src/lib/tasks/tag.ts"(){"use strict";sl()}}),cl=Wo({"src/git.js"(t,e){"use strict";var{GitExecutor:r}=(uc(),E(an)),{SimpleGitApi:s}=(au(),E(Gn)),{Scheduler:n}=(cu(),E(Un)),{configurationErrorTask:i}=(O(),E(Ae)),{asArray:o,filterArray:a,filterPrimitives:u,filterString:h,filterStringOrStringArray:l,filterType:p,getTrailingOptions:d,trailingFunctionArgument:m,trailingOptionsArgument:F}=(_(),E(Cs)),{applyPatchTask:w}=(lu(),E(Xn)),{branchTask:M,branchLocalTask:q,deleteBranchesTask:K,deleteBranchTask:Ft}=(vu(),E(Qn)),{checkIgnoreTask:it}=(Su(),E(ei)),{checkIsRepoTask:yr}=(Fs(),E(Os)),{cloneTask:ht,cloneMirrorTask:ue}=(Ru(),E(ri)),{cleanWithOptionsTask:At,isCleanOptionsArray:le}=(Gs(),E($s)),{diffSummaryTask:Yi}=(ar(),E(Tn)),{fetchTask:Wi}=(Nu(),E(ii)),{moveTask:zi}=(Lu(),E(ai)),{pullTask:Ji}=($u(),E(ci)),{pushTagsTask:Ki}=(Pn(),E(In)),{addRemoteTask:Qi,getRemotesTask:Vi,listRemotesTask:Zi,remoteTask:to,removeRemoteTask:eo}=(zu(),E(li)),{getResetMode:ro,resetTask:so}=(tn(),E(Qs)),{stashListTask:no}=(Ku(),E(fi)),{addSubModuleTask:io,initSubModuleTask:oo,subModuleTask:ao,updateSubModuleTask:co}=(tl(),E(pi)),{addAnnotatedTagTask:uo,addTagTask:lo,tagListTask:fo}=(al(),E(hi)),{straightThroughBufferTask:po,straightThroughStringTask:W}=(O(),E(Ae));function y(f,g){this._plugins=g,this._executor=new r(f.baseDir,new n(f.maxConcurrentProcesses),g),this._trimmed=f.trimmed}(y.prototype=Object.create(s.prototype)).constructor=y,y.prototype.customBinary=function(f){return this._plugins.reconfigure("binary",f),this},y.prototype.env=function(f,g){return arguments.length===1&&typeof f=="object"?this._executor.env=f:(this._executor.env=this._executor.env||{})[f]=g,this},y.prototype.stashList=function(f){return this._runTask(no(F(arguments)||{},a(f)&&f||[]),m(arguments))};function _r(f,g,v,N){return typeof v!="string"?i(`git.${f}() requires a string 'repoPath'`):g(v,p(N,h),d(arguments))}y.prototype.clone=function(){return this._runTask(_r("clone",ht,...arguments),m(arguments))},y.prototype.mirror=function(){return this._runTask(_r("mirror",ue,...arguments),m(arguments))},y.prototype.mv=function(f,g){return this._runTask(zi(f,g),m(arguments))},y.prototype.checkoutLatestTag=function(f){var g=this;return this.pull(function(){g.tags(function(v,N){g.checkout(N.latest,f)})})},y.prototype.pull=function(f,g,v,N){return this._runTask(Ji(p(f,h),p(g,h),d(arguments)),m(arguments))},y.prototype.fetch=function(f,g){return this._runTask(Wi(p(f,h),p(g,h),d(arguments)),m(arguments))},y.prototype.silent=function(f){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},y.prototype.tags=function(f,g){return this._runTask(fo(d(arguments)),m(arguments))},y.prototype.rebase=function(){return this._runTask(W(["rebase",...d(arguments)]),m(arguments))},y.prototype.reset=function(f){return this._runTask(so(ro(f),d(arguments)),m(arguments))},y.prototype.revert=function(f){let g=m(arguments);return typeof f!="string"?this._runTask(i("Commit must be a string"),g):this._runTask(W(["revert",...d(arguments,0,!0),f]),g)},y.prototype.addTag=function(f){let g=typeof f=="string"?lo(f):i("Git.addTag requires a tag name");return this._runTask(g,m(arguments))},y.prototype.addAnnotatedTag=function(f,g){return this._runTask(uo(f,g),m(arguments))},y.prototype.deleteLocalBranch=function(f,g,v){return this._runTask(Ft(f,typeof g=="boolean"?g:!1),m(arguments))},y.prototype.deleteLocalBranches=function(f,g,v){return this._runTask(K(f,typeof g=="boolean"?g:!1),m(arguments))},y.prototype.branch=function(f,g){return this._runTask(M(d(arguments)),m(arguments))},y.prototype.branchLocal=function(f){return this._runTask(q(),m(arguments))},y.prototype.raw=function(f){let g=!Array.isArray(f),v=[].slice.call(g?arguments:f,0);for(let X=0;X<v.length&&g;X++)if(!u(v[X])){v.splice(X,v.length-X);break}v.push(...d(arguments,0,!0));var N=m(arguments);return v.length?this._runTask(W(v,this._trimmed),N):this._runTask(i("Raw: must supply one or more command to execute"),N)},y.prototype.submoduleAdd=function(f,g,v){return this._runTask(io(f,g),m(arguments))},y.prototype.submoduleUpdate=function(f,g){return this._runTask(co(d(arguments,!0)),m(arguments))},y.prototype.submoduleInit=function(f,g){return this._runTask(oo(d(arguments,!0)),m(arguments))},y.prototype.subModule=function(f,g){return this._runTask(ao(d(arguments)),m(arguments))},y.prototype.listRemote=function(){return this._runTask(Zi(d(arguments)),m(arguments))},y.prototype.addRemote=function(f,g,v){return this._runTask(Qi(f,g,d(arguments)),m(arguments))},y.prototype.removeRemote=function(f,g){return this._runTask(eo(f),m(arguments))},y.prototype.getRemotes=function(f,g){return this._runTask(Vi(f===!0),m(arguments))},y.prototype.remote=function(f,g){return this._runTask(to(d(arguments)),m(arguments))},y.prototype.tag=function(f,g){let v=d(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(W(v),m(arguments))},y.prototype.updateServerInfo=function(f){return this._runTask(W(["update-server-info"]),m(arguments))},y.prototype.pushTags=function(f,g){let v=Ki({remote:p(f,h)},d(arguments));return this._runTask(v,m(arguments))},y.prototype.rm=function(f){return this._runTask(W(["rm","-f",...o(f)]),m(arguments))},y.prototype.rmKeepLocal=function(f){return this._runTask(W(["rm","--cached",...o(f)]),m(arguments))},y.prototype.catFile=function(f,g){return this._catFile("utf-8",arguments)},y.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},y.prototype._catFile=function(f,g){var v=m(g),N=["cat-file"],X=g[0];if(typeof X=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(X)&&N.push.apply(N,X);let fe=f==="buffer"?po(N):W(N);return this._runTask(fe,v)},y.prototype.diff=function(f,g){let v=h(f)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):W(["diff",...d(arguments)]);return this._runTask(v,m(arguments))},y.prototype.diffSummary=function(){return this._runTask(Yi(d(arguments,1)),m(arguments))},y.prototype.applyPatch=function(f){let g=l(f)?w(o(f),d([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(g,m(arguments))},y.prototype.revparse=function(){let f=["rev-parse",...d(arguments,!0)];return this._runTask(W(f,!0),m(arguments))},y.prototype.clean=function(f,g,v){let N=le(f),X=N&&f.join("")||p(f,h)||"",fe=d([].slice.call(arguments,N?1:0));return this._runTask(At(X,fe),m(arguments))},y.prototype.exec=function(f){let g={commands:[],format:"utf-8",parser(){typeof f=="function"&&f()}};return this._runTask(g)},y.prototype.clearQueue=function(){return this},y.prototype.checkIgnore=function(f,g){return this._runTask(it(o(p(f,l,[]))),m(arguments))},y.prototype.checkIsRepo=function(f,g){return this._runTask(yr(p(f,h)),m(arguments))},e.exports=y}}),gi={};S(gi,{esModuleFactory:()=>ul,gitExportFactory:()=>ll,gitInstanceFactory:()=>yi});function ul(t){return Object.defineProperties(t,{__esModule:{value:!0},default:{value:t}})}function ll(t){return Object.assign(t.bind(null),en)}function yi(t,e){let r=new sn,s=Es(t&&(typeof t=="string"?{baseDir:t}:t)||{},e);if(!He(s.baseDir))throw new Ue(s,"Cannot use simple-git on a directory that does not exist");return Array.isArray(s.config)&&r.add(Pa(s.config)),r.add(Na(s.unsafe)),r.add(rc()),r.add(La(s.completion)),s.abort&&r.add(Ra(s.abort)),s.progress&&r.add(Wa(s.progress)),s.timeout&&r.add(Za(s.timeout)),s.spawnOptions&&r.add(Qa(s.spawnOptions)),r.add(Nr(Xa(!0))),s.errors&&r.add(Nr(s.errors)),Ba(r,s.binary,s.unsafe?.allowUnsafeCustomBinary),new _i(s,r)}var _i,bi=c({"src/lib/git-factory.ts"(){"use strict";Oa(),ec(),sc(),_(),_i=cl()}}),Ti={};S(Ti,{gitP:()=>fl});function fl(...t){let e,r=Promise.resolve();try{e=yi(...t)}catch(u){r=Promise.reject(u)}function s(){return i}function n(){return r}let i=[...vi,...Be].reduce((u,h)=>{let l=Be.includes(h),p=l?o(h,e):a(h,e,u);return Object.defineProperty(u,h,{enumerable:!1,configurable:!1,value:e?p:l?n:s}),u},{});return i;function o(u,h){return function(...l){if(typeof l[l.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+u);return r.then(function(){return new Promise(function(p,d){let m=(F,w)=>{if(F)return d(pl(F));p(w)};l.push(m),h[u].apply(h,l)})})}}function a(u,h,l){return(...p)=>(h[u](...p),l)}}function pl(t){return t instanceof Error?t:typeof t=="string"?new Error(t):new st(t)}var vi,Be,dl=c({"src/lib/runners/promise-wrapped.ts"(){"use strict";pt(),bi(),vi=["customBinary","env","outputHandler","silent"],Be=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:ml}=(dl(),E(Ti)),{esModuleFactory:hl,gitInstanceFactory:gl,gitExportFactory:yl}=(bi(),E(gi)),cs=hl(yl(gl));ki.exports=Object.assign(cs,{gitP:ml,simpleGit:cs})});var Ci=A((Af,Si)=>{var Ei=wi(),{execSync:fr}=require("node:child_process"),Y=require("node:path"),P=require("node:fs"),_l=require("node:os"),bl=Y.join(_l.homedir(),".claude-memory","repo"),Tl="claude-memory-storage",pr=class{constructor(e,r=null,s=Tl){this.auth=e,this.repoOwner=r,this.repoName=s,this.syncDir=bl,this._git=null}get git(){return this._git||(this._git=Ei(this.syncDir)),this._git}async ensureRepo(){if(P.existsSync(this.syncDir)&&P.existsSync(Y.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),s=JSON.parse(fr(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=s.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let e=await this.auth.getToken();return fr(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${e}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let e=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return fr(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${e}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(e){return console.error("Failed to create repository:",e.message),!1}}async cloneRepo(){let e=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=Y.dirname(this.syncDir);P.existsSync(r)||P.mkdirSync(r,{recursive:!0}),await Ei().clone(e,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(e){let r=new Date(e.created_at),s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,n=String(r.getDate()).padStart(2,"0"),i=Y.join(this.syncDir,"memories",e.container_tag,s);P.existsSync(i)||P.mkdirSync(i,{recursive:!0});let o=`${n}-${e.id}.json`,a=Y.join(i,o),u={id:e.id,content:e.content,containerTag:e.container_tag,metadata:typeof e.metadata=="string"?JSON.parse(e.metadata):e.metadata,createdAt:e.created_at,updatedAt:e.updated_at};return P.writeFileSync(a,JSON.stringify(u,null,2)),a}exportMemories(e){let r=[];for(let s of e){let n=this.exportMemory(s);r.push(n)}return r}exportProfiles(e){let r=Y.join(this.syncDir,"profiles");P.existsSync(r)||P.mkdirSync(r,{recursive:!0});let s=Y.join(r,"user-preferences.json");return P.writeFileSync(s,JSON.stringify(e,null,2)),s}async syncToGitHub(e,r=null){try{await this.ensureRepo();let s=this.exportMemories(e);if(r){let o=this.exportProfiles(r);s.push(o)}if(s.length===0)return{success:!0,synced:0};for(let o of s){let a=Y.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(e.map(o=>o.container_tag))].join(", ")} (${e.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:e.length}}catch(s){return console.error("GitHub sync failed:",s.message),{success:!1,error:s.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(e){return e.message.includes("conflict")?{success:!1,conflict:!0,error:e.message}:{success:!1,conflict:!1,error:e.message}}}importMemories(){let e=Y.join(this.syncDir,"memories");if(!P.existsSync(e))return[];let r=[],s=n=>{let i=P.readdirSync(n,{withFileTypes:!0});for(let o of i){let a=Y.join(n,o.name);if(o.isDirectory())s(a);else if(o.name.endsWith(".json"))try{let u=JSON.parse(P.readFileSync(a,"utf8"));r.push({id:u.id,content:u.content,container_tag:u.containerTag,metadata:JSON.stringify(u.metadata||{}),created_at:u.createdAt,updated_at:u.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(u){console.error(`Failed to parse ${a}:`,u.message)}}};return s(e),r}importProfiles(){let e=Y.join(this.syncDir,"profiles","user-preferences.json");if(!P.existsSync(e))return{static:[],dynamic:[]};try{return JSON.parse(P.readFileSync(e,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};Si.exports={GitHubSync:pr}});var Fi=A((Mf,xi)=>{var{execSync:Oi}=require("node:child_process"),mt=require("node:fs"),Ri=require("node:path"),vl=require("node:os"),Ot=Ri.join(vl.homedir(),".claude-memory","github-token.json"),dr=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return Oi("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return Oi("gh auth token",{encoding:"utf8"}).trim()}catch(e){console.error("Failed to get gh token:",e.message)}if(mt.existsSync(Ot))return JSON.parse(mt.readFileSync(Ot,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(e){let r=Ri.dirname(Ot);mt.existsSync(r)||mt.mkdirSync(r,{recursive:!0}),mt.writeFileSync(Ot,JSON.stringify({token:e}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||mt.existsSync(Ot)}async initiateDeviceFlow(){let e=require("node:https");return new Promise((r,s)=>{let n=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":n.length,Accept:"application/json"}},o=e.request(i,a=>{let u="";a.on("data",h=>{u+=h}),a.on("end",()=>r(JSON.parse(u)))});o.on("error",s),o.write(n),o.end()})}async pollForToken(e,r=5){let s=require("node:https"),n=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:e,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),u={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},h=s.request(u,l=>{let p="";l.on("data",d=>{p+=d}),l.on("end",()=>{let d=JSON.parse(p);d.access_token?i(d.access_token):d.error==="authorization_pending"?i(null):o(new Error(d.error||"Unknown error"))})});h.on("error",o),h.write(a),h.end()});for(let i=0;i<120;i++){let o=await n();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let e=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${e.verification_uri}`),console.log(`Enter code: ${e.user_code}
`);let r=await this.pollForToken(e.device_code,e.interval);return this.saveToken(r),r}};xi.exports={GitHubAuth:dr}});var Mi=A((Nf,Ai)=>{var{SqliteManager:kl}=vr(),{GitHubSync:wl}=Ci(),{GitHubAuth:El}=Fi(),Sl=require("node:crypto"),mr=class{constructor(e=null){this.db=new kl(e),this.auth=new El,this.sync=null}async initSync(){this.sync||(this.sync=new wl(this.auth))}generateId(e="mem"){return`${e}_${Sl.randomBytes(8).toString("hex")}`}async addMemory(e,r,s={},n=null){let i=n||this.generateId("mem");return this.db.addMemory(i,e,r,s),{id:i,status:"saved",containerTag:r}}async search(e,r=null,s={}){let n=this.db.searchMemories(e,r,s.limit||10);return{results:n.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:n.length}}async getProfile(e,r=null){let s=this.db.getProfile(e),n=null;if(r){let i=this.db.searchMemories(r,e,10);n={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:s.static,dynamic:s.dynamic},searchResults:n}}async listMemories(e,r=20){return{memories:this.db.listMemories(e,r)}}async deleteMemory(e){return this.db.deleteMemory(e),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=this.db.getPendingSync();if(e.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(e);if(r.success){let s=e.map(n=>n.id);this.db.markSynced(s)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=await this.sync.pullFromGitHub();if(!e.success)return e;let r=this.sync.importMemories();for(let s of r)this.db.getMemory(s.id)||this.db.addMemory(s.id,s.content,s.container_tag,JSON.parse(s.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};Ai.exports={StorageClient:mr}});var Pi=A((If,Ii)=>{var{execSync:Ni}=require("node:child_process"),Cl=require("node:crypto");function ie(t){return Cl.createHash("sha256").update(t).digest("hex").slice(0,16)}function hr(t){try{return Ni("git rev-parse --show-toplevel",{cwd:t,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function Ol(t){let r=hr(t)||t;return`claudecode_project_${ie(r)}`}function Rl(t){return(hr(t)||t).split("/").pop()||"unknown"}function xl(){try{let e=Ni("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(e)return`claudecode_user_${ie(e)}`}catch{}let t=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${ie(t)}`}Ii.exports={sha256:ie,getGitRoot:hr,getContainerTag:Ol,getProjectName:Rl,getUserContainerTag:xl}});var $i=A((Pf,ji)=>{var xt=require("node:fs"),Di=require("node:path"),Fl=require("node:os"),oe=Di.join(Fl.homedir(),".supermemory-claude"),Rt=Di.join(oe,"settings.json"),Li={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function Al(){xt.existsSync(oe)||xt.mkdirSync(oe,{recursive:!0})}function Ml(){let t={...Li};try{if(xt.existsSync(Rt)){let e=xt.readFileSync(Rt,"utf-8");Object.assign(t,JSON.parse(e))}}catch(e){console.error(`Settings: Failed to load ${Rt}: ${e.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(t.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(t.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(e=>e.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(t.debug=!0),t}function Nl(t){Al();let e={...t};delete e.apiKey,xt.writeFileSync(Rt,JSON.stringify(e,null,2))}function Il(t){if(t.apiKey)return t.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function Pl(t,e){return e.skipTools.includes(t)?!1:e.captureTools&&e.captureTools.length>0?e.captureTools.includes(t):!0}function Dl(t,e,r){if(t.debug){let s=new Date().toISOString();console.error(r?`[${s}] ${e}: ${JSON.stringify(r)}`:`[${s}] ${e}`)}}ji.exports={SETTINGS_DIR:oe,SETTINGS_FILE:Rt,DEFAULT_SETTINGS:Li,loadSettings:Ml,saveSettings:Nl,getApiKey:Il,shouldCaptureTool:Pl,debugLog:Dl}});var Gi=A((Df,Bi)=>{async function Ll(){return new Promise((t,e)=>{let r="";process.stdin.setEncoding("utf8"),process.stdin.on("data",s=>{r+=s}),process.stdin.on("end",()=>{try{t(r.trim()?JSON.parse(r):{})}catch(s){e(new Error(`Failed to parse stdin JSON: ${s.message}`))}}),process.stdin.on("error",e),process.stdin.isTTY&&t({})})}function ae(t){console.log(JSON.stringify(t))}function jl(t=null){ae(t?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:t}}:{continue:!0,suppressOutput:!0})}function $l(t){console.error(`Supermemory: ${t}`),ae({continue:!0,suppressOutput:!0})}Bi.exports={readStdin:Ll,writeOutput:ae,outputSuccess:jl,outputError:$l}});var Hi=A((Lf,Xi)=>{function Ui(t){try{let e=new Date(t),r=new Date,s=(r.getTime()-e.getTime())/1e3,n=s/60,i=s/3600,o=s/86400;if(n<30)return"just now";if(n<60)return`${Math.floor(n)}mins ago`;if(i<24)return`${Math.floor(i)}hrs ago`;if(o<7)return`${Math.floor(o)}d ago`;let a=e.toLocaleString("en",{month:"short"});return e.getFullYear()===r.getFullYear()?`${e.getDate()} ${a}`:`${e.getDate()} ${a}, ${e.getFullYear()}`}catch{return""}}function qi(t,e,r){let s=new Set,n=t.filter(a=>s.has(a)?!1:(s.add(a),!0)),i=e.filter(a=>s.has(a)?!1:(s.add(a),!0)),o=r.filter(a=>{let u=a.memory??"";return!u||s.has(u)?!1:(s.add(u),!0)});return{static:n,dynamic:i,searchResults:o}}function Bl(t,e=!0,r=!1,s=10){if(!t)return null;let n=t.profile?.static||[],i=t.profile?.dynamic||[],o=t.searchResults?.results||[],a=qi(e?n:[],e?i:[],r?o:[]),u=a.static.slice(0,s),h=a.dynamic.slice(0,s),l=a.searchResults.slice(0,s);if(u.length===0&&h.length===0&&l.length===0)return null;let p=[];if(u.length>0&&p.push(`## User Profile (Persistent)
`+u.map(F=>`- ${F}`).join(`
`)),h.length>0&&p.push(`## Recent Context
${h.map(F=>`- ${F}`).join(`
`)}`),l.length>0){let F=l.map(w=>{let M=w.memory??"",q=w.updatedAt?Ui(w.updatedAt):"",K=w.similarity!=null?`[${Math.round(w.similarity*100)}%]`:"";return`- ${q?`[${q}] `:""}${M} ${K}`.trim()});p.push(`## Relevant Memories (with relevance %)
${F.join(`
`)}`)}return`<supermemory-context>
The following is recalled context about the user. Reference it only when relevant to the conversation.

${p.join(`

`)}

Use these memories naturally when relevant \u2014 including indirect connections \u2014 but don't force them into every response or make assumptions beyond what's stated.
</supermemory-context>`}Xi.exports={formatContext:Bl,formatRelativeTime:Ui,deduplicateMemories:qi}});var{StorageClient:Gl}=Mi(),{getContainerTag:Ul,getProjectName:ql}=Pi(),{loadSettings:Xl,debugLog:ce}=$i(),{readStdin:Hl,writeOutput:gr}=Gi(),{formatContext:Yl}=Hi();async function Wl(){let t=Xl();try{let r=(await Hl()).cwd||process.cwd(),s=Ul(r),n=ql(r);ce(t,"SessionStart",{cwd:r,containerTag:s,projectName:n});let i=new Gl,o=await i.syncFromGitHub().catch(()=>({success:!1}));o.success||ce(t,"GitHub sync unavailable, working offline");let a=await i.getProfile(s,n).catch(()=>null),u=Yl(a,!0,!1,t.maxProfileItems||5);if(!u){gr({hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:`<supermemory-context>
No previous memories found for this project.
Memories will be saved as you work.
${o.success?"":"\u26A0 GitHub sync unavailable - working offline"}
</supermemory-context>`}}),i.close();return}ce(t,"Context generated",{length:u.length});let h=o.success?"":`
\u26A0 GitHub sync unavailable - working offline`;gr({hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:u+h}}),i.close()}catch(e){ce(t,"Error",{error:e.message}),console.error(`Claude Memory: ${e.message}`),gr({hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:`<supermemory-status>
Failed to load memories: ${e.message}
Session will continue without memory context.
</supermemory-status>`}})}}Wl().catch(t=>{console.error(`Claude Memory fatal: ${t.message}`),process.exit(1)});
