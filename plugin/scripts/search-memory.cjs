#!/usr/bin/env node
var T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var V=T($e=>{"use strict";$e.getBooleanOption=(e,t)=>{let r=!1;if(t in e&&typeof(r=e[t])!="boolean")throw new TypeError(`Expected the "${t}" option to be a boolean`);return r};$e.cppdb=Symbol();$e.inspect=Symbol.for("nodejs.util.inspect.custom")});var Ct=T((fp,jr)=>{"use strict";var Ot={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function re(e,t){if(new.target!==re)return new re(e,t);if(typeof t!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,e),Ot.value=""+e,Object.defineProperty(this,"message",Ot),Error.captureStackTrace(this,re),this.code=t}Object.setPrototypeOf(re,Error);Object.setPrototypeOf(re.prototype,Error.prototype);Object.defineProperty(re.prototype,"name",Ot);jr.exports=re});var $r=T((pp,Lr)=>{var Be=require("path").sep||"/";Lr.exports=oa;function oa(e){if(typeof e!="string"||e.length<=7||e.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var t=decodeURI(e.substring(7)),r=t.indexOf("/"),n=t.substring(0,r),s=t.substring(r+1);return n=="localhost"&&(n=""),n&&(n=Be+Be+n),s=s.replace(/^(.+)\|/,"$1:"),Be=="\\"&&(s=s.replace(/\//g,"\\")),/^.+\:/.test(s)||(s=Be+s),n+s}});var Gr=T((pe,Ur)=>{var Rt=require("fs"),Ue=require("path"),aa=$r(),qe=Ue.join,ca=Ue.dirname,Br=Rt.accessSync&&function(e){try{Rt.accessSync(e)}catch{return!1}return!0}||Rt.existsSync||Ue.existsSync,qr={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function ua(e){typeof e=="string"?e={bindings:e}:e||(e={}),Object.keys(qr).map(function(c){c in e||(e[c]=qr[c])}),e.module_root||(e.module_root=pe.getRoot(pe.getFileName())),Ue.extname(e.bindings)!=".node"&&(e.bindings+=".node");for(var t=typeof __webpack_require__=="function"?__non_webpack_require__:require,r=[],n=0,s=e.try.length,i,o,a;n<s;n++){i=qe.apply(null,e.try[n].map(function(c){return e[c]||c})),r.push(i);try{return o=e.path?t.resolve(i):t(i),e.path||(o.path=i),o}catch(c){if(c.code!=="MODULE_NOT_FOUND"&&c.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(c.message))throw c}}throw a=new Error(`Could not locate the bindings file. Tried:
`+r.map(function(c){return e.arrow+c}).join(`
`)),a.tries=r,a}Ur.exports=pe=ua;pe.getFileName=function(t){var r=Error.prepareStackTrace,n=Error.stackTraceLimit,s={},i;Error.stackTraceLimit=10,Error.prepareStackTrace=function(a,c){for(var f=0,u=c.length;f<u;f++)if(i=c[f].getFileName(),i!==__filename)if(t){if(i!==t)return}else return},Error.captureStackTrace(s),s.stack,Error.prepareStackTrace=r,Error.stackTraceLimit=n;var o="file://";return i.indexOf(o)===0&&(i=aa(i)),i};pe.getRoot=function(t){for(var r=ca(t),n;;){if(r==="."&&(r=process.cwd()),Br(qe(r,"package.json"))||Br(qe(r,"node_modules")))return r;if(n===r)throw new Error('Could not find module root given file: "'+t+'". Do you have a `package.json` file? ');n=r,r=qe(r,"..")}}});var Xr=T(Z=>{"use strict";var{cppdb:z}=V();Z.prepare=function(t){return this[z].prepare(t,this,!1)};Z.exec=function(t){return this[z].exec(t),this};Z.close=function(){return this[z].close(),this};Z.loadExtension=function(...t){return this[z].loadExtension(...t),this};Z.defaultSafeIntegers=function(...t){return this[z].defaultSafeIntegers(...t),this};Z.unsafeMode=function(...t){return this[z].unsafeMode(...t),this};Z.getters={name:{get:function(){return this[z].name},enumerable:!0},open:{get:function(){return this[z].open},enumerable:!0},inTransaction:{get:function(){return this[z].inTransaction},enumerable:!0},readonly:{get:function(){return this[z].readonly},enumerable:!0},memory:{get:function(){return this[z].memory},enumerable:!0}}});var Wr=T((hp,Hr)=>{"use strict";var{cppdb:la}=V(),zr=new WeakMap;Hr.exports=function(t){if(typeof t!="function")throw new TypeError("Expected first argument to be a function");let r=this[la],n=fa(r,this),{apply:s}=Function.prototype,i={default:{value:Ge(s,t,r,n.default)},deferred:{value:Ge(s,t,r,n.deferred)},immediate:{value:Ge(s,t,r,n.immediate)},exclusive:{value:Ge(s,t,r,n.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(i.default.value,i),Object.defineProperties(i.deferred.value,i),Object.defineProperties(i.immediate.value,i),Object.defineProperties(i.exclusive.value,i),i.default.value};var fa=(e,t)=>{let r=zr.get(e);if(!r){let n={commit:e.prepare("COMMIT",t,!1),rollback:e.prepare("ROLLBACK",t,!1),savepoint:e.prepare("SAVEPOINT `	_bs3.	`",t,!1),release:e.prepare("RELEASE `	_bs3.	`",t,!1),rollbackTo:e.prepare("ROLLBACK TO `	_bs3.	`",t,!1)};zr.set(e,r={default:Object.assign({begin:e.prepare("BEGIN",t,!1)},n),deferred:Object.assign({begin:e.prepare("BEGIN DEFERRED",t,!1)},n),immediate:Object.assign({begin:e.prepare("BEGIN IMMEDIATE",t,!1)},n),exclusive:Object.assign({begin:e.prepare("BEGIN EXCLUSIVE",t,!1)},n)})}return r},Ge=(e,t,r,{begin:n,commit:s,rollback:i,savepoint:o,release:a,rollbackTo:c})=>function(){let u,d,m;r.inTransaction?(u=o,d=a,m=c):(u=n,d=s,m=i),u.run();try{let h=e.call(t,this,arguments);if(h&&typeof h.then=="function")throw new TypeError("Transaction function cannot return a promise");return d.run(),h}catch(h){throw r.inTransaction&&(m.run(),m!==i&&d.run()),h}}});var Vr=T((mp,Yr)=>{"use strict";var{getBooleanOption:pa,cppdb:da}=V();Yr.exports=function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");let n=pa(r,"simple"),s=this[da].prepare(`PRAGMA ${t}`,this,!0);return n?s.pluck().get():s.all()}});var Qr=T((gp,Jr)=>{"use strict";var ha=require("fs"),ma=require("path"),{promisify:ga}=require("util"),{cppdb:ya}=V(),Kr=ga(ha.access);Jr.exports=async function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");t=t.trim();let n="attached"in r?r.attached:"main",s="progress"in r?r.progress:null;if(!t)throw new TypeError("Backup filename cannot be an empty string");if(t===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof n!="string")throw new TypeError('Expected the "attached" option to be a string');if(!n)throw new TypeError('The "attached" option cannot be an empty string');if(s!=null&&typeof s!="function")throw new TypeError('Expected the "progress" option to be a function');await Kr(ma.dirname(t)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let i=await Kr(t).then(()=>!1,()=>!0);return ba(this[ya].backup(this,n,t,i),s||null)};var ba=(e,t)=>{let r=0,n=!0;return new Promise((s,i)=>{setImmediate(function o(){try{let a=e.transfer(r);if(!a.remainingPages){e.close(),s(a);return}if(n&&(n=!1,r=100),t){let c=t(a);if(c!==void 0)if(typeof c=="number"&&c===c)r=Math.max(0,Math.min(2147483647,Math.round(c)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(o)}catch(a){e.close(),i(a)}})})}});var en=T((yp,Zr)=>{"use strict";var{cppdb:_a}=V();Zr.exports=function(t){if(t==null&&(t={}),typeof t!="object")throw new TypeError("Expected first argument to be an options object");let r="attached"in t?t.attached:"main";if(typeof r!="string")throw new TypeError('Expected the "attached" option to be a string');if(!r)throw new TypeError('The "attached" option cannot be an empty string');return this[_a].serialize(r)}});var rn=T((bp,tn)=>{"use strict";var{getBooleanOption:Xe,cppdb:wa}=V();tn.exports=function(t,r,n){if(r==null&&(r={}),typeof r=="function"&&(n=r,r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof n!="function")throw new TypeError("Expected last argument to be a function");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let s="safeIntegers"in r?+Xe(r,"safeIntegers"):2,i=Xe(r,"deterministic"),o=Xe(r,"directOnly"),a=Xe(r,"varargs"),c=-1;if(!a){if(c=n.length,!Number.isInteger(c)||c<0)throw new TypeError("Expected function.length to be a positive integer");if(c>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[wa].function(n,t,c,s,i,o),this}});var on=T((_p,sn)=>{"use strict";var{getBooleanOption:ze,cppdb:Ta}=V();sn.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object"||r===null)throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let n="start"in r?r.start:null,s=xt(r,"step",!0),i=xt(r,"inverse",!1),o=xt(r,"result",!1),a="safeIntegers"in r?+ze(r,"safeIntegers"):2,c=ze(r,"deterministic"),f=ze(r,"directOnly"),u=ze(r,"varargs"),d=-1;if(!u&&(d=Math.max(nn(s),i?nn(i):0),d>0&&(d-=1),d>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[Ta].aggregate(n,s,i,o,t,d,a,c,f),this};var xt=(e,t,r)=>{let n=t in e?e[t]:null;if(typeof n=="function")return n;if(n!=null)throw new TypeError(`Expected the "${t}" option to be a function`);if(r)throw new TypeError(`Missing required option "${t}"`);return null},nn=({length:e})=>{if(Number.isInteger(e)&&e>=0)return e;throw new TypeError("Expected function.length to be a positive integer")}});var ln=T((wp,un)=>{"use strict";var{cppdb:va}=V();un.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(!t)throw new TypeError("Virtual table module name cannot be an empty string");let n=!1;if(typeof r=="object"&&r!==null)n=!0,r=Fa(cn(r,"used",t));else{if(typeof r!="function")throw new TypeError("Expected second argument to be a function or a table definition object");r=Ea(r)}return this[va].table(r,t,n),this};function Ea(e){return function(r,n,s,...i){let o={module:r,database:n,table:s},a=Ra.call(e,o,i);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${r}" did not return a table definition object`);return cn(a,"returned",r)}}function cn(e,t,r){if(!Ee.call(e,"rows"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "rows" property`);if(!Ee.call(e,"columns"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "columns" property`);let n=e.rows;if(typeof n!="function"||Object.getPrototypeOf(n)!==xa)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "rows" property (should be a generator function)`);let s=e.columns;if(!Array.isArray(s)||!(s=[...s]).every(f=>typeof f=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "columns" property (should be an array of strings)`);if(s.length!==new Set(s).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate column names`);if(!s.length)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with zero columns`);let i;if(Ee.call(e,"parameters")){if(i=e.parameters,!Array.isArray(i)||!(i=[...i]).every(f=>typeof f=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "parameters" property (should be an array of strings)`)}else i=Ca(n);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate parameter names`);if(i.length>32)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with more than the maximum number of 32 parameters`);for(let f of i)if(s.includes(f))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with column "${f}" which was ambiguously defined as both a column and parameter`);let o=2;if(Ee.call(e,"safeIntegers")){let f=e.safeIntegers;if(typeof f!="boolean")throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "safeIntegers" property (should be a boolean)`);o=+f}let a=!1;if(Ee.call(e,"directOnly")&&(a=e.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...i.map(an).map(f=>`${f} HIDDEN`),...s.map(an)].join(", ")});`,ka(n,new Map(s.map((f,u)=>[f,i.length+u])),r),i,o,a]}function ka(e,t,r){return function*(...s){let i=s.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);for(let o=0;o<t.size;++o)i.push(null);for(let o of e(...s))if(Array.isArray(o))Sa(o,i,t.size,r),yield i;else if(typeof o=="object"&&o!==null)Oa(o,i,t,r),yield i;else throw new TypeError(`Virtual table module "${r}" yielded something that isn't a valid row object`)}}function Sa(e,t,r,n){if(e.length!==r)throw new TypeError(`Virtual table module "${n}" yielded a row with an incorrect number of columns`);let s=t.length-r;for(let i=0;i<r;++i)t[i+s]=e[i]}function Oa(e,t,r,n){let s=0;for(let i of Object.keys(e)){let o=r.get(i);if(o===void 0)throw new TypeError(`Virtual table module "${n}" yielded a row with an undeclared column "${i}"`);t[o]=e[i],s+=1}if(s!==r.size)throw new TypeError(`Virtual table module "${n}" yielded a row with missing columns`)}function Ca({length:e}){if(!Number.isInteger(e)||e<0)throw new TypeError("Expected function.length to be a positive integer");let t=[];for(let r=0;r<e;++r)t.push(`$${r+1}`);return t}var{hasOwnProperty:Ee}=Object.prototype,{apply:Ra}=Function.prototype,xa=Object.getPrototypeOf(function*(){}),an=e=>`"${e.replace(/"/g,'""')}"`,Fa=e=>()=>e});var pn=T((Tp,fn)=>{"use strict";var Aa=function(){};fn.exports=function(t,r){return Object.assign(new Aa,this)}});var gn=T((vp,mn)=>{"use strict";var Ia=require("fs"),dn=require("path"),He=V(),Ma=Ct(),hn;function A(e,t){if(new.target==null)return new A(e,t);let r;if(Buffer.isBuffer(e)&&(r=e,e=":memory:"),e==null&&(e=""),t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in t)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in t)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let n=e.trim(),s=n===""||n===":memory:",i=He.getBooleanOption(t,"readonly"),o=He.getBooleanOption(t,"fileMustExist"),a="timeout"in t?t.timeout:5e3,c="verbose"in t?t.verbose:null,f="nativeBinding"in t?t.nativeBinding:null;if(i&&s&&!r)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(c!=null&&typeof c!="function")throw new TypeError('Expected the "verbose" option to be a function');if(f!=null&&typeof f!="string"&&typeof f!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let u;if(f==null?u=hn||(hn=Gr()("better_sqlite3.node")):typeof f=="string"?u=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(dn.resolve(f).replace(/(\.node)?$/,".node")):u=f,u.isInitialized||(u.setErrorConstructor(Ma),u.isInitialized=!0),!s&&!Ia.existsSync(dn.dirname(n)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[He.cppdb]:{value:new u.Database(n,e,s,i,o,a,c||null,r||null)},...ne.getters})}var ne=Xr();A.prototype.prepare=ne.prepare;A.prototype.transaction=Wr();A.prototype.pragma=Vr();A.prototype.backup=Qr();A.prototype.serialize=en();A.prototype.function=rn();A.prototype.aggregate=on();A.prototype.table=ln();A.prototype.loadExtension=ne.loadExtension;A.prototype.exec=ne.exec;A.prototype.close=ne.close;A.prototype.defaultSafeIntegers=ne.defaultSafeIntegers;A.prototype.unsafeMode=ne.unsafeMode;A.prototype[He.inspect]=pn();mn.exports=A});var yn=T((Ep,Ft)=>{"use strict";Ft.exports=gn();Ft.exports.SqliteError=Ct()});var wn=T((kp,_n)=>{var Pa=yn(),Mt=require("path"),bn=require("fs"),Da=require("os"),Na=Mt.join(Da.homedir(),".claude-memory"),At=Mt.join(Na,"memories.db"),It=class{constructor(t=At){t||(t=At);let r=Mt.dirname(t);bn.existsSync(r)||bn.mkdirSync(r,{recursive:!0}),this.db=new Pa(t),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(t,r,n,s={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(t,r,n,JSON.stringify(s),i,i),{id:t,createdAt:i}}getMemory(t){let n=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(t);return n&&n.metadata&&(n.metadata=JSON.parse(n.metadata)),n}updateMemory(t,r,n=null){let s=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,s,"pending"];n!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(n))),o.push(t),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(t){this.db.prepare("DELETE FROM memories WHERE id = ?").run(t)}listMemories(t,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(n=>(n.metadata&&(n.metadata=JSON.parse(n.metadata)),n))}markSynced(t){let r=Date.now(),n=t.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${n})
    `).run(r,...t)}searchMemories(t,r=null,n=10){let s=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[t];return r&&(s+=" AND m.container_tag = ?",i.push(r)),s+=" ORDER BY rank LIMIT ?",i.push(n),this.db.prepare(s).all(...i).map(c=>(c.metadata&&(c.metadata=JSON.parse(c.metadata)),c))}getContextMemories(t,r,n=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,Math.floor(n/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,t,Math.floor(n/2)),c=new Set(i.map(u=>u.id)),f=[...i];for(let u of a)c.has(u.id)||(f.push(u),c.add(u.id));return f.slice(0,n).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}addProfileFact(t,r,n,s="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(t,r,n,s,i)}getProfile(t,r=5){let s=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r);return{static:s.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(t){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(t)}close(){this.db.close()}};_n.exports={SqliteManager:It,DEFAULT_DB_PATH:At}});var vn=T((Sp,Tn)=>{var de=1e3,he=de*60,me=he*60,se=me*24,ja=se*7,La=se*365.25;Tn.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return $a(e);if(r==="number"&&isFinite(e))return t.long?qa(e):Ba(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function $a(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*La;case"weeks":case"week":case"w":return r*ja;case"days":case"day":case"d":return r*se;case"hours":case"hour":case"hrs":case"hr":case"h":return r*me;case"minutes":case"minute":case"mins":case"min":case"m":return r*he;case"seconds":case"second":case"secs":case"sec":case"s":return r*de;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Ba(e){var t=Math.abs(e);return t>=se?Math.round(e/se)+"d":t>=me?Math.round(e/me)+"h":t>=he?Math.round(e/he)+"m":t>=de?Math.round(e/de)+"s":e+"ms"}function qa(e){var t=Math.abs(e);return t>=se?We(e,t,se,"day"):t>=me?We(e,t,me,"hour"):t>=he?We(e,t,he,"minute"):t>=de?We(e,t,de,"second"):e+" ms"}function We(e,t,r,n){var s=t>=r*1.5;return Math.round(e/r)+" "+n+(s?"s":"")}});var Pt=T((Op,En)=>{function Ua(e){r.debug=r,r.default=r,r.coerce=c,r.disable=o,r.enable=s,r.enabled=a,r.humanize=vn(),r.destroy=f,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function t(u){let d=0;for(let m=0;m<u.length;m++)d=(d<<5)-d+u.charCodeAt(m),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=t;function r(u){let d,m=null,h,G;function R(...D){if(!R.enabled)return;let Q=R,le=Number(new Date),vt=le-(d||le);Q.diff=vt,Q.prev=d,Q.curr=le,d=le,D[0]=r.coerce(D[0]),typeof D[0]!="string"&&D.unshift("%O");let fe=0;D[0]=D[0].replace(/%([a-zA-Z%])/g,(ve,Et)=>{if(ve==="%%")return"%";fe++;let Le=r.formatters[Et];if(typeof Le=="function"){let kt=D[fe];ve=Le.call(Q,kt),D.splice(fe,1),fe--}return ve}),r.formatArgs.call(Q,D),(Q.log||r.log).apply(Q,D)}return R.namespace=u,R.useColors=r.useColors(),R.color=r.selectColor(u),R.extend=n,R.destroy=r.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==r.namespaces&&(h=r.namespaces,G=r.enabled(u)),G),set:D=>{m=D}}),typeof r.init=="function"&&r.init(R),R}function n(u,d){let m=r(this.namespace+(typeof d>"u"?":":d)+u);return m.log=this.log,m}function s(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let m of d)m[0]==="-"?r.skips.push(m.slice(1)):r.names.push(m)}function i(u,d){let m=0,h=0,G=-1,R=0;for(;m<u.length;)if(h<d.length&&(d[h]===u[m]||d[h]==="*"))d[h]==="*"?(G=h,R=m,h++):(m++,h++);else if(G!==-1)h=G+1,R++,m=R;else return!1;for(;h<d.length&&d[h]==="*";)h++;return h===d.length}function o(){let u=[...r.names,...r.skips.map(d=>"-"+d)].join(",");return r.enable(""),u}function a(u){for(let d of r.skips)if(i(u,d))return!1;for(let d of r.names)if(i(u,d))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}En.exports=Ua});var kn=T((N,Ye)=>{N.formatArgs=Xa;N.save=za;N.load=Ha;N.useColors=Ga;N.storage=Wa();N.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();N.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ga(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Xa(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Ye.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),e.splice(n,0,t)}N.log=console.debug||console.log||(()=>{});function za(e){try{e?N.storage.setItem("debug",e):N.storage.removeItem("debug")}catch{}}function Ha(){let e;try{e=N.storage.getItem("debug")||N.storage.getItem("DEBUG")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function Wa(){try{return localStorage}catch{}}Ye.exports=Pt()(N);var{formatters:Ya}=Ye.exports;Ya.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var On=T((x,Ke)=>{var Va=require("tty"),Ve=require("util");x.init=rc;x.log=Za;x.formatArgs=Ja;x.save=ec;x.load=tc;x.useColors=Ka;x.destroy=Ve.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");x.colors=[6,2,3,4,5,1];try{let e=require("supports-color");e&&(e.stderr||e).level>=2&&(x.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}x.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(s,i)=>i.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function Ka(){return"colors"in x.inspectOpts?!!x.inspectOpts.colors:Va.isatty(process.stderr.fd)}function Ja(e){let{namespace:t,useColors:r}=this;if(r){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),i=`  ${s};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(s+"m+"+Ke.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=Qa()+t+" "+e[0]}function Qa(){return x.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Za(...e){return process.stderr.write(Ve.formatWithOptions(x.inspectOpts,...e)+`
`)}function ec(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function tc(){return process.env.DEBUG}function rc(e){e.inspectOpts={};let t=Object.keys(x.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=x.inspectOpts[t[r]]}Ke.exports=Pt()(x);var{formatters:Sn}=Ke.exports;Sn.o=function(e){return this.inspectOpts.colors=this.useColors,Ve.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Sn.O=function(e){return this.inspectOpts.colors=this.useColors,Ve.inspect(e,this.inspectOpts)}});var Nt=T((Cp,Dt)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Dt.exports=kn():Dt.exports=On()});var Cn=T(B=>{"use strict";var nc=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(B,"__esModule",{value:!0});var sc=require("fs"),ic=nc(Nt()),ge=ic.default("@kwsites/file-exists");function oc(e,t,r){ge("checking %s",e);try{let n=sc.statSync(e);return n.isFile()&&t?(ge("[OK] path represents a file"),!0):n.isDirectory()&&r?(ge("[OK] path represents a directory"),!0):(ge("[FAIL] path represents something other than a file or directory"),!1)}catch(n){if(n.code==="ENOENT")return ge("[FAIL] path is not accessible: %o",n),!1;throw ge("[FATAL] %o",n),n}}function ac(e,t=B.READABLE){return oc(e,(t&B.FILE)>0,(t&B.FOLDER)>0)}B.exists=ac;B.FILE=1;B.FOLDER=2;B.READABLE=B.FILE+B.FOLDER});var Rn=T(Je=>{"use strict";function cc(e){for(var t in e)Je.hasOwnProperty(t)||(Je[t]=e[t])}Object.defineProperty(Je,"__esModule",{value:!0});cc(Cn())});var Lt=T(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.createDeferred=ie.deferred=void 0;function jt(){let e,t,r="pending";return{promise:new Promise((s,i)=>{e=s,t=i}),done(s){r==="pending"&&(r="resolved",e(s))},fail(s){r==="pending"&&(r="rejected",t(s))},get fulfilled(){return r!=="pending"},get status(){return r}}}ie.deferred=jt;ie.createDeferred=jt;ie.default=jt});var vo=T((Ap,To)=>{"use strict";var uc=Object.create,ut=Object.defineProperty,lc=Object.getOwnPropertyDescriptor,or=Object.getOwnPropertyNames,fc=Object.getPrototypeOf,pc=Object.prototype.hasOwnProperty,l=(e,t)=>function(){return e&&(t=(0,e[or(e)[0]])(e=0)),t},dc=(e,t)=>function(){return t||(0,e[or(e)[0]])((t={exports:{}}).exports,t),t.exports},S=(e,t)=>{for(var r in t)ut(e,r,{get:t[r],enumerable:!0})},cs=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of or(t))!pc.call(e,s)&&s!==r&&ut(e,s,{get:()=>t[s],enumerable:!(n=lc(t,s))||n.enumerable});return e},hc=(e,t,r)=>(r=e!=null?uc(fc(e)):{},cs(t||!e||!e.__esModule?ut(r,"default",{value:e,enumerable:!0}):r,e)),k=e=>cs(ut({},"__esModule",{value:!0}),e),K,te=l({"src/lib/errors/git-error.ts"(){"use strict";K=class extends Error{constructor(e,t){super(t),this.task=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),ce,_e=l({"src/lib/errors/git-response-error.ts"(){"use strict";te(),ce=class extends K{constructor(e,t){super(void 0,t||String(e)),this.git=e}}}});function us(...e){let t=new String(e);return lt.set(t,e),t}function nt(e){return e instanceof String&&lt.has(e)}function xn(e){return lt.get(e)||[]}var lt,xe=l({"src/lib/args/pathspec.ts"(){"use strict";lt=new WeakMap}}),ar,mc=l({"src/lib/errors/git-construct-error.ts"(){"use strict";te(),ar=class extends K{constructor(e,t){super(void 0,t),this.config=e}}}}),H,Fe=l({"src/lib/errors/git-plugin-error.ts"(){"use strict";te(),H=class extends K{constructor(e,t,r){super(e,r),this.task=e,this.plugin=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),cr,ls=l({"src/lib/errors/task-configuration-error.ts"(){"use strict";te(),cr=class extends K{constructor(e){super(void 0,e)}}}});function fs(e){return typeof e!="function"?ue:e}function ps(e){return typeof e=="function"&&e!==ue}function ds(e,t){let r=e.indexOf(t);return r<=0?[e,""]:[e.substr(0,r),e.substr(r+1)]}function hs(e,t=0){return ms(e)&&e.length>t?e[t]:void 0}function ae(e,t=0){if(ms(e)&&e.length>t)return e[e.length-1-t]}function ms(e){return ht(e)}function Ae(e="",t=!0,r=`
`){return e.split(r).reduce((n,s)=>{let i=t?s.trim():s;return i&&n.push(i),n},[])}function ur(e,t){return Ae(e,!0).map(r=>t(r))}function lr(e){return(0,Ht.exists)(e,Ht.FOLDER)}function w(e,t){return Array.isArray(e)?e.includes(t)||e.push(t):e.add(t),t}function gs(e,t){return Array.isArray(e)&&!e.includes(t)&&e.push(t),e}function ft(e,t){if(Array.isArray(e)){let r=e.indexOf(t);r>=0&&e.splice(r,1)}else e.delete(t);return t}function J(e){return Array.isArray(e)?e:[e]}function ys(e){return e.replace(/[\s-]+(.)/g,(t,r)=>r.toUpperCase())}function we(e){return J(e).map(t=>t instanceof String?t:String(t))}function E(e,t=0){if(e==null)return t;let r=parseInt(e,10);return Number.isNaN(r)?t:r}function Ce(e,t){let r=[];for(let n=0,s=e.length;n<s;n++)r.push(t,e[n]);return r}function Re(e){return(Array.isArray(e)?_s.Buffer.concat(e):e).toString("utf-8")}function bs(e,t){let r={};return t.forEach(n=>{e[n]!==void 0&&(r[n]=e[n])}),r}function Xt(e=0){return new Promise(t=>setTimeout(t,e))}function zt(e){if(e!==!1)return e}var _s,Ht,be,ue,Ie,pt=l({"src/lib/utils/util.ts"(){"use strict";_s=require("node:buffer"),Ht=Rn(),fr(),be="\0",ue=()=>{},Ie=Object.prototype.toString.call.bind(Object.prototype.toString)}});function U(e,t,r){return t(e)?e:arguments.length>2?r:void 0}function Wt(e,t){let r=nt(e)?"string":typeof e;return/number|string|boolean/.test(r)&&(!t||!t.includes(r))}function dt(e){return!!e&&Ie(e)==="[object Object]"}function ws(e){return typeof e=="function"}var Me,Ts,F,st,ht,fr=l({"src/lib/utils/argument-filters.ts"(){"use strict";xe(),pt(),Me=e=>Array.isArray(e),Ts=e=>typeof e=="number",F=e=>typeof e=="string",st=e=>F(e)||Array.isArray(e)&&e.every(F),ht=e=>e==null||"number|boolean|function".includes(typeof e)?!1:typeof e.length=="number"}}),Yt,gc=l({"src/lib/utils/exit-codes.ts"(){"use strict";Yt=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR",e[e.NOT_FOUND=-2]="NOT_FOUND",e[e.UNCLEAN=128]="UNCLEAN",e))(Yt||{})}}),it,yc=l({"src/lib/utils/git-output-streams.ts"(){"use strict";it=class vs{constructor(t,r){this.stdOut=t,this.stdErr=r}asStrings(){return new vs(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function bc(){throw new Error("LineParser:useMatches not implemented")}var _,ee,_c=l({"src/lib/utils/line-parser.ts"(){"use strict";_=class{constructor(e,t){this.matches=[],this.useMatches=bc,this.parse=(r,n)=>(this.resetMatches(),this._regExp.every((s,i)=>this.addMatch(s,i,r(i)))?this.useMatches(n,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(e)?e:[e],t&&(this.useMatches=t)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(e,t,r){let n=r&&e.exec(r);return n&&this.pushMatch(t,n),!!n}pushMatch(e,t){this.matches.push(...t.slice(1))}},ee=class extends _{addMatch(e,t,r){return/^remote:\s/.test(String(r))&&super.addMatch(e,t,r)}pushMatch(e,t){(e>0||t.length>1)&&super.pushMatch(e,t)}}}});function Es(...e){let t=process.cwd(),r=Object.assign({baseDir:t,...ks},...e.filter(n=>typeof n=="object"&&n));return r.baseDir=r.baseDir||t,r.trimmed=r.trimmed===!0,r}var ks,wc=l({"src/lib/utils/simple-git-options.ts"(){"use strict";ks={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function pr(e,t=[]){return dt(e)?Object.keys(e).reduce((r,n)=>{let s=e[n];if(nt(s))r.push(s);else if(Wt(s,["boolean"]))r.push(n+"="+s);else if(Array.isArray(s))for(let i of s)Wt(i,["string","number"])||r.push(n+"="+i);else r.push(n);return r},t):t}function j(e,t=0,r=!1){let n=[];for(let s=0,i=t<0?e.length:t;s<i;s++)"string|number".includes(typeof e[s])&&n.push(String(e[s]));return pr(dr(e),n),r||n.push(...Tc(e)),n}function Tc(e){let t=typeof ae(e)=="function";return we(U(ae(e,t?1:0),Me,[]))}function dr(e){let t=ws(ae(e));return U(ae(e,t?1:0),dt)}function O(e,t=!0){let r=fs(ae(e));return t||ps(r)?r:void 0}var vc=l({"src/lib/utils/task-options.ts"(){"use strict";fr(),pt(),xe()}});function Vt(e,t){return e(t.stdOut,t.stdErr)}function $(e,t,r,n=!0){return J(r).forEach(s=>{for(let i=Ae(s,n),o=0,a=i.length;o<a;o++){let c=(f=0)=>{if(!(o+f>=a))return i[o+f]};t.some(({parse:f})=>f(c,e))}}),e}var Ec=l({"src/lib/utils/task-parser.ts"(){"use strict";pt()}}),Ss={};S(Ss,{ExitCodes:()=>Yt,GitOutputStreams:()=>it,LineParser:()=>_,NOOP:()=>ue,NULL:()=>be,RemoteLineParser:()=>ee,append:()=>w,appendTaskOptions:()=>pr,asArray:()=>J,asCamelCase:()=>ys,asFunction:()=>fs,asNumber:()=>E,asStringArray:()=>we,bufferToString:()=>Re,callTaskParser:()=>Vt,createInstanceConfig:()=>Es,delay:()=>Xt,filterArray:()=>Me,filterFunction:()=>ws,filterHasLength:()=>ht,filterNumber:()=>Ts,filterPlainObject:()=>dt,filterPrimitives:()=>Wt,filterString:()=>F,filterStringOrStringArray:()=>st,filterType:()=>U,first:()=>hs,folderExists:()=>lr,forEachLineWithContent:()=>ur,getTrailingOptions:()=>j,including:()=>gs,isUserFunction:()=>ps,last:()=>ae,objectToString:()=>Ie,orVoid:()=>zt,parseStringResponse:()=>$,pick:()=>bs,prefixedArray:()=>Ce,remove:()=>ft,splitOn:()=>ds,toLinesWithContent:()=>Ae,trailingFunctionArgument:()=>O,trailingOptionsArgument:()=>dr});var b=l({"src/lib/utils/index.ts"(){"use strict";fr(),gc(),yc(),_c(),wc(),vc(),Ec(),pt()}}),Os={};S(Os,{CheckRepoActions:()=>ot,checkIsBareRepoTask:()=>Rs,checkIsRepoRootTask:()=>Cs,checkIsRepoTask:()=>kc});function kc(e){switch(e){case"bare":return Rs();case"root":return Cs()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:mt,parser:hr}}function Cs(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:mt,parser(t){return/^\.(git)?$/.test(t.trim())}}}function Rs(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:mt,parser:hr}}function Sc(e){return/(Not a git repository|Kein Git-Repository)/i.test(String(e))}var ot,mt,hr,xs=l({"src/lib/tasks/check-is-repo.ts"(){"use strict";b(),ot=(e=>(e.BARE="bare",e.IN_TREE="tree",e.IS_REPO_ROOT="root",e))(ot||{}),mt=({exitCode:e},t,r,n)=>{if(e===128&&Sc(t))return r(Buffer.from("false"));n(t)},hr=e=>e.trim()==="true"}});function Oc(e,t){let r=new Fs(e),n=e?Is:As;return Ae(t).forEach(s=>{let i=s.replace(n,"");r.paths.push(i),(Ms.test(i)?r.folders:r.files).push(i)}),r}var Fs,As,Is,Ms,Cc=l({"src/lib/responses/CleanSummary.ts"(){"use strict";b(),Fs=class{constructor(e){this.dryRun=e,this.paths=[],this.files=[],this.folders=[]}},As=/^[a-z]+\s*/i,Is=/^[a-z]+\s+[a-z]+\s*/i,Ms=/\/$/}}),Kt={};S(Kt,{EMPTY_COMMANDS:()=>gt,adhocExecTask:()=>Ps,configurationErrorTask:()=>L,isBufferTask:()=>Ns,isEmptyTask:()=>js,straightThroughBufferTask:()=>Ds,straightThroughStringTask:()=>M});function Ps(e){return{commands:gt,format:"empty",parser:e}}function L(e){return{commands:gt,format:"empty",parser(){throw typeof e=="string"?new cr(e):e}}}function M(e,t=!1){return{commands:e,format:"utf-8",parser(r){return t?String(r).trim():r}}}function Ds(e){return{commands:e,format:"buffer",parser(t){return t}}}function Ns(e){return e.format==="buffer"}function js(e){return e.format==="empty"||!e.commands.length}var gt,C=l({"src/lib/tasks/task.ts"(){"use strict";ls(),gt=[]}}),Ls={};S(Ls,{CONFIG_ERROR_INTERACTIVE_MODE:()=>mr,CONFIG_ERROR_MODE_REQUIRED:()=>gr,CONFIG_ERROR_UNKNOWN_OPTION:()=>yr,CleanOptions:()=>Se,cleanTask:()=>$s,cleanWithOptionsTask:()=>Rc,isCleanOptionsArray:()=>xc});function Rc(e,t){let{cleanMode:r,options:n,valid:s}=Fc(e);return r?s.options?(n.push(...t),n.some(Mc)?L(mr):$s(r,n)):L(yr+JSON.stringify(e)):L(gr)}function $s(e,t){return{commands:["clean",`-${e}`,...t],format:"utf-8",parser(n){return Oc(e==="n",n)}}}function xc(e){return Array.isArray(e)&&e.every(t=>br.has(t))}function Fc(e){let t,r=[],n={cleanMode:!1,options:!0};return e.replace(/[^a-z]i/g,"").split("").forEach(s=>{Ac(s)?(t=s,n.cleanMode=!0):n.options=n.options&&Ic(r[r.length]=`-${s}`)}),{cleanMode:t,options:r,valid:n}}function Ac(e){return e==="f"||e==="n"}function Ic(e){return/^-[a-z]$/i.test(e)&&br.has(e.charAt(1))}function Mc(e){return/^-[^\-]/.test(e)?e.indexOf("i")>0:e==="--interactive"}var mr,gr,yr,Se,br,Bs=l({"src/lib/tasks/clean.ts"(){"use strict";Cc(),b(),C(),mr="Git clean interactive mode is not supported",gr='Git clean mode parameter ("n" or "f") is required',yr="Git clean unknown option found in: ",Se=(e=>(e.DRY_RUN="n",e.FORCE="f",e.IGNORED_INCLUDED="x",e.IGNORED_ONLY="X",e.EXCLUDING="e",e.QUIET="q",e.RECURSIVE="d",e))(Se||{}),br=new Set(["i",...we(Object.values(Se))])}});function Pc(e){let t=new Us;for(let r of qs(e))t.addValue(r.file,String(r.key),r.value);return t}function Dc(e,t){let r=null,n=[],s=new Map;for(let i of qs(e,t))i.key===t&&(n.push(r=i.value),s.has(i.file)||s.set(i.file,[]),s.get(i.file).push(r));return{key:t,paths:Array.from(s.keys()),scopes:s,value:r,values:n}}function Nc(e){return e.replace(/^(file):/,"")}function*qs(e,t=null){let r=e.split("\0");for(let n=0,s=r.length-1;n<s;){let i=Nc(r[n++]),o=r[n++],a=t;if(o.includes(`
`)){let c=ds(o,`
`);a=c[0],o=c[1]}yield{file:i,key:a,value:o}}}var Us,jc=l({"src/lib/responses/ConfigList.ts"(){"use strict";b(),Us=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((e,t)=>Object.assign(e,this.values[t]),{})),this._all}addFile(e){if(!(e in this.values)){let t=ae(this.files);this.values[e]=t?Object.create(this.values[t]):{},this.files.push(e)}return this.values[e]}addValue(e,t,r){let n=this.addFile(e);Object.hasOwn(n,t)?Array.isArray(n[t])?n[t].push(r):n[t]=[n[t],r]:n[t]=r,this._all=void 0}}}});function $t(e,t){return typeof e=="string"&&Object.hasOwn(at,e)?e:t}function Lc(e,t,r,n){let s=["config",`--${n}`];return r&&s.push("--add"),s.push(e,t),{commands:s,format:"utf-8",parser(i){return i}}}function $c(e,t){let r=["config","--null","--show-origin","--get-all",e];return t&&r.splice(1,0,`--${t}`),{commands:r,format:"utf-8",parser(n){return Dc(n,e)}}}function Bc(e){let t=["config","--list","--show-origin","--null"];return e&&t.push(`--${e}`),{commands:t,format:"utf-8",parser(r){return Pc(r)}}}function qc(){return{addConfig(e,t,...r){return this._runTask(Lc(e,t,r[0]===!0,$t(r[1],"local")),O(arguments))},getConfig(e,t){return this._runTask($c(e,$t(t,void 0)),O(arguments))},listConfig(...e){return this._runTask(Bc($t(e[0],void 0)),O(arguments))}}}var at,Gs=l({"src/lib/tasks/config.ts"(){"use strict";jc(),b(),at=(e=>(e.system="system",e.global="global",e.local="local",e.worktree="worktree",e))(at||{})}});function Uc(e){return Xs.has(e)}var Ze,Xs,zs=l({"src/lib/tasks/diff-name-status.ts"(){"use strict";Ze=(e=>(e.ADDED="A",e.COPIED="C",e.DELETED="D",e.MODIFIED="M",e.RENAMED="R",e.CHANGED="T",e.UNMERGED="U",e.UNKNOWN="X",e.BROKEN="B",e))(Ze||{}),Xs=new Set(Object.values(Ze))}});function Hs(...e){return new Ys().param(...e)}function Gc(e){let t=new Set,r={};return ur(e,n=>{let[s,i,o]=n.split(be);t.add(s),(r[s]=r[s]||[]).push({line:E(i),path:s,preview:o})}),{paths:t,results:r}}function Xc(){return{grep(e){let t=O(arguments),r=j(arguments);for(let s of Ws)if(r.includes(s))return this._runTask(L(`git.grep: use of "${s}" is not supported.`),t);typeof e=="string"&&(e=Hs().param(e));let n=["grep","--null","-n","--full-name",...r,...e];return this._runTask({commands:n,format:"utf-8",parser(s){return Gc(s)}},t)}}}var Ws,ke,Fn,Ys,Vs=l({"src/lib/tasks/grep.ts"(){"use strict";b(),C(),Ws=["-h"],ke=Symbol("grepQuery"),Ys=class{constructor(){this[Fn]=[]}*[(Fn=ke,Symbol.iterator)](){for(let e of this[ke])yield e}and(...e){return e.length&&this[ke].push("--and","(",...Ce(e,"-e"),")"),this}param(...e){return this[ke].push(...Ce(e,"-e")),this}}}}),Ks={};S(Ks,{ResetMode:()=>Oe,getResetMode:()=>Hc,resetTask:()=>zc});function zc(e,t){let r=["reset"];return Js(e)&&r.push(`--${e}`),r.push(...t),M(r)}function Hc(e){if(Js(e))return e;switch(typeof e){case"string":case"undefined":return"soft"}}function Js(e){return typeof e=="string"&&Qs.includes(e)}var Oe,Qs,Zs=l({"src/lib/tasks/reset.ts"(){"use strict";b(),C(),Oe=(e=>(e.MIXED="mixed",e.SOFT="soft",e.HARD="hard",e.MERGE="merge",e.KEEP="keep",e))(Oe||{}),Qs=we(Object.values(Oe))}}),ei={};S(ei,{CheckRepoActions:()=>ot,CleanOptions:()=>Se,DiffNameStatus:()=>Ze,GitConfigScope:()=>at,GitConstructError:()=>ar,GitError:()=>K,GitPluginError:()=>H,GitResponseError:()=>ce,ResetMode:()=>Oe,TaskConfigurationError:()=>cr,grepQueryBuilder:()=>Hs,pathspec:()=>us});var Wc=l({"src/lib/api.ts"(){"use strict";xe(),mc(),te(),Fe(),_e(),ls(),xs(),Bs(),Gs(),zs(),Vs(),Zs()}});function Yc(e){return e?[{type:"spawn.before",action(n,s){e.aborted&&s.kill(new H(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(n,s){function i(){s.kill(new H(void 0,"abort","Abort signal received"))}e.addEventListener("abort",i),s.spawned.on("close",()=>e.removeEventListener("abort",i))}}]:void 0}var Vc=l({"src/lib/plugins/abort-plugin.ts"(){"use strict";Fe()}});function Kc(e){return typeof e=="string"&&e.trim().toLowerCase()==="-c"}function Jc(e,t){if(Kc(e)&&/^\s*protocol(.[a-z]+)?.allow/.test(t))throw new H(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function Qc(e,t){if(/^\s*--(upload|receive)-pack/.test(e))throw new H(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(t==="clone"&&/^\s*-u\b/.test(e))throw new H(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(t==="push"&&/^\s*--exec\b/.test(e))throw new H(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function Zc({allowUnsafeProtocolOverride:e=!1,allowUnsafePack:t=!1}={}){return{type:"spawn.args",action(r,n){return r.forEach((s,i)=>{let o=i<r.length?r[i+1]:"";e||Jc(s,o),t||Qc(s,n.method)}),r}}}var eu=l({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";Fe()}});function tu(e){let t=Ce(e,"-c");return{type:"spawn.args",action(r){return[...t,...r]}}}var ru=l({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";b()}});function nu({onClose:e=!0,onExit:t=50}={}){function r(){let s=-1,i={close:(0,ye.deferred)(),closeTimeout:(0,ye.deferred)(),exit:(0,ye.deferred)(),exitTimeout:(0,ye.deferred)()},o=Promise.race([e===!1?Jt:i.closeTimeout.promise,t===!1?Jt:i.exitTimeout.promise]);return n(e,i.close,i.closeTimeout),n(t,i.exit,i.exitTimeout),{close(a){s=a,i.close.done()},exit(a){s=a,i.exit.done()},get exitCode(){return s},result:o}}function n(s,i,o){s!==!1&&(s===!0?i.promise:i.promise.then(()=>Xt(s))).then(o.done)}return{type:"spawn.after",async action(s,{spawned:i,close:o}){let a=r(),c=!0,f=()=>void(c=!1);i.stdout?.on("data",f),i.stderr?.on("data",f),i.on("error",f),i.on("close",u=>a.close(u)),i.on("exit",u=>a.exit(u));try{await a.result,c&&await Xt(50),o(a.exitCode)}catch(u){o(a.exitCode,u)}}}}var ye,Jt,su=l({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";ye=Lt(),b(),Jt=(0,ye.deferred)().promise}});function iu(e){return!e||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(e)}function An(e,t){if(e.length<1||e.length>2)throw new H(void 0,"binary",ti);if(e.some(iu))if(t)console.warn(Qt);else throw new H(void 0,"binary",Qt);let[n,s]=e;return{binary:n,prefix:s}}function ou(e,t=["git"],r=!1){let n=An(J(t),r);e.on("binary",s=>{n=An(J(s),r)}),e.append("spawn.binary",()=>n.binary),e.append("spawn.args",s=>n.prefix?[n.prefix,...s]:s)}var ti,Qt,au=l({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";Fe(),b(),ti="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",Qt="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function cu(e){return!!(e.exitCode&&e.stdErr.length)}function uu(e){return Buffer.concat([...e.stdOut,...e.stdErr])}function lu(e=!1,t=cu,r=uu){return(n,s)=>!e&&n||!t(s)?n:r(s)}function In(e){return{type:"task.error",action(t,r){let n=e(t.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(n)?{error:new K(void 0,n.toString("utf-8"))}:{error:n}}}}var fu=l({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";te()}}),Mn,ri,pu=l({"src/lib/plugins/plugin-store.ts"(){"use strict";Mn=require("node:events"),b(),ri=class{constructor(){this.plugins=new Set,this.events=new Mn.EventEmitter}on(e,t){this.events.on(e,t)}reconfigure(e,t){this.events.emit(e,t)}append(e,t){let r=w(this.plugins,{type:e,action:t});return()=>this.plugins.delete(r)}add(e){let t=[];return J(e).forEach(r=>r&&this.plugins.add(w(t,r))),()=>{t.forEach(r=>this.plugins.delete(r))}}exec(e,t,r){let n=t,s=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===e&&(n=i.action(n,s));return n}}}});function du(e){let t="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?gs(i,t):i}},{type:"spawn.after",action(i,o){o.commands.includes(t)&&o.spawned.stderr?.on("data",a=>{let c=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));c&&e({method:o.method,stage:hu(c[1]),progress:E(c[2]),processed:E(c[3]),total:E(c[4])})})}}]}function hu(e){return String(e.toLowerCase().split(" ",1))||"unknown"}var mu=l({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";b()}}),gu=l({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function yu(e){let t=bs(e,["uid","gid"]);return{type:"spawn.options",action(r){return{...t,...r}}}}var bu=l({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";b()}});function _u({block:e,stdErr:t=!0,stdOut:r=!0}){if(e>0)return{type:"spawn.after",action(n,s){let i;function o(){i&&clearTimeout(i),i=setTimeout(c,e)}function a(){s.spawned.stdout?.off("data",o),s.spawned.stderr?.off("data",o),s.spawned.off("exit",a),s.spawned.off("close",a),i&&clearTimeout(i)}function c(){a(),s.kill(new H(void 0,"timeout","block timeout reached"))}r&&s.spawned.stdout?.on("data",o),t&&s.spawned.stderr?.on("data",o),s.spawned.on("exit",a),s.spawned.on("close",a),o()}}}var wu=l({"src/lib/plugins/timout-plugin.ts"(){"use strict";Fe()}}),Tu=l({"src/lib/plugins/index.ts"(){"use strict";Vc(),eu(),ru(),su(),au(),fu(),pu(),mu(),gu(),bu(),wu()}});function vu(){return{type:"spawn.args",action(e){let t=[],r;function n(s){(r=r||[]).push(...s)}for(let s=0;s<e.length;s++){let i=e[s];if(nt(i)){n(xn(i));continue}if(i==="--"){n(e.slice(s+1).flatMap(o=>nt(o)&&xn(o)||o));break}t.push(i)}return r?[...t,"--",...r.map(String)]:t}}}var Eu=l({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";xe()}});function ku(){return(0,et.default)("simple-git")}function Pn(e,t,r){return!t||!String(t).replace(/\s*/,"")?r?(n,...s)=>{e(n,...s),r(n,...s)}:e:(n,...s)=>{e(`%s ${n}`,t,...s),r&&r(n,...s)}}function Su(e,t,{namespace:r}){if(typeof e=="string")return e;let n=t&&t.namespace||"";return n.startsWith(r)?n.substr(r.length+1):n||r}function _r(e,t,r,n=ku()){let s=e&&`[${e}]`||"",i=[],o=typeof t=="string"?n.extend(t):t,a=Su(U(t,F),o,n);return f(r);function c(u,d){return w(i,_r(e,a.replace(/^[^:]+/,u),d,n))}function f(u){let d=u&&`[${u}]`||"",m=o&&Pn(o,d)||ue,h=Pn(n,`${s} ${d}`,m);return Object.assign(o?m:h,{label:e,sibling:c,info:h,step:f})}}var et,ni=l({"src/lib/git-logger.ts"(){"use strict";et=hc(Nt()),b(),et.default.formatters.L=e=>String(ht(e)?e.length:"-"),et.default.formatters.B=e=>Buffer.isBuffer(e)?e.toString("utf8"):Ie(e)}}),si,Ou=l({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";te(),ni(),si=class Zt{constructor(t="GitExecutor"){this.logLabel=t,this._queue=new Map}withProgress(t){return this._queue.get(t)}createProgress(t){let r=Zt.getName(t.commands[0]),n=_r(this.logLabel,r);return{task:t,logger:n,name:r}}push(t){let r=this.createProgress(t);return r.logger("Adding task to the queue, commands = %o",t.commands),this._queue.set(t,r),r}fatal(t){for(let[r,{logger:n}]of Array.from(this._queue.entries()))r===t.task?(n.info("Failed %o",t),n("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):n.info("A fatal exception occurred in a previous task, the queue has been purged: %o",t.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(t){this.withProgress(t)&&this._queue.delete(t)}attempt(t){let r=this.withProgress(t);if(!r)throw new K(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(t="empty"){return`task:${t}:${++Zt.counter}`}static{this.counter=0}}}});function oe(e,t){return{method:hs(e.commands)||"",commands:t}}function Cu(e,t){return r=>{t("[ERROR] child process exception %o",r),e.push(Buffer.from(String(r.stack),"ascii"))}}function Dn(e,t,r,n){return s=>{r("%s received %L bytes",t,s),n("%B",s),e.push(s)}}var Nn,er,Ru=l({"src/lib/runners/git-executor-chain.ts"(){"use strict";Nn=require("child_process"),te(),C(),b(),Ou(),er=class{constructor(e,t,r){this._executor=e,this._scheduler=t,this._plugins=r,this._chain=Promise.resolve(),this._queue=new si}get cwd(){return this._cwd||this._executor.cwd}set cwd(e){this._cwd=e}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(e){return this._queue.push(e),this._chain=this._chain.then(()=>this.attemptTask(e))}async attemptTask(e){let t=await this._scheduler.next(),r=()=>this._queue.complete(e);try{let{logger:n}=this._queue.attempt(e);return await(js(e)?this.attemptEmptyTask(e,n):this.attemptRemoteTask(e,n))}catch(n){throw this.onFatalException(e,n)}finally{r(),t()}}onFatalException(e,t){let r=t instanceof K?Object.assign(t,{task:e}):new K(e,t&&String(t));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(e,t){let r=this._plugins.exec("spawn.binary","",oe(e,e.commands)),n=this._plugins.exec("spawn.args",[...e.commands],oe(e,e.commands)),s=await this.gitResponse(e,r,n,this.outputHandler,t.step("SPAWN")),i=await this.handleTaskData(e,n,s,t.step("HANDLE"));return t("passing response to task's parser as a %s",e.format),Ns(e)?Vt(e.parser,i):Vt(e.parser,i.asStrings())}async attemptEmptyTask(e,t){return t("empty task bypassing child process to call to task's parser"),e.parser(this)}handleTaskData(e,t,r,n){let{exitCode:s,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((c,f)=>{n("Preparing to handle process response exitCode=%d stdOut=",s);let{error:u}=this._plugins.exec("task.error",{error:i},{...oe(e,t),...r});if(u&&e.onError)return n.info("exitCode=%s handling with custom error handler"),e.onError(r,u,d=>{n.info("custom error handler treated as success"),n("custom error returned a %s",Ie(d)),c(new it(Array.isArray(d)?Buffer.concat(d):d,Buffer.concat(a)))},f);if(u)return n.info("handling as error: exitCode=%s stdErr=%s rejection=%o",s,a.length,i),f(u);n.info("retrieving task output complete"),c(new it(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(e,t,r,n,s){let i=s.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},oe(e,e.commands));return new Promise(a=>{let c=[],f=[];s.info("%s %o",t,r),s("%O",o);let u=this._beforeSpawn(e,r);if(u)return a({stdOut:c,stdErr:f,exitCode:9901,rejection:u});this._plugins.exec("spawn.before",void 0,{...oe(e,r),kill(m){u=m||u}});let d=(0,Nn.spawn)(t,r,o);d.stdout.on("data",Dn(c,"stdOut",s,i.step("stdOut"))),d.stderr.on("data",Dn(f,"stdErr",s,i.step("stdErr"))),d.on("error",Cu(f,s)),n&&(s("Passing child process stdOut/stdErr to custom outputHandler"),n(t,d.stdout,d.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...oe(e,r),spawned:d,close(m,h){a({stdOut:c,stdErr:f,exitCode:m,rejection:u||h})},kill(m){d.killed||(u=m,d.kill("SIGINT"))}})})}_beforeSpawn(e,t){let r;return this._plugins.exec("spawn.before",void 0,{...oe(e,t),kill(n){r=n||r}}),r}}}}),ii={};S(ii,{GitExecutor:()=>oi});var oi,xu=l({"src/lib/runners/git-executor.ts"(){"use strict";Ru(),oi=class{constructor(e,t,r){this.cwd=e,this._scheduler=t,this._plugins=r,this._chain=new er(this,this._scheduler,this._plugins)}chain(){return new er(this,this._scheduler,this._plugins)}push(e){return this._chain.push(e)}}}});function Fu(e,t,r=ue){let n=i=>{r(null,i)},s=i=>{i?.task===e&&r(i instanceof ce?Au(i):i,void 0)};t.then(n,s)}function Au(e){let t=n=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${n} should be GitResponseError.git.${n}, this will no longer be available in version 3`),t=ue};return Object.create(e,Object.getOwnPropertyNames(e.git).reduce(r,{}));function r(n,s){return s in e||(n[s]={enumerable:!1,configurable:!1,get(){return t(s),e.git[s]}}),n}}var Iu=l({"src/lib/task-callback.ts"(){"use strict";_e(),b()}});function jn(e,t){return Ps(r=>{if(!lr(e))throw new Error(`Git.cwd: cannot change to non-directory "${e}"`);return(t||r).cwd=e})}var Mu=l({"src/lib/tasks/change-working-directory.ts"(){"use strict";b(),C()}});function Bt(e){let t=["checkout",...e];return t[1]==="-b"&&t.includes("-B")&&(t[1]=ft(t,"-B")),M(t)}function Pu(){return{checkout(){return this._runTask(Bt(j(arguments,1)),O(arguments))},checkoutBranch(e,t){return this._runTask(Bt(["-b",e,t,...j(arguments)]),O(arguments))},checkoutLocalBranch(e){return this._runTask(Bt(["-b",e,...j(arguments)]),O(arguments))}}}var Du=l({"src/lib/tasks/checkout.ts"(){"use strict";b(),C()}});function Nu(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function ju(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(e){return $(Nu(),[ai],e)}})}}}var ai,Lu=l({"src/lib/tasks/count-objects.ts"(){"use strict";b(),ai=new _(/([a-z-]+): (\d+)$/,(e,[t,r])=>{let n=ys(t);Object.hasOwn(e,n)&&(e[n]=E(r))})}});function $u(e){return $({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},ci,e)}var ci,Bu=l({"src/lib/parsers/parse-commit.ts"(){"use strict";b(),ci=[new _(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(e,[t,r,n])=>{e.branch=t,e.commit=n,e.root=!!r}),new _(/\s*Author:\s(.+)/i,(e,[t])=>{let r=t.split("<"),n=r.pop();!n||!n.includes("@")||(e.author={email:n.substr(0,n.length-1),name:r.join("<").trim()})}),new _(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0,e.summary.insertions=parseInt(r,10)||0,e.summary.deletions=parseInt(n,10)||0}),new _(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0;let s=parseInt(r,10)||0;n==="-"?e.summary.deletions=s:n==="+"&&(e.summary.insertions=s)})]}});function qu(e,t,r){return{commands:["-c","core.abbrev=40","commit",...Ce(e,"-m"),...t,...r],format:"utf-8",parser:$u}}function Uu(){return{commit(t,...r){let n=O(arguments),s=e(t)||qu(J(t),J(U(r[0],st,[])),[...we(U(r[1],Me,[])),...j(arguments,0,!0)]);return this._runTask(s,n)}};function e(t){return!st(t)&&L("git.commit: requires the commit message to be supplied as a string/string[]")}}var Gu=l({"src/lib/tasks/commit.ts"(){"use strict";Bu(),b(),C()}});function Xu(){return{firstCommit(){return this._runTask(M(["rev-list","--max-parents=0","HEAD"],!0),O(arguments))}}}var zu=l({"src/lib/tasks/first-commit.ts"(){"use strict";b(),C()}});function Hu(e,t){let r=["hash-object",e];return t&&r.push("-w"),M(r,!0)}var Wu=l({"src/lib/tasks/hash-object.ts"(){"use strict";C()}});function Yu(e,t,r){let n=String(r).trim(),s;if(s=ui.exec(n))return new tt(e,t,!1,s[1]);if(s=li.exec(n))return new tt(e,t,!0,s[1]);let i="",o=n.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new tt(e,t,/^re/i.test(n),i)}var tt,ui,li,Vu=l({"src/lib/responses/InitSummary.ts"(){"use strict";tt=class{constructor(e,t,r,n){this.bare=e,this.path=t,this.existing=r,this.gitDir=n}},ui=/^Init.+ repository in (.+)$/,li=/^Rein.+ in (.+)$/}});function Ku(e){return e.includes(wr)}function Ju(e=!1,t,r){let n=["init",...r];return e&&!Ku(n)&&n.splice(1,0,wr),{commands:n,format:"utf-8",parser(s){return Yu(n.includes("--bare"),t,s)}}}var wr,Qu=l({"src/lib/tasks/init.ts"(){"use strict";Vu(),wr="--bare"}});function Tr(e){for(let t=0;t<e.length;t++){let r=vr.exec(e[t]);if(r)return`--${r[1]}`}return""}function Zu(e){return vr.test(e)}var vr,Pe=l({"src/lib/args/log-format.ts"(){"use strict";vr=/^--(stat|numstat|name-only|name-status)(=|$)/}}),fi,el=l({"src/lib/responses/DiffSummary.ts"(){"use strict";fi=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function pi(e=""){let t=di[e];return r=>$(new fi,t,r,!1)}var qt,Ln,$n,Bn,di,hi=l({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Pe(),el(),zs(),b(),qt=[new _(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(e,[t,r,n=""])=>{e.files.push({file:t.trim(),changes:E(r),insertions:n.replace(/[^+]/g,"").length,deletions:n.replace(/[^-]/g,"").length,binary:!1})}),new _(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(e,[t,r,n])=>{e.files.push({file:t.trim(),before:E(r),after:E(n),binary:!0})}),new _(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(e,[t,r])=>{let n=/(\d+) i/.exec(r),s=/(\d+) d/.exec(r);e.changed=E(t),e.insertions=E(n?.[1]),e.deletions=E(s?.[1])})],Ln=[new _(/(\d+)\t(\d+)\t(.+)$/,(e,[t,r,n])=>{let s=E(t),i=E(r);e.changed++,e.insertions+=s,e.deletions+=i,e.files.push({file:n,changes:s+i,insertions:s,deletions:i,binary:!1})}),new _(/-\t-\t(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,after:0,before:0,binary:!0})})],$n=[new _(/(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,changes:0,insertions:0,deletions:0,binary:!1})})],Bn=[new _(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(e,[t,r,n,s,i])=>{e.changed++,e.files.push({file:i??n,changes:0,insertions:0,deletions:0,binary:!1,status:zt(Uc(t)&&t),from:zt(!!i&&n!==i&&n),similarity:E(r)})})],di={"":qt,"--stat":qt,"--numstat":Ln,"--name-status":Bn,"--name-only":$n}}});function tl(e,t){return t.reduce((r,n,s)=>(r[n]=e[s]||"",r),Object.create({diff:null}))}function mi(e=Sr,t=gi,r=""){let n=pi(r);return function(s){let i=Ae(s.trim(),!1,Er).map(function(o){let a=o.split(kr),c=tl(a[0].split(e),t);return a.length>1&&a[1].trim()&&(c.diff=n(a[1])),c});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var Er,kr,Sr,gi,yi=l({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";b(),hi(),Pe(),Er="\xF2\xF2\xF2\xF2\xF2\xF2 ",kr=" \xF2\xF2",Sr=" \xF2 ",gi=["hash","date","message","refs","author_name","author_email"]}}),bi={};S(bi,{diffSummaryTask:()=>rl,validateLogFormatConfig:()=>yt});function rl(e){let t=Tr(e),r=["diff"];return t===""&&(t="--stat",r.push("--stat=4096")),r.push(...e),yt(r)||{commands:r,format:"utf-8",parser:pi(t)}}function yt(e){let t=e.filter(Zu);if(t.length>1)return L(`Summary flags are mutually exclusive - pick one of ${t.join(",")}`);if(t.length&&e.includes("-z"))return L(`Summary flag ${t} parsing is not compatible with null termination option '-z'`)}var Or=l({"src/lib/tasks/diff.ts"(){"use strict";Pe(),hi(),C()}});function nl(e,t){let r=[],n=[];return Object.keys(e).forEach(s=>{r.push(s),n.push(String(e[s]))}),[r,n.join(t)]}function sl(e){return Object.keys(e).reduce((t,r)=>(r in tr||(t[r]=e[r]),t),{})}function _i(e={},t=[]){let r=U(e.splitter,F,Sr),n=dt(e.format)?e.format:{hash:"%H",date:e.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:e.multiLine?"%B":"%b",author_name:e.mailMap!==!1?"%aN":"%an",author_email:e.mailMap!==!1?"%aE":"%ae"},[s,i]=nl(n,r),o=[],a=[`--pretty=format:${Er}${i}${kr}`,...t],c=e.n||e["max-count"]||e.maxCount;if(c&&a.push(`--max-count=${c}`),e.from||e.to){let f=e.symmetric!==!1?"...":"..";o.push(`${e.from||""}${f}${e.to||""}`)}return F(e.file)&&a.push("--follow",us(e.file)),pr(sl(e),a),{fields:s,splitter:r,commands:[...a,...o]}}function il(e,t,r){let n=mi(e,t,Tr(r));return{commands:["log",...r],format:"utf-8",parser:n}}function ol(){return{log(...r){let n=O(arguments),s=_i(dr(arguments),we(U(arguments[0],Me,[]))),i=t(...r)||yt(s.commands)||e(s);return this._runTask(i,n)}};function e(r){return il(r.splitter,r.fields,r.commands)}function t(r,n){return F(r)&&F(n)&&L("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var tr,wi=l({"src/lib/tasks/log.ts"(){"use strict";Pe(),xe(),yi(),b(),C(),Or(),tr=(e=>(e[e["--pretty"]=0]="--pretty",e[e["max-count"]=1]="max-count",e[e.maxCount=2]="maxCount",e[e.n=3]="n",e[e.file=4]="file",e[e.format=5]="format",e[e.from=6]="from",e[e.to=7]="to",e[e.splitter=8]="splitter",e[e.symmetric=9]="symmetric",e[e.mailMap=10]="mailMap",e[e.multiLine=11]="multiLine",e[e.strictDate=12]="strictDate",e))(tr||{})}}),rt,Ti,al=l({"src/lib/responses/MergeSummary.ts"(){"use strict";rt=class{constructor(e,t=null,r){this.reason=e,this.file=t,this.meta=r}toString(){return`${this.file}:${this.reason}`}},Ti=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),rr,vi,cl=l({"src/lib/responses/PullSummary.ts"(){"use strict";rr=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},vi=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function Ut(e){return e.objects=e.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function qn(e){let t=/^\s*(\d+)/.exec(e),r=/delta (\d+)/i.exec(e);return{count:E(t&&t[1]||"0"),delta:E(r&&r[1]||"0")}}var Ei,ul=l({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";b(),Ei=[new ee(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=Ut(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new ee(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=Ut(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new ee(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(e,[t,r,n])=>{let s=Ut(e.remoteMessages);s.total=qn(t),s.reused=qn(r),s.packReused=E(n)})]}});function ki(e,t){return $({remoteMessages:new Oi},Si,t)}var Si,Oi,Ci=l({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";b(),ul(),Si=[new ee(/^remote:\s*(.+)$/,(e,[t])=>(e.remoteMessages.all.push(t.trim()),!1)),...Ei,new ee([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(e,[t])=>{e.remoteMessages.pullRequestUrl=t}),new ee([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(e,[t,r,n])=>{e.remoteMessages.vulnerabilities={count:E(t),summary:r,url:n}})],Oi=class{constructor(){this.all=[]}}}});function ll(e,t){let r=$(new vi,Ri,[e,t]);return r.message&&r}var Un,Gn,Xn,zn,Ri,Hn,Cr,xi=l({"src/lib/parsers/parse-pull.ts"(){"use strict";cl(),b(),Ci(),Un=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,Gn=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,Xn=/^(create|delete) mode \d+ (.+)/,zn=[new _(Un,(e,[t,r,n])=>{e.files.push(t),r&&(e.insertions[t]=r.length),n&&(e.deletions[t]=n.length)}),new _(Gn,(e,[t,,r,,n])=>r!==void 0||n!==void 0?(e.summary.changes=+t||0,e.summary.insertions=+r||0,e.summary.deletions=+n||0,!0):!1),new _(Xn,(e,[t,r])=>{w(e.files,r),w(t==="create"?e.created:e.deleted,r)})],Ri=[new _(/^from\s(.+)$/i,(e,[t])=>void(e.remote=t)),new _(/^fatal:\s(.+)$/,(e,[t])=>void(e.message=t)),new _(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(e,[t,r,n,s])=>{e.branch.local=n,e.hash.local=t,e.branch.remote=s,e.hash.remote=r})],Hn=(e,t)=>$(new rr,zn,[e,t]),Cr=(e,t)=>Object.assign(new rr,Hn(e,t),ki(e,t))}}),Wn,Fi,Yn,fl=l({"src/lib/parsers/parse-merge.ts"(){"use strict";al(),b(),xi(),Wn=[new _(/^Auto-merging\s+(.+)$/,(e,[t])=>{e.merges.push(t)}),new _(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(e,[t,r])=>{e.conflicts.push(new rt(t,r))}),new _(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(e,[t,r,n])=>{e.conflicts.push(new rt(t,r,{deleteRef:n}))}),new _(/^CONFLICT\s+\((.+)\):/,(e,[t])=>{e.conflicts.push(new rt(t,null))}),new _(/^Automatic merge failed;\s+(.+)$/,(e,[t])=>{e.result=t})],Fi=(e,t)=>Object.assign(Yn(e,t),Cr(e,t)),Yn=e=>$(new Ti,Wn,e)}});function Vn(e){return e.length?{commands:["merge",...e],format:"utf-8",parser(t,r){let n=Fi(t,r);if(n.failed)throw new ce(n);return n}}:L("Git.merge requires at least one option")}var pl=l({"src/lib/tasks/merge.ts"(){"use strict";_e(),fl(),C()}});function dl(e,t,r){let n=r.includes("deleted"),s=r.includes("tag")||/^refs\/tags/.test(e),i=!r.includes("new");return{deleted:n,tag:s,branch:!s,new:!i,alreadyUpdated:i,local:e,remote:t}}var Kn,Ai,Jn,hl=l({"src/lib/parsers/parse-push.ts"(){"use strict";b(),Ci(),Kn=[new _(/^Pushing to (.+)$/,(e,[t])=>{e.repo=t}),new _(/^updating local tracking ref '(.+)'/,(e,[t])=>{e.ref={...e.ref||{},local:t}}),new _(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(e,[t,r,n])=>{e.pushed.push(dl(t,r,n))}),new _(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(e,[t,r,n])=>{e.branch={...e.branch||{},local:t,remote:r,remoteName:n}}),new _(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(e,[t,r,n,s])=>{e.update={head:{local:t,remote:r},hash:{from:n,to:s}}})],Ai=(e,t)=>{let r=Jn(e,t),n=ki(e,t);return{...r,...n}},Jn=(e,t)=>$({pushed:[]},Kn,[e,t])}}),Ii={};S(Ii,{pushTagsTask:()=>ml,pushTask:()=>Rr});function ml(e={},t){return w(t,"--tags"),Rr(e,t)}function Rr(e={},t){let r=["push",...t];return e.branch&&r.splice(1,0,e.branch),e.remote&&r.splice(1,0,e.remote),ft(r,"-v"),w(r,"--verbose"),w(r,"--porcelain"),{commands:r,format:"utf-8",parser:Ai}}var Mi=l({"src/lib/tasks/push.ts"(){"use strict";hl(),b()}});function gl(){return{showBuffer(){let e=["show",...j(arguments,1)];return e.includes("--binary")||e.splice(1,0,"--binary"),this._runTask(Ds(e),O(arguments))},show(){let e=["show",...j(arguments,1)];return this._runTask(M(e),O(arguments))}}}var yl=l({"src/lib/tasks/show.ts"(){"use strict";b(),C()}}),Qn,Pi,bl=l({"src/lib/responses/FileStatusSummary.ts"(){"use strict";Qn=/^(.+)\0(.+)$/,Pi=class{constructor(e,t,r){if(this.path=e,this.index=t,this.working_dir=r,t==="R"||r==="R"){let n=Qn.exec(e)||[null,e,e];this.from=n[2]||"",this.path=n[1]||""}}}}});function Zn(e){let[t,r]=e.split(be);return{from:r||t,to:t}}function q(e,t,r){return[`${e}${t}`,r]}function Gt(e,...t){return t.map(r=>q(e,r,(n,s)=>w(n.conflicted,s)))}function _l(e,t){let r=t.trim();switch(" "){case r.charAt(2):return n(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return n(" ",r.charAt(0),r.substr(2));default:return}function n(s,i,o){let a=`${s}${i}`,c=Di.get(a);c&&c(e,o),a!=="##"&&a!=="!!"&&e.files.push(new Pi(o,s,i))}}var es,Di,Ni,wl=l({"src/lib/responses/StatusSummary.ts"(){"use strict";b(),bl(),es=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},Di=new Map([q(" ","A",(e,t)=>w(e.created,t)),q(" ","D",(e,t)=>w(e.deleted,t)),q(" ","M",(e,t)=>w(e.modified,t)),q("A"," ",(e,t)=>w(e.created,t)&&w(e.staged,t)),q("A","M",(e,t)=>w(e.created,t)&&w(e.staged,t)&&w(e.modified,t)),q("D"," ",(e,t)=>w(e.deleted,t)&&w(e.staged,t)),q("M"," ",(e,t)=>w(e.modified,t)&&w(e.staged,t)),q("M","M",(e,t)=>w(e.modified,t)&&w(e.staged,t)),q("R"," ",(e,t)=>{w(e.renamed,Zn(t))}),q("R","M",(e,t)=>{let r=Zn(t);w(e.renamed,r),w(e.modified,r.to)}),q("!","!",(e,t)=>{w(e.ignored=e.ignored||[],t)}),q("?","?",(e,t)=>w(e.not_added,t)),...Gt("A","A","U"),...Gt("D","D","U"),...Gt("U","A","D","U"),["##",(e,t)=>{let r=/ahead (\d+)/,n=/behind (\d+)/,s=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(t);e.ahead=a&&+a[1]||0,a=n.exec(t),e.behind=a&&+a[1]||0,a=s.exec(t),e.current=U(a?.[1],F,null),a=i.exec(t),e.tracking=U(a?.[1],F,null),a=o.exec(t),a&&(e.current=U(a?.[1],F,e.current)),e.detached=/\(no branch\)/.test(t)}]]),Ni=function(e){let t=e.split(be),r=new es;for(let n=0,s=t.length;n<s;){let i=t[n++].trim();i&&(i.charAt(0)==="R"&&(i+=be+(t[n++]||"")),_l(r,i))}return r}}});function Tl(e){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...e.filter(r=>!ji.includes(r))],parser(r){return Ni(r)}}}var ji,vl=l({"src/lib/tasks/status.ts"(){"use strict";wl(),ji=["--null","-z"]}});function ct(e=0,t=0,r=0,n="",s=!0){return Object.defineProperty({major:e,minor:t,patch:r,agent:n,installed:s},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function El(){return ct(0,0,0,"",!1)}function kl(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:Sl,onError(e,t,r,n){if(e.exitCode===-2)return r(Buffer.from(xr));n(t)}})}}}function Sl(e){return e===xr?El():$(ct(0,0,0,e),Li,e)}var xr,Li,Ol=l({"src/lib/tasks/version.ts"(){"use strict";b(),xr="installed=false",Li=[new _(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(e,[t,r,n,s=""])=>{Object.assign(e,ct(E(t),E(r),E(n),s))}),new _(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(e,[t,r,n,s=""])=>{Object.assign(e,ct(E(t),E(r),n,s))})]}}),$i={};S($i,{SimpleGitApi:()=>nr});var nr,Cl=l({"src/lib/simple-git-api.ts"(){"use strict";Iu(),Mu(),Du(),Lu(),Gu(),Gs(),zu(),Vs(),Wu(),Qu(),wi(),pl(),Mi(),yl(),vl(),C(),Ol(),b(),nr=class{constructor(e){this._executor=e}_runTask(e,t){let r=this._executor.chain(),n=r.push(e);return t&&Fu(e,n,t),Object.create(this,{then:{value:n.then.bind(n)},catch:{value:n.catch.bind(n)},_executor:{value:r}})}add(e){return this._runTask(M(["add",...J(e)]),O(arguments))}cwd(e){let t=O(arguments);return typeof e=="string"?this._runTask(jn(e,this._executor),t):typeof e?.path=="string"?this._runTask(jn(e.path,e.root&&this._executor||void 0),t):this._runTask(L("Git.cwd: workingDirectory must be supplied as a string"),t)}hashObject(e,t){return this._runTask(Hu(e,t===!0),O(arguments))}init(e){return this._runTask(Ju(e===!0,this._executor.cwd,j(arguments)),O(arguments))}merge(){return this._runTask(Vn(j(arguments)),O(arguments))}mergeFromTo(e,t){return F(e)&&F(t)?this._runTask(Vn([e,t,...j(arguments)]),O(arguments,!1)):this._runTask(L("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(e){return this._executor.outputHandler=e,this}push(){let e=Rr({remote:U(arguments[0],F),branch:U(arguments[1],F)},j(arguments));return this._runTask(e,O(arguments))}stash(){return this._runTask(M(["stash",...j(arguments)]),O(arguments))}status(){return this._runTask(Tl(j(arguments)),O(arguments))}},Object.assign(nr.prototype,Pu(),Uu(),qc(),ju(),Xu(),Xc(),ol(),gl(),kl())}}),Bi={};S(Bi,{Scheduler:()=>qi});var ts,rs,qi,Rl=l({"src/lib/runners/scheduler.ts"(){"use strict";b(),ts=Lt(),ni(),rs=(()=>{let e=0;return()=>{e++;let{promise:t,done:r}=(0,ts.createDeferred)();return{promise:t,done:r,id:e}}})(),qi=class{constructor(e=2){this.concurrency=e,this.logger=_r("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",e)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let e=w(this.running,this.pending.shift());this.logger("Attempting id=%s",e.id),e.done(()=>{this.logger("Completing id=",e.id),ft(this.running,e),this.schedule()})}next(){let{promise:e,id:t}=w(this.pending,rs());return this.logger("Scheduling id=%s",t),this.schedule(),e}}}}),Ui={};S(Ui,{applyPatchTask:()=>xl});function xl(e,t){return M(["apply",...t,...e])}var Fl=l({"src/lib/tasks/apply-patch.ts"(){"use strict";C()}});function Al(e,t){return{branch:e,hash:t,success:!0}}function Il(e){return{branch:e,hash:null,success:!1}}var Gi,Ml=l({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";Gi=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Xi(e,t){return t===1&&sr.test(e)}var ns,sr,ss,bt,Pl=l({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";Ml(),b(),ns=/(\S+)\s+\(\S+\s([^)]+)\)/,sr=/^error[^']+'([^']+)'/m,ss=[new _(ns,(e,[t,r])=>{let n=Al(t,r);e.all.push(n),e.branches[t]=n}),new _(sr,(e,[t])=>{let r=Il(t);e.errors.push(r),e.all.push(r),e.branches[t]=r})],bt=(e,t)=>$(new Gi,ss,[e,t])}}),zi,Dl=l({"src/lib/responses/BranchSummary.ts"(){"use strict";zi=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(e,t,r,n,s){e==="*"&&(this.detached=t,this.current=r),this.all.push(r),this.branches[r]={current:e==="*",linkedWorkTree:e==="+",name:r,commit:n,label:s}}}}});function is(e){return e?e.charAt(0):""}function Hi(e,t=!1){return $(new zi,t?[Yi]:Wi,e)}var Wi,Yi,Nl=l({"src/lib/parsers/parse-branch.ts"(){"use strict";Dl(),b(),Wi=[new _(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(e,[t,r,n,s])=>{e.push(is(t),!0,r,n,s)}),new _(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(e,[t,r,n,s])=>{e.push(is(t),!1,r,n,s)})],Yi=new _(/^(\S+)$/s,(e,[t])=>{e.push("*",!1,t,"","")})}}),Vi={};S(Vi,{branchLocalTask:()=>Ll,branchTask:()=>jl,containsDeleteBranchCommand:()=>Ki,deleteBranchTask:()=>Bl,deleteBranchesTask:()=>$l});function Ki(e){let t=["-d","-D","--delete"];return e.some(r=>t.includes(r))}function jl(e){let t=Ki(e),r=e.includes("--show-current"),n=["branch",...e];return n.length===1&&n.push("-a"),n.includes("-v")||n.splice(1,0,"-v"),{format:"utf-8",commands:n,parser(s,i){return t?bt(s,i).all[0]:Hi(s,r)}}}function Ll(){return{format:"utf-8",commands:["branch","-v"],parser(e){return Hi(e)}}}function $l(e,t=!1){return{format:"utf-8",commands:["branch","-v",t?"-D":"-d",...e],parser(r,n){return bt(r,n)},onError({exitCode:r,stdOut:n},s,i,o){if(!Xi(String(s),r))return o(s);i(n)}}}function Bl(e,t=!1){let r={format:"utf-8",commands:["branch","-v",t?"-D":"-d",e],parser(n,s){return bt(n,s).branches[e]},onError({exitCode:n,stdErr:s,stdOut:i},o,a,c){if(!Xi(String(o),n))return c(o);throw new ce(r.parser(Re(i),Re(s)),String(o))}};return r}var ql=l({"src/lib/tasks/branch.ts"(){"use strict";_e(),Pl(),Nl(),b()}});function Ul(e){let t=e.trim().replace(/^["']|["']$/g,"");return t&&(0,Ji.normalize)(t)}var Ji,Qi,Gl=l({"src/lib/responses/CheckIgnore.ts"(){"use strict";Ji=require("node:path"),Qi=e=>e.split(/\n/g).map(Ul).filter(Boolean)}}),Zi={};S(Zi,{checkIgnoreTask:()=>Xl});function Xl(e){return{commands:["check-ignore",...e],format:"utf-8",parser:Qi}}var zl=l({"src/lib/tasks/check-ignore.ts"(){"use strict";Gl()}}),eo={};S(eo,{cloneMirrorTask:()=>Wl,cloneTask:()=>to});function Hl(e){return/^--upload-pack(=|$)/.test(e)}function to(e,t,r){let n=["clone",...r];return F(e)&&n.push(e),F(t)&&n.push(t),n.find(Hl)?L("git.fetch: potential exploit argument blocked."):M(n)}function Wl(e,t,r){return w(r,"--mirror"),to(e,t,r)}var Yl=l({"src/lib/tasks/clone.ts"(){"use strict";C(),b()}});function Vl(e,t){return $({raw:e,remote:null,branches:[],tags:[],updated:[],deleted:[]},ro,[e,t])}var ro,Kl=l({"src/lib/parsers/parse-fetch.ts"(){"use strict";b(),ro=[new _(/From (.+)$/,(e,[t])=>{e.remote=t}),new _(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.branches.push({name:t,tracking:r})}),new _(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.tags.push({name:t,tracking:r})}),new _(/- \[deleted]\s+\S+\s*-> (.+)$/,(e,[t])=>{e.deleted.push({tracking:t})}),new _(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(e,[t,r,n,s])=>{e.updated.push({name:n,tracking:s,to:r,from:t})})]}}),no={};S(no,{fetchTask:()=>Ql});function Jl(e){return/^--upload-pack(=|$)/.test(e)}function Ql(e,t,r){let n=["fetch",...r];return e&&t&&n.push(e,t),n.find(Jl)?L("git.fetch: potential exploit argument blocked."):{commands:n,format:"utf-8",parser:Vl}}var Zl=l({"src/lib/tasks/fetch.ts"(){"use strict";Kl(),C()}});function ef(e){return $({moves:[]},so,e)}var so,tf=l({"src/lib/parsers/parse-move.ts"(){"use strict";b(),so=[new _(/^Renaming (.+) to (.+)$/,(e,[t,r])=>{e.moves.push({from:t,to:r})})]}}),io={};S(io,{moveTask:()=>rf});function rf(e,t){return{commands:["mv","-v",...J(e),t],format:"utf-8",parser:ef}}var nf=l({"src/lib/tasks/move.ts"(){"use strict";tf(),b()}}),oo={};S(oo,{pullTask:()=>sf});function sf(e,t,r){let n=["pull",...r];return e&&t&&n.splice(1,0,e,t),{commands:n,format:"utf-8",parser(s,i){return Cr(s,i)},onError(s,i,o,a){let c=ll(Re(s.stdOut),Re(s.stdErr));if(c)return a(new ce(c));a(i)}}}var of=l({"src/lib/tasks/pull.ts"(){"use strict";_e(),xi(),b()}});function af(e){let t={};return ao(e,([r])=>t[r]={name:r}),Object.values(t)}function cf(e){let t={};return ao(e,([r,n,s])=>{Object.hasOwn(t,r)||(t[r]={name:r,refs:{fetch:"",push:""}}),s&&n&&(t[r].refs[s.replace(/[^a-z]/g,"")]=n)}),Object.values(t)}function ao(e,t){ur(e,r=>t(r.split(/\s+/)))}var uf=l({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";b()}}),co={};S(co,{addRemoteTask:()=>lf,getRemotesTask:()=>ff,listRemotesTask:()=>pf,remoteTask:()=>df,removeRemoteTask:()=>hf});function lf(e,t,r){return M(["remote","add",...r,e,t])}function ff(e){let t=["remote"];return e&&t.push("-v"),{commands:t,format:"utf-8",parser:e?cf:af}}function pf(e){let t=[...e];return t[0]!=="ls-remote"&&t.unshift("ls-remote"),M(t)}function df(e){let t=[...e];return t[0]!=="remote"&&t.unshift("remote"),M(t)}function hf(e){return M(["remote","remove",e])}var mf=l({"src/lib/tasks/remote.ts"(){"use strict";uf(),C()}}),uo={};S(uo,{stashListTask:()=>gf});function gf(e={},t){let r=_i(e),n=["stash","list",...r.commands,...t],s=mi(r.splitter,r.fields,Tr(n));return yt(n)||{commands:n,format:"utf-8",parser:s}}var yf=l({"src/lib/tasks/stash-list.ts"(){"use strict";Pe(),yi(),Or(),wi()}}),lo={};S(lo,{addSubModuleTask:()=>bf,initSubModuleTask:()=>_f,subModuleTask:()=>_t,updateSubModuleTask:()=>wf});function bf(e,t){return _t(["add",e,t])}function _f(e){return _t(["init",...e])}function _t(e){let t=[...e];return t[0]!=="submodule"&&t.unshift("submodule"),M(t)}function wf(e){return _t(["update",...e])}var Tf=l({"src/lib/tasks/sub-module.ts"(){"use strict";C()}});function vf(e,t){let r=Number.isNaN(e),n=Number.isNaN(t);return r!==n?r?1:-1:r?fo(e,t):0}function fo(e,t){return e===t?0:e>t?1:-1}function Ef(e){return e.trim()}function Qe(e){return typeof e=="string"&&parseInt(e.replace(/^\D+/g,""),10)||0}var os,po,kf=l({"src/lib/responses/TagList.ts"(){"use strict";os=class{constructor(e,t){this.all=e,this.latest=t}},po=function(e,t=!1){let r=e.split(`
`).map(Ef).filter(Boolean);t||r.sort(function(s,i){let o=s.split("."),a=i.split(".");if(o.length===1||a.length===1)return vf(Qe(o[0]),Qe(a[0]));for(let c=0,f=Math.max(o.length,a.length);c<f;c++){let u=fo(Qe(o[c]),Qe(a[c]));if(u)return u}return 0});let n=t?r[0]:[...r].reverse().find(s=>s.indexOf(".")>=0);return new os(r,n)}}}),ho={};S(ho,{addAnnotatedTagTask:()=>Cf,addTagTask:()=>Of,tagListTask:()=>Sf});function Sf(e=[]){let t=e.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...e],parser(r){return po(r,t)}}}function Of(e){return{format:"utf-8",commands:["tag",e],parser(){return{name:e}}}}function Cf(e,t){return{format:"utf-8",commands:["tag","-a","-m",t,e],parser(){return{name:e}}}}var Rf=l({"src/lib/tasks/tag.ts"(){"use strict";kf()}}),xf=dc({"src/git.js"(e,t){"use strict";var{GitExecutor:r}=(xu(),k(ii)),{SimpleGitApi:n}=(Cl(),k($i)),{Scheduler:s}=(Rl(),k(Bi)),{configurationErrorTask:i}=(C(),k(Kt)),{asArray:o,filterArray:a,filterPrimitives:c,filterString:f,filterStringOrStringArray:u,filterType:d,getTrailingOptions:m,trailingFunctionArgument:h,trailingOptionsArgument:G}=(b(),k(Ss)),{applyPatchTask:R}=(Fl(),k(Ui)),{branchTask:D,branchLocalTask:Q,deleteBranchesTask:le,deleteBranchTask:vt}=(ql(),k(Vi)),{checkIgnoreTask:fe}=(zl(),k(Zi)),{checkIsRepoTask:Dr}=(xs(),k(Os)),{cloneTask:ve,cloneMirrorTask:Et}=(Yl(),k(eo)),{cleanWithOptionsTask:Le,isCleanOptionsArray:kt}=(Bs(),k(Ls)),{diffSummaryTask:$o}=(Or(),k(bi)),{fetchTask:Bo}=(Zl(),k(no)),{moveTask:qo}=(nf(),k(io)),{pullTask:Uo}=(of(),k(oo)),{pushTagsTask:Go}=(Mi(),k(Ii)),{addRemoteTask:Xo,getRemotesTask:zo,listRemotesTask:Ho,remoteTask:Wo,removeRemoteTask:Yo}=(mf(),k(co)),{getResetMode:Vo,resetTask:Ko}=(Zs(),k(Ks)),{stashListTask:Jo}=(yf(),k(uo)),{addSubModuleTask:Qo,initSubModuleTask:Zo,subModuleTask:ea,updateSubModuleTask:ta}=(Tf(),k(lo)),{addAnnotatedTagTask:ra,addTagTask:na,tagListTask:sa}=(Rf(),k(ho)),{straightThroughBufferTask:ia,straightThroughStringTask:Y}=(C(),k(Kt));function y(p,g){this._plugins=g,this._executor=new r(p.baseDir,new s(p.maxConcurrentProcesses),g),this._trimmed=p.trimmed}(y.prototype=Object.create(n.prototype)).constructor=y,y.prototype.customBinary=function(p){return this._plugins.reconfigure("binary",p),this},y.prototype.env=function(p,g){return arguments.length===1&&typeof p=="object"?this._executor.env=p:(this._executor.env=this._executor.env||{})[p]=g,this},y.prototype.stashList=function(p){return this._runTask(Jo(G(arguments)||{},a(p)&&p||[]),h(arguments))};function Nr(p,g,v,I){return typeof v!="string"?i(`git.${p}() requires a string 'repoPath'`):g(v,d(I,f),m(arguments))}y.prototype.clone=function(){return this._runTask(Nr("clone",ve,...arguments),h(arguments))},y.prototype.mirror=function(){return this._runTask(Nr("mirror",Et,...arguments),h(arguments))},y.prototype.mv=function(p,g){return this._runTask(qo(p,g),h(arguments))},y.prototype.checkoutLatestTag=function(p){var g=this;return this.pull(function(){g.tags(function(v,I){g.checkout(I.latest,p)})})},y.prototype.pull=function(p,g,v,I){return this._runTask(Uo(d(p,f),d(g,f),m(arguments)),h(arguments))},y.prototype.fetch=function(p,g){return this._runTask(Bo(d(p,f),d(g,f),m(arguments)),h(arguments))},y.prototype.silent=function(p){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},y.prototype.tags=function(p,g){return this._runTask(sa(m(arguments)),h(arguments))},y.prototype.rebase=function(){return this._runTask(Y(["rebase",...m(arguments)]),h(arguments))},y.prototype.reset=function(p){return this._runTask(Ko(Vo(p),m(arguments)),h(arguments))},y.prototype.revert=function(p){let g=h(arguments);return typeof p!="string"?this._runTask(i("Commit must be a string"),g):this._runTask(Y(["revert",...m(arguments,0,!0),p]),g)},y.prototype.addTag=function(p){let g=typeof p=="string"?na(p):i("Git.addTag requires a tag name");return this._runTask(g,h(arguments))},y.prototype.addAnnotatedTag=function(p,g){return this._runTask(ra(p,g),h(arguments))},y.prototype.deleteLocalBranch=function(p,g,v){return this._runTask(vt(p,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.deleteLocalBranches=function(p,g,v){return this._runTask(le(p,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.branch=function(p,g){return this._runTask(D(m(arguments)),h(arguments))},y.prototype.branchLocal=function(p){return this._runTask(Q(),h(arguments))},y.prototype.raw=function(p){let g=!Array.isArray(p),v=[].slice.call(g?arguments:p,0);for(let X=0;X<v.length&&g;X++)if(!c(v[X])){v.splice(X,v.length-X);break}v.push(...m(arguments,0,!0));var I=h(arguments);return v.length?this._runTask(Y(v,this._trimmed),I):this._runTask(i("Raw: must supply one or more command to execute"),I)},y.prototype.submoduleAdd=function(p,g,v){return this._runTask(Qo(p,g),h(arguments))},y.prototype.submoduleUpdate=function(p,g){return this._runTask(ta(m(arguments,!0)),h(arguments))},y.prototype.submoduleInit=function(p,g){return this._runTask(Zo(m(arguments,!0)),h(arguments))},y.prototype.subModule=function(p,g){return this._runTask(ea(m(arguments)),h(arguments))},y.prototype.listRemote=function(){return this._runTask(Ho(m(arguments)),h(arguments))},y.prototype.addRemote=function(p,g,v){return this._runTask(Xo(p,g,m(arguments)),h(arguments))},y.prototype.removeRemote=function(p,g){return this._runTask(Yo(p),h(arguments))},y.prototype.getRemotes=function(p,g){return this._runTask(zo(p===!0),h(arguments))},y.prototype.remote=function(p,g){return this._runTask(Wo(m(arguments)),h(arguments))},y.prototype.tag=function(p,g){let v=m(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(Y(v),h(arguments))},y.prototype.updateServerInfo=function(p){return this._runTask(Y(["update-server-info"]),h(arguments))},y.prototype.pushTags=function(p,g){let v=Go({remote:d(p,f)},m(arguments));return this._runTask(v,h(arguments))},y.prototype.rm=function(p){return this._runTask(Y(["rm","-f",...o(p)]),h(arguments))},y.prototype.rmKeepLocal=function(p){return this._runTask(Y(["rm","--cached",...o(p)]),h(arguments))},y.prototype.catFile=function(p,g){return this._catFile("utf-8",arguments)},y.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},y.prototype._catFile=function(p,g){var v=h(g),I=["cat-file"],X=g[0];if(typeof X=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(X)&&I.push.apply(I,X);let St=p==="buffer"?ia(I):Y(I);return this._runTask(St,v)},y.prototype.diff=function(p,g){let v=f(p)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):Y(["diff",...m(arguments)]);return this._runTask(v,h(arguments))},y.prototype.diffSummary=function(){return this._runTask($o(m(arguments,1)),h(arguments))},y.prototype.applyPatch=function(p){let g=u(p)?R(o(p),m([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(g,h(arguments))},y.prototype.revparse=function(){let p=["rev-parse",...m(arguments,!0)];return this._runTask(Y(p,!0),h(arguments))},y.prototype.clean=function(p,g,v){let I=kt(p),X=I&&p.join("")||d(p,f)||"",St=m([].slice.call(arguments,I?1:0));return this._runTask(Le(X,St),h(arguments))},y.prototype.exec=function(p){let g={commands:[],format:"utf-8",parser(){typeof p=="function"&&p()}};return this._runTask(g)},y.prototype.clearQueue=function(){return this},y.prototype.checkIgnore=function(p,g){return this._runTask(fe(o(d(p,u,[]))),h(arguments))},y.prototype.checkIsRepo=function(p,g){return this._runTask(Dr(d(p,f)),h(arguments))},t.exports=y}}),mo={};S(mo,{esModuleFactory:()=>Ff,gitExportFactory:()=>Af,gitInstanceFactory:()=>go});function Ff(e){return Object.defineProperties(e,{__esModule:{value:!0},default:{value:e}})}function Af(e){return Object.assign(e.bind(null),ei)}function go(e,t){let r=new ri,n=Es(e&&(typeof e=="string"?{baseDir:e}:e)||{},t);if(!lr(n.baseDir))throw new ar(n,"Cannot use simple-git on a directory that does not exist");return Array.isArray(n.config)&&r.add(tu(n.config)),r.add(Zc(n.unsafe)),r.add(vu()),r.add(nu(n.completion)),n.abort&&r.add(Yc(n.abort)),n.progress&&r.add(du(n.progress)),n.timeout&&r.add(_u(n.timeout)),n.spawnOptions&&r.add(yu(n.spawnOptions)),r.add(In(lu(!0))),n.errors&&r.add(In(n.errors)),ou(r,n.binary,n.unsafe?.allowUnsafeCustomBinary),new yo(n,r)}var yo,bo=l({"src/lib/git-factory.ts"(){"use strict";Wc(),Tu(),Eu(),b(),yo=xf()}}),_o={};S(_o,{gitP:()=>If});function If(...e){let t,r=Promise.resolve();try{t=go(...e)}catch(c){r=Promise.reject(c)}function n(){return i}function s(){return r}let i=[...wo,...ir].reduce((c,f)=>{let u=ir.includes(f),d=u?o(f,t):a(f,t,c);return Object.defineProperty(c,f,{enumerable:!1,configurable:!1,value:t?d:u?s:n}),c},{});return i;function o(c,f){return function(...u){if(typeof u[u.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+c);return r.then(function(){return new Promise(function(d,m){let h=(G,R)=>{if(G)return m(Mf(G));d(R)};u.push(h),f[c].apply(f,u)})})}}function a(c,f,u){return(...d)=>(f[c](...d),u)}}function Mf(e){return e instanceof Error?e:typeof e=="string"?new Error(e):new ce(e)}var wo,ir,Pf=l({"src/lib/runners/promise-wrapped.ts"(){"use strict";_e(),bo(),wo=["customBinary","env","outputHandler","silent"],ir=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:Df}=(Pf(),k(_o)),{esModuleFactory:Nf,gitInstanceFactory:jf,gitExportFactory:Lf}=(bo(),k(mo)),as=Nf(Lf(jf));To.exports=Object.assign(as,{gitP:Df,simpleGit:as})});var So=T((id,ko)=>{var Eo=vo(),{execSync:Fr}=require("child_process"),W=require("path"),P=require("fs"),$f=require("os"),Bf=W.join($f.homedir(),".claude-memory","repo"),qf="claude-memory-storage",Ar=class{constructor(t,r=null,n=qf){this.auth=t,this.repoOwner=r,this.repoName=n,this.syncDir=Bf,this._git=null}get git(){return this._git||(this._git=Eo(this.syncDir)),this._git}async ensureRepo(){if(P.existsSync(this.syncDir)&&P.existsSync(W.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),n=JSON.parse(Fr(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=n.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let t=await this.auth.getToken();return Fr(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${t}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let t=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return Fr(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${t}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(t){return console.error("Failed to create repository:",t.message),!1}}async cloneRepo(){let t=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=W.dirname(this.syncDir);P.existsSync(r)||P.mkdirSync(r,{recursive:!0}),await Eo().clone(t,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(t){let r=new Date(t.created_at),n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,s=String(r.getDate()).padStart(2,"0"),i=W.join(this.syncDir,"memories",t.container_tag,n);P.existsSync(i)||P.mkdirSync(i,{recursive:!0});let o=`${s}-${t.id}.json`,a=W.join(i,o),c={id:t.id,content:t.content,containerTag:t.container_tag,metadata:typeof t.metadata=="string"?JSON.parse(t.metadata):t.metadata,createdAt:t.created_at,updatedAt:t.updated_at};return P.writeFileSync(a,JSON.stringify(c,null,2)),a}exportMemories(t){let r=[];for(let n of t){let s=this.exportMemory(n);r.push(s)}return r}exportProfiles(t){let r=W.join(this.syncDir,"profiles");P.existsSync(r)||P.mkdirSync(r,{recursive:!0});let n=W.join(r,"user-preferences.json");return P.writeFileSync(n,JSON.stringify(t,null,2)),n}async syncToGitHub(t,r=null){try{await this.ensureRepo();let n=this.exportMemories(t);if(r){let o=this.exportProfiles(r);n.push(o)}if(n.length===0)return{success:!0,synced:0};for(let o of n){let a=W.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(t.map(o=>o.container_tag))].join(", ")} (${t.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:t.length}}catch(n){return console.error("GitHub sync failed:",n.message),{success:!1,error:n.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(t){return t.message.includes("conflict")?{success:!1,conflict:!0,error:t.message}:{success:!1,conflict:!1,error:t.message}}}importMemories(){let t=W.join(this.syncDir,"memories");if(!P.existsSync(t))return[];let r=[],n=s=>{let i=P.readdirSync(s,{withFileTypes:!0});for(let o of i){let a=W.join(s,o.name);if(o.isDirectory())n(a);else if(o.name.endsWith(".json"))try{let c=JSON.parse(P.readFileSync(a,"utf8"));r.push({id:c.id,content:c.content,container_tag:c.containerTag,metadata:JSON.stringify(c.metadata||{}),created_at:c.createdAt,updated_at:c.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(c){console.error(`Failed to parse ${a}:`,c.message)}}};return n(t),r}importProfiles(){let t=W.join(this.syncDir,"profiles","user-preferences.json");if(!P.existsSync(t))return{static:[],dynamic:[]};try{return JSON.parse(P.readFileSync(t,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};ko.exports={GitHubSync:Ar}});var xo=T((od,Ro)=>{var{execSync:Oo}=require("child_process"),Te=require("fs"),Co=require("path"),Uf=require("os"),De=Co.join(Uf.homedir(),".claude-memory","github-token.json"),Ir=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return Oo("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return Oo("gh auth token",{encoding:"utf8"}).trim()}catch(t){console.error("Failed to get gh token:",t.message)}if(Te.existsSync(De))return JSON.parse(Te.readFileSync(De,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(t){let r=Co.dirname(De);Te.existsSync(r)||Te.mkdirSync(r,{recursive:!0}),Te.writeFileSync(De,JSON.stringify({token:t}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||Te.existsSync(De)}async initiateDeviceFlow(){let t=require("https");return new Promise((r,n)=>{let s=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":s.length,Accept:"application/json"}},o=t.request(i,a=>{let c="";a.on("data",f=>c+=f),a.on("end",()=>r(JSON.parse(c)))});o.on("error",n),o.write(s),o.end()})}async pollForToken(t,r=5){let n=require("https"),s=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:t,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),c={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},f=n.request(c,u=>{let d="";u.on("data",m=>d+=m),u.on("end",()=>{let m=JSON.parse(d);m.access_token?i(m.access_token):m.error==="authorization_pending"?i(null):o(new Error(m.error||"Unknown error"))})});f.on("error",o),f.write(a),f.end()});for(let i=0;i<120;i++){let o=await s();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let t=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${t.verification_uri}`),console.log(`Enter code: ${t.user_code}
`);let r=await this.pollForToken(t.device_code,t.interval);return this.saveToken(r),r}};Ro.exports={GitHubAuth:Ir}});var Ao=T((ad,Fo)=>{var{SqliteManager:Gf}=wn(),{GitHubSync:Xf}=So(),{GitHubAuth:zf}=xo(),Hf=require("crypto"),Mr=class{constructor(t=null){this.db=new Gf(t),this.auth=new zf,this.sync=null}async initSync(){this.sync||(this.sync=new Xf(this.auth))}generateId(t="mem"){return`${t}_${Hf.randomBytes(8).toString("hex")}`}async addMemory(t,r,n={},s=null){let i=s||this.generateId("mem");return this.db.addMemory(i,t,r,n),{id:i,status:"saved",containerTag:r}}async search(t,r=null,n={}){let s=this.db.searchMemories(t,r,n.limit||10);return{results:s.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:s.length}}async getProfile(t,r=null){let n=this.db.getProfile(t),s=null;if(r){let i=this.db.searchMemories(r,t,10);s={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:n.static,dynamic:n.dynamic},searchResults:s}}async listMemories(t,r=20){return{memories:this.db.listMemories(t,r)}}async deleteMemory(t){return this.db.deleteMemory(t),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=this.db.getPendingSync();if(t.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(t);if(r.success){let n=t.map(s=>s.id);this.db.markSynced(n)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=await this.sync.pullFromGitHub();if(!t.success)return t;let r=this.sync.importMemories();for(let n of r)this.db.getMemory(n.id)||this.db.addMemory(n.id,n.content,n.container_tag,JSON.parse(n.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};Fo.exports={StorageClient:Mr}});var Po=T((cd,Mo)=>{var{execSync:Io}=require("node:child_process"),Wf=require("node:crypto");function wt(e){return Wf.createHash("sha256").update(e).digest("hex").slice(0,16)}function Pr(e){try{return Io("git rev-parse --show-toplevel",{cwd:e,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function Yf(e){let r=Pr(e)||e;return`claudecode_project_${wt(r)}`}function Vf(e){return(Pr(e)||e).split("/").pop()||"unknown"}function Kf(){try{let t=Io("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(t)return`claudecode_user_${wt(t)}`}catch{}let e=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${wt(e)}`}Mo.exports={sha256:wt,getGitRoot:Pr,getContainerTag:Yf,getProjectName:Vf,getUserContainerTag:Kf}});var Lo=T((ud,jo)=>{var je=require("node:fs"),Do=require("node:path"),Jf=require("node:os"),Tt=Do.join(Jf.homedir(),".supermemory-claude"),Ne=Do.join(Tt,"settings.json"),No={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function Qf(){je.existsSync(Tt)||je.mkdirSync(Tt,{recursive:!0})}function Zf(){let e={...No};try{if(je.existsSync(Ne)){let t=je.readFileSync(Ne,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${Ne}: ${t.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function ep(e){Qf();let t={...e};delete t.apiKey,je.writeFileSync(Ne,JSON.stringify(t,null,2))}function tp(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function rp(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function np(e,t,r){if(e.debug){let n=new Date().toISOString();console.error(r?`[${n}] ${t}: ${JSON.stringify(r)}`:`[${n}] ${t}`)}}jo.exports={SETTINGS_DIR:Tt,SETTINGS_FILE:Ne,DEFAULT_SETTINGS:No,loadSettings:Zf,saveSettings:ep,getApiKey:tp,shouldCaptureTool:rp,debugLog:np}});var{StorageClient:sp}=Ao(),{getContainerTag:ip,getProjectName:op}=Po(),{loadSettings:ap}=Lo();async function cp(){let e=process.argv.slice(2).join(" ");if(!e||!e.trim()){console.log("No search query provided. Please specify what you want to search for.");return}let t=ap(),r=process.cwd(),n=ip(r),s=op(r);try{let i=new sp,o=await i.getProfile(n,e);if(console.log(`## Memory Search: "${e}"`),console.log(`Project: ${s}
`),o.profile&&(o.profile.static?.length>0&&(console.log("### User Preferences"),o.profile.static.forEach(a=>console.log(`- ${a}`)),console.log("")),o.profile.dynamic?.length>0&&(console.log("### Recent Context"),o.profile.dynamic.forEach(a=>console.log(`- ${a}`)),console.log(""))),o.searchResults?.results?.length>0)console.log("### Relevant Memories"),o.searchResults.results.forEach((a,c)=>{let f=Math.round((a.similarity||.5)*100),u=a.memory||a.content||"";console.log(`
**Memory ${c+1}** (${f}% match)`),a.title&&console.log(`*${a.title}*`),console.log(u.slice(0,500))});else{let a=await i.search(e,n,{limit:10});a.results?.length>0?(console.log("### Relevant Memories"),a.results.forEach((c,f)=>{let u=Math.round((c.similarity||.5)*100),d=c.memory||c.content||"";console.log(`
**Memory ${f+1}** (${u}% match)`),c.title&&console.log(`*${c.title}*`),console.log(d.slice(0,500))})):(console.log("No memories found matching your query."),console.log("Memories are automatically saved as you work in this project."))}i.close()}catch(i){console.log(`Error searching memories: ${i.message}`)}}cp().catch(e=>{console.error(`Fatal error: ${e.message}`),process.exit(1)});
