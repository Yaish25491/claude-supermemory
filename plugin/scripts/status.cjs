#!/usr/bin/env node
var j=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var hr=j((ul,dr)=>{var zi=require("better-sqlite3"),ce=require("node:path"),pr=require("node:fs"),Wi=require("node:os"),Ji=ce.join(Wi.homedir(),".claude-memory"),oe=ce.join(Ji,"memories.db"),ae=class{constructor(e=oe){e||(e=oe);let r=ce.dirname(e);pr.existsSync(r)||pr.mkdirSync(r,{recursive:!0}),this.db=new zi(e),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(e,r,s,n={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(e,r,s,JSON.stringify(n),i,i),{id:e,createdAt:i}}getMemory(e){let s=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(e);return s?.metadata&&(s.metadata=JSON.parse(s.metadata)),s}updateMemory(e,r,s=null){let n=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,n,"pending"];s!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(s))),o.push(e),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(e){this.db.prepare("DELETE FROM memories WHERE id = ?").run(e)}listMemories(e,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(s=>(s.metadata&&(s.metadata=JSON.parse(s.metadata)),s))}markSynced(e){let r=Date.now(),s=e.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${s})
    `).run(r,...e)}searchMemories(e,r=null,s=10){let n=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[e];return r&&(n+=" AND m.container_tag = ?",i.push(r)),n+=" ORDER BY rank LIMIT ?",i.push(s),this.db.prepare(n).all(...i).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}getContextMemories(e,r,s=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,Math.floor(s/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,e,Math.floor(s/2)),u=new Set(i.map(f=>f.id)),g=[...i];for(let f of a)u.has(f.id)||(g.push(f),u.add(f.id));return g.slice(0,s).map(f=>(f.metadata&&(f.metadata=JSON.parse(f.metadata)),f))}addProfileFact(e,r,s,n="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(e,r,s,n,i)}getProfile(e,r=5){let n=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r);return{static:n.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(e){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(e)}close(){this.db.close()}};dr.exports={SqliteManager:ae,DEFAULT_DB_PATH:oe}});var gr=j((ll,mr)=>{var ot=1e3,at=ot*60,ct=at*60,Q=ct*24,Yi=Q*7,Ki=Q*365.25;mr.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return Vi(t);if(r==="number"&&isFinite(t))return e.long?Zi(t):Qi(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function Vi(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*Ki;case"weeks":case"week":case"w":return r*Yi;case"days":case"day":case"d":return r*Q;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ct;case"minutes":case"minute":case"mins":case"min":case"m":return r*at;case"seconds":case"second":case"secs":case"sec":case"s":return r*ot;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Qi(t){var e=Math.abs(t);return e>=Q?Math.round(t/Q)+"d":e>=ct?Math.round(t/ct)+"h":e>=at?Math.round(t/at)+"m":e>=ot?Math.round(t/ot)+"s":t+"ms"}function Zi(t){var e=Math.abs(t);return e>=Q?Ft(t,e,Q,"day"):e>=ct?Ft(t,e,ct,"hour"):e>=at?Ft(t,e,at,"minute"):e>=ot?Ft(t,e,ot,"second"):t+" ms"}function Ft(t,e,r,s){var n=e>=r*1.5;return Math.round(t/r)+" "+s+(n?"s":"")}});var ue=j((fl,_r)=>{function to(t){r.debug=r,r.default=r,r.coerce=u,r.disable=o,r.enable=n,r.enabled=a,r.humanize=gr(),r.destroy=g,Object.keys(t).forEach(f=>{r[f]=t[f]}),r.names=[],r.skips=[],r.formatters={};function e(f){let p=0;for(let d=0;d<f.length;d++)p=(p<<5)-p+f.charCodeAt(d),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=e;function r(f){let p,d=null,h,U;function O(...M){if(!O.enabled)return;let Y=O,nt=Number(new Date),re=nt-(p||nt);Y.diff=re,Y.prev=p,Y.curr=nt,p=nt,M[0]=r.coerce(M[0]),typeof M[0]!="string"&&M.unshift("%O");let it=0;M[0]=M[0].replace(/%([a-zA-Z%])/g,(mt,se)=>{if(mt==="%%")return"%";it++;let Rt=r.formatters[se];if(typeof Rt=="function"){let ne=M[it];mt=Rt.call(Y,ne),M.splice(it,1),it--}return mt}),r.formatArgs.call(Y,M),(Y.log||r.log).apply(Y,M)}return O.namespace=f,O.useColors=r.useColors(),O.color=r.selectColor(f),O.extend=s,O.destroy=r.destroy,Object.defineProperty(O,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==r.namespaces&&(h=r.namespaces,U=r.enabled(f)),U),set:M=>{d=M}}),typeof r.init=="function"&&r.init(O),O}function s(f,p){let d=r(this.namespace+(typeof p>"u"?":":p)+f);return d.log=this.log,d}function n(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let p=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let d of p)d[0]==="-"?r.skips.push(d.slice(1)):r.names.push(d)}function i(f,p){let d=0,h=0,U=-1,O=0;for(;d<f.length;)if(h<p.length&&(p[h]===f[d]||p[h]==="*"))p[h]==="*"?(U=h,O=d,h++):(d++,h++);else if(U!==-1)h=U+1,O++,d=O;else return!1;for(;h<p.length&&p[h]==="*";)h++;return h===p.length}function o(){let f=[...r.names,...r.skips.map(p=>"-"+p)].join(",");return r.enable(""),f}function a(f){for(let p of r.skips)if(i(f,p))return!1;for(let p of r.names)if(i(f,p))return!0;return!1}function u(f){return f instanceof Error?f.stack||f.message:f}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}_r.exports=to});var yr=j((I,xt)=>{I.formatArgs=ro;I.save=so;I.load=no;I.useColors=eo;I.storage=io();I.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();I.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function eo(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ro(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+xt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(s=r))}),t.splice(s,0,e)}I.log=console.debug||console.log||(()=>{});function so(t){try{t?I.storage.setItem("debug",t):I.storage.removeItem("debug")}catch{}}function no(){let t;try{t=I.storage.getItem("debug")||I.storage.getItem("DEBUG")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function io(){try{return localStorage}catch{}}xt.exports=ue()(I);var{formatters:oo}=xt.exports;oo.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Tr=j((R,Nt)=>{var ao=require("tty"),At=require("util");R.init=mo;R.log=fo;R.formatArgs=uo;R.save=po;R.load=ho;R.useColors=co;R.destroy=At.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");R.colors=[6,2,3,4,5,1];try{let t=require("supports-color");t&&(t.stderr||t).level>=2&&(R.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}R.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),t[r]=s,t},{});function co(){return"colors"in R.inspectOpts?!!R.inspectOpts.colors:ao.isatty(process.stderr.fd)}function uo(t){let{namespace:e,useColors:r}=this;if(r){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${e} \x1B[0m`;t[0]=i+t[0].split(`
`).join(`
`+i),t.push(n+"m+"+Nt.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=lo()+e+" "+t[0]}function lo(){return R.inspectOpts.hideDate?"":new Date().toISOString()+" "}function fo(...t){return process.stderr.write(At.formatWithOptions(R.inspectOpts,...t)+`
`)}function po(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function ho(){return process.env.DEBUG}function mo(t){t.inspectOpts={};let e=Object.keys(R.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=R.inspectOpts[e[r]]}Nt.exports=ue()(R);var{formatters:br}=Nt.exports;br.o=function(t){return this.inspectOpts.colors=this.useColors,At.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};br.O=function(t){return this.inspectOpts.colors=this.useColors,At.inspect(t,this.inspectOpts)}});var fe=j((pl,le)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?le.exports=yr():le.exports=Tr()});var vr=j(B=>{"use strict";var go=B&&B.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(B,"__esModule",{value:!0});var _o=require("fs"),yo=go(fe()),ut=yo.default("@kwsites/file-exists");function bo(t,e,r){ut("checking %s",t);try{let s=_o.statSync(t);return s.isFile()&&e?(ut("[OK] path represents a file"),!0):s.isDirectory()&&r?(ut("[OK] path represents a directory"),!0):(ut("[FAIL] path represents something other than a file or directory"),!1)}catch(s){if(s.code==="ENOENT")return ut("[FAIL] path is not accessible: %o",s),!1;throw ut("[FATAL] %o",s),s}}function To(t,e=B.READABLE){return bo(t,(e&B.FILE)>0,(e&B.FOLDER)>0)}B.exists=To;B.FILE=1;B.FOLDER=2;B.READABLE=B.FILE+B.FOLDER});var kr=j(Mt=>{"use strict";function vo(t){for(var e in t)Mt.hasOwnProperty(e)||(Mt[e]=t[e])}Object.defineProperty(Mt,"__esModule",{value:!0});vo(vr())});var de=j(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.createDeferred=Z.deferred=void 0;function pe(){let t,e,r="pending";return{promise:new Promise((n,i)=>{t=n,e=i}),done(n){r==="pending"&&(r="resolved",t(n))},fail(n){r==="pending"&&(r="rejected",e(n))},get fulfilled(){return r!=="pending"},get status(){return r}}}Z.deferred=pe;Z.createDeferred=pe;Z.default=pe});var gi=j((gl,mi)=>{"use strict";var ko=Object.create,Ht=Object.defineProperty,wo=Object.getOwnPropertyDescriptor,De=Object.getOwnPropertyNames,Eo=Object.getPrototypeOf,So=Object.prototype.hasOwnProperty,c=(t,e)=>function(){return t&&(e=(0,t[De(t)[0]])(t=0)),e},Co=(t,e)=>function(){return e||(0,t[De(t)[0]])((e={exports:{}}).exports,e),e.exports},E=(t,e)=>{for(var r in e)Ht(t,r,{get:e[r],enumerable:!0})},rs=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of De(e))!So.call(t,n)&&n!==r&&Ht(t,n,{get:()=>e[n],enumerable:!(s=wo(e,n))||s.enumerable});return t},Oo=(t,e,r)=>(r=t!=null?ko(Eo(t)):{},rs(e||!t||!t.__esModule?Ht(r,"default",{value:t,enumerable:!0}):r,t)),w=t=>rs(Ht({},"__esModule",{value:!0}),t),W,V=c({"src/lib/errors/git-error.ts"(){"use strict";W=class extends Error{constructor(t,e){super(e),this.task=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),rt,pt=c({"src/lib/errors/git-response-error.ts"(){"use strict";V(),rt=class extends W{constructor(t,e){super(void 0,e||String(t)),this.git=t}}}});function ss(...t){let e=new String(t);return zt.set(e,t),e}function Bt(t){return t instanceof String&&zt.has(t)}function wr(t){return zt.get(t)||[]}var zt,vt=c({"src/lib/args/pathspec.ts"(){"use strict";zt=new WeakMap}}),Le,Ro=c({"src/lib/errors/git-construct-error.ts"(){"use strict";V(),Le=class extends W{constructor(t,e){super(void 0,e),this.config=t}}}}),X,kt=c({"src/lib/errors/git-plugin-error.ts"(){"use strict";V(),X=class extends W{constructor(t,e,r){super(t,r),this.task=t,this.plugin=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),Pe,ns=c({"src/lib/errors/task-configuration-error.ts"(){"use strict";V(),Pe=class extends W{constructor(t){super(void 0,t)}}}});function is(t){return typeof t!="function"?st:t}function os(t){return typeof t=="function"&&t!==st}function as(t,e){let r=t.indexOf(e);return r<=0?[t,""]:[t.substr(0,r),t.substr(r+1)]}function cs(t,e=0){return us(t)&&t.length>e?t[e]:void 0}function et(t,e=0){if(us(t)&&t.length>e)return t[t.length-1-e]}function us(t){return Kt(t)}function wt(t="",e=!0,r=`
`){return t.split(r).reduce((s,n)=>{let i=e?n.trim():n;return i&&s.push(i),s},[])}function je(t,e){return wt(t,!0).map(r=>e(r))}function Be(t){return(0,ve.exists)(t,ve.FOLDER)}function T(t,e){return Array.isArray(t)?t.includes(e)||t.push(e):t.add(e),e}function ls(t,e){return Array.isArray(t)&&!t.includes(e)&&t.push(e),t}function Wt(t,e){if(Array.isArray(t)){let r=t.indexOf(e);r>=0&&t.splice(r,1)}else t.delete(e);return e}function J(t){return Array.isArray(t)?t:[t]}function fs(t){return t.replace(/[\s-]+(.)/g,(e,r)=>r.toUpperCase())}function dt(t){return J(t).map(e=>e instanceof String?e:String(e))}function k(t,e=0){if(t==null)return e;let r=parseInt(t,10);return Number.isNaN(r)?e:r}function bt(t,e){let r=[];for(let s=0,n=t.length;s<n;s++)r.push(e,t[s]);return r}function Tt(t){return(Array.isArray(t)?ds.Buffer.concat(t):t).toString("utf-8")}function ps(t,e){let r={};return e.forEach(s=>{t[s]!==void 0&&(r[s]=t[s])}),r}function be(t=0){return new Promise(e=>setTimeout(e,t))}function Te(t){if(t!==!1)return t}var ds,ve,ft,st,Et,Jt=c({"src/lib/utils/util.ts"(){"use strict";ds=require("node:buffer"),ve=kr(),$e(),ft="\0",st=()=>{},Et=Object.prototype.toString.call.bind(Object.prototype.toString)}});function G(t,e,r){return e(t)?t:arguments.length>2?r:void 0}function ke(t,e){let r=Bt(t)?"string":typeof t;return/number|string|boolean/.test(r)&&(!e||!e.includes(r))}function Yt(t){return!!t&&Et(t)==="[object Object]"}function hs(t){return typeof t=="function"}var St,ms,F,$t,Kt,$e=c({"src/lib/utils/argument-filters.ts"(){"use strict";vt(),Jt(),St=t=>Array.isArray(t),ms=t=>typeof t=="number",F=t=>typeof t=="string",$t=t=>F(t)||Array.isArray(t)&&t.every(F),Kt=t=>t==null||"number|boolean|function".includes(typeof t)?!1:typeof t.length=="number"}}),we,Fo=c({"src/lib/utils/exit-codes.ts"(){"use strict";we=(t=>(t[t.SUCCESS=0]="SUCCESS",t[t.ERROR=1]="ERROR",t[t.NOT_FOUND=-2]="NOT_FOUND",t[t.UNCLEAN=128]="UNCLEAN",t))(we||{})}}),Gt,xo=c({"src/lib/utils/git-output-streams.ts"(){"use strict";Gt=class gs{constructor(e,r){this.stdOut=e,this.stdErr=r}asStrings(){return new gs(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function Ao(){throw new Error("LineParser:useMatches not implemented")}var b,K,No=c({"src/lib/utils/line-parser.ts"(){"use strict";b=class{constructor(t,e){this.matches=[],this.useMatches=Ao,this.parse=(r,s)=>(this.resetMatches(),this._regExp.every((n,i)=>this.addMatch(n,i,r(i)))?this.useMatches(s,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(t)?t:[t],e&&(this.useMatches=e)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(t,e,r){let s=r&&t.exec(r);return s&&this.pushMatch(e,s),!!s}pushMatch(t,e){this.matches.push(...e.slice(1))}},K=class extends b{addMatch(t,e,r){return/^remote:\s/.test(String(r))&&super.addMatch(t,e,r)}pushMatch(t,e){(t>0||e.length>1)&&super.pushMatch(t,e)}}}});function _s(...t){let e=process.cwd(),r=Object.assign({baseDir:e,...ys},...t.filter(s=>typeof s=="object"&&s));return r.baseDir=r.baseDir||e,r.trimmed=r.trimmed===!0,r}var ys,Mo=c({"src/lib/utils/simple-git-options.ts"(){"use strict";ys={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function Ge(t,e=[]){return Yt(t)?Object.keys(t).reduce((r,s)=>{let n=t[s];if(Bt(n))r.push(n);else if(ke(n,["boolean"]))r.push(s+"="+n);else if(Array.isArray(n))for(let i of n)ke(i,["string","number"])||r.push(s+"="+i);else r.push(s);return r},e):e}function D(t,e=0,r=!1){let s=[];for(let n=0,i=e<0?t.length:e;n<i;n++)"string|number".includes(typeof t[n])&&s.push(String(t[n]));return Ge(Ue(t),s),r||s.push(...Io(t)),s}function Io(t){let e=typeof et(t)=="function";return dt(G(et(t,e?1:0),St,[]))}function Ue(t){let e=hs(et(t));return G(et(t,e?1:0),Yt)}function S(t,e=!0){let r=is(et(t));return e||os(r)?r:void 0}var Do=c({"src/lib/utils/task-options.ts"(){"use strict";$e(),Jt(),vt()}});function Ee(t,e){return t(e.stdOut,e.stdErr)}function P(t,e,r,s=!0){return J(r).forEach(n=>{for(let i=wt(n,s),o=0,a=i.length;o<a;o++){let u=(g=0)=>{if(!(o+g>=a))return i[o+g]};e.some(({parse:g})=>g(u,t))}}),t}var Lo=c({"src/lib/utils/task-parser.ts"(){"use strict";Jt()}}),bs={};E(bs,{ExitCodes:()=>we,GitOutputStreams:()=>Gt,LineParser:()=>b,NOOP:()=>st,NULL:()=>ft,RemoteLineParser:()=>K,append:()=>T,appendTaskOptions:()=>Ge,asArray:()=>J,asCamelCase:()=>fs,asFunction:()=>is,asNumber:()=>k,asStringArray:()=>dt,bufferToString:()=>Tt,callTaskParser:()=>Ee,createInstanceConfig:()=>_s,delay:()=>be,filterArray:()=>St,filterFunction:()=>hs,filterHasLength:()=>Kt,filterNumber:()=>ms,filterPlainObject:()=>Yt,filterPrimitives:()=>ke,filterString:()=>F,filterStringOrStringArray:()=>$t,filterType:()=>G,first:()=>cs,folderExists:()=>Be,forEachLineWithContent:()=>je,getTrailingOptions:()=>D,including:()=>ls,isUserFunction:()=>os,last:()=>et,objectToString:()=>Et,orVoid:()=>Te,parseStringResponse:()=>P,pick:()=>ps,prefixedArray:()=>bt,remove:()=>Wt,splitOn:()=>as,toLinesWithContent:()=>wt,trailingFunctionArgument:()=>S,trailingOptionsArgument:()=>Ue});var y=c({"src/lib/utils/index.ts"(){"use strict";$e(),Fo(),xo(),No(),Mo(),Do(),Lo(),Jt()}}),Ts={};E(Ts,{CheckRepoActions:()=>Ut,checkIsBareRepoTask:()=>ks,checkIsRepoRootTask:()=>vs,checkIsRepoTask:()=>Po});function Po(t){switch(t){case"bare":return ks();case"root":return vs()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:Vt,parser:qe}}function vs(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:Vt,parser(e){return/^\.(git)?$/.test(e.trim())}}}function ks(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:Vt,parser:qe}}function jo(t){return/(Not a git repository|Kein Git-Repository)/i.test(String(t))}var Ut,Vt,qe,ws=c({"src/lib/tasks/check-is-repo.ts"(){"use strict";y(),Ut=(t=>(t.BARE="bare",t.IN_TREE="tree",t.IS_REPO_ROOT="root",t))(Ut||{}),Vt=({exitCode:t},e,r,s)=>{if(t===128&&jo(e))return r(Buffer.from("false"));s(e)},qe=t=>t.trim()==="true"}});function Bo(t,e){let r=new Es(t),s=t?Cs:Ss;return wt(e).forEach(n=>{let i=n.replace(s,"");r.paths.push(i),(Os.test(i)?r.folders:r.files).push(i)}),r}var Es,Ss,Cs,Os,$o=c({"src/lib/responses/CleanSummary.ts"(){"use strict";y(),Es=class{constructor(t){this.dryRun=t,this.paths=[],this.files=[],this.folders=[]}},Ss=/^[a-z]+\s*/i,Cs=/^[a-z]+\s+[a-z]+\s*/i,Os=/\/$/}}),Se={};E(Se,{EMPTY_COMMANDS:()=>Qt,adhocExecTask:()=>Rs,configurationErrorTask:()=>L,isBufferTask:()=>xs,isEmptyTask:()=>As,straightThroughBufferTask:()=>Fs,straightThroughStringTask:()=>A});function Rs(t){return{commands:Qt,format:"empty",parser:t}}function L(t){return{commands:Qt,format:"empty",parser(){throw typeof t=="string"?new Pe(t):t}}}function A(t,e=!1){return{commands:t,format:"utf-8",parser(r){return e?String(r).trim():r}}}function Fs(t){return{commands:t,format:"buffer",parser(e){return e}}}function xs(t){return t.format==="buffer"}function As(t){return t.format==="empty"||!t.commands.length}var Qt,C=c({"src/lib/tasks/task.ts"(){"use strict";ns(),Qt=[]}}),Ns={};E(Ns,{CONFIG_ERROR_INTERACTIVE_MODE:()=>Xe,CONFIG_ERROR_MODE_REQUIRED:()=>He,CONFIG_ERROR_UNKNOWN_OPTION:()=>ze,CleanOptions:()=>_t,cleanTask:()=>Ms,cleanWithOptionsTask:()=>Go,isCleanOptionsArray:()=>Uo});function Go(t,e){let{cleanMode:r,options:s,valid:n}=qo(t);return r?n.options?(s.push(...e),s.some(zo)?L(Xe):Ms(r,s)):L(ze+JSON.stringify(t)):L(He)}function Ms(t,e){return{commands:["clean",`-${t}`,...e],format:"utf-8",parser(s){return Bo(t==="n",s)}}}function Uo(t){return Array.isArray(t)&&t.every(e=>We.has(e))}function qo(t){let e,r=[],s={cleanMode:!1,options:!0};return t.replace(/[^a-z]i/g,"").split("").forEach(n=>{Xo(n)?(e=n,s.cleanMode=!0):s.options=s.options&&Ho(r[r.length]=`-${n}`)}),{cleanMode:e,options:r,valid:s}}function Xo(t){return t==="f"||t==="n"}function Ho(t){return/^-[a-z]$/i.test(t)&&We.has(t.charAt(1))}function zo(t){return/^-[^\-]/.test(t)?t.indexOf("i")>0:t==="--interactive"}var Xe,He,ze,_t,We,Is=c({"src/lib/tasks/clean.ts"(){"use strict";$o(),y(),C(),Xe="Git clean interactive mode is not supported",He='Git clean mode parameter ("n" or "f") is required',ze="Git clean unknown option found in: ",_t=(t=>(t.DRY_RUN="n",t.FORCE="f",t.IGNORED_INCLUDED="x",t.IGNORED_ONLY="X",t.EXCLUDING="e",t.QUIET="q",t.RECURSIVE="d",t))(_t||{}),We=new Set(["i",...dt(Object.values(_t))])}});function Wo(t){let e=new Ls;for(let r of Ds(t))e.addValue(r.file,String(r.key),r.value);return e}function Jo(t,e){let r=null,s=[],n=new Map;for(let i of Ds(t,e))i.key===e&&(s.push(r=i.value),n.has(i.file)||n.set(i.file,[]),n.get(i.file).push(r));return{key:e,paths:Array.from(n.keys()),scopes:n,value:r,values:s}}function Yo(t){return t.replace(/^(file):/,"")}function*Ds(t,e=null){let r=t.split("\0");for(let s=0,n=r.length-1;s<n;){let i=Yo(r[s++]),o=r[s++],a=e;if(o.includes(`
`)){let u=as(o,`
`);a=u[0],o=u[1]}yield{file:i,key:a,value:o}}}var Ls,Ko=c({"src/lib/responses/ConfigList.ts"(){"use strict";y(),Ls=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((t,e)=>Object.assign(t,this.values[e]),{})),this._all}addFile(t){if(!(t in this.values)){let e=et(this.files);this.values[t]=e?Object.create(this.values[e]):{},this.files.push(t)}return this.values[t]}addValue(t,e,r){let s=this.addFile(t);Object.hasOwn(s,e)?Array.isArray(s[e])?s[e].push(r):s[e]=[s[e],r]:s[e]=r,this._all=void 0}}}});function he(t,e){return typeof t=="string"&&Object.hasOwn(qt,t)?t:e}function Vo(t,e,r,s){let n=["config",`--${s}`];return r&&n.push("--add"),n.push(t,e),{commands:n,format:"utf-8",parser(i){return i}}}function Qo(t,e){let r=["config","--null","--show-origin","--get-all",t];return e&&r.splice(1,0,`--${e}`),{commands:r,format:"utf-8",parser(s){return Jo(s,t)}}}function Zo(t){let e=["config","--list","--show-origin","--null"];return t&&e.push(`--${t}`),{commands:e,format:"utf-8",parser(r){return Wo(r)}}}function ta(){return{addConfig(t,e,...r){return this._runTask(Vo(t,e,r[0]===!0,he(r[1],"local")),S(arguments))},getConfig(t,e){return this._runTask(Qo(t,he(e,void 0)),S(arguments))},listConfig(...t){return this._runTask(Zo(he(t[0],void 0)),S(arguments))}}}var qt,Ps=c({"src/lib/tasks/config.ts"(){"use strict";Ko(),y(),qt=(t=>(t.system="system",t.global="global",t.local="local",t.worktree="worktree",t))(qt||{})}});function ea(t){return js.has(t)}var Dt,js,Bs=c({"src/lib/tasks/diff-name-status.ts"(){"use strict";Dt=(t=>(t.ADDED="A",t.COPIED="C",t.DELETED="D",t.MODIFIED="M",t.RENAMED="R",t.CHANGED="T",t.UNMERGED="U",t.UNKNOWN="X",t.BROKEN="B",t))(Dt||{}),js=new Set(Object.values(Dt))}});function $s(...t){return new Us().param(...t)}function ra(t){let e=new Set,r={};return je(t,s=>{let[n,i,o]=s.split(ft);e.add(n),(r[n]=r[n]||[]).push({line:k(i),path:n,preview:o})}),{paths:e,results:r}}function sa(){return{grep(t){let e=S(arguments),r=D(arguments);for(let n of Gs)if(r.includes(n))return this._runTask(L(`git.grep: use of "${n}" is not supported.`),e);typeof t=="string"&&(t=$s().param(t));let s=["grep","--null","-n","--full-name",...r,...t];return this._runTask({commands:s,format:"utf-8",parser(n){return ra(n)}},e)}}}var Gs,gt,Er,Us,qs=c({"src/lib/tasks/grep.ts"(){"use strict";y(),C(),Gs=["-h"],gt=Symbol("grepQuery"),Us=class{constructor(){this[Er]=[]}*[(Er=gt,Symbol.iterator)](){for(let t of this[gt])yield t}and(...t){return t.length&&this[gt].push("--and","(",...bt(t,"-e"),")"),this}param(...t){return this[gt].push(...bt(t,"-e")),this}}}}),Xs={};E(Xs,{ResetMode:()=>yt,getResetMode:()=>ia,resetTask:()=>na});function na(t,e){let r=["reset"];return Hs(t)&&r.push(`--${t}`),r.push(...e),A(r)}function ia(t){if(Hs(t))return t;switch(typeof t){case"string":case"undefined":return"soft"}}function Hs(t){return typeof t=="string"&&zs.includes(t)}var yt,zs,Ws=c({"src/lib/tasks/reset.ts"(){"use strict";y(),C(),yt=(t=>(t.MIXED="mixed",t.SOFT="soft",t.HARD="hard",t.MERGE="merge",t.KEEP="keep",t))(yt||{}),zs=dt(Object.values(yt))}}),Js={};E(Js,{CheckRepoActions:()=>Ut,CleanOptions:()=>_t,DiffNameStatus:()=>Dt,GitConfigScope:()=>qt,GitConstructError:()=>Le,GitError:()=>W,GitPluginError:()=>X,GitResponseError:()=>rt,ResetMode:()=>yt,TaskConfigurationError:()=>Pe,grepQueryBuilder:()=>$s,pathspec:()=>ss});var oa=c({"src/lib/api.ts"(){"use strict";vt(),Ro(),V(),kt(),pt(),ns(),ws(),Is(),Ps(),Bs(),qs(),Ws()}});function aa(t){return t?[{type:"spawn.before",action(s,n){t.aborted&&n.kill(new X(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(s,n){function i(){n.kill(new X(void 0,"abort","Abort signal received"))}t.addEventListener("abort",i),n.spawned.on("close",()=>t.removeEventListener("abort",i))}}]:void 0}var ca=c({"src/lib/plugins/abort-plugin.ts"(){"use strict";kt()}});function ua(t){return typeof t=="string"&&t.trim().toLowerCase()==="-c"}function la(t,e){if(ua(t)&&/^\s*protocol(.[a-z]+)?.allow/.test(e))throw new X(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function fa(t,e){if(/^\s*--(upload|receive)-pack/.test(t))throw new X(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(e==="clone"&&/^\s*-u\b/.test(t))throw new X(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(e==="push"&&/^\s*--exec\b/.test(t))throw new X(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function pa({allowUnsafeProtocolOverride:t=!1,allowUnsafePack:e=!1}={}){return{type:"spawn.args",action(r,s){return r.forEach((n,i)=>{let o=i<r.length?r[i+1]:"";t||la(n,o),e||fa(n,s.method)}),r}}}var da=c({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";kt()}});function ha(t){let e=bt(t,"-c");return{type:"spawn.args",action(r){return[...e,...r]}}}var ma=c({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";y()}});function ga({onClose:t=!0,onExit:e=50}={}){function r(){let n=-1,i={close:(0,lt.deferred)(),closeTimeout:(0,lt.deferred)(),exit:(0,lt.deferred)(),exitTimeout:(0,lt.deferred)()},o=Promise.race([t===!1?Ce:i.closeTimeout.promise,e===!1?Ce:i.exitTimeout.promise]);return s(t,i.close,i.closeTimeout),s(e,i.exit,i.exitTimeout),{close(a){n=a,i.close.done()},exit(a){n=a,i.exit.done()},get exitCode(){return n},result:o}}function s(n,i,o){n!==!1&&(n===!0?i.promise:i.promise.then(()=>be(n))).then(o.done)}return{type:"spawn.after",async action(n,{spawned:i,close:o}){let a=r(),u=!0,g=()=>void(u=!1);i.stdout?.on("data",g),i.stderr?.on("data",g),i.on("error",g),i.on("close",f=>a.close(f)),i.on("exit",f=>a.exit(f));try{await a.result,u&&await be(50),o(a.exitCode)}catch(f){o(a.exitCode,f)}}}}var lt,Ce,_a=c({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";lt=de(),y(),Ce=(0,lt.deferred)().promise}});function ya(t){return!t||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(t)}function Sr(t,e){if(t.length<1||t.length>2)throw new X(void 0,"binary",Ys);if(t.some(ya))if(e)console.warn(Oe);else throw new X(void 0,"binary",Oe);let[s,n]=t;return{binary:s,prefix:n}}function ba(t,e=["git"],r=!1){let s=Sr(J(e),r);t.on("binary",n=>{s=Sr(J(n),r)}),t.append("spawn.binary",()=>s.binary),t.append("spawn.args",n=>s.prefix?[s.prefix,...n]:n)}var Ys,Oe,Ta=c({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";kt(),y(),Ys="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",Oe="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function va(t){return!!(t.exitCode&&t.stdErr.length)}function ka(t){return Buffer.concat([...t.stdOut,...t.stdErr])}function wa(t=!1,e=va,r=ka){return(s,n)=>!t&&s||!e(n)?s:r(n)}function Cr(t){return{type:"task.error",action(e,r){let s=t(e.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(s)?{error:new W(void 0,s.toString("utf-8"))}:{error:s}}}}var Ea=c({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";V()}}),Or,Ks,Sa=c({"src/lib/plugins/plugin-store.ts"(){"use strict";Or=require("node:events"),y(),Ks=class{constructor(){this.plugins=new Set,this.events=new Or.EventEmitter}on(t,e){this.events.on(t,e)}reconfigure(t,e){this.events.emit(t,e)}append(t,e){let r=T(this.plugins,{type:t,action:e});return()=>this.plugins.delete(r)}add(t){let e=[];return J(t).forEach(r=>r&&this.plugins.add(T(e,r))),()=>{e.forEach(r=>this.plugins.delete(r))}}exec(t,e,r){let s=e,n=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===t&&(s=i.action(s,n));return s}}}});function Ca(t){let e="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?ls(i,e):i}},{type:"spawn.after",action(i,o){o.commands.includes(e)&&o.spawned.stderr?.on("data",a=>{let u=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));u&&t({method:o.method,stage:Oa(u[1]),progress:k(u[2]),processed:k(u[3]),total:k(u[4])})})}}]}function Oa(t){return String(t.toLowerCase().split(" ",1))||"unknown"}var Ra=c({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";y()}}),Fa=c({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function xa(t){let e=ps(t,["uid","gid"]);return{type:"spawn.options",action(r){return{...e,...r}}}}var Aa=c({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";y()}});function Na({block:t,stdErr:e=!0,stdOut:r=!0}){if(t>0)return{type:"spawn.after",action(s,n){let i;function o(){i&&clearTimeout(i),i=setTimeout(u,t)}function a(){n.spawned.stdout?.off("data",o),n.spawned.stderr?.off("data",o),n.spawned.off("exit",a),n.spawned.off("close",a),i&&clearTimeout(i)}function u(){a(),n.kill(new X(void 0,"timeout","block timeout reached"))}r&&n.spawned.stdout?.on("data",o),e&&n.spawned.stderr?.on("data",o),n.spawned.on("exit",a),n.spawned.on("close",a),o()}}}var Ma=c({"src/lib/plugins/timout-plugin.ts"(){"use strict";kt()}}),Ia=c({"src/lib/plugins/index.ts"(){"use strict";ca(),da(),ma(),_a(),Ta(),Ea(),Sa(),Ra(),Fa(),Aa(),Ma()}});function Da(){return{type:"spawn.args",action(t){let e=[],r;function s(n){(r=r||[]).push(...n)}for(let n=0;n<t.length;n++){let i=t[n];if(Bt(i)){s(wr(i));continue}if(i==="--"){s(t.slice(n+1).flatMap(o=>Bt(o)&&wr(o)||o));break}e.push(i)}return r?[...e,"--",...r.map(String)]:e}}}var La=c({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";vt()}});function Pa(){return(0,Lt.default)("simple-git")}function Rr(t,e,r){return!e||!String(e).replace(/\s*/,"")?r?(s,...n)=>{t(s,...n),r(s,...n)}:t:(s,...n)=>{t(`%s ${s}`,e,...n),r&&r(s,...n)}}function ja(t,e,{namespace:r}){if(typeof t=="string")return t;let s=e&&e.namespace||"";return s.startsWith(r)?s.substr(r.length+1):s||r}function Je(t,e,r,s=Pa()){let n=t&&`[${t}]`||"",i=[],o=typeof e=="string"?s.extend(e):e,a=ja(G(e,F),o,s);return g(r);function u(f,p){return T(i,Je(t,a.replace(/^[^:]+/,f),p,s))}function g(f){let p=f&&`[${f}]`||"",d=o&&Rr(o,p)||st,h=Rr(s,`${n} ${p}`,d);return Object.assign(o?d:h,{label:t,sibling:u,info:h,step:g})}}var Lt,Vs=c({"src/lib/git-logger.ts"(){"use strict";Lt=Oo(fe()),y(),Lt.default.formatters.L=t=>String(Kt(t)?t.length:"-"),Lt.default.formatters.B=t=>Buffer.isBuffer(t)?t.toString("utf8"):Et(t)}}),Qs,Ba=c({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";V(),Vs(),Qs=class Re{constructor(e="GitExecutor"){this.logLabel=e,this._queue=new Map}withProgress(e){return this._queue.get(e)}createProgress(e){let r=Re.getName(e.commands[0]),s=Je(this.logLabel,r);return{task:e,logger:s,name:r}}push(e){let r=this.createProgress(e);return r.logger("Adding task to the queue, commands = %o",e.commands),this._queue.set(e,r),r}fatal(e){for(let[r,{logger:s}]of Array.from(this._queue.entries()))r===e.task?(s.info("Failed %o",e),s("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):s.info("A fatal exception occurred in a previous task, the queue has been purged: %o",e.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(e){this.withProgress(e)&&this._queue.delete(e)}attempt(e){let r=this.withProgress(e);if(!r)throw new W(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(e="empty"){return`task:${e}:${++Re.counter}`}static{this.counter=0}}}});function tt(t,e){return{method:cs(t.commands)||"",commands:e}}function $a(t,e){return r=>{e("[ERROR] child process exception %o",r),t.push(Buffer.from(String(r.stack),"ascii"))}}function Fr(t,e,r,s){return n=>{r("%s received %L bytes",e,n),s("%B",n),t.push(n)}}var xr,Fe,Ga=c({"src/lib/runners/git-executor-chain.ts"(){"use strict";xr=require("child_process"),V(),C(),y(),Ba(),Fe=class{constructor(t,e,r){this._executor=t,this._scheduler=e,this._plugins=r,this._chain=Promise.resolve(),this._queue=new Qs}get cwd(){return this._cwd||this._executor.cwd}set cwd(t){this._cwd=t}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(t){return this._queue.push(t),this._chain=this._chain.then(()=>this.attemptTask(t))}async attemptTask(t){let e=await this._scheduler.next(),r=()=>this._queue.complete(t);try{let{logger:s}=this._queue.attempt(t);return await(As(t)?this.attemptEmptyTask(t,s):this.attemptRemoteTask(t,s))}catch(s){throw this.onFatalException(t,s)}finally{r(),e()}}onFatalException(t,e){let r=e instanceof W?Object.assign(e,{task:t}):new W(t,e&&String(e));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(t,e){let r=this._plugins.exec("spawn.binary","",tt(t,t.commands)),s=this._plugins.exec("spawn.args",[...t.commands],tt(t,t.commands)),n=await this.gitResponse(t,r,s,this.outputHandler,e.step("SPAWN")),i=await this.handleTaskData(t,s,n,e.step("HANDLE"));return e("passing response to task's parser as a %s",t.format),xs(t)?Ee(t.parser,i):Ee(t.parser,i.asStrings())}async attemptEmptyTask(t,e){return e("empty task bypassing child process to call to task's parser"),t.parser(this)}handleTaskData(t,e,r,s){let{exitCode:n,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((u,g)=>{s("Preparing to handle process response exitCode=%d stdOut=",n);let{error:f}=this._plugins.exec("task.error",{error:i},{...tt(t,e),...r});if(f&&t.onError)return s.info("exitCode=%s handling with custom error handler"),t.onError(r,f,p=>{s.info("custom error handler treated as success"),s("custom error returned a %s",Et(p)),u(new Gt(Array.isArray(p)?Buffer.concat(p):p,Buffer.concat(a)))},g);if(f)return s.info("handling as error: exitCode=%s stdErr=%s rejection=%o",n,a.length,i),g(f);s.info("retrieving task output complete"),u(new Gt(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(t,e,r,s,n){let i=n.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},tt(t,t.commands));return new Promise(a=>{let u=[],g=[];n.info("%s %o",e,r),n("%O",o);let f=this._beforeSpawn(t,r);if(f)return a({stdOut:u,stdErr:g,exitCode:9901,rejection:f});this._plugins.exec("spawn.before",void 0,{...tt(t,r),kill(d){f=d||f}});let p=(0,xr.spawn)(e,r,o);p.stdout.on("data",Fr(u,"stdOut",n,i.step("stdOut"))),p.stderr.on("data",Fr(g,"stdErr",n,i.step("stdErr"))),p.on("error",$a(g,n)),s&&(n("Passing child process stdOut/stdErr to custom outputHandler"),s(e,p.stdout,p.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...tt(t,r),spawned:p,close(d,h){a({stdOut:u,stdErr:g,exitCode:d,rejection:f||h})},kill(d){p.killed||(f=d,p.kill("SIGINT"))}})})}_beforeSpawn(t,e){let r;return this._plugins.exec("spawn.before",void 0,{...tt(t,e),kill(s){r=s||r}}),r}}}}),Zs={};E(Zs,{GitExecutor:()=>tn});var tn,Ua=c({"src/lib/runners/git-executor.ts"(){"use strict";Ga(),tn=class{constructor(t,e,r){this.cwd=t,this._scheduler=e,this._plugins=r,this._chain=new Fe(this,this._scheduler,this._plugins)}chain(){return new Fe(this,this._scheduler,this._plugins)}push(t){return this._chain.push(t)}}}});function qa(t,e,r=st){let s=i=>{r(null,i)},n=i=>{i?.task===t&&r(i instanceof rt?Xa(i):i,void 0)};e.then(s,n)}function Xa(t){let e=s=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${s} should be GitResponseError.git.${s}, this will no longer be available in version 3`),e=st};return Object.create(t,Object.getOwnPropertyNames(t.git).reduce(r,{}));function r(s,n){return n in t||(s[n]={enumerable:!1,configurable:!1,get(){return e(n),t.git[n]}}),s}}var Ha=c({"src/lib/task-callback.ts"(){"use strict";pt(),y()}});function Ar(t,e){return Rs(r=>{if(!Be(t))throw new Error(`Git.cwd: cannot change to non-directory "${t}"`);return(e||r).cwd=t})}var za=c({"src/lib/tasks/change-working-directory.ts"(){"use strict";y(),C()}});function me(t){let e=["checkout",...t];return e[1]==="-b"&&e.includes("-B")&&(e[1]=Wt(e,"-B")),A(e)}function Wa(){return{checkout(){return this._runTask(me(D(arguments,1)),S(arguments))},checkoutBranch(t,e){return this._runTask(me(["-b",t,e,...D(arguments)]),S(arguments))},checkoutLocalBranch(t){return this._runTask(me(["-b",t,...D(arguments)]),S(arguments))}}}var Ja=c({"src/lib/tasks/checkout.ts"(){"use strict";y(),C()}});function Ya(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function Ka(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(t){return P(Ya(),[en],t)}})}}}var en,Va=c({"src/lib/tasks/count-objects.ts"(){"use strict";y(),en=new b(/([a-z-]+): (\d+)$/,(t,[e,r])=>{let s=fs(e);Object.hasOwn(t,s)&&(t[s]=k(r))})}});function Qa(t){return P({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},rn,t)}var rn,Za=c({"src/lib/parsers/parse-commit.ts"(){"use strict";y(),rn=[new b(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(t,[e,r,s])=>{t.branch=e,t.commit=s,t.root=!!r}),new b(/\s*Author:\s(.+)/i,(t,[e])=>{let r=e.split("<"),s=r.pop();!s||!s.includes("@")||(t.author={email:s.substr(0,s.length-1),name:r.join("<").trim()})}),new b(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0,t.summary.insertions=parseInt(r,10)||0,t.summary.deletions=parseInt(s,10)||0}),new b(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0;let n=parseInt(r,10)||0;s==="-"?t.summary.deletions=n:s==="+"&&(t.summary.insertions=n)})]}});function tc(t,e,r){return{commands:["-c","core.abbrev=40","commit",...bt(t,"-m"),...e,...r],format:"utf-8",parser:Qa}}function ec(){return{commit(e,...r){let s=S(arguments),n=t(e)||tc(J(e),J(G(r[0],$t,[])),[...dt(G(r[1],St,[])),...D(arguments,0,!0)]);return this._runTask(n,s)}};function t(e){return!$t(e)&&L("git.commit: requires the commit message to be supplied as a string/string[]")}}var rc=c({"src/lib/tasks/commit.ts"(){"use strict";Za(),y(),C()}});function sc(){return{firstCommit(){return this._runTask(A(["rev-list","--max-parents=0","HEAD"],!0),S(arguments))}}}var nc=c({"src/lib/tasks/first-commit.ts"(){"use strict";y(),C()}});function ic(t,e){let r=["hash-object",t];return e&&r.push("-w"),A(r,!0)}var oc=c({"src/lib/tasks/hash-object.ts"(){"use strict";C()}});function ac(t,e,r){let s=String(r).trim(),n;if(n=sn.exec(s))return new Pt(t,e,!1,n[1]);if(n=nn.exec(s))return new Pt(t,e,!0,n[1]);let i="",o=s.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new Pt(t,e,/^re/i.test(s),i)}var Pt,sn,nn,cc=c({"src/lib/responses/InitSummary.ts"(){"use strict";Pt=class{constructor(t,e,r,s){this.bare=t,this.path=e,this.existing=r,this.gitDir=s}},sn=/^Init.+ repository in (.+)$/,nn=/^Rein.+ in (.+)$/}});function uc(t){return t.includes(Ye)}function lc(t=!1,e,r){let s=["init",...r];return t&&!uc(s)&&s.splice(1,0,Ye),{commands:s,format:"utf-8",parser(n){return ac(s.includes("--bare"),e,n)}}}var Ye,fc=c({"src/lib/tasks/init.ts"(){"use strict";cc(),Ye="--bare"}});function Ke(t){for(let e=0;e<t.length;e++){let r=Ve.exec(t[e]);if(r)return`--${r[1]}`}return""}function pc(t){return Ve.test(t)}var Ve,Ct=c({"src/lib/args/log-format.ts"(){"use strict";Ve=/^--(stat|numstat|name-only|name-status)(=|$)/}}),on,dc=c({"src/lib/responses/DiffSummary.ts"(){"use strict";on=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function an(t=""){let e=cn[t];return r=>P(new on,e,r,!1)}var ge,Nr,Mr,Ir,cn,un=c({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Ct(),dc(),Bs(),y(),ge=[new b(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(t,[e,r,s=""])=>{t.files.push({file:e.trim(),changes:k(r),insertions:s.replace(/[^+]/g,"").length,deletions:s.replace(/[^-]/g,"").length,binary:!1})}),new b(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(t,[e,r,s])=>{t.files.push({file:e.trim(),before:k(r),after:k(s),binary:!0})}),new b(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(t,[e,r])=>{let s=/(\d+) i/.exec(r),n=/(\d+) d/.exec(r);t.changed=k(e),t.insertions=k(s?.[1]),t.deletions=k(n?.[1])})],Nr=[new b(/(\d+)\t(\d+)\t(.+)$/,(t,[e,r,s])=>{let n=k(e),i=k(r);t.changed++,t.insertions+=n,t.deletions+=i,t.files.push({file:s,changes:n+i,insertions:n,deletions:i,binary:!1})}),new b(/-\t-\t(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,after:0,before:0,binary:!0})})],Mr=[new b(/(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,changes:0,insertions:0,deletions:0,binary:!1})})],Ir=[new b(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(t,[e,r,s,n,i])=>{t.changed++,t.files.push({file:i??s,changes:0,insertions:0,deletions:0,binary:!1,status:Te(ea(e)&&e),from:Te(!!i&&s!==i&&s),similarity:k(r)})})],cn={"":ge,"--stat":ge,"--numstat":Nr,"--name-status":Ir,"--name-only":Mr}}});function hc(t,e){return e.reduce((r,s,n)=>(r[s]=t[n]||"",r),Object.create({diff:null}))}function ln(t=tr,e=fn,r=""){let s=an(r);return function(n){let i=wt(n.trim(),!1,Qe).map(function(o){let a=o.split(Ze),u=hc(a[0].split(t),e);return a.length>1&&a[1].trim()&&(u.diff=s(a[1])),u});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var Qe,Ze,tr,fn,pn=c({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";y(),un(),Ct(),Qe="\xF2\xF2\xF2\xF2\xF2\xF2 ",Ze=" \xF2\xF2",tr=" \xF2 ",fn=["hash","date","message","refs","author_name","author_email"]}}),dn={};E(dn,{diffSummaryTask:()=>mc,validateLogFormatConfig:()=>Zt});function mc(t){let e=Ke(t),r=["diff"];return e===""&&(e="--stat",r.push("--stat=4096")),r.push(...t),Zt(r)||{commands:r,format:"utf-8",parser:an(e)}}function Zt(t){let e=t.filter(pc);if(e.length>1)return L(`Summary flags are mutually exclusive - pick one of ${e.join(",")}`);if(e.length&&t.includes("-z"))return L(`Summary flag ${e} parsing is not compatible with null termination option '-z'`)}var er=c({"src/lib/tasks/diff.ts"(){"use strict";Ct(),un(),C()}});function gc(t,e){let r=[],s=[];return Object.keys(t).forEach(n=>{r.push(n),s.push(String(t[n]))}),[r,s.join(e)]}function _c(t){return Object.keys(t).reduce((e,r)=>(r in xe||(e[r]=t[r]),e),{})}function hn(t={},e=[]){let r=G(t.splitter,F,tr),s=Yt(t.format)?t.format:{hash:"%H",date:t.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:t.multiLine?"%B":"%b",author_name:t.mailMap!==!1?"%aN":"%an",author_email:t.mailMap!==!1?"%aE":"%ae"},[n,i]=gc(s,r),o=[],a=[`--pretty=format:${Qe}${i}${Ze}`,...e],u=t.n||t["max-count"]||t.maxCount;if(u&&a.push(`--max-count=${u}`),t.from||t.to){let g=t.symmetric!==!1?"...":"..";o.push(`${t.from||""}${g}${t.to||""}`)}return F(t.file)&&a.push("--follow",ss(t.file)),Ge(_c(t),a),{fields:n,splitter:r,commands:[...a,...o]}}function yc(t,e,r){let s=ln(t,e,Ke(r));return{commands:["log",...r],format:"utf-8",parser:s}}function bc(){return{log(...r){let s=S(arguments),n=hn(Ue(arguments),dt(G(arguments[0],St,[]))),i=e(...r)||Zt(n.commands)||t(n);return this._runTask(i,s)}};function t(r){return yc(r.splitter,r.fields,r.commands)}function e(r,s){return F(r)&&F(s)&&L("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var xe,mn=c({"src/lib/tasks/log.ts"(){"use strict";Ct(),vt(),pn(),y(),C(),er(),xe=(t=>(t[t["--pretty"]=0]="--pretty",t[t["max-count"]=1]="max-count",t[t.maxCount=2]="maxCount",t[t.n=3]="n",t[t.file=4]="file",t[t.format=5]="format",t[t.from=6]="from",t[t.to=7]="to",t[t.splitter=8]="splitter",t[t.symmetric=9]="symmetric",t[t.mailMap=10]="mailMap",t[t.multiLine=11]="multiLine",t[t.strictDate=12]="strictDate",t))(xe||{})}}),jt,gn,Tc=c({"src/lib/responses/MergeSummary.ts"(){"use strict";jt=class{constructor(t,e=null,r){this.reason=t,this.file=e,this.meta=r}toString(){return`${this.file}:${this.reason}`}},gn=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),Ae,_n,vc=c({"src/lib/responses/PullSummary.ts"(){"use strict";Ae=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},_n=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function _e(t){return t.objects=t.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function Dr(t){let e=/^\s*(\d+)/.exec(t),r=/delta (\d+)/i.exec(t);return{count:k(e&&e[1]||"0"),delta:k(r&&r[1]||"0")}}var yn,kc=c({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";y(),yn=[new K(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=_e(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new K(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=_e(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new K(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(t,[e,r,s])=>{let n=_e(t.remoteMessages);n.total=Dr(e),n.reused=Dr(r),n.packReused=k(s)})]}});function bn(t,e){return P({remoteMessages:new vn},Tn,e)}var Tn,vn,kn=c({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";y(),kc(),Tn=[new K(/^remote:\s*(.+)$/,(t,[e])=>(t.remoteMessages.all.push(e.trim()),!1)),...yn,new K([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(t,[e])=>{t.remoteMessages.pullRequestUrl=e}),new K([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(t,[e,r,s])=>{t.remoteMessages.vulnerabilities={count:k(e),summary:r,url:s}})],vn=class{constructor(){this.all=[]}}}});function wc(t,e){let r=P(new _n,wn,[t,e]);return r.message&&r}var Lr,Pr,jr,Br,wn,$r,rr,En=c({"src/lib/parsers/parse-pull.ts"(){"use strict";vc(),y(),kn(),Lr=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,Pr=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,jr=/^(create|delete) mode \d+ (.+)/,Br=[new b(Lr,(t,[e,r,s])=>{t.files.push(e),r&&(t.insertions[e]=r.length),s&&(t.deletions[e]=s.length)}),new b(Pr,(t,[e,,r,,s])=>r!==void 0||s!==void 0?(t.summary.changes=+e||0,t.summary.insertions=+r||0,t.summary.deletions=+s||0,!0):!1),new b(jr,(t,[e,r])=>{T(t.files,r),T(e==="create"?t.created:t.deleted,r)})],wn=[new b(/^from\s(.+)$/i,(t,[e])=>void(t.remote=e)),new b(/^fatal:\s(.+)$/,(t,[e])=>void(t.message=e)),new b(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(t,[e,r,s,n])=>{t.branch.local=s,t.hash.local=e,t.branch.remote=n,t.hash.remote=r})],$r=(t,e)=>P(new Ae,Br,[t,e]),rr=(t,e)=>Object.assign(new Ae,$r(t,e),bn(t,e))}}),Gr,Sn,Ur,Ec=c({"src/lib/parsers/parse-merge.ts"(){"use strict";Tc(),y(),En(),Gr=[new b(/^Auto-merging\s+(.+)$/,(t,[e])=>{t.merges.push(e)}),new b(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(t,[e,r])=>{t.conflicts.push(new jt(e,r))}),new b(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(t,[e,r,s])=>{t.conflicts.push(new jt(e,r,{deleteRef:s}))}),new b(/^CONFLICT\s+\((.+)\):/,(t,[e])=>{t.conflicts.push(new jt(e,null))}),new b(/^Automatic merge failed;\s+(.+)$/,(t,[e])=>{t.result=e})],Sn=(t,e)=>Object.assign(Ur(t,e),rr(t,e)),Ur=t=>P(new gn,Gr,t)}});function qr(t){return t.length?{commands:["merge",...t],format:"utf-8",parser(e,r){let s=Sn(e,r);if(s.failed)throw new rt(s);return s}}:L("Git.merge requires at least one option")}var Sc=c({"src/lib/tasks/merge.ts"(){"use strict";pt(),Ec(),C()}});function Cc(t,e,r){let s=r.includes("deleted"),n=r.includes("tag")||/^refs\/tags/.test(t),i=!r.includes("new");return{deleted:s,tag:n,branch:!n,new:!i,alreadyUpdated:i,local:t,remote:e}}var Xr,Cn,Hr,Oc=c({"src/lib/parsers/parse-push.ts"(){"use strict";y(),kn(),Xr=[new b(/^Pushing to (.+)$/,(t,[e])=>{t.repo=e}),new b(/^updating local tracking ref '(.+)'/,(t,[e])=>{t.ref={...t.ref||{},local:e}}),new b(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(t,[e,r,s])=>{t.pushed.push(Cc(e,r,s))}),new b(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(t,[e,r,s])=>{t.branch={...t.branch||{},local:e,remote:r,remoteName:s}}),new b(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(t,[e,r,s,n])=>{t.update={head:{local:e,remote:r},hash:{from:s,to:n}}})],Cn=(t,e)=>{let r=Hr(t,e),s=bn(t,e);return{...r,...s}},Hr=(t,e)=>P({pushed:[]},Xr,[t,e])}}),On={};E(On,{pushTagsTask:()=>Rc,pushTask:()=>sr});function Rc(t={},e){return T(e,"--tags"),sr(t,e)}function sr(t={},e){let r=["push",...e];return t.branch&&r.splice(1,0,t.branch),t.remote&&r.splice(1,0,t.remote),Wt(r,"-v"),T(r,"--verbose"),T(r,"--porcelain"),{commands:r,format:"utf-8",parser:Cn}}var Rn=c({"src/lib/tasks/push.ts"(){"use strict";Oc(),y()}});function Fc(){return{showBuffer(){let t=["show",...D(arguments,1)];return t.includes("--binary")||t.splice(1,0,"--binary"),this._runTask(Fs(t),S(arguments))},show(){let t=["show",...D(arguments,1)];return this._runTask(A(t),S(arguments))}}}var xc=c({"src/lib/tasks/show.ts"(){"use strict";y(),C()}}),zr,Fn,Ac=c({"src/lib/responses/FileStatusSummary.ts"(){"use strict";zr=/^(.+)\0(.+)$/,Fn=class{constructor(t,e,r){if(this.path=t,this.index=e,this.working_dir=r,e==="R"||r==="R"){let s=zr.exec(t)||[null,t,t];this.from=s[2]||"",this.path=s[1]||""}}}}});function Wr(t){let[e,r]=t.split(ft);return{from:r||e,to:e}}function $(t,e,r){return[`${t}${e}`,r]}function ye(t,...e){return e.map(r=>$(t,r,(s,n)=>T(s.conflicted,n)))}function Nc(t,e){let r=e.trim();switch(" "){case r.charAt(2):return s(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return s(" ",r.charAt(0),r.substr(2));default:return}function s(n,i,o){let a=`${n}${i}`,u=xn.get(a);u&&u(t,o),a!=="##"&&a!=="!!"&&t.files.push(new Fn(o,n,i))}}var Jr,xn,An,Mc=c({"src/lib/responses/StatusSummary.ts"(){"use strict";y(),Ac(),Jr=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},xn=new Map([$(" ","A",(t,e)=>T(t.created,e)),$(" ","D",(t,e)=>T(t.deleted,e)),$(" ","M",(t,e)=>T(t.modified,e)),$("A"," ",(t,e)=>T(t.created,e)&&T(t.staged,e)),$("A","M",(t,e)=>T(t.created,e)&&T(t.staged,e)&&T(t.modified,e)),$("D"," ",(t,e)=>T(t.deleted,e)&&T(t.staged,e)),$("M"," ",(t,e)=>T(t.modified,e)&&T(t.staged,e)),$("M","M",(t,e)=>T(t.modified,e)&&T(t.staged,e)),$("R"," ",(t,e)=>{T(t.renamed,Wr(e))}),$("R","M",(t,e)=>{let r=Wr(e);T(t.renamed,r),T(t.modified,r.to)}),$("!","!",(t,e)=>{T(t.ignored=t.ignored||[],e)}),$("?","?",(t,e)=>T(t.not_added,e)),...ye("A","A","U"),...ye("D","D","U"),...ye("U","A","D","U"),["##",(t,e)=>{let r=/ahead (\d+)/,s=/behind (\d+)/,n=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(e);t.ahead=a&&+a[1]||0,a=s.exec(e),t.behind=a&&+a[1]||0,a=n.exec(e),t.current=G(a?.[1],F,null),a=i.exec(e),t.tracking=G(a?.[1],F,null),a=o.exec(e),a&&(t.current=G(a?.[1],F,t.current)),t.detached=/\(no branch\)/.test(e)}]]),An=function(t){let e=t.split(ft),r=new Jr;for(let s=0,n=e.length;s<n;){let i=e[s++].trim();i&&(i.charAt(0)==="R"&&(i+=ft+(e[s++]||"")),Nc(r,i))}return r}}});function Ic(t){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...t.filter(r=>!Nn.includes(r))],parser(r){return An(r)}}}var Nn,Dc=c({"src/lib/tasks/status.ts"(){"use strict";Mc(),Nn=["--null","-z"]}});function Xt(t=0,e=0,r=0,s="",n=!0){return Object.defineProperty({major:t,minor:e,patch:r,agent:s,installed:n},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function Lc(){return Xt(0,0,0,"",!1)}function Pc(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:jc,onError(t,e,r,s){if(t.exitCode===-2)return r(Buffer.from(nr));s(e)}})}}}function jc(t){return t===nr?Lc():P(Xt(0,0,0,t),Mn,t)}var nr,Mn,Bc=c({"src/lib/tasks/version.ts"(){"use strict";y(),nr="installed=false",Mn=[new b(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(t,[e,r,s,n=""])=>{Object.assign(t,Xt(k(e),k(r),k(s),n))}),new b(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(t,[e,r,s,n=""])=>{Object.assign(t,Xt(k(e),k(r),s,n))})]}}),In={};E(In,{SimpleGitApi:()=>Ne});var Ne,$c=c({"src/lib/simple-git-api.ts"(){"use strict";Ha(),za(),Ja(),Va(),rc(),Ps(),nc(),qs(),oc(),fc(),mn(),Sc(),Rn(),xc(),Dc(),C(),Bc(),y(),Ne=class{constructor(t){this._executor=t}_runTask(t,e){let r=this._executor.chain(),s=r.push(t);return e&&qa(t,s,e),Object.create(this,{then:{value:s.then.bind(s)},catch:{value:s.catch.bind(s)},_executor:{value:r}})}add(t){return this._runTask(A(["add",...J(t)]),S(arguments))}cwd(t){let e=S(arguments);return typeof t=="string"?this._runTask(Ar(t,this._executor),e):typeof t?.path=="string"?this._runTask(Ar(t.path,t.root&&this._executor||void 0),e):this._runTask(L("Git.cwd: workingDirectory must be supplied as a string"),e)}hashObject(t,e){return this._runTask(ic(t,e===!0),S(arguments))}init(t){return this._runTask(lc(t===!0,this._executor.cwd,D(arguments)),S(arguments))}merge(){return this._runTask(qr(D(arguments)),S(arguments))}mergeFromTo(t,e){return F(t)&&F(e)?this._runTask(qr([t,e,...D(arguments)]),S(arguments,!1)):this._runTask(L("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(t){return this._executor.outputHandler=t,this}push(){let t=sr({remote:G(arguments[0],F),branch:G(arguments[1],F)},D(arguments));return this._runTask(t,S(arguments))}stash(){return this._runTask(A(["stash",...D(arguments)]),S(arguments))}status(){return this._runTask(Ic(D(arguments)),S(arguments))}},Object.assign(Ne.prototype,Wa(),ec(),ta(),Ka(),sc(),sa(),bc(),Fc(),Pc())}}),Dn={};E(Dn,{Scheduler:()=>Ln});var Yr,Kr,Ln,Gc=c({"src/lib/runners/scheduler.ts"(){"use strict";y(),Yr=de(),Vs(),Kr=(()=>{let t=0;return()=>{t++;let{promise:e,done:r}=(0,Yr.createDeferred)();return{promise:e,done:r,id:t}}})(),Ln=class{constructor(t=2){this.concurrency=t,this.logger=Je("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",t)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let t=T(this.running,this.pending.shift());this.logger("Attempting id=%s",t.id),t.done(()=>{this.logger("Completing id=",t.id),Wt(this.running,t),this.schedule()})}next(){let{promise:t,id:e}=T(this.pending,Kr());return this.logger("Scheduling id=%s",e),this.schedule(),t}}}}),Pn={};E(Pn,{applyPatchTask:()=>Uc});function Uc(t,e){return A(["apply",...e,...t])}var qc=c({"src/lib/tasks/apply-patch.ts"(){"use strict";C()}});function Xc(t,e){return{branch:t,hash:e,success:!0}}function Hc(t){return{branch:t,hash:null,success:!1}}var jn,zc=c({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";jn=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Bn(t,e){return e===1&&Me.test(t)}var Vr,Me,Qr,te,Wc=c({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";zc(),y(),Vr=/(\S+)\s+\(\S+\s([^)]+)\)/,Me=/^error[^']+'([^']+)'/m,Qr=[new b(Vr,(t,[e,r])=>{let s=Xc(e,r);t.all.push(s),t.branches[e]=s}),new b(Me,(t,[e])=>{let r=Hc(e);t.errors.push(r),t.all.push(r),t.branches[e]=r})],te=(t,e)=>P(new jn,Qr,[t,e])}}),$n,Jc=c({"src/lib/responses/BranchSummary.ts"(){"use strict";$n=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(t,e,r,s,n){t==="*"&&(this.detached=e,this.current=r),this.all.push(r),this.branches[r]={current:t==="*",linkedWorkTree:t==="+",name:r,commit:s,label:n}}}}});function Zr(t){return t?t.charAt(0):""}function Gn(t,e=!1){return P(new $n,e?[qn]:Un,t)}var Un,qn,Yc=c({"src/lib/parsers/parse-branch.ts"(){"use strict";Jc(),y(),Un=[new b(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(t,[e,r,s,n])=>{t.push(Zr(e),!0,r,s,n)}),new b(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(t,[e,r,s,n])=>{t.push(Zr(e),!1,r,s,n)})],qn=new b(/^(\S+)$/s,(t,[e])=>{t.push("*",!1,e,"","")})}}),Xn={};E(Xn,{branchLocalTask:()=>Vc,branchTask:()=>Kc,containsDeleteBranchCommand:()=>Hn,deleteBranchTask:()=>Zc,deleteBranchesTask:()=>Qc});function Hn(t){let e=["-d","-D","--delete"];return t.some(r=>e.includes(r))}function Kc(t){let e=Hn(t),r=t.includes("--show-current"),s=["branch",...t];return s.length===1&&s.push("-a"),s.includes("-v")||s.splice(1,0,"-v"),{format:"utf-8",commands:s,parser(n,i){return e?te(n,i).all[0]:Gn(n,r)}}}function Vc(){return{format:"utf-8",commands:["branch","-v"],parser(t){return Gn(t)}}}function Qc(t,e=!1){return{format:"utf-8",commands:["branch","-v",e?"-D":"-d",...t],parser(r,s){return te(r,s)},onError({exitCode:r,stdOut:s},n,i,o){if(!Bn(String(n),r))return o(n);i(s)}}}function Zc(t,e=!1){let r={format:"utf-8",commands:["branch","-v",e?"-D":"-d",t],parser(s,n){return te(s,n).branches[t]},onError({exitCode:s,stdErr:n,stdOut:i},o,a,u){if(!Bn(String(o),s))return u(o);throw new rt(r.parser(Tt(i),Tt(n)),String(o))}};return r}var tu=c({"src/lib/tasks/branch.ts"(){"use strict";pt(),Wc(),Yc(),y()}});function eu(t){let e=t.trim().replace(/^["']|["']$/g,"");return e&&(0,zn.normalize)(e)}var zn,Wn,ru=c({"src/lib/responses/CheckIgnore.ts"(){"use strict";zn=require("node:path"),Wn=t=>t.split(/\n/g).map(eu).filter(Boolean)}}),Jn={};E(Jn,{checkIgnoreTask:()=>su});function su(t){return{commands:["check-ignore",...t],format:"utf-8",parser:Wn}}var nu=c({"src/lib/tasks/check-ignore.ts"(){"use strict";ru()}}),Yn={};E(Yn,{cloneMirrorTask:()=>ou,cloneTask:()=>Kn});function iu(t){return/^--upload-pack(=|$)/.test(t)}function Kn(t,e,r){let s=["clone",...r];return F(t)&&s.push(t),F(e)&&s.push(e),s.find(iu)?L("git.fetch: potential exploit argument blocked."):A(s)}function ou(t,e,r){return T(r,"--mirror"),Kn(t,e,r)}var au=c({"src/lib/tasks/clone.ts"(){"use strict";C(),y()}});function cu(t,e){return P({raw:t,remote:null,branches:[],tags:[],updated:[],deleted:[]},Vn,[t,e])}var Vn,uu=c({"src/lib/parsers/parse-fetch.ts"(){"use strict";y(),Vn=[new b(/From (.+)$/,(t,[e])=>{t.remote=e}),new b(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.branches.push({name:e,tracking:r})}),new b(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.tags.push({name:e,tracking:r})}),new b(/- \[deleted]\s+\S+\s*-> (.+)$/,(t,[e])=>{t.deleted.push({tracking:e})}),new b(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(t,[e,r,s,n])=>{t.updated.push({name:s,tracking:n,to:r,from:e})})]}}),Qn={};E(Qn,{fetchTask:()=>fu});function lu(t){return/^--upload-pack(=|$)/.test(t)}function fu(t,e,r){let s=["fetch",...r];return t&&e&&s.push(t,e),s.find(lu)?L("git.fetch: potential exploit argument blocked."):{commands:s,format:"utf-8",parser:cu}}var pu=c({"src/lib/tasks/fetch.ts"(){"use strict";uu(),C()}});function du(t){return P({moves:[]},Zn,t)}var Zn,hu=c({"src/lib/parsers/parse-move.ts"(){"use strict";y(),Zn=[new b(/^Renaming (.+) to (.+)$/,(t,[e,r])=>{t.moves.push({from:e,to:r})})]}}),ti={};E(ti,{moveTask:()=>mu});function mu(t,e){return{commands:["mv","-v",...J(t),e],format:"utf-8",parser:du}}var gu=c({"src/lib/tasks/move.ts"(){"use strict";hu(),y()}}),ei={};E(ei,{pullTask:()=>_u});function _u(t,e,r){let s=["pull",...r];return t&&e&&s.splice(1,0,t,e),{commands:s,format:"utf-8",parser(n,i){return rr(n,i)},onError(n,i,o,a){let u=wc(Tt(n.stdOut),Tt(n.stdErr));if(u)return a(new rt(u));a(i)}}}var yu=c({"src/lib/tasks/pull.ts"(){"use strict";pt(),En(),y()}});function bu(t){let e={};return ri(t,([r])=>e[r]={name:r}),Object.values(e)}function Tu(t){let e={};return ri(t,([r,s,n])=>{Object.hasOwn(e,r)||(e[r]={name:r,refs:{fetch:"",push:""}}),n&&s&&(e[r].refs[n.replace(/[^a-z]/g,"")]=s)}),Object.values(e)}function ri(t,e){je(t,r=>e(r.split(/\s+/)))}var vu=c({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";y()}}),si={};E(si,{addRemoteTask:()=>ku,getRemotesTask:()=>wu,listRemotesTask:()=>Eu,remoteTask:()=>Su,removeRemoteTask:()=>Cu});function ku(t,e,r){return A(["remote","add",...r,t,e])}function wu(t){let e=["remote"];return t&&e.push("-v"),{commands:e,format:"utf-8",parser:t?Tu:bu}}function Eu(t){let e=[...t];return e[0]!=="ls-remote"&&e.unshift("ls-remote"),A(e)}function Su(t){let e=[...t];return e[0]!=="remote"&&e.unshift("remote"),A(e)}function Cu(t){return A(["remote","remove",t])}var Ou=c({"src/lib/tasks/remote.ts"(){"use strict";vu(),C()}}),ni={};E(ni,{stashListTask:()=>Ru});function Ru(t={},e){let r=hn(t),s=["stash","list",...r.commands,...e],n=ln(r.splitter,r.fields,Ke(s));return Zt(s)||{commands:s,format:"utf-8",parser:n}}var Fu=c({"src/lib/tasks/stash-list.ts"(){"use strict";Ct(),pn(),er(),mn()}}),ii={};E(ii,{addSubModuleTask:()=>xu,initSubModuleTask:()=>Au,subModuleTask:()=>ee,updateSubModuleTask:()=>Nu});function xu(t,e){return ee(["add",t,e])}function Au(t){return ee(["init",...t])}function ee(t){let e=[...t];return e[0]!=="submodule"&&e.unshift("submodule"),A(e)}function Nu(t){return ee(["update",...t])}var Mu=c({"src/lib/tasks/sub-module.ts"(){"use strict";C()}});function Iu(t,e){let r=Number.isNaN(t),s=Number.isNaN(e);return r!==s?r?1:-1:r?oi(t,e):0}function oi(t,e){return t===e?0:t>e?1:-1}function Du(t){return t.trim()}function It(t){return typeof t=="string"&&parseInt(t.replace(/^\D+/g,""),10)||0}var ts,ai,Lu=c({"src/lib/responses/TagList.ts"(){"use strict";ts=class{constructor(t,e){this.all=t,this.latest=e}},ai=function(t,e=!1){let r=t.split(`
`).map(Du).filter(Boolean);e||r.sort(function(n,i){let o=n.split("."),a=i.split(".");if(o.length===1||a.length===1)return Iu(It(o[0]),It(a[0]));for(let u=0,g=Math.max(o.length,a.length);u<g;u++){let f=oi(It(o[u]),It(a[u]));if(f)return f}return 0});let s=e?r[0]:[...r].reverse().find(n=>n.indexOf(".")>=0);return new ts(r,s)}}}),ci={};E(ci,{addAnnotatedTagTask:()=>Bu,addTagTask:()=>ju,tagListTask:()=>Pu});function Pu(t=[]){let e=t.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...t],parser(r){return ai(r,e)}}}function ju(t){return{format:"utf-8",commands:["tag",t],parser(){return{name:t}}}}function Bu(t,e){return{format:"utf-8",commands:["tag","-a","-m",e,t],parser(){return{name:t}}}}var $u=c({"src/lib/tasks/tag.ts"(){"use strict";Lu()}}),Gu=Co({"src/git.js"(t,e){"use strict";var{GitExecutor:r}=(Ua(),w(Zs)),{SimpleGitApi:s}=($c(),w(In)),{Scheduler:n}=(Gc(),w(Dn)),{configurationErrorTask:i}=(C(),w(Se)),{asArray:o,filterArray:a,filterPrimitives:u,filterString:g,filterStringOrStringArray:f,filterType:p,getTrailingOptions:d,trailingFunctionArgument:h,trailingOptionsArgument:U}=(y(),w(bs)),{applyPatchTask:O}=(qc(),w(Pn)),{branchTask:M,branchLocalTask:Y,deleteBranchesTask:nt,deleteBranchTask:re}=(tu(),w(Xn)),{checkIgnoreTask:it}=(nu(),w(Jn)),{checkIsRepoTask:lr}=(ws(),w(Ts)),{cloneTask:mt,cloneMirrorTask:se}=(au(),w(Yn)),{cleanWithOptionsTask:Rt,isCleanOptionsArray:ne}=(Is(),w(Ns)),{diffSummaryTask:Si}=(er(),w(dn)),{fetchTask:Ci}=(pu(),w(Qn)),{moveTask:Oi}=(gu(),w(ti)),{pullTask:Ri}=(yu(),w(ei)),{pushTagsTask:Fi}=(Rn(),w(On)),{addRemoteTask:xi,getRemotesTask:Ai,listRemotesTask:Ni,remoteTask:Mi,removeRemoteTask:Ii}=(Ou(),w(si)),{getResetMode:Di,resetTask:Li}=(Ws(),w(Xs)),{stashListTask:Pi}=(Fu(),w(ni)),{addSubModuleTask:ji,initSubModuleTask:Bi,subModuleTask:$i,updateSubModuleTask:Gi}=(Mu(),w(ii)),{addAnnotatedTagTask:Ui,addTagTask:qi,tagListTask:Xi}=($u(),w(ci)),{straightThroughBufferTask:Hi,straightThroughStringTask:z}=(C(),w(Se));function _(l,m){this._plugins=m,this._executor=new r(l.baseDir,new n(l.maxConcurrentProcesses),m),this._trimmed=l.trimmed}(_.prototype=Object.create(s.prototype)).constructor=_,_.prototype.customBinary=function(l){return this._plugins.reconfigure("binary",l),this},_.prototype.env=function(l,m){return arguments.length===1&&typeof l=="object"?this._executor.env=l:(this._executor.env=this._executor.env||{})[l]=m,this},_.prototype.stashList=function(l){return this._runTask(Pi(U(arguments)||{},a(l)&&l||[]),h(arguments))};function fr(l,m,v,x){return typeof v!="string"?i(`git.${l}() requires a string 'repoPath'`):m(v,p(x,g),d(arguments))}_.prototype.clone=function(){return this._runTask(fr("clone",mt,...arguments),h(arguments))},_.prototype.mirror=function(){return this._runTask(fr("mirror",se,...arguments),h(arguments))},_.prototype.mv=function(l,m){return this._runTask(Oi(l,m),h(arguments))},_.prototype.checkoutLatestTag=function(l){var m=this;return this.pull(function(){m.tags(function(v,x){m.checkout(x.latest,l)})})},_.prototype.pull=function(l,m,v,x){return this._runTask(Ri(p(l,g),p(m,g),d(arguments)),h(arguments))},_.prototype.fetch=function(l,m){return this._runTask(Ci(p(l,g),p(m,g),d(arguments)),h(arguments))},_.prototype.silent=function(l){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},_.prototype.tags=function(l,m){return this._runTask(Xi(d(arguments)),h(arguments))},_.prototype.rebase=function(){return this._runTask(z(["rebase",...d(arguments)]),h(arguments))},_.prototype.reset=function(l){return this._runTask(Li(Di(l),d(arguments)),h(arguments))},_.prototype.revert=function(l){let m=h(arguments);return typeof l!="string"?this._runTask(i("Commit must be a string"),m):this._runTask(z(["revert",...d(arguments,0,!0),l]),m)},_.prototype.addTag=function(l){let m=typeof l=="string"?qi(l):i("Git.addTag requires a tag name");return this._runTask(m,h(arguments))},_.prototype.addAnnotatedTag=function(l,m){return this._runTask(Ui(l,m),h(arguments))},_.prototype.deleteLocalBranch=function(l,m,v){return this._runTask(re(l,typeof m=="boolean"?m:!1),h(arguments))},_.prototype.deleteLocalBranches=function(l,m,v){return this._runTask(nt(l,typeof m=="boolean"?m:!1),h(arguments))},_.prototype.branch=function(l,m){return this._runTask(M(d(arguments)),h(arguments))},_.prototype.branchLocal=function(l){return this._runTask(Y(),h(arguments))},_.prototype.raw=function(l){let m=!Array.isArray(l),v=[].slice.call(m?arguments:l,0);for(let q=0;q<v.length&&m;q++)if(!u(v[q])){v.splice(q,v.length-q);break}v.push(...d(arguments,0,!0));var x=h(arguments);return v.length?this._runTask(z(v,this._trimmed),x):this._runTask(i("Raw: must supply one or more command to execute"),x)},_.prototype.submoduleAdd=function(l,m,v){return this._runTask(ji(l,m),h(arguments))},_.prototype.submoduleUpdate=function(l,m){return this._runTask(Gi(d(arguments,!0)),h(arguments))},_.prototype.submoduleInit=function(l,m){return this._runTask(Bi(d(arguments,!0)),h(arguments))},_.prototype.subModule=function(l,m){return this._runTask($i(d(arguments)),h(arguments))},_.prototype.listRemote=function(){return this._runTask(Ni(d(arguments)),h(arguments))},_.prototype.addRemote=function(l,m,v){return this._runTask(xi(l,m,d(arguments)),h(arguments))},_.prototype.removeRemote=function(l,m){return this._runTask(Ii(l),h(arguments))},_.prototype.getRemotes=function(l,m){return this._runTask(Ai(l===!0),h(arguments))},_.prototype.remote=function(l,m){return this._runTask(Mi(d(arguments)),h(arguments))},_.prototype.tag=function(l,m){let v=d(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(z(v),h(arguments))},_.prototype.updateServerInfo=function(l){return this._runTask(z(["update-server-info"]),h(arguments))},_.prototype.pushTags=function(l,m){let v=Fi({remote:p(l,g)},d(arguments));return this._runTask(v,h(arguments))},_.prototype.rm=function(l){return this._runTask(z(["rm","-f",...o(l)]),h(arguments))},_.prototype.rmKeepLocal=function(l){return this._runTask(z(["rm","--cached",...o(l)]),h(arguments))},_.prototype.catFile=function(l,m){return this._catFile("utf-8",arguments)},_.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},_.prototype._catFile=function(l,m){var v=h(m),x=["cat-file"],q=m[0];if(typeof q=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(q)&&x.push.apply(x,q);let ie=l==="buffer"?Hi(x):z(x);return this._runTask(ie,v)},_.prototype.diff=function(l,m){let v=g(l)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):z(["diff",...d(arguments)]);return this._runTask(v,h(arguments))},_.prototype.diffSummary=function(){return this._runTask(Si(d(arguments,1)),h(arguments))},_.prototype.applyPatch=function(l){let m=f(l)?O(o(l),d([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(m,h(arguments))},_.prototype.revparse=function(){let l=["rev-parse",...d(arguments,!0)];return this._runTask(z(l,!0),h(arguments))},_.prototype.clean=function(l,m,v){let x=ne(l),q=x&&l.join("")||p(l,g)||"",ie=d([].slice.call(arguments,x?1:0));return this._runTask(Rt(q,ie),h(arguments))},_.prototype.exec=function(l){let m={commands:[],format:"utf-8",parser(){typeof l=="function"&&l()}};return this._runTask(m)},_.prototype.clearQueue=function(){return this},_.prototype.checkIgnore=function(l,m){return this._runTask(it(o(p(l,f,[]))),h(arguments))},_.prototype.checkIsRepo=function(l,m){return this._runTask(lr(p(l,g)),h(arguments))},e.exports=_}}),ui={};E(ui,{esModuleFactory:()=>Uu,gitExportFactory:()=>qu,gitInstanceFactory:()=>li});function Uu(t){return Object.defineProperties(t,{__esModule:{value:!0},default:{value:t}})}function qu(t){return Object.assign(t.bind(null),Js)}function li(t,e){let r=new Ks,s=_s(t&&(typeof t=="string"?{baseDir:t}:t)||{},e);if(!Be(s.baseDir))throw new Le(s,"Cannot use simple-git on a directory that does not exist");return Array.isArray(s.config)&&r.add(ha(s.config)),r.add(pa(s.unsafe)),r.add(Da()),r.add(ga(s.completion)),s.abort&&r.add(aa(s.abort)),s.progress&&r.add(Ca(s.progress)),s.timeout&&r.add(Na(s.timeout)),s.spawnOptions&&r.add(xa(s.spawnOptions)),r.add(Cr(wa(!0))),s.errors&&r.add(Cr(s.errors)),ba(r,s.binary,s.unsafe?.allowUnsafeCustomBinary),new fi(s,r)}var fi,pi=c({"src/lib/git-factory.ts"(){"use strict";oa(),Ia(),La(),y(),fi=Gu()}}),di={};E(di,{gitP:()=>Xu});function Xu(...t){let e,r=Promise.resolve();try{e=li(...t)}catch(u){r=Promise.reject(u)}function s(){return i}function n(){return r}let i=[...hi,...Ie].reduce((u,g)=>{let f=Ie.includes(g),p=f?o(g,e):a(g,e,u);return Object.defineProperty(u,g,{enumerable:!1,configurable:!1,value:e?p:f?n:s}),u},{});return i;function o(u,g){return function(...f){if(typeof f[f.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+u);return r.then(function(){return new Promise(function(p,d){let h=(U,O)=>{if(U)return d(Hu(U));p(O)};f.push(h),g[u].apply(g,f)})})}}function a(u,g,f){return(...p)=>(g[u](...p),f)}}function Hu(t){return t instanceof Error?t:typeof t=="string"?new Error(t):new rt(t)}var hi,Ie,zu=c({"src/lib/runners/promise-wrapped.ts"(){"use strict";pt(),pi(),hi=["customBinary","env","outputHandler","silent"],Ie=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:Wu}=(zu(),w(di)),{esModuleFactory:Ju,gitInstanceFactory:Yu,gitExportFactory:Ku}=(pi(),w(ui)),es=Ju(Ku(Yu));mi.exports=Object.assign(es,{gitP:Wu,simpleGit:es})});var bi=j((Xl,yi)=>{var _i=gi(),{execSync:ir}=require("node:child_process"),H=require("node:path"),N=require("node:fs"),Vu=require("node:os"),Qu=H.join(Vu.homedir(),".claude-memory","repo"),Zu="claude-memory-storage",or=class{constructor(e,r=null,s=Zu){this.auth=e,this.repoOwner=r,this.repoName=s,this.syncDir=Qu,this._git=null}get git(){return this._git||(this._git=_i(this.syncDir)),this._git}async ensureRepo(){if(N.existsSync(this.syncDir)&&N.existsSync(H.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),s=JSON.parse(ir(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=s.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let e=await this.auth.getToken();return ir(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${e}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let e=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return ir(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${e}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(e){return console.error("Failed to create repository:",e.message),!1}}async cloneRepo(){let e=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=H.dirname(this.syncDir);N.existsSync(r)||N.mkdirSync(r,{recursive:!0}),await _i().clone(e,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(e){let r=new Date(e.created_at),s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,n=String(r.getDate()).padStart(2,"0"),i=H.join(this.syncDir,"memories",e.container_tag,s);N.existsSync(i)||N.mkdirSync(i,{recursive:!0});let o=`${n}-${e.id}.json`,a=H.join(i,o),u={id:e.id,content:e.content,containerTag:e.container_tag,metadata:typeof e.metadata=="string"?JSON.parse(e.metadata):e.metadata,createdAt:e.created_at,updatedAt:e.updated_at};return N.writeFileSync(a,JSON.stringify(u,null,2)),a}exportMemories(e){let r=[];for(let s of e){let n=this.exportMemory(s);r.push(n)}return r}exportProfiles(e){let r=H.join(this.syncDir,"profiles");N.existsSync(r)||N.mkdirSync(r,{recursive:!0});let s=H.join(r,"user-preferences.json");return N.writeFileSync(s,JSON.stringify(e,null,2)),s}async syncToGitHub(e,r=null){try{await this.ensureRepo();let s=this.exportMemories(e);if(r){let o=this.exportProfiles(r);s.push(o)}if(s.length===0)return{success:!0,synced:0};for(let o of s){let a=H.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(e.map(o=>o.container_tag))].join(", ")} (${e.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:e.length}}catch(s){return console.error("GitHub sync failed:",s.message),{success:!1,error:s.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(e){return e.message.includes("conflict")?{success:!1,conflict:!0,error:e.message}:{success:!1,conflict:!1,error:e.message}}}importMemories(){let e=H.join(this.syncDir,"memories");if(!N.existsSync(e))return[];let r=[],s=n=>{let i=N.readdirSync(n,{withFileTypes:!0});for(let o of i){let a=H.join(n,o.name);if(o.isDirectory())s(a);else if(o.name.endsWith(".json"))try{let u=JSON.parse(N.readFileSync(a,"utf8"));r.push({id:u.id,content:u.content,container_tag:u.containerTag,metadata:JSON.stringify(u.metadata||{}),created_at:u.createdAt,updated_at:u.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(u){console.error(`Failed to parse ${a}:`,u.message)}}};return s(e),r}importProfiles(){let e=H.join(this.syncDir,"profiles","user-preferences.json");if(!N.existsSync(e))return{static:[],dynamic:[]};try{return JSON.parse(N.readFileSync(e,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};yi.exports={GitHubSync:or}});var cr=j((Hl,ki)=>{var{execSync:Ti}=require("node:child_process"),ht=require("node:fs"),vi=require("node:path"),tl=require("node:os"),Ot=vi.join(tl.homedir(),".claude-memory","github-token.json"),ar=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return Ti("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return Ti("gh auth token",{encoding:"utf8"}).trim()}catch(e){console.error("Failed to get gh token:",e.message)}if(ht.existsSync(Ot))return JSON.parse(ht.readFileSync(Ot,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(e){let r=vi.dirname(Ot);ht.existsSync(r)||ht.mkdirSync(r,{recursive:!0}),ht.writeFileSync(Ot,JSON.stringify({token:e}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||ht.existsSync(Ot)}async initiateDeviceFlow(){let e=require("node:https");return new Promise((r,s)=>{let n=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":n.length,Accept:"application/json"}},o=e.request(i,a=>{let u="";a.on("data",g=>{u+=g}),a.on("end",()=>r(JSON.parse(u)))});o.on("error",s),o.write(n),o.end()})}async pollForToken(e,r=5){let s=require("node:https"),n=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:e,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),u={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},g=s.request(u,f=>{let p="";f.on("data",d=>{p+=d}),f.on("end",()=>{let d=JSON.parse(p);d.access_token?i(d.access_token):d.error==="authorization_pending"?i(null):o(new Error(d.error||"Unknown error"))})});g.on("error",o),g.write(a),g.end()});for(let i=0;i<120;i++){let o=await n();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let e=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${e.verification_uri}`),console.log(`Enter code: ${e.user_code}
`);let r=await this.pollForToken(e.device_code,e.interval);return this.saveToken(r),r}};ki.exports={GitHubAuth:ar}});var Ei=j((zl,wi)=>{var{SqliteManager:el}=hr(),{GitHubSync:rl}=bi(),{GitHubAuth:sl}=cr(),nl=require("node:crypto"),ur=class{constructor(e=null){this.db=new el(e),this.auth=new sl,this.sync=null}async initSync(){this.sync||(this.sync=new rl(this.auth))}generateId(e="mem"){return`${e}_${nl.randomBytes(8).toString("hex")}`}async addMemory(e,r,s={},n=null){let i=n||this.generateId("mem");return this.db.addMemory(i,e,r,s),{id:i,status:"saved",containerTag:r}}async search(e,r=null,s={}){let n=this.db.searchMemories(e,r,s.limit||10);return{results:n.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:n.length}}async getProfile(e,r=null){let s=this.db.getProfile(e),n=null;if(r){let i=this.db.searchMemories(r,e,10);n={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:s.static,dynamic:s.dynamic},searchResults:n}}async listMemories(e,r=20){return{memories:this.db.listMemories(e,r)}}async deleteMemory(e){return this.db.deleteMemory(e),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=this.db.getPendingSync();if(e.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(e);if(r.success){let s=e.map(n=>n.id);this.db.markSynced(s)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=await this.sync.pullFromGitHub();if(!e.success)return e;let r=this.sync.importMemories();for(let s of r)this.db.getMemory(s.id)||this.db.addMemory(s.id,s.content,s.container_tag,JSON.parse(s.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};wi.exports={StorageClient:ur}});var{StorageClient:il}=Ei(),{GitHubAuth:ol}=cr();async function al(){try{let t=new il,e=new ol,r=t.db,n=r.db.prepare("SELECT COUNT(*) as count FROM memories").get().count,i=t.db.getPendingSync().length,a=r.db.prepare("SELECT MAX(synced_at) as last_sync FROM memories WHERE synced_at IS NOT NULL").get().last_sync;if(console.log(`## Claude Memory Status
`),console.log("**Local Storage:**"),console.log(`- Total memories: ${n}`),console.log(`- Pending sync: ${i}`),console.log(`- Database: ~/.claude-memory/memories.db
`),console.log("**GitHub Sync:**"),e.isAuthenticated()){if(console.log("- Status: Authenticated \u2713"),a){let u=new Date(a);console.log(`- Last sync: ${u.toLocaleString()}`)}else console.log("- Last sync: Never");console.log("- Repository: ~/.claude-memory/repo")}else console.log("- Status: Not authenticated \u2717"),console.log("- Run `gh auth login` to enable GitHub sync");t.close()}catch(t){console.error(`Error: ${t.message}`),process.exit(1)}}al();
