#!/usr/bin/env node
var v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var J=v(Le=>{"use strict";Le.getBooleanOption=(e,t)=>{let r=!1;if(t in e&&typeof(r=e[t])!="boolean")throw new TypeError(`Expected the "${t}" option to be a boolean`);return r};Le.cppdb=Symbol();Le.inspect=Symbol.for("nodejs.util.inspect.custom")});var Et=v((Bf,Dr)=>{"use strict";var vt={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function re(e,t){if(new.target!==re)return new re(e,t);if(typeof t!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,e),vt.value=""+e,Object.defineProperty(this,"message",vt),Error.captureStackTrace(this,re),this.code=t}Object.setPrototypeOf(re,Error);Object.setPrototypeOf(re.prototype,Error.prototype);Object.defineProperty(re.prototype,"name",vt);Dr.exports=re});var Nr=v((qf,Mr)=>{var je=require("path").sep||"/";Mr.exports=Vo;function Vo(e){if(typeof e!="string"||e.length<=7||e.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var t=decodeURI(e.substring(7)),r=t.indexOf("/"),n=t.substring(0,r),s=t.substring(r+1);return n=="localhost"&&(n=""),n&&(n=je+je+n),s=s.replace(/^(.+)\|/,"$1:"),je=="\\"&&(s=s.replace(/\//g,"\\")),/^.+\:/.test(s)||(s=je+s),n+s}});var $r=v((pe,jr)=>{var kt=require("fs"),Be=require("path"),Jo=Nr(),$e=Be.join,Yo=Be.dirname,Pr=kt.accessSync&&function(e){try{kt.accessSync(e)}catch{return!1}return!0}||kt.existsSync||Be.existsSync,Lr={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function Ko(e){typeof e=="string"?e={bindings:e}:e||(e={}),Object.keys(Lr).map(function(c){c in e||(e[c]=Lr[c])}),e.module_root||(e.module_root=pe.getRoot(pe.getFileName())),Be.extname(e.bindings)!=".node"&&(e.bindings+=".node");for(var t=typeof __webpack_require__=="function"?__non_webpack_require__:require,r=[],n=0,s=e.try.length,i,o,a;n<s;n++){i=$e.apply(null,e.try[n].map(function(c){return e[c]||c})),r.push(i);try{return o=e.path?t.resolve(i):t(i),e.path||(o.path=i),o}catch(c){if(c.code!=="MODULE_NOT_FOUND"&&c.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(c.message))throw c}}throw a=new Error(`Could not locate the bindings file. Tried:
`+r.map(function(c){return e.arrow+c}).join(`
`)),a.tries=r,a}jr.exports=pe=Ko;pe.getFileName=function(t){var r=Error.prepareStackTrace,n=Error.stackTraceLimit,s={},i;Error.stackTraceLimit=10,Error.prepareStackTrace=function(a,c){for(var p=0,u=c.length;p<u;p++)if(i=c[p].getFileName(),i!==__filename)if(t){if(i!==t)return}else return},Error.captureStackTrace(s),s.stack,Error.prepareStackTrace=r,Error.stackTraceLimit=n;var o="file://";return i.indexOf(o)===0&&(i=Jo(i)),i};pe.getRoot=function(t){for(var r=Yo(t),n;;){if(r==="."&&(r=process.cwd()),Pr($e(r,"package.json"))||Pr($e(r,"node_modules")))return r;if(n===r)throw new Error('Could not find module root given file: "'+t+'". Do you have a `package.json` file? ');n=r,r=$e(r,"..")}}});var Br=v(Z=>{"use strict";var{cppdb:H}=J();Z.prepare=function(t){return this[H].prepare(t,this,!1)};Z.exec=function(t){return this[H].exec(t),this};Z.close=function(){return this[H].close(),this};Z.loadExtension=function(...t){return this[H].loadExtension(...t),this};Z.defaultSafeIntegers=function(...t){return this[H].defaultSafeIntegers(...t),this};Z.unsafeMode=function(...t){return this[H].unsafeMode(...t),this};Z.getters={name:{get:function(){return this[H].name},enumerable:!0},open:{get:function(){return this[H].open},enumerable:!0},inTransaction:{get:function(){return this[H].inTransaction},enumerable:!0},readonly:{get:function(){return this[H].readonly},enumerable:!0},memory:{get:function(){return this[H].memory},enumerable:!0}}});var Ur=v((Uf,Gr)=>{"use strict";var{cppdb:Qo}=J(),qr=new WeakMap;Gr.exports=function(t){if(typeof t!="function")throw new TypeError("Expected first argument to be a function");let r=this[Qo],n=Zo(r,this),{apply:s}=Function.prototype,i={default:{value:qe(s,t,r,n.default)},deferred:{value:qe(s,t,r,n.deferred)},immediate:{value:qe(s,t,r,n.immediate)},exclusive:{value:qe(s,t,r,n.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(i.default.value,i),Object.defineProperties(i.deferred.value,i),Object.defineProperties(i.immediate.value,i),Object.defineProperties(i.exclusive.value,i),i.default.value};var Zo=(e,t)=>{let r=qr.get(e);if(!r){let n={commit:e.prepare("COMMIT",t,!1),rollback:e.prepare("ROLLBACK",t,!1),savepoint:e.prepare("SAVEPOINT `	_bs3.	`",t,!1),release:e.prepare("RELEASE `	_bs3.	`",t,!1),rollbackTo:e.prepare("ROLLBACK TO `	_bs3.	`",t,!1)};qr.set(e,r={default:Object.assign({begin:e.prepare("BEGIN",t,!1)},n),deferred:Object.assign({begin:e.prepare("BEGIN DEFERRED",t,!1)},n),immediate:Object.assign({begin:e.prepare("BEGIN IMMEDIATE",t,!1)},n),exclusive:Object.assign({begin:e.prepare("BEGIN EXCLUSIVE",t,!1)},n)})}return r},qe=(e,t,r,{begin:n,commit:s,rollback:i,savepoint:o,release:a,rollbackTo:c})=>function(){let u,d,m;r.inTransaction?(u=o,d=a,m=c):(u=n,d=s,m=i),u.run();try{let h=e.call(t,this,arguments);if(h&&typeof h.then=="function")throw new TypeError("Transaction function cannot return a promise");return d.run(),h}catch(h){throw r.inTransaction&&(m.run(),m!==i&&d.run()),h}}});var Hr=v((Xf,Xr)=>{"use strict";var{getBooleanOption:ea,cppdb:ta}=J();Xr.exports=function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");let n=ea(r,"simple"),s=this[ta].prepare(`PRAGMA ${t}`,this,!0);return n?s.pluck().get():s.all()}});var Vr=v((Hf,Wr)=>{"use strict";var ra=require("fs"),na=require("path"),{promisify:sa}=require("util"),{cppdb:ia}=J(),zr=sa(ra.access);Wr.exports=async function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");t=t.trim();let n="attached"in r?r.attached:"main",s="progress"in r?r.progress:null;if(!t)throw new TypeError("Backup filename cannot be an empty string");if(t===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof n!="string")throw new TypeError('Expected the "attached" option to be a string');if(!n)throw new TypeError('The "attached" option cannot be an empty string');if(s!=null&&typeof s!="function")throw new TypeError('Expected the "progress" option to be a function');await zr(na.dirname(t)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let i=await zr(t).then(()=>!1,()=>!0);return oa(this[ia].backup(this,n,t,i),s||null)};var oa=(e,t)=>{let r=0,n=!0;return new Promise((s,i)=>{setImmediate(function o(){try{let a=e.transfer(r);if(!a.remainingPages){e.close(),s(a);return}if(n&&(n=!1,r=100),t){let c=t(a);if(c!==void 0)if(typeof c=="number"&&c===c)r=Math.max(0,Math.min(2147483647,Math.round(c)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(o)}catch(a){e.close(),i(a)}})})}});var Yr=v((zf,Jr)=>{"use strict";var{cppdb:aa}=J();Jr.exports=function(t){if(t==null&&(t={}),typeof t!="object")throw new TypeError("Expected first argument to be an options object");let r="attached"in t?t.attached:"main";if(typeof r!="string")throw new TypeError('Expected the "attached" option to be a string');if(!r)throw new TypeError('The "attached" option cannot be an empty string');return this[aa].serialize(r)}});var Qr=v((Wf,Kr)=>{"use strict";var{getBooleanOption:Ge,cppdb:ca}=J();Kr.exports=function(t,r,n){if(r==null&&(r={}),typeof r=="function"&&(n=r,r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof n!="function")throw new TypeError("Expected last argument to be a function");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let s="safeIntegers"in r?+Ge(r,"safeIntegers"):2,i=Ge(r,"deterministic"),o=Ge(r,"directOnly"),a=Ge(r,"varargs"),c=-1;if(!a){if(c=n.length,!Number.isInteger(c)||c<0)throw new TypeError("Expected function.length to be a positive integer");if(c>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[ca].function(n,t,c,s,i,o),this}});var tn=v((Vf,en)=>{"use strict";var{getBooleanOption:Ue,cppdb:ua}=J();en.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object"||r===null)throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let n="start"in r?r.start:null,s=St(r,"step",!0),i=St(r,"inverse",!1),o=St(r,"result",!1),a="safeIntegers"in r?+Ue(r,"safeIntegers"):2,c=Ue(r,"deterministic"),p=Ue(r,"directOnly"),u=Ue(r,"varargs"),d=-1;if(!u&&(d=Math.max(Zr(s),i?Zr(i):0),d>0&&(d-=1),d>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[ua].aggregate(n,s,i,o,t,d,a,c,p),this};var St=(e,t,r)=>{let n=t in e?e[t]:null;if(typeof n=="function")return n;if(n!=null)throw new TypeError(`Expected the "${t}" option to be a function`);if(r)throw new TypeError(`Missing required option "${t}"`);return null},Zr=({length:e})=>{if(Number.isInteger(e)&&e>=0)return e;throw new TypeError("Expected function.length to be a positive integer")}});var on=v((Jf,sn)=>{"use strict";var{cppdb:la}=J();sn.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(!t)throw new TypeError("Virtual table module name cannot be an empty string");let n=!1;if(typeof r=="object"&&r!==null)n=!0,r=ba(nn(r,"used",t));else{if(typeof r!="function")throw new TypeError("Expected second argument to be a function or a table definition object");r=fa(r)}return this[la].table(r,t,n),this};function fa(e){return function(r,n,s,...i){let o={module:r,database:n,table:s},a=ga.call(e,o,i);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${r}" did not return a table definition object`);return nn(a,"returned",r)}}function nn(e,t,r){if(!Ee.call(e,"rows"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "rows" property`);if(!Ee.call(e,"columns"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "columns" property`);let n=e.rows;if(typeof n!="function"||Object.getPrototypeOf(n)!==ya)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "rows" property (should be a generator function)`);let s=e.columns;if(!Array.isArray(s)||!(s=[...s]).every(p=>typeof p=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "columns" property (should be an array of strings)`);if(s.length!==new Set(s).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate column names`);if(!s.length)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with zero columns`);let i;if(Ee.call(e,"parameters")){if(i=e.parameters,!Array.isArray(i)||!(i=[...i]).every(p=>typeof p=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "parameters" property (should be an array of strings)`)}else i=ma(n);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate parameter names`);if(i.length>32)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with more than the maximum number of 32 parameters`);for(let p of i)if(s.includes(p))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with column "${p}" which was ambiguously defined as both a column and parameter`);let o=2;if(Ee.call(e,"safeIntegers")){let p=e.safeIntegers;if(typeof p!="boolean")throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "safeIntegers" property (should be a boolean)`);o=+p}let a=!1;if(Ee.call(e,"directOnly")&&(a=e.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...i.map(rn).map(p=>`${p} HIDDEN`),...s.map(rn)].join(", ")});`,pa(n,new Map(s.map((p,u)=>[p,i.length+u])),r),i,o,a]}function pa(e,t,r){return function*(...s){let i=s.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);for(let o=0;o<t.size;++o)i.push(null);for(let o of e(...s))if(Array.isArray(o))da(o,i,t.size,r),yield i;else if(typeof o=="object"&&o!==null)ha(o,i,t,r),yield i;else throw new TypeError(`Virtual table module "${r}" yielded something that isn't a valid row object`)}}function da(e,t,r,n){if(e.length!==r)throw new TypeError(`Virtual table module "${n}" yielded a row with an incorrect number of columns`);let s=t.length-r;for(let i=0;i<r;++i)t[i+s]=e[i]}function ha(e,t,r,n){let s=0;for(let i of Object.keys(e)){let o=r.get(i);if(o===void 0)throw new TypeError(`Virtual table module "${n}" yielded a row with an undeclared column "${i}"`);t[o]=e[i],s+=1}if(s!==r.size)throw new TypeError(`Virtual table module "${n}" yielded a row with missing columns`)}function ma({length:e}){if(!Number.isInteger(e)||e<0)throw new TypeError("Expected function.length to be a positive integer");let t=[];for(let r=0;r<e;++r)t.push(`$${r+1}`);return t}var{hasOwnProperty:Ee}=Object.prototype,{apply:ga}=Function.prototype,ya=Object.getPrototypeOf(function*(){}),rn=e=>`"${e.replace(/"/g,'""')}"`,ba=e=>()=>e});var cn=v((Yf,an)=>{"use strict";var _a=function(){};an.exports=function(t,r){return Object.assign(new _a,this)}});var pn=v((Kf,fn)=>{"use strict";var wa=require("fs"),un=require("path"),Xe=J(),Ta=Et(),ln;function A(e,t){if(new.target==null)return new A(e,t);let r;if(Buffer.isBuffer(e)&&(r=e,e=":memory:"),e==null&&(e=""),t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in t)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in t)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let n=e.trim(),s=n===""||n===":memory:",i=Xe.getBooleanOption(t,"readonly"),o=Xe.getBooleanOption(t,"fileMustExist"),a="timeout"in t?t.timeout:5e3,c="verbose"in t?t.verbose:null,p="nativeBinding"in t?t.nativeBinding:null;if(i&&s&&!r)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(c!=null&&typeof c!="function")throw new TypeError('Expected the "verbose" option to be a function');if(p!=null&&typeof p!="string"&&typeof p!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let u;if(p==null?u=ln||(ln=$r()("better_sqlite3.node")):typeof p=="string"?u=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(un.resolve(p).replace(/(\.node)?$/,".node")):u=p,u.isInitialized||(u.setErrorConstructor(Ta),u.isInitialized=!0),!s&&!wa.existsSync(un.dirname(n)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[Xe.cppdb]:{value:new u.Database(n,e,s,i,o,a,c||null,r||null)},...ne.getters})}var ne=Br();A.prototype.prepare=ne.prepare;A.prototype.transaction=Ur();A.prototype.pragma=Hr();A.prototype.backup=Vr();A.prototype.serialize=Yr();A.prototype.function=Qr();A.prototype.aggregate=tn();A.prototype.table=on();A.prototype.loadExtension=ne.loadExtension;A.prototype.exec=ne.exec;A.prototype.close=ne.close;A.prototype.defaultSafeIntegers=ne.defaultSafeIntegers;A.prototype.unsafeMode=ne.unsafeMode;A.prototype[Xe.inspect]=cn();fn.exports=A});var dn=v((Qf,Ot)=>{"use strict";Ot.exports=pn();Ot.exports.SqliteError=Et()});var gn=v((Zf,mn)=>{var va=dn(),xt=require("node:path"),hn=require("node:fs"),Ea=require("node:os"),ka=xt.join(Ea.homedir(),".claude-memory"),Ct=xt.join(ka,"memories.db"),Rt=class{constructor(t=Ct){t||(t=Ct);let r=xt.dirname(t);hn.existsSync(r)||hn.mkdirSync(r,{recursive:!0}),this.db=new va(t),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(t,r,n,s={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(t,r,n,JSON.stringify(s),i,i),{id:t,createdAt:i}}getMemory(t){let n=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(t);return n?.metadata&&(n.metadata=JSON.parse(n.metadata)),n}updateMemory(t,r,n=null){let s=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,s,"pending"];n!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(n))),o.push(t),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(t){this.db.prepare("DELETE FROM memories WHERE id = ?").run(t)}listMemories(t,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(n=>(n.metadata&&(n.metadata=JSON.parse(n.metadata)),n))}markSynced(t){let r=Date.now(),n=t.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${n})
    `).run(r,...t)}searchMemories(t,r=null,n=10){let s=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[t];return r&&(s+=" AND m.container_tag = ?",i.push(r)),s+=" ORDER BY rank LIMIT ?",i.push(n),this.db.prepare(s).all(...i).map(c=>(c.metadata&&(c.metadata=JSON.parse(c.metadata)),c))}getContextMemories(t,r,n=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,Math.floor(n/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,t,Math.floor(n/2)),c=new Set(i.map(u=>u.id)),p=[...i];for(let u of a)c.has(u.id)||(p.push(u),c.add(u.id));return p.slice(0,n).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}addProfileFact(t,r,n,s="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(t,r,n,s,i)}getProfile(t,r=5){let s=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r);return{static:s.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(t){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(t)}close(){this.db.close()}};mn.exports={SqliteManager:Rt,DEFAULT_DB_PATH:Ct}});var bn=v((ep,yn)=>{var de=1e3,he=de*60,me=he*60,se=me*24,Sa=se*7,Oa=se*365.25;yn.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Ca(e);if(r==="number"&&isFinite(e))return t.long?xa(e):Ra(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Ca(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Oa;case"weeks":case"week":case"w":return r*Sa;case"days":case"day":case"d":return r*se;case"hours":case"hour":case"hrs":case"hr":case"h":return r*me;case"minutes":case"minute":case"mins":case"min":case"m":return r*he;case"seconds":case"second":case"secs":case"sec":case"s":return r*de;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Ra(e){var t=Math.abs(e);return t>=se?Math.round(e/se)+"d":t>=me?Math.round(e/me)+"h":t>=he?Math.round(e/he)+"m":t>=de?Math.round(e/de)+"s":e+"ms"}function xa(e){var t=Math.abs(e);return t>=se?He(e,t,se,"day"):t>=me?He(e,t,me,"hour"):t>=he?He(e,t,he,"minute"):t>=de?He(e,t,de,"second"):e+" ms"}function He(e,t,r,n){var s=t>=r*1.5;return Math.round(e/r)+" "+n+(s?"s":"")}});var Ft=v((tp,_n)=>{function Fa(e){r.debug=r,r.default=r,r.coerce=c,r.disable=o,r.enable=s,r.enabled=a,r.humanize=bn(),r.destroy=p,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function t(u){let d=0;for(let m=0;m<u.length;m++)d=(d<<5)-d+u.charCodeAt(m),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=t;function r(u){let d,m=null,h,U;function R(...N){if(!R.enabled)return;let Q=R,le=Number(new Date),bt=le-(d||le);Q.diff=bt,Q.prev=d,Q.curr=le,d=le,N[0]=r.coerce(N[0]),typeof N[0]!="string"&&N.unshift("%O");let fe=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(ve,_t)=>{if(ve==="%%")return"%";fe++;let Pe=r.formatters[_t];if(typeof Pe=="function"){let wt=N[fe];ve=Pe.call(Q,wt),N.splice(fe,1),fe--}return ve}),r.formatArgs.call(Q,N),(Q.log||r.log).apply(Q,N)}return R.namespace=u,R.useColors=r.useColors(),R.color=r.selectColor(u),R.extend=n,R.destroy=r.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==r.namespaces&&(h=r.namespaces,U=r.enabled(u)),U),set:N=>{m=N}}),typeof r.init=="function"&&r.init(R),R}function n(u,d){let m=r(this.namespace+(typeof d>"u"?":":d)+u);return m.log=this.log,m}function s(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let m of d)m[0]==="-"?r.skips.push(m.slice(1)):r.names.push(m)}function i(u,d){let m=0,h=0,U=-1,R=0;for(;m<u.length;)if(h<d.length&&(d[h]===u[m]||d[h]==="*"))d[h]==="*"?(U=h,R=m,h++):(m++,h++);else if(U!==-1)h=U+1,R++,m=R;else return!1;for(;h<d.length&&d[h]==="*";)h++;return h===d.length}function o(){let u=[...r.names,...r.skips.map(d=>"-"+d)].join(",");return r.enable(""),u}function a(u){for(let d of r.skips)if(i(u,d))return!1;for(let d of r.names)if(i(u,d))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function p(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}_n.exports=Fa});var wn=v((P,ze)=>{P.formatArgs=Ia;P.save=Da;P.load=Ma;P.useColors=Aa;P.storage=Na();P.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Aa(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ia(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+ze.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),e.splice(n,0,t)}P.log=console.debug||console.log||(()=>{});function Da(e){try{e?P.storage.setItem("debug",e):P.storage.removeItem("debug")}catch{}}function Ma(){let e;try{e=P.storage.getItem("debug")||P.storage.getItem("DEBUG")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function Na(){try{return localStorage}catch{}}ze.exports=Ft()(P);var{formatters:Pa}=ze.exports;Pa.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var vn=v((x,Ve)=>{var La=require("tty"),We=require("util");x.init=Xa;x.log=qa;x.formatArgs=$a;x.save=Ga;x.load=Ua;x.useColors=ja;x.destroy=We.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");x.colors=[6,2,3,4,5,1];try{let e=require("supports-color");e&&(e.stderr||e).level>=2&&(x.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}x.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(s,i)=>i.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function ja(){return"colors"in x.inspectOpts?!!x.inspectOpts.colors:La.isatty(process.stderr.fd)}function $a(e){let{namespace:t,useColors:r}=this;if(r){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),i=`  ${s};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(s+"m+"+Ve.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=Ba()+t+" "+e[0]}function Ba(){return x.inspectOpts.hideDate?"":new Date().toISOString()+" "}function qa(...e){return process.stderr.write(We.formatWithOptions(x.inspectOpts,...e)+`
`)}function Ga(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function Ua(){return process.env.DEBUG}function Xa(e){e.inspectOpts={};let t=Object.keys(x.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=x.inspectOpts[t[r]]}Ve.exports=Ft()(x);var{formatters:Tn}=Ve.exports;Tn.o=function(e){return this.inspectOpts.colors=this.useColors,We.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Tn.O=function(e){return this.inspectOpts.colors=this.useColors,We.inspect(e,this.inspectOpts)}});var It=v((rp,At)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?At.exports=wn():At.exports=vn()});var En=v(B=>{"use strict";var Ha=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(B,"__esModule",{value:!0});var za=require("fs"),Wa=Ha(It()),ge=Wa.default("@kwsites/file-exists");function Va(e,t,r){ge("checking %s",e);try{let n=za.statSync(e);return n.isFile()&&t?(ge("[OK] path represents a file"),!0):n.isDirectory()&&r?(ge("[OK] path represents a directory"),!0):(ge("[FAIL] path represents something other than a file or directory"),!1)}catch(n){if(n.code==="ENOENT")return ge("[FAIL] path is not accessible: %o",n),!1;throw ge("[FATAL] %o",n),n}}function Ja(e,t=B.READABLE){return Va(e,(t&B.FILE)>0,(t&B.FOLDER)>0)}B.exists=Ja;B.FILE=1;B.FOLDER=2;B.READABLE=B.FILE+B.FOLDER});var kn=v(Je=>{"use strict";function Ya(e){for(var t in e)Je.hasOwnProperty(t)||(Je[t]=e[t])}Object.defineProperty(Je,"__esModule",{value:!0});Ya(En())});var Mt=v(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.createDeferred=ie.deferred=void 0;function Dt(){let e,t,r="pending";return{promise:new Promise((s,i)=>{e=s,t=i}),done(s){r==="pending"&&(r="resolved",e(s))},fail(s){r==="pending"&&(r="rejected",t(s))},get fulfilled(){return r!=="pending"},get status(){return r}}}ie.deferred=Dt;ie.createDeferred=Dt;ie.default=Dt});var bo=v((op,yo)=>{"use strict";var Ka=Object.create,at=Object.defineProperty,Qa=Object.getOwnPropertyDescriptor,rr=Object.getOwnPropertyNames,Za=Object.getPrototypeOf,ec=Object.prototype.hasOwnProperty,l=(e,t)=>function(){return e&&(t=(0,e[rr(e)[0]])(e=0)),t},tc=(e,t)=>function(){return t||(0,e[rr(e)[0]])((t={exports:{}}).exports,t),t.exports},S=(e,t)=>{for(var r in t)at(e,r,{get:t[r],enumerable:!0})},ss=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of rr(t))!ec.call(e,s)&&s!==r&&at(e,s,{get:()=>t[s],enumerable:!(n=Qa(t,s))||n.enumerable});return e},rc=(e,t,r)=>(r=e!=null?Ka(Za(e)):{},ss(t||!e||!e.__esModule?at(r,"default",{value:e,enumerable:!0}):r,e)),k=e=>ss(at({},"__esModule",{value:!0}),e),Y,te=l({"src/lib/errors/git-error.ts"(){"use strict";Y=class extends Error{constructor(e,t){super(t),this.task=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),ce,_e=l({"src/lib/errors/git-response-error.ts"(){"use strict";te(),ce=class extends Y{constructor(e,t){super(void 0,t||String(e)),this.git=e}}}});function is(...e){let t=new String(e);return ct.set(t,e),t}function tt(e){return e instanceof String&&ct.has(e)}function Sn(e){return ct.get(e)||[]}var ct,xe=l({"src/lib/args/pathspec.ts"(){"use strict";ct=new WeakMap}}),nr,nc=l({"src/lib/errors/git-construct-error.ts"(){"use strict";te(),nr=class extends Y{constructor(e,t){super(void 0,t),this.config=e}}}}),z,Fe=l({"src/lib/errors/git-plugin-error.ts"(){"use strict";te(),z=class extends Y{constructor(e,t,r){super(e,r),this.task=e,this.plugin=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),sr,os=l({"src/lib/errors/task-configuration-error.ts"(){"use strict";te(),sr=class extends Y{constructor(e){super(void 0,e)}}}});function as(e){return typeof e!="function"?ue:e}function cs(e){return typeof e=="function"&&e!==ue}function us(e,t){let r=e.indexOf(t);return r<=0?[e,""]:[e.substr(0,r),e.substr(r+1)]}function ls(e,t=0){return fs(e)&&e.length>t?e[t]:void 0}function ae(e,t=0){if(fs(e)&&e.length>t)return e[e.length-1-t]}function fs(e){return pt(e)}function Ae(e="",t=!0,r=`
`){return e.split(r).reduce((n,s)=>{let i=t?s.trim():s;return i&&n.push(i),n},[])}function ir(e,t){return Ae(e,!0).map(r=>t(r))}function or(e){return(0,Gt.exists)(e,Gt.FOLDER)}function w(e,t){return Array.isArray(e)?e.includes(t)||e.push(t):e.add(t),t}function ps(e,t){return Array.isArray(e)&&!e.includes(t)&&e.push(t),e}function ut(e,t){if(Array.isArray(e)){let r=e.indexOf(t);r>=0&&e.splice(r,1)}else e.delete(t);return t}function K(e){return Array.isArray(e)?e:[e]}function ds(e){return e.replace(/[\s-]+(.)/g,(t,r)=>r.toUpperCase())}function we(e){return K(e).map(t=>t instanceof String?t:String(t))}function E(e,t=0){if(e==null)return t;let r=parseInt(e,10);return Number.isNaN(r)?t:r}function Ce(e,t){let r=[];for(let n=0,s=e.length;n<s;n++)r.push(t,e[n]);return r}function Re(e){return(Array.isArray(e)?ms.Buffer.concat(e):e).toString("utf-8")}function hs(e,t){let r={};return t.forEach(n=>{e[n]!==void 0&&(r[n]=e[n])}),r}function Bt(e=0){return new Promise(t=>setTimeout(t,e))}function qt(e){if(e!==!1)return e}var ms,Gt,be,ue,Ie,lt=l({"src/lib/utils/util.ts"(){"use strict";ms=require("node:buffer"),Gt=kn(),ar(),be="\0",ue=()=>{},Ie=Object.prototype.toString.call.bind(Object.prototype.toString)}});function G(e,t,r){return t(e)?e:arguments.length>2?r:void 0}function Ut(e,t){let r=tt(e)?"string":typeof e;return/number|string|boolean/.test(r)&&(!t||!t.includes(r))}function ft(e){return!!e&&Ie(e)==="[object Object]"}function gs(e){return typeof e=="function"}var De,ys,F,rt,pt,ar=l({"src/lib/utils/argument-filters.ts"(){"use strict";xe(),lt(),De=e=>Array.isArray(e),ys=e=>typeof e=="number",F=e=>typeof e=="string",rt=e=>F(e)||Array.isArray(e)&&e.every(F),pt=e=>e==null||"number|boolean|function".includes(typeof e)?!1:typeof e.length=="number"}}),Xt,sc=l({"src/lib/utils/exit-codes.ts"(){"use strict";Xt=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR",e[e.NOT_FOUND=-2]="NOT_FOUND",e[e.UNCLEAN=128]="UNCLEAN",e))(Xt||{})}}),nt,ic=l({"src/lib/utils/git-output-streams.ts"(){"use strict";nt=class bs{constructor(t,r){this.stdOut=t,this.stdErr=r}asStrings(){return new bs(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function oc(){throw new Error("LineParser:useMatches not implemented")}var _,ee,ac=l({"src/lib/utils/line-parser.ts"(){"use strict";_=class{constructor(e,t){this.matches=[],this.useMatches=oc,this.parse=(r,n)=>(this.resetMatches(),this._regExp.every((s,i)=>this.addMatch(s,i,r(i)))?this.useMatches(n,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(e)?e:[e],t&&(this.useMatches=t)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(e,t,r){let n=r&&e.exec(r);return n&&this.pushMatch(t,n),!!n}pushMatch(e,t){this.matches.push(...t.slice(1))}},ee=class extends _{addMatch(e,t,r){return/^remote:\s/.test(String(r))&&super.addMatch(e,t,r)}pushMatch(e,t){(e>0||t.length>1)&&super.pushMatch(e,t)}}}});function _s(...e){let t=process.cwd(),r=Object.assign({baseDir:t,...ws},...e.filter(n=>typeof n=="object"&&n));return r.baseDir=r.baseDir||t,r.trimmed=r.trimmed===!0,r}var ws,cc=l({"src/lib/utils/simple-git-options.ts"(){"use strict";ws={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function cr(e,t=[]){return ft(e)?Object.keys(e).reduce((r,n)=>{let s=e[n];if(tt(s))r.push(s);else if(Ut(s,["boolean"]))r.push(n+"="+s);else if(Array.isArray(s))for(let i of s)Ut(i,["string","number"])||r.push(n+"="+i);else r.push(n);return r},t):t}function L(e,t=0,r=!1){let n=[];for(let s=0,i=t<0?e.length:t;s<i;s++)"string|number".includes(typeof e[s])&&n.push(String(e[s]));return cr(ur(e),n),r||n.push(...uc(e)),n}function uc(e){let t=typeof ae(e)=="function";return we(G(ae(e,t?1:0),De,[]))}function ur(e){let t=gs(ae(e));return G(ae(e,t?1:0),ft)}function O(e,t=!0){let r=as(ae(e));return t||cs(r)?r:void 0}var lc=l({"src/lib/utils/task-options.ts"(){"use strict";ar(),lt(),xe()}});function Ht(e,t){return e(t.stdOut,t.stdErr)}function $(e,t,r,n=!0){return K(r).forEach(s=>{for(let i=Ae(s,n),o=0,a=i.length;o<a;o++){let c=(p=0)=>{if(!(o+p>=a))return i[o+p]};t.some(({parse:p})=>p(c,e))}}),e}var fc=l({"src/lib/utils/task-parser.ts"(){"use strict";lt()}}),Ts={};S(Ts,{ExitCodes:()=>Xt,GitOutputStreams:()=>nt,LineParser:()=>_,NOOP:()=>ue,NULL:()=>be,RemoteLineParser:()=>ee,append:()=>w,appendTaskOptions:()=>cr,asArray:()=>K,asCamelCase:()=>ds,asFunction:()=>as,asNumber:()=>E,asStringArray:()=>we,bufferToString:()=>Re,callTaskParser:()=>Ht,createInstanceConfig:()=>_s,delay:()=>Bt,filterArray:()=>De,filterFunction:()=>gs,filterHasLength:()=>pt,filterNumber:()=>ys,filterPlainObject:()=>ft,filterPrimitives:()=>Ut,filterString:()=>F,filterStringOrStringArray:()=>rt,filterType:()=>G,first:()=>ls,folderExists:()=>or,forEachLineWithContent:()=>ir,getTrailingOptions:()=>L,including:()=>ps,isUserFunction:()=>cs,last:()=>ae,objectToString:()=>Ie,orVoid:()=>qt,parseStringResponse:()=>$,pick:()=>hs,prefixedArray:()=>Ce,remove:()=>ut,splitOn:()=>us,toLinesWithContent:()=>Ae,trailingFunctionArgument:()=>O,trailingOptionsArgument:()=>ur});var b=l({"src/lib/utils/index.ts"(){"use strict";ar(),sc(),ic(),ac(),cc(),lc(),fc(),lt()}}),vs={};S(vs,{CheckRepoActions:()=>st,checkIsBareRepoTask:()=>ks,checkIsRepoRootTask:()=>Es,checkIsRepoTask:()=>pc});function pc(e){switch(e){case"bare":return ks();case"root":return Es()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:dt,parser:lr}}function Es(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:dt,parser(t){return/^\.(git)?$/.test(t.trim())}}}function ks(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:dt,parser:lr}}function dc(e){return/(Not a git repository|Kein Git-Repository)/i.test(String(e))}var st,dt,lr,Ss=l({"src/lib/tasks/check-is-repo.ts"(){"use strict";b(),st=(e=>(e.BARE="bare",e.IN_TREE="tree",e.IS_REPO_ROOT="root",e))(st||{}),dt=({exitCode:e},t,r,n)=>{if(e===128&&dc(t))return r(Buffer.from("false"));n(t)},lr=e=>e.trim()==="true"}});function hc(e,t){let r=new Os(e),n=e?Rs:Cs;return Ae(t).forEach(s=>{let i=s.replace(n,"");r.paths.push(i),(xs.test(i)?r.folders:r.files).push(i)}),r}var Os,Cs,Rs,xs,mc=l({"src/lib/responses/CleanSummary.ts"(){"use strict";b(),Os=class{constructor(e){this.dryRun=e,this.paths=[],this.files=[],this.folders=[]}},Cs=/^[a-z]+\s*/i,Rs=/^[a-z]+\s+[a-z]+\s*/i,xs=/\/$/}}),zt={};S(zt,{EMPTY_COMMANDS:()=>ht,adhocExecTask:()=>Fs,configurationErrorTask:()=>j,isBufferTask:()=>Is,isEmptyTask:()=>Ds,straightThroughBufferTask:()=>As,straightThroughStringTask:()=>D});function Fs(e){return{commands:ht,format:"empty",parser:e}}function j(e){return{commands:ht,format:"empty",parser(){throw typeof e=="string"?new sr(e):e}}}function D(e,t=!1){return{commands:e,format:"utf-8",parser(r){return t?String(r).trim():r}}}function As(e){return{commands:e,format:"buffer",parser(t){return t}}}function Is(e){return e.format==="buffer"}function Ds(e){return e.format==="empty"||!e.commands.length}var ht,C=l({"src/lib/tasks/task.ts"(){"use strict";os(),ht=[]}}),Ms={};S(Ms,{CONFIG_ERROR_INTERACTIVE_MODE:()=>fr,CONFIG_ERROR_MODE_REQUIRED:()=>pr,CONFIG_ERROR_UNKNOWN_OPTION:()=>dr,CleanOptions:()=>Se,cleanTask:()=>Ns,cleanWithOptionsTask:()=>gc,isCleanOptionsArray:()=>yc});function gc(e,t){let{cleanMode:r,options:n,valid:s}=bc(e);return r?s.options?(n.push(...t),n.some(Tc)?j(fr):Ns(r,n)):j(dr+JSON.stringify(e)):j(pr)}function Ns(e,t){return{commands:["clean",`-${e}`,...t],format:"utf-8",parser(n){return hc(e==="n",n)}}}function yc(e){return Array.isArray(e)&&e.every(t=>hr.has(t))}function bc(e){let t,r=[],n={cleanMode:!1,options:!0};return e.replace(/[^a-z]i/g,"").split("").forEach(s=>{_c(s)?(t=s,n.cleanMode=!0):n.options=n.options&&wc(r[r.length]=`-${s}`)}),{cleanMode:t,options:r,valid:n}}function _c(e){return e==="f"||e==="n"}function wc(e){return/^-[a-z]$/i.test(e)&&hr.has(e.charAt(1))}function Tc(e){return/^-[^\-]/.test(e)?e.indexOf("i")>0:e==="--interactive"}var fr,pr,dr,Se,hr,Ps=l({"src/lib/tasks/clean.ts"(){"use strict";mc(),b(),C(),fr="Git clean interactive mode is not supported",pr='Git clean mode parameter ("n" or "f") is required',dr="Git clean unknown option found in: ",Se=(e=>(e.DRY_RUN="n",e.FORCE="f",e.IGNORED_INCLUDED="x",e.IGNORED_ONLY="X",e.EXCLUDING="e",e.QUIET="q",e.RECURSIVE="d",e))(Se||{}),hr=new Set(["i",...we(Object.values(Se))])}});function vc(e){let t=new js;for(let r of Ls(e))t.addValue(r.file,String(r.key),r.value);return t}function Ec(e,t){let r=null,n=[],s=new Map;for(let i of Ls(e,t))i.key===t&&(n.push(r=i.value),s.has(i.file)||s.set(i.file,[]),s.get(i.file).push(r));return{key:t,paths:Array.from(s.keys()),scopes:s,value:r,values:n}}function kc(e){return e.replace(/^(file):/,"")}function*Ls(e,t=null){let r=e.split("\0");for(let n=0,s=r.length-1;n<s;){let i=kc(r[n++]),o=r[n++],a=t;if(o.includes(`
`)){let c=us(o,`
`);a=c[0],o=c[1]}yield{file:i,key:a,value:o}}}var js,Sc=l({"src/lib/responses/ConfigList.ts"(){"use strict";b(),js=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((e,t)=>Object.assign(e,this.values[t]),{})),this._all}addFile(e){if(!(e in this.values)){let t=ae(this.files);this.values[e]=t?Object.create(this.values[t]):{},this.files.push(e)}return this.values[e]}addValue(e,t,r){let n=this.addFile(e);Object.hasOwn(n,t)?Array.isArray(n[t])?n[t].push(r):n[t]=[n[t],r]:n[t]=r,this._all=void 0}}}});function Nt(e,t){return typeof e=="string"&&Object.hasOwn(it,e)?e:t}function Oc(e,t,r,n){let s=["config",`--${n}`];return r&&s.push("--add"),s.push(e,t),{commands:s,format:"utf-8",parser(i){return i}}}function Cc(e,t){let r=["config","--null","--show-origin","--get-all",e];return t&&r.splice(1,0,`--${t}`),{commands:r,format:"utf-8",parser(n){return Ec(n,e)}}}function Rc(e){let t=["config","--list","--show-origin","--null"];return e&&t.push(`--${e}`),{commands:t,format:"utf-8",parser(r){return vc(r)}}}function xc(){return{addConfig(e,t,...r){return this._runTask(Oc(e,t,r[0]===!0,Nt(r[1],"local")),O(arguments))},getConfig(e,t){return this._runTask(Cc(e,Nt(t,void 0)),O(arguments))},listConfig(...e){return this._runTask(Rc(Nt(e[0],void 0)),O(arguments))}}}var it,$s=l({"src/lib/tasks/config.ts"(){"use strict";Sc(),b(),it=(e=>(e.system="system",e.global="global",e.local="local",e.worktree="worktree",e))(it||{})}});function Fc(e){return Bs.has(e)}var Ke,Bs,qs=l({"src/lib/tasks/diff-name-status.ts"(){"use strict";Ke=(e=>(e.ADDED="A",e.COPIED="C",e.DELETED="D",e.MODIFIED="M",e.RENAMED="R",e.CHANGED="T",e.UNMERGED="U",e.UNKNOWN="X",e.BROKEN="B",e))(Ke||{}),Bs=new Set(Object.values(Ke))}});function Gs(...e){return new Xs().param(...e)}function Ac(e){let t=new Set,r={};return ir(e,n=>{let[s,i,o]=n.split(be);t.add(s),(r[s]=r[s]||[]).push({line:E(i),path:s,preview:o})}),{paths:t,results:r}}function Ic(){return{grep(e){let t=O(arguments),r=L(arguments);for(let s of Us)if(r.includes(s))return this._runTask(j(`git.grep: use of "${s}" is not supported.`),t);typeof e=="string"&&(e=Gs().param(e));let n=["grep","--null","-n","--full-name",...r,...e];return this._runTask({commands:n,format:"utf-8",parser(s){return Ac(s)}},t)}}}var Us,ke,On,Xs,Hs=l({"src/lib/tasks/grep.ts"(){"use strict";b(),C(),Us=["-h"],ke=Symbol("grepQuery"),Xs=class{constructor(){this[On]=[]}*[(On=ke,Symbol.iterator)](){for(let e of this[ke])yield e}and(...e){return e.length&&this[ke].push("--and","(",...Ce(e,"-e"),")"),this}param(...e){return this[ke].push(...Ce(e,"-e")),this}}}}),zs={};S(zs,{ResetMode:()=>Oe,getResetMode:()=>Mc,resetTask:()=>Dc});function Dc(e,t){let r=["reset"];return Ws(e)&&r.push(`--${e}`),r.push(...t),D(r)}function Mc(e){if(Ws(e))return e;switch(typeof e){case"string":case"undefined":return"soft"}}function Ws(e){return typeof e=="string"&&Vs.includes(e)}var Oe,Vs,Js=l({"src/lib/tasks/reset.ts"(){"use strict";b(),C(),Oe=(e=>(e.MIXED="mixed",e.SOFT="soft",e.HARD="hard",e.MERGE="merge",e.KEEP="keep",e))(Oe||{}),Vs=we(Object.values(Oe))}}),Ys={};S(Ys,{CheckRepoActions:()=>st,CleanOptions:()=>Se,DiffNameStatus:()=>Ke,GitConfigScope:()=>it,GitConstructError:()=>nr,GitError:()=>Y,GitPluginError:()=>z,GitResponseError:()=>ce,ResetMode:()=>Oe,TaskConfigurationError:()=>sr,grepQueryBuilder:()=>Gs,pathspec:()=>is});var Nc=l({"src/lib/api.ts"(){"use strict";xe(),nc(),te(),Fe(),_e(),os(),Ss(),Ps(),$s(),qs(),Hs(),Js()}});function Pc(e){return e?[{type:"spawn.before",action(n,s){e.aborted&&s.kill(new z(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(n,s){function i(){s.kill(new z(void 0,"abort","Abort signal received"))}e.addEventListener("abort",i),s.spawned.on("close",()=>e.removeEventListener("abort",i))}}]:void 0}var Lc=l({"src/lib/plugins/abort-plugin.ts"(){"use strict";Fe()}});function jc(e){return typeof e=="string"&&e.trim().toLowerCase()==="-c"}function $c(e,t){if(jc(e)&&/^\s*protocol(.[a-z]+)?.allow/.test(t))throw new z(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function Bc(e,t){if(/^\s*--(upload|receive)-pack/.test(e))throw new z(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(t==="clone"&&/^\s*-u\b/.test(e))throw new z(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(t==="push"&&/^\s*--exec\b/.test(e))throw new z(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function qc({allowUnsafeProtocolOverride:e=!1,allowUnsafePack:t=!1}={}){return{type:"spawn.args",action(r,n){return r.forEach((s,i)=>{let o=i<r.length?r[i+1]:"";e||$c(s,o),t||Bc(s,n.method)}),r}}}var Gc=l({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";Fe()}});function Uc(e){let t=Ce(e,"-c");return{type:"spawn.args",action(r){return[...t,...r]}}}var Xc=l({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";b()}});function Hc({onClose:e=!0,onExit:t=50}={}){function r(){let s=-1,i={close:(0,ye.deferred)(),closeTimeout:(0,ye.deferred)(),exit:(0,ye.deferred)(),exitTimeout:(0,ye.deferred)()},o=Promise.race([e===!1?Wt:i.closeTimeout.promise,t===!1?Wt:i.exitTimeout.promise]);return n(e,i.close,i.closeTimeout),n(t,i.exit,i.exitTimeout),{close(a){s=a,i.close.done()},exit(a){s=a,i.exit.done()},get exitCode(){return s},result:o}}function n(s,i,o){s!==!1&&(s===!0?i.promise:i.promise.then(()=>Bt(s))).then(o.done)}return{type:"spawn.after",async action(s,{spawned:i,close:o}){let a=r(),c=!0,p=()=>void(c=!1);i.stdout?.on("data",p),i.stderr?.on("data",p),i.on("error",p),i.on("close",u=>a.close(u)),i.on("exit",u=>a.exit(u));try{await a.result,c&&await Bt(50),o(a.exitCode)}catch(u){o(a.exitCode,u)}}}}var ye,Wt,zc=l({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";ye=Mt(),b(),Wt=(0,ye.deferred)().promise}});function Wc(e){return!e||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(e)}function Cn(e,t){if(e.length<1||e.length>2)throw new z(void 0,"binary",Ks);if(e.some(Wc))if(t)console.warn(Vt);else throw new z(void 0,"binary",Vt);let[n,s]=e;return{binary:n,prefix:s}}function Vc(e,t=["git"],r=!1){let n=Cn(K(t),r);e.on("binary",s=>{n=Cn(K(s),r)}),e.append("spawn.binary",()=>n.binary),e.append("spawn.args",s=>n.prefix?[n.prefix,...s]:s)}var Ks,Vt,Jc=l({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";Fe(),b(),Ks="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",Vt="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function Yc(e){return!!(e.exitCode&&e.stdErr.length)}function Kc(e){return Buffer.concat([...e.stdOut,...e.stdErr])}function Qc(e=!1,t=Yc,r=Kc){return(n,s)=>!e&&n||!t(s)?n:r(s)}function Rn(e){return{type:"task.error",action(t,r){let n=e(t.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(n)?{error:new Y(void 0,n.toString("utf-8"))}:{error:n}}}}var Zc=l({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";te()}}),xn,Qs,eu=l({"src/lib/plugins/plugin-store.ts"(){"use strict";xn=require("node:events"),b(),Qs=class{constructor(){this.plugins=new Set,this.events=new xn.EventEmitter}on(e,t){this.events.on(e,t)}reconfigure(e,t){this.events.emit(e,t)}append(e,t){let r=w(this.plugins,{type:e,action:t});return()=>this.plugins.delete(r)}add(e){let t=[];return K(e).forEach(r=>r&&this.plugins.add(w(t,r))),()=>{t.forEach(r=>this.plugins.delete(r))}}exec(e,t,r){let n=t,s=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===e&&(n=i.action(n,s));return n}}}});function tu(e){let t="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?ps(i,t):i}},{type:"spawn.after",action(i,o){o.commands.includes(t)&&o.spawned.stderr?.on("data",a=>{let c=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));c&&e({method:o.method,stage:ru(c[1]),progress:E(c[2]),processed:E(c[3]),total:E(c[4])})})}}]}function ru(e){return String(e.toLowerCase().split(" ",1))||"unknown"}var nu=l({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";b()}}),su=l({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function iu(e){let t=hs(e,["uid","gid"]);return{type:"spawn.options",action(r){return{...t,...r}}}}var ou=l({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";b()}});function au({block:e,stdErr:t=!0,stdOut:r=!0}){if(e>0)return{type:"spawn.after",action(n,s){let i;function o(){i&&clearTimeout(i),i=setTimeout(c,e)}function a(){s.spawned.stdout?.off("data",o),s.spawned.stderr?.off("data",o),s.spawned.off("exit",a),s.spawned.off("close",a),i&&clearTimeout(i)}function c(){a(),s.kill(new z(void 0,"timeout","block timeout reached"))}r&&s.spawned.stdout?.on("data",o),t&&s.spawned.stderr?.on("data",o),s.spawned.on("exit",a),s.spawned.on("close",a),o()}}}var cu=l({"src/lib/plugins/timout-plugin.ts"(){"use strict";Fe()}}),uu=l({"src/lib/plugins/index.ts"(){"use strict";Lc(),Gc(),Xc(),zc(),Jc(),Zc(),eu(),nu(),su(),ou(),cu()}});function lu(){return{type:"spawn.args",action(e){let t=[],r;function n(s){(r=r||[]).push(...s)}for(let s=0;s<e.length;s++){let i=e[s];if(tt(i)){n(Sn(i));continue}if(i==="--"){n(e.slice(s+1).flatMap(o=>tt(o)&&Sn(o)||o));break}t.push(i)}return r?[...t,"--",...r.map(String)]:t}}}var fu=l({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";xe()}});function pu(){return(0,Qe.default)("simple-git")}function Fn(e,t,r){return!t||!String(t).replace(/\s*/,"")?r?(n,...s)=>{e(n,...s),r(n,...s)}:e:(n,...s)=>{e(`%s ${n}`,t,...s),r&&r(n,...s)}}function du(e,t,{namespace:r}){if(typeof e=="string")return e;let n=t&&t.namespace||"";return n.startsWith(r)?n.substr(r.length+1):n||r}function mr(e,t,r,n=pu()){let s=e&&`[${e}]`||"",i=[],o=typeof t=="string"?n.extend(t):t,a=du(G(t,F),o,n);return p(r);function c(u,d){return w(i,mr(e,a.replace(/^[^:]+/,u),d,n))}function p(u){let d=u&&`[${u}]`||"",m=o&&Fn(o,d)||ue,h=Fn(n,`${s} ${d}`,m);return Object.assign(o?m:h,{label:e,sibling:c,info:h,step:p})}}var Qe,Zs=l({"src/lib/git-logger.ts"(){"use strict";Qe=rc(It()),b(),Qe.default.formatters.L=e=>String(pt(e)?e.length:"-"),Qe.default.formatters.B=e=>Buffer.isBuffer(e)?e.toString("utf8"):Ie(e)}}),ei,hu=l({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";te(),Zs(),ei=class Jt{constructor(t="GitExecutor"){this.logLabel=t,this._queue=new Map}withProgress(t){return this._queue.get(t)}createProgress(t){let r=Jt.getName(t.commands[0]),n=mr(this.logLabel,r);return{task:t,logger:n,name:r}}push(t){let r=this.createProgress(t);return r.logger("Adding task to the queue, commands = %o",t.commands),this._queue.set(t,r),r}fatal(t){for(let[r,{logger:n}]of Array.from(this._queue.entries()))r===t.task?(n.info("Failed %o",t),n("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):n.info("A fatal exception occurred in a previous task, the queue has been purged: %o",t.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(t){this.withProgress(t)&&this._queue.delete(t)}attempt(t){let r=this.withProgress(t);if(!r)throw new Y(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(t="empty"){return`task:${t}:${++Jt.counter}`}static{this.counter=0}}}});function oe(e,t){return{method:ls(e.commands)||"",commands:t}}function mu(e,t){return r=>{t("[ERROR] child process exception %o",r),e.push(Buffer.from(String(r.stack),"ascii"))}}function An(e,t,r,n){return s=>{r("%s received %L bytes",t,s),n("%B",s),e.push(s)}}var In,Yt,gu=l({"src/lib/runners/git-executor-chain.ts"(){"use strict";In=require("child_process"),te(),C(),b(),hu(),Yt=class{constructor(e,t,r){this._executor=e,this._scheduler=t,this._plugins=r,this._chain=Promise.resolve(),this._queue=new ei}get cwd(){return this._cwd||this._executor.cwd}set cwd(e){this._cwd=e}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(e){return this._queue.push(e),this._chain=this._chain.then(()=>this.attemptTask(e))}async attemptTask(e){let t=await this._scheduler.next(),r=()=>this._queue.complete(e);try{let{logger:n}=this._queue.attempt(e);return await(Ds(e)?this.attemptEmptyTask(e,n):this.attemptRemoteTask(e,n))}catch(n){throw this.onFatalException(e,n)}finally{r(),t()}}onFatalException(e,t){let r=t instanceof Y?Object.assign(t,{task:e}):new Y(e,t&&String(t));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(e,t){let r=this._plugins.exec("spawn.binary","",oe(e,e.commands)),n=this._plugins.exec("spawn.args",[...e.commands],oe(e,e.commands)),s=await this.gitResponse(e,r,n,this.outputHandler,t.step("SPAWN")),i=await this.handleTaskData(e,n,s,t.step("HANDLE"));return t("passing response to task's parser as a %s",e.format),Is(e)?Ht(e.parser,i):Ht(e.parser,i.asStrings())}async attemptEmptyTask(e,t){return t("empty task bypassing child process to call to task's parser"),e.parser(this)}handleTaskData(e,t,r,n){let{exitCode:s,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((c,p)=>{n("Preparing to handle process response exitCode=%d stdOut=",s);let{error:u}=this._plugins.exec("task.error",{error:i},{...oe(e,t),...r});if(u&&e.onError)return n.info("exitCode=%s handling with custom error handler"),e.onError(r,u,d=>{n.info("custom error handler treated as success"),n("custom error returned a %s",Ie(d)),c(new nt(Array.isArray(d)?Buffer.concat(d):d,Buffer.concat(a)))},p);if(u)return n.info("handling as error: exitCode=%s stdErr=%s rejection=%o",s,a.length,i),p(u);n.info("retrieving task output complete"),c(new nt(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(e,t,r,n,s){let i=s.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},oe(e,e.commands));return new Promise(a=>{let c=[],p=[];s.info("%s %o",t,r),s("%O",o);let u=this._beforeSpawn(e,r);if(u)return a({stdOut:c,stdErr:p,exitCode:9901,rejection:u});this._plugins.exec("spawn.before",void 0,{...oe(e,r),kill(m){u=m||u}});let d=(0,In.spawn)(t,r,o);d.stdout.on("data",An(c,"stdOut",s,i.step("stdOut"))),d.stderr.on("data",An(p,"stdErr",s,i.step("stdErr"))),d.on("error",mu(p,s)),n&&(s("Passing child process stdOut/stdErr to custom outputHandler"),n(t,d.stdout,d.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...oe(e,r),spawned:d,close(m,h){a({stdOut:c,stdErr:p,exitCode:m,rejection:u||h})},kill(m){d.killed||(u=m,d.kill("SIGINT"))}})})}_beforeSpawn(e,t){let r;return this._plugins.exec("spawn.before",void 0,{...oe(e,t),kill(n){r=n||r}}),r}}}}),ti={};S(ti,{GitExecutor:()=>ri});var ri,yu=l({"src/lib/runners/git-executor.ts"(){"use strict";gu(),ri=class{constructor(e,t,r){this.cwd=e,this._scheduler=t,this._plugins=r,this._chain=new Yt(this,this._scheduler,this._plugins)}chain(){return new Yt(this,this._scheduler,this._plugins)}push(e){return this._chain.push(e)}}}});function bu(e,t,r=ue){let n=i=>{r(null,i)},s=i=>{i?.task===e&&r(i instanceof ce?_u(i):i,void 0)};t.then(n,s)}function _u(e){let t=n=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${n} should be GitResponseError.git.${n}, this will no longer be available in version 3`),t=ue};return Object.create(e,Object.getOwnPropertyNames(e.git).reduce(r,{}));function r(n,s){return s in e||(n[s]={enumerable:!1,configurable:!1,get(){return t(s),e.git[s]}}),n}}var wu=l({"src/lib/task-callback.ts"(){"use strict";_e(),b()}});function Dn(e,t){return Fs(r=>{if(!or(e))throw new Error(`Git.cwd: cannot change to non-directory "${e}"`);return(t||r).cwd=e})}var Tu=l({"src/lib/tasks/change-working-directory.ts"(){"use strict";b(),C()}});function Pt(e){let t=["checkout",...e];return t[1]==="-b"&&t.includes("-B")&&(t[1]=ut(t,"-B")),D(t)}function vu(){return{checkout(){return this._runTask(Pt(L(arguments,1)),O(arguments))},checkoutBranch(e,t){return this._runTask(Pt(["-b",e,t,...L(arguments)]),O(arguments))},checkoutLocalBranch(e){return this._runTask(Pt(["-b",e,...L(arguments)]),O(arguments))}}}var Eu=l({"src/lib/tasks/checkout.ts"(){"use strict";b(),C()}});function ku(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function Su(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(e){return $(ku(),[ni],e)}})}}}var ni,Ou=l({"src/lib/tasks/count-objects.ts"(){"use strict";b(),ni=new _(/([a-z-]+): (\d+)$/,(e,[t,r])=>{let n=ds(t);Object.hasOwn(e,n)&&(e[n]=E(r))})}});function Cu(e){return $({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},si,e)}var si,Ru=l({"src/lib/parsers/parse-commit.ts"(){"use strict";b(),si=[new _(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(e,[t,r,n])=>{e.branch=t,e.commit=n,e.root=!!r}),new _(/\s*Author:\s(.+)/i,(e,[t])=>{let r=t.split("<"),n=r.pop();!n||!n.includes("@")||(e.author={email:n.substr(0,n.length-1),name:r.join("<").trim()})}),new _(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0,e.summary.insertions=parseInt(r,10)||0,e.summary.deletions=parseInt(n,10)||0}),new _(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0;let s=parseInt(r,10)||0;n==="-"?e.summary.deletions=s:n==="+"&&(e.summary.insertions=s)})]}});function xu(e,t,r){return{commands:["-c","core.abbrev=40","commit",...Ce(e,"-m"),...t,...r],format:"utf-8",parser:Cu}}function Fu(){return{commit(t,...r){let n=O(arguments),s=e(t)||xu(K(t),K(G(r[0],rt,[])),[...we(G(r[1],De,[])),...L(arguments,0,!0)]);return this._runTask(s,n)}};function e(t){return!rt(t)&&j("git.commit: requires the commit message to be supplied as a string/string[]")}}var Au=l({"src/lib/tasks/commit.ts"(){"use strict";Ru(),b(),C()}});function Iu(){return{firstCommit(){return this._runTask(D(["rev-list","--max-parents=0","HEAD"],!0),O(arguments))}}}var Du=l({"src/lib/tasks/first-commit.ts"(){"use strict";b(),C()}});function Mu(e,t){let r=["hash-object",e];return t&&r.push("-w"),D(r,!0)}var Nu=l({"src/lib/tasks/hash-object.ts"(){"use strict";C()}});function Pu(e,t,r){let n=String(r).trim(),s;if(s=ii.exec(n))return new Ze(e,t,!1,s[1]);if(s=oi.exec(n))return new Ze(e,t,!0,s[1]);let i="",o=n.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new Ze(e,t,/^re/i.test(n),i)}var Ze,ii,oi,Lu=l({"src/lib/responses/InitSummary.ts"(){"use strict";Ze=class{constructor(e,t,r,n){this.bare=e,this.path=t,this.existing=r,this.gitDir=n}},ii=/^Init.+ repository in (.+)$/,oi=/^Rein.+ in (.+)$/}});function ju(e){return e.includes(gr)}function $u(e=!1,t,r){let n=["init",...r];return e&&!ju(n)&&n.splice(1,0,gr),{commands:n,format:"utf-8",parser(s){return Pu(n.includes("--bare"),t,s)}}}var gr,Bu=l({"src/lib/tasks/init.ts"(){"use strict";Lu(),gr="--bare"}});function yr(e){for(let t=0;t<e.length;t++){let r=br.exec(e[t]);if(r)return`--${r[1]}`}return""}function qu(e){return br.test(e)}var br,Me=l({"src/lib/args/log-format.ts"(){"use strict";br=/^--(stat|numstat|name-only|name-status)(=|$)/}}),ai,Gu=l({"src/lib/responses/DiffSummary.ts"(){"use strict";ai=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function ci(e=""){let t=ui[e];return r=>$(new ai,t,r,!1)}var Lt,Mn,Nn,Pn,ui,li=l({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Me(),Gu(),qs(),b(),Lt=[new _(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(e,[t,r,n=""])=>{e.files.push({file:t.trim(),changes:E(r),insertions:n.replace(/[^+]/g,"").length,deletions:n.replace(/[^-]/g,"").length,binary:!1})}),new _(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(e,[t,r,n])=>{e.files.push({file:t.trim(),before:E(r),after:E(n),binary:!0})}),new _(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(e,[t,r])=>{let n=/(\d+) i/.exec(r),s=/(\d+) d/.exec(r);e.changed=E(t),e.insertions=E(n?.[1]),e.deletions=E(s?.[1])})],Mn=[new _(/(\d+)\t(\d+)\t(.+)$/,(e,[t,r,n])=>{let s=E(t),i=E(r);e.changed++,e.insertions+=s,e.deletions+=i,e.files.push({file:n,changes:s+i,insertions:s,deletions:i,binary:!1})}),new _(/-\t-\t(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,after:0,before:0,binary:!0})})],Nn=[new _(/(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,changes:0,insertions:0,deletions:0,binary:!1})})],Pn=[new _(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(e,[t,r,n,s,i])=>{e.changed++,e.files.push({file:i??n,changes:0,insertions:0,deletions:0,binary:!1,status:qt(Fc(t)&&t),from:qt(!!i&&n!==i&&n),similarity:E(r)})})],ui={"":Lt,"--stat":Lt,"--numstat":Mn,"--name-status":Pn,"--name-only":Nn}}});function Uu(e,t){return t.reduce((r,n,s)=>(r[n]=e[s]||"",r),Object.create({diff:null}))}function fi(e=Tr,t=pi,r=""){let n=ci(r);return function(s){let i=Ae(s.trim(),!1,_r).map(function(o){let a=o.split(wr),c=Uu(a[0].split(e),t);return a.length>1&&a[1].trim()&&(c.diff=n(a[1])),c});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var _r,wr,Tr,pi,di=l({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";b(),li(),Me(),_r="\xF2\xF2\xF2\xF2\xF2\xF2 ",wr=" \xF2\xF2",Tr=" \xF2 ",pi=["hash","date","message","refs","author_name","author_email"]}}),hi={};S(hi,{diffSummaryTask:()=>Xu,validateLogFormatConfig:()=>mt});function Xu(e){let t=yr(e),r=["diff"];return t===""&&(t="--stat",r.push("--stat=4096")),r.push(...e),mt(r)||{commands:r,format:"utf-8",parser:ci(t)}}function mt(e){let t=e.filter(qu);if(t.length>1)return j(`Summary flags are mutually exclusive - pick one of ${t.join(",")}`);if(t.length&&e.includes("-z"))return j(`Summary flag ${t} parsing is not compatible with null termination option '-z'`)}var vr=l({"src/lib/tasks/diff.ts"(){"use strict";Me(),li(),C()}});function Hu(e,t){let r=[],n=[];return Object.keys(e).forEach(s=>{r.push(s),n.push(String(e[s]))}),[r,n.join(t)]}function zu(e){return Object.keys(e).reduce((t,r)=>(r in Kt||(t[r]=e[r]),t),{})}function mi(e={},t=[]){let r=G(e.splitter,F,Tr),n=ft(e.format)?e.format:{hash:"%H",date:e.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:e.multiLine?"%B":"%b",author_name:e.mailMap!==!1?"%aN":"%an",author_email:e.mailMap!==!1?"%aE":"%ae"},[s,i]=Hu(n,r),o=[],a=[`--pretty=format:${_r}${i}${wr}`,...t],c=e.n||e["max-count"]||e.maxCount;if(c&&a.push(`--max-count=${c}`),e.from||e.to){let p=e.symmetric!==!1?"...":"..";o.push(`${e.from||""}${p}${e.to||""}`)}return F(e.file)&&a.push("--follow",is(e.file)),cr(zu(e),a),{fields:s,splitter:r,commands:[...a,...o]}}function Wu(e,t,r){let n=fi(e,t,yr(r));return{commands:["log",...r],format:"utf-8",parser:n}}function Vu(){return{log(...r){let n=O(arguments),s=mi(ur(arguments),we(G(arguments[0],De,[]))),i=t(...r)||mt(s.commands)||e(s);return this._runTask(i,n)}};function e(r){return Wu(r.splitter,r.fields,r.commands)}function t(r,n){return F(r)&&F(n)&&j("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var Kt,gi=l({"src/lib/tasks/log.ts"(){"use strict";Me(),xe(),di(),b(),C(),vr(),Kt=(e=>(e[e["--pretty"]=0]="--pretty",e[e["max-count"]=1]="max-count",e[e.maxCount=2]="maxCount",e[e.n=3]="n",e[e.file=4]="file",e[e.format=5]="format",e[e.from=6]="from",e[e.to=7]="to",e[e.splitter=8]="splitter",e[e.symmetric=9]="symmetric",e[e.mailMap=10]="mailMap",e[e.multiLine=11]="multiLine",e[e.strictDate=12]="strictDate",e))(Kt||{})}}),et,yi,Ju=l({"src/lib/responses/MergeSummary.ts"(){"use strict";et=class{constructor(e,t=null,r){this.reason=e,this.file=t,this.meta=r}toString(){return`${this.file}:${this.reason}`}},yi=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),Qt,bi,Yu=l({"src/lib/responses/PullSummary.ts"(){"use strict";Qt=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},bi=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function jt(e){return e.objects=e.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function Ln(e){let t=/^\s*(\d+)/.exec(e),r=/delta (\d+)/i.exec(e);return{count:E(t&&t[1]||"0"),delta:E(r&&r[1]||"0")}}var _i,Ku=l({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";b(),_i=[new ee(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=jt(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new ee(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=jt(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new ee(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(e,[t,r,n])=>{let s=jt(e.remoteMessages);s.total=Ln(t),s.reused=Ln(r),s.packReused=E(n)})]}});function wi(e,t){return $({remoteMessages:new vi},Ti,t)}var Ti,vi,Ei=l({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";b(),Ku(),Ti=[new ee(/^remote:\s*(.+)$/,(e,[t])=>(e.remoteMessages.all.push(t.trim()),!1)),..._i,new ee([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(e,[t])=>{e.remoteMessages.pullRequestUrl=t}),new ee([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(e,[t,r,n])=>{e.remoteMessages.vulnerabilities={count:E(t),summary:r,url:n}})],vi=class{constructor(){this.all=[]}}}});function Qu(e,t){let r=$(new bi,ki,[e,t]);return r.message&&r}var jn,$n,Bn,qn,ki,Gn,Er,Si=l({"src/lib/parsers/parse-pull.ts"(){"use strict";Yu(),b(),Ei(),jn=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,$n=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,Bn=/^(create|delete) mode \d+ (.+)/,qn=[new _(jn,(e,[t,r,n])=>{e.files.push(t),r&&(e.insertions[t]=r.length),n&&(e.deletions[t]=n.length)}),new _($n,(e,[t,,r,,n])=>r!==void 0||n!==void 0?(e.summary.changes=+t||0,e.summary.insertions=+r||0,e.summary.deletions=+n||0,!0):!1),new _(Bn,(e,[t,r])=>{w(e.files,r),w(t==="create"?e.created:e.deleted,r)})],ki=[new _(/^from\s(.+)$/i,(e,[t])=>void(e.remote=t)),new _(/^fatal:\s(.+)$/,(e,[t])=>void(e.message=t)),new _(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(e,[t,r,n,s])=>{e.branch.local=n,e.hash.local=t,e.branch.remote=s,e.hash.remote=r})],Gn=(e,t)=>$(new Qt,qn,[e,t]),Er=(e,t)=>Object.assign(new Qt,Gn(e,t),wi(e,t))}}),Un,Oi,Xn,Zu=l({"src/lib/parsers/parse-merge.ts"(){"use strict";Ju(),b(),Si(),Un=[new _(/^Auto-merging\s+(.+)$/,(e,[t])=>{e.merges.push(t)}),new _(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(e,[t,r])=>{e.conflicts.push(new et(t,r))}),new _(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(e,[t,r,n])=>{e.conflicts.push(new et(t,r,{deleteRef:n}))}),new _(/^CONFLICT\s+\((.+)\):/,(e,[t])=>{e.conflicts.push(new et(t,null))}),new _(/^Automatic merge failed;\s+(.+)$/,(e,[t])=>{e.result=t})],Oi=(e,t)=>Object.assign(Xn(e,t),Er(e,t)),Xn=e=>$(new yi,Un,e)}});function Hn(e){return e.length?{commands:["merge",...e],format:"utf-8",parser(t,r){let n=Oi(t,r);if(n.failed)throw new ce(n);return n}}:j("Git.merge requires at least one option")}var el=l({"src/lib/tasks/merge.ts"(){"use strict";_e(),Zu(),C()}});function tl(e,t,r){let n=r.includes("deleted"),s=r.includes("tag")||/^refs\/tags/.test(e),i=!r.includes("new");return{deleted:n,tag:s,branch:!s,new:!i,alreadyUpdated:i,local:e,remote:t}}var zn,Ci,Wn,rl=l({"src/lib/parsers/parse-push.ts"(){"use strict";b(),Ei(),zn=[new _(/^Pushing to (.+)$/,(e,[t])=>{e.repo=t}),new _(/^updating local tracking ref '(.+)'/,(e,[t])=>{e.ref={...e.ref||{},local:t}}),new _(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(e,[t,r,n])=>{e.pushed.push(tl(t,r,n))}),new _(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(e,[t,r,n])=>{e.branch={...e.branch||{},local:t,remote:r,remoteName:n}}),new _(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(e,[t,r,n,s])=>{e.update={head:{local:t,remote:r},hash:{from:n,to:s}}})],Ci=(e,t)=>{let r=Wn(e,t),n=wi(e,t);return{...r,...n}},Wn=(e,t)=>$({pushed:[]},zn,[e,t])}}),Ri={};S(Ri,{pushTagsTask:()=>nl,pushTask:()=>kr});function nl(e={},t){return w(t,"--tags"),kr(e,t)}function kr(e={},t){let r=["push",...t];return e.branch&&r.splice(1,0,e.branch),e.remote&&r.splice(1,0,e.remote),ut(r,"-v"),w(r,"--verbose"),w(r,"--porcelain"),{commands:r,format:"utf-8",parser:Ci}}var xi=l({"src/lib/tasks/push.ts"(){"use strict";rl(),b()}});function sl(){return{showBuffer(){let e=["show",...L(arguments,1)];return e.includes("--binary")||e.splice(1,0,"--binary"),this._runTask(As(e),O(arguments))},show(){let e=["show",...L(arguments,1)];return this._runTask(D(e),O(arguments))}}}var il=l({"src/lib/tasks/show.ts"(){"use strict";b(),C()}}),Vn,Fi,ol=l({"src/lib/responses/FileStatusSummary.ts"(){"use strict";Vn=/^(.+)\0(.+)$/,Fi=class{constructor(e,t,r){if(this.path=e,this.index=t,this.working_dir=r,t==="R"||r==="R"){let n=Vn.exec(e)||[null,e,e];this.from=n[2]||"",this.path=n[1]||""}}}}});function Jn(e){let[t,r]=e.split(be);return{from:r||t,to:t}}function q(e,t,r){return[`${e}${t}`,r]}function $t(e,...t){return t.map(r=>q(e,r,(n,s)=>w(n.conflicted,s)))}function al(e,t){let r=t.trim();switch(" "){case r.charAt(2):return n(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return n(" ",r.charAt(0),r.substr(2));default:return}function n(s,i,o){let a=`${s}${i}`,c=Ai.get(a);c&&c(e,o),a!=="##"&&a!=="!!"&&e.files.push(new Fi(o,s,i))}}var Yn,Ai,Ii,cl=l({"src/lib/responses/StatusSummary.ts"(){"use strict";b(),ol(),Yn=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},Ai=new Map([q(" ","A",(e,t)=>w(e.created,t)),q(" ","D",(e,t)=>w(e.deleted,t)),q(" ","M",(e,t)=>w(e.modified,t)),q("A"," ",(e,t)=>w(e.created,t)&&w(e.staged,t)),q("A","M",(e,t)=>w(e.created,t)&&w(e.staged,t)&&w(e.modified,t)),q("D"," ",(e,t)=>w(e.deleted,t)&&w(e.staged,t)),q("M"," ",(e,t)=>w(e.modified,t)&&w(e.staged,t)),q("M","M",(e,t)=>w(e.modified,t)&&w(e.staged,t)),q("R"," ",(e,t)=>{w(e.renamed,Jn(t))}),q("R","M",(e,t)=>{let r=Jn(t);w(e.renamed,r),w(e.modified,r.to)}),q("!","!",(e,t)=>{w(e.ignored=e.ignored||[],t)}),q("?","?",(e,t)=>w(e.not_added,t)),...$t("A","A","U"),...$t("D","D","U"),...$t("U","A","D","U"),["##",(e,t)=>{let r=/ahead (\d+)/,n=/behind (\d+)/,s=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(t);e.ahead=a&&+a[1]||0,a=n.exec(t),e.behind=a&&+a[1]||0,a=s.exec(t),e.current=G(a?.[1],F,null),a=i.exec(t),e.tracking=G(a?.[1],F,null),a=o.exec(t),a&&(e.current=G(a?.[1],F,e.current)),e.detached=/\(no branch\)/.test(t)}]]),Ii=function(e){let t=e.split(be),r=new Yn;for(let n=0,s=t.length;n<s;){let i=t[n++].trim();i&&(i.charAt(0)==="R"&&(i+=be+(t[n++]||"")),al(r,i))}return r}}});function ul(e){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...e.filter(r=>!Di.includes(r))],parser(r){return Ii(r)}}}var Di,ll=l({"src/lib/tasks/status.ts"(){"use strict";cl(),Di=["--null","-z"]}});function ot(e=0,t=0,r=0,n="",s=!0){return Object.defineProperty({major:e,minor:t,patch:r,agent:n,installed:s},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function fl(){return ot(0,0,0,"",!1)}function pl(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:dl,onError(e,t,r,n){if(e.exitCode===-2)return r(Buffer.from(Sr));n(t)}})}}}function dl(e){return e===Sr?fl():$(ot(0,0,0,e),Mi,e)}var Sr,Mi,hl=l({"src/lib/tasks/version.ts"(){"use strict";b(),Sr="installed=false",Mi=[new _(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(e,[t,r,n,s=""])=>{Object.assign(e,ot(E(t),E(r),E(n),s))}),new _(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(e,[t,r,n,s=""])=>{Object.assign(e,ot(E(t),E(r),n,s))})]}}),Ni={};S(Ni,{SimpleGitApi:()=>Zt});var Zt,ml=l({"src/lib/simple-git-api.ts"(){"use strict";wu(),Tu(),Eu(),Ou(),Au(),$s(),Du(),Hs(),Nu(),Bu(),gi(),el(),xi(),il(),ll(),C(),hl(),b(),Zt=class{constructor(e){this._executor=e}_runTask(e,t){let r=this._executor.chain(),n=r.push(e);return t&&bu(e,n,t),Object.create(this,{then:{value:n.then.bind(n)},catch:{value:n.catch.bind(n)},_executor:{value:r}})}add(e){return this._runTask(D(["add",...K(e)]),O(arguments))}cwd(e){let t=O(arguments);return typeof e=="string"?this._runTask(Dn(e,this._executor),t):typeof e?.path=="string"?this._runTask(Dn(e.path,e.root&&this._executor||void 0),t):this._runTask(j("Git.cwd: workingDirectory must be supplied as a string"),t)}hashObject(e,t){return this._runTask(Mu(e,t===!0),O(arguments))}init(e){return this._runTask($u(e===!0,this._executor.cwd,L(arguments)),O(arguments))}merge(){return this._runTask(Hn(L(arguments)),O(arguments))}mergeFromTo(e,t){return F(e)&&F(t)?this._runTask(Hn([e,t,...L(arguments)]),O(arguments,!1)):this._runTask(j("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(e){return this._executor.outputHandler=e,this}push(){let e=kr({remote:G(arguments[0],F),branch:G(arguments[1],F)},L(arguments));return this._runTask(e,O(arguments))}stash(){return this._runTask(D(["stash",...L(arguments)]),O(arguments))}status(){return this._runTask(ul(L(arguments)),O(arguments))}},Object.assign(Zt.prototype,vu(),Fu(),xc(),Su(),Iu(),Ic(),Vu(),sl(),pl())}}),Pi={};S(Pi,{Scheduler:()=>Li});var Kn,Qn,Li,gl=l({"src/lib/runners/scheduler.ts"(){"use strict";b(),Kn=Mt(),Zs(),Qn=(()=>{let e=0;return()=>{e++;let{promise:t,done:r}=(0,Kn.createDeferred)();return{promise:t,done:r,id:e}}})(),Li=class{constructor(e=2){this.concurrency=e,this.logger=mr("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",e)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let e=w(this.running,this.pending.shift());this.logger("Attempting id=%s",e.id),e.done(()=>{this.logger("Completing id=",e.id),ut(this.running,e),this.schedule()})}next(){let{promise:e,id:t}=w(this.pending,Qn());return this.logger("Scheduling id=%s",t),this.schedule(),e}}}}),ji={};S(ji,{applyPatchTask:()=>yl});function yl(e,t){return D(["apply",...t,...e])}var bl=l({"src/lib/tasks/apply-patch.ts"(){"use strict";C()}});function _l(e,t){return{branch:e,hash:t,success:!0}}function wl(e){return{branch:e,hash:null,success:!1}}var $i,Tl=l({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";$i=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Bi(e,t){return t===1&&er.test(e)}var Zn,er,es,gt,vl=l({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";Tl(),b(),Zn=/(\S+)\s+\(\S+\s([^)]+)\)/,er=/^error[^']+'([^']+)'/m,es=[new _(Zn,(e,[t,r])=>{let n=_l(t,r);e.all.push(n),e.branches[t]=n}),new _(er,(e,[t])=>{let r=wl(t);e.errors.push(r),e.all.push(r),e.branches[t]=r})],gt=(e,t)=>$(new $i,es,[e,t])}}),qi,El=l({"src/lib/responses/BranchSummary.ts"(){"use strict";qi=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(e,t,r,n,s){e==="*"&&(this.detached=t,this.current=r),this.all.push(r),this.branches[r]={current:e==="*",linkedWorkTree:e==="+",name:r,commit:n,label:s}}}}});function ts(e){return e?e.charAt(0):""}function Gi(e,t=!1){return $(new qi,t?[Xi]:Ui,e)}var Ui,Xi,kl=l({"src/lib/parsers/parse-branch.ts"(){"use strict";El(),b(),Ui=[new _(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(e,[t,r,n,s])=>{e.push(ts(t),!0,r,n,s)}),new _(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(e,[t,r,n,s])=>{e.push(ts(t),!1,r,n,s)})],Xi=new _(/^(\S+)$/s,(e,[t])=>{e.push("*",!1,t,"","")})}}),Hi={};S(Hi,{branchLocalTask:()=>Ol,branchTask:()=>Sl,containsDeleteBranchCommand:()=>zi,deleteBranchTask:()=>Rl,deleteBranchesTask:()=>Cl});function zi(e){let t=["-d","-D","--delete"];return e.some(r=>t.includes(r))}function Sl(e){let t=zi(e),r=e.includes("--show-current"),n=["branch",...e];return n.length===1&&n.push("-a"),n.includes("-v")||n.splice(1,0,"-v"),{format:"utf-8",commands:n,parser(s,i){return t?gt(s,i).all[0]:Gi(s,r)}}}function Ol(){return{format:"utf-8",commands:["branch","-v"],parser(e){return Gi(e)}}}function Cl(e,t=!1){return{format:"utf-8",commands:["branch","-v",t?"-D":"-d",...e],parser(r,n){return gt(r,n)},onError({exitCode:r,stdOut:n},s,i,o){if(!Bi(String(s),r))return o(s);i(n)}}}function Rl(e,t=!1){let r={format:"utf-8",commands:["branch","-v",t?"-D":"-d",e],parser(n,s){return gt(n,s).branches[e]},onError({exitCode:n,stdErr:s,stdOut:i},o,a,c){if(!Bi(String(o),n))return c(o);throw new ce(r.parser(Re(i),Re(s)),String(o))}};return r}var xl=l({"src/lib/tasks/branch.ts"(){"use strict";_e(),vl(),kl(),b()}});function Fl(e){let t=e.trim().replace(/^["']|["']$/g,"");return t&&(0,Wi.normalize)(t)}var Wi,Vi,Al=l({"src/lib/responses/CheckIgnore.ts"(){"use strict";Wi=require("node:path"),Vi=e=>e.split(/\n/g).map(Fl).filter(Boolean)}}),Ji={};S(Ji,{checkIgnoreTask:()=>Il});function Il(e){return{commands:["check-ignore",...e],format:"utf-8",parser:Vi}}var Dl=l({"src/lib/tasks/check-ignore.ts"(){"use strict";Al()}}),Yi={};S(Yi,{cloneMirrorTask:()=>Nl,cloneTask:()=>Ki});function Ml(e){return/^--upload-pack(=|$)/.test(e)}function Ki(e,t,r){let n=["clone",...r];return F(e)&&n.push(e),F(t)&&n.push(t),n.find(Ml)?j("git.fetch: potential exploit argument blocked."):D(n)}function Nl(e,t,r){return w(r,"--mirror"),Ki(e,t,r)}var Pl=l({"src/lib/tasks/clone.ts"(){"use strict";C(),b()}});function Ll(e,t){return $({raw:e,remote:null,branches:[],tags:[],updated:[],deleted:[]},Qi,[e,t])}var Qi,jl=l({"src/lib/parsers/parse-fetch.ts"(){"use strict";b(),Qi=[new _(/From (.+)$/,(e,[t])=>{e.remote=t}),new _(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.branches.push({name:t,tracking:r})}),new _(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.tags.push({name:t,tracking:r})}),new _(/- \[deleted]\s+\S+\s*-> (.+)$/,(e,[t])=>{e.deleted.push({tracking:t})}),new _(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(e,[t,r,n,s])=>{e.updated.push({name:n,tracking:s,to:r,from:t})})]}}),Zi={};S(Zi,{fetchTask:()=>Bl});function $l(e){return/^--upload-pack(=|$)/.test(e)}function Bl(e,t,r){let n=["fetch",...r];return e&&t&&n.push(e,t),n.find($l)?j("git.fetch: potential exploit argument blocked."):{commands:n,format:"utf-8",parser:Ll}}var ql=l({"src/lib/tasks/fetch.ts"(){"use strict";jl(),C()}});function Gl(e){return $({moves:[]},eo,e)}var eo,Ul=l({"src/lib/parsers/parse-move.ts"(){"use strict";b(),eo=[new _(/^Renaming (.+) to (.+)$/,(e,[t,r])=>{e.moves.push({from:t,to:r})})]}}),to={};S(to,{moveTask:()=>Xl});function Xl(e,t){return{commands:["mv","-v",...K(e),t],format:"utf-8",parser:Gl}}var Hl=l({"src/lib/tasks/move.ts"(){"use strict";Ul(),b()}}),ro={};S(ro,{pullTask:()=>zl});function zl(e,t,r){let n=["pull",...r];return e&&t&&n.splice(1,0,e,t),{commands:n,format:"utf-8",parser(s,i){return Er(s,i)},onError(s,i,o,a){let c=Qu(Re(s.stdOut),Re(s.stdErr));if(c)return a(new ce(c));a(i)}}}var Wl=l({"src/lib/tasks/pull.ts"(){"use strict";_e(),Si(),b()}});function Vl(e){let t={};return no(e,([r])=>t[r]={name:r}),Object.values(t)}function Jl(e){let t={};return no(e,([r,n,s])=>{Object.hasOwn(t,r)||(t[r]={name:r,refs:{fetch:"",push:""}}),s&&n&&(t[r].refs[s.replace(/[^a-z]/g,"")]=n)}),Object.values(t)}function no(e,t){ir(e,r=>t(r.split(/\s+/)))}var Yl=l({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";b()}}),so={};S(so,{addRemoteTask:()=>Kl,getRemotesTask:()=>Ql,listRemotesTask:()=>Zl,remoteTask:()=>ef,removeRemoteTask:()=>tf});function Kl(e,t,r){return D(["remote","add",...r,e,t])}function Ql(e){let t=["remote"];return e&&t.push("-v"),{commands:t,format:"utf-8",parser:e?Jl:Vl}}function Zl(e){let t=[...e];return t[0]!=="ls-remote"&&t.unshift("ls-remote"),D(t)}function ef(e){let t=[...e];return t[0]!=="remote"&&t.unshift("remote"),D(t)}function tf(e){return D(["remote","remove",e])}var rf=l({"src/lib/tasks/remote.ts"(){"use strict";Yl(),C()}}),io={};S(io,{stashListTask:()=>nf});function nf(e={},t){let r=mi(e),n=["stash","list",...r.commands,...t],s=fi(r.splitter,r.fields,yr(n));return mt(n)||{commands:n,format:"utf-8",parser:s}}var sf=l({"src/lib/tasks/stash-list.ts"(){"use strict";Me(),di(),vr(),gi()}}),oo={};S(oo,{addSubModuleTask:()=>of,initSubModuleTask:()=>af,subModuleTask:()=>yt,updateSubModuleTask:()=>cf});function of(e,t){return yt(["add",e,t])}function af(e){return yt(["init",...e])}function yt(e){let t=[...e];return t[0]!=="submodule"&&t.unshift("submodule"),D(t)}function cf(e){return yt(["update",...e])}var uf=l({"src/lib/tasks/sub-module.ts"(){"use strict";C()}});function lf(e,t){let r=Number.isNaN(e),n=Number.isNaN(t);return r!==n?r?1:-1:r?ao(e,t):0}function ao(e,t){return e===t?0:e>t?1:-1}function ff(e){return e.trim()}function Ye(e){return typeof e=="string"&&parseInt(e.replace(/^\D+/g,""),10)||0}var rs,co,pf=l({"src/lib/responses/TagList.ts"(){"use strict";rs=class{constructor(e,t){this.all=e,this.latest=t}},co=function(e,t=!1){let r=e.split(`
`).map(ff).filter(Boolean);t||r.sort(function(s,i){let o=s.split("."),a=i.split(".");if(o.length===1||a.length===1)return lf(Ye(o[0]),Ye(a[0]));for(let c=0,p=Math.max(o.length,a.length);c<p;c++){let u=ao(Ye(o[c]),Ye(a[c]));if(u)return u}return 0});let n=t?r[0]:[...r].reverse().find(s=>s.indexOf(".")>=0);return new rs(r,n)}}}),uo={};S(uo,{addAnnotatedTagTask:()=>mf,addTagTask:()=>hf,tagListTask:()=>df});function df(e=[]){let t=e.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...e],parser(r){return co(r,t)}}}function hf(e){return{format:"utf-8",commands:["tag",e],parser(){return{name:e}}}}function mf(e,t){return{format:"utf-8",commands:["tag","-a","-m",t,e],parser(){return{name:e}}}}var gf=l({"src/lib/tasks/tag.ts"(){"use strict";pf()}}),yf=tc({"src/git.js"(e,t){"use strict";var{GitExecutor:r}=(yu(),k(ti)),{SimpleGitApi:n}=(ml(),k(Ni)),{Scheduler:s}=(gl(),k(Pi)),{configurationErrorTask:i}=(C(),k(zt)),{asArray:o,filterArray:a,filterPrimitives:c,filterString:p,filterStringOrStringArray:u,filterType:d,getTrailingOptions:m,trailingFunctionArgument:h,trailingOptionsArgument:U}=(b(),k(Ts)),{applyPatchTask:R}=(bl(),k(ji)),{branchTask:N,branchLocalTask:Q,deleteBranchesTask:le,deleteBranchTask:bt}=(xl(),k(Hi)),{checkIgnoreTask:fe}=(Dl(),k(Ji)),{checkIsRepoTask:Ar}=(Ss(),k(vs)),{cloneTask:ve,cloneMirrorTask:_t}=(Pl(),k(Yi)),{cleanWithOptionsTask:Pe,isCleanOptionsArray:wt}=(Ps(),k(Ms)),{diffSummaryTask:Co}=(vr(),k(hi)),{fetchTask:Ro}=(ql(),k(Zi)),{moveTask:xo}=(Hl(),k(to)),{pullTask:Fo}=(Wl(),k(ro)),{pushTagsTask:Ao}=(xi(),k(Ri)),{addRemoteTask:Io,getRemotesTask:Do,listRemotesTask:Mo,remoteTask:No,removeRemoteTask:Po}=(rf(),k(so)),{getResetMode:Lo,resetTask:jo}=(Js(),k(zs)),{stashListTask:$o}=(sf(),k(io)),{addSubModuleTask:Bo,initSubModuleTask:qo,subModuleTask:Go,updateSubModuleTask:Uo}=(uf(),k(oo)),{addAnnotatedTagTask:Xo,addTagTask:Ho,tagListTask:zo}=(gf(),k(uo)),{straightThroughBufferTask:Wo,straightThroughStringTask:V}=(C(),k(zt));function y(f,g){this._plugins=g,this._executor=new r(f.baseDir,new s(f.maxConcurrentProcesses),g),this._trimmed=f.trimmed}(y.prototype=Object.create(n.prototype)).constructor=y,y.prototype.customBinary=function(f){return this._plugins.reconfigure("binary",f),this},y.prototype.env=function(f,g){return arguments.length===1&&typeof f=="object"?this._executor.env=f:(this._executor.env=this._executor.env||{})[f]=g,this},y.prototype.stashList=function(f){return this._runTask($o(U(arguments)||{},a(f)&&f||[]),h(arguments))};function Ir(f,g,T,I){return typeof T!="string"?i(`git.${f}() requires a string 'repoPath'`):g(T,d(I,p),m(arguments))}y.prototype.clone=function(){return this._runTask(Ir("clone",ve,...arguments),h(arguments))},y.prototype.mirror=function(){return this._runTask(Ir("mirror",_t,...arguments),h(arguments))},y.prototype.mv=function(f,g){return this._runTask(xo(f,g),h(arguments))},y.prototype.checkoutLatestTag=function(f){var g=this;return this.pull(function(){g.tags(function(T,I){g.checkout(I.latest,f)})})},y.prototype.pull=function(f,g,T,I){return this._runTask(Fo(d(f,p),d(g,p),m(arguments)),h(arguments))},y.prototype.fetch=function(f,g){return this._runTask(Ro(d(f,p),d(g,p),m(arguments)),h(arguments))},y.prototype.silent=function(f){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},y.prototype.tags=function(f,g){return this._runTask(zo(m(arguments)),h(arguments))},y.prototype.rebase=function(){return this._runTask(V(["rebase",...m(arguments)]),h(arguments))},y.prototype.reset=function(f){return this._runTask(jo(Lo(f),m(arguments)),h(arguments))},y.prototype.revert=function(f){let g=h(arguments);return typeof f!="string"?this._runTask(i("Commit must be a string"),g):this._runTask(V(["revert",...m(arguments,0,!0),f]),g)},y.prototype.addTag=function(f){let g=typeof f=="string"?Ho(f):i("Git.addTag requires a tag name");return this._runTask(g,h(arguments))},y.prototype.addAnnotatedTag=function(f,g){return this._runTask(Xo(f,g),h(arguments))},y.prototype.deleteLocalBranch=function(f,g,T){return this._runTask(bt(f,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.deleteLocalBranches=function(f,g,T){return this._runTask(le(f,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.branch=function(f,g){return this._runTask(N(m(arguments)),h(arguments))},y.prototype.branchLocal=function(f){return this._runTask(Q(),h(arguments))},y.prototype.raw=function(f){let g=!Array.isArray(f),T=[].slice.call(g?arguments:f,0);for(let X=0;X<T.length&&g;X++)if(!c(T[X])){T.splice(X,T.length-X);break}T.push(...m(arguments,0,!0));var I=h(arguments);return T.length?this._runTask(V(T,this._trimmed),I):this._runTask(i("Raw: must supply one or more command to execute"),I)},y.prototype.submoduleAdd=function(f,g,T){return this._runTask(Bo(f,g),h(arguments))},y.prototype.submoduleUpdate=function(f,g){return this._runTask(Uo(m(arguments,!0)),h(arguments))},y.prototype.submoduleInit=function(f,g){return this._runTask(qo(m(arguments,!0)),h(arguments))},y.prototype.subModule=function(f,g){return this._runTask(Go(m(arguments)),h(arguments))},y.prototype.listRemote=function(){return this._runTask(Mo(m(arguments)),h(arguments))},y.prototype.addRemote=function(f,g,T){return this._runTask(Io(f,g,m(arguments)),h(arguments))},y.prototype.removeRemote=function(f,g){return this._runTask(Po(f),h(arguments))},y.prototype.getRemotes=function(f,g){return this._runTask(Do(f===!0),h(arguments))},y.prototype.remote=function(f,g){return this._runTask(No(m(arguments)),h(arguments))},y.prototype.tag=function(f,g){let T=m(arguments);return T[0]!=="tag"&&T.unshift("tag"),this._runTask(V(T),h(arguments))},y.prototype.updateServerInfo=function(f){return this._runTask(V(["update-server-info"]),h(arguments))},y.prototype.pushTags=function(f,g){let T=Ao({remote:d(f,p)},m(arguments));return this._runTask(T,h(arguments))},y.prototype.rm=function(f){return this._runTask(V(["rm","-f",...o(f)]),h(arguments))},y.prototype.rmKeepLocal=function(f){return this._runTask(V(["rm","--cached",...o(f)]),h(arguments))},y.prototype.catFile=function(f,g){return this._catFile("utf-8",arguments)},y.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},y.prototype._catFile=function(f,g){var T=h(g),I=["cat-file"],X=g[0];if(typeof X=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),T);Array.isArray(X)&&I.push.apply(I,X);let Tt=f==="buffer"?Wo(I):V(I);return this._runTask(Tt,T)},y.prototype.diff=function(f,g){let T=p(f)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):V(["diff",...m(arguments)]);return this._runTask(T,h(arguments))},y.prototype.diffSummary=function(){return this._runTask(Co(m(arguments,1)),h(arguments))},y.prototype.applyPatch=function(f){let g=u(f)?R(o(f),m([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(g,h(arguments))},y.prototype.revparse=function(){let f=["rev-parse",...m(arguments,!0)];return this._runTask(V(f,!0),h(arguments))},y.prototype.clean=function(f,g,T){let I=wt(f),X=I&&f.join("")||d(f,p)||"",Tt=m([].slice.call(arguments,I?1:0));return this._runTask(Pe(X,Tt),h(arguments))},y.prototype.exec=function(f){let g={commands:[],format:"utf-8",parser(){typeof f=="function"&&f()}};return this._runTask(g)},y.prototype.clearQueue=function(){return this},y.prototype.checkIgnore=function(f,g){return this._runTask(fe(o(d(f,u,[]))),h(arguments))},y.prototype.checkIsRepo=function(f,g){return this._runTask(Ar(d(f,p)),h(arguments))},t.exports=y}}),lo={};S(lo,{esModuleFactory:()=>bf,gitExportFactory:()=>_f,gitInstanceFactory:()=>fo});function bf(e){return Object.defineProperties(e,{__esModule:{value:!0},default:{value:e}})}function _f(e){return Object.assign(e.bind(null),Ys)}function fo(e,t){let r=new Qs,n=_s(e&&(typeof e=="string"?{baseDir:e}:e)||{},t);if(!or(n.baseDir))throw new nr(n,"Cannot use simple-git on a directory that does not exist");return Array.isArray(n.config)&&r.add(Uc(n.config)),r.add(qc(n.unsafe)),r.add(lu()),r.add(Hc(n.completion)),n.abort&&r.add(Pc(n.abort)),n.progress&&r.add(tu(n.progress)),n.timeout&&r.add(au(n.timeout)),n.spawnOptions&&r.add(iu(n.spawnOptions)),r.add(Rn(Qc(!0))),n.errors&&r.add(Rn(n.errors)),Vc(r,n.binary,n.unsafe?.allowUnsafeCustomBinary),new po(n,r)}var po,ho=l({"src/lib/git-factory.ts"(){"use strict";Nc(),uu(),fu(),b(),po=yf()}}),mo={};S(mo,{gitP:()=>wf});function wf(...e){let t,r=Promise.resolve();try{t=fo(...e)}catch(c){r=Promise.reject(c)}function n(){return i}function s(){return r}let i=[...go,...tr].reduce((c,p)=>{let u=tr.includes(p),d=u?o(p,t):a(p,t,c);return Object.defineProperty(c,p,{enumerable:!1,configurable:!1,value:t?d:u?s:n}),c},{});return i;function o(c,p){return function(...u){if(typeof u[u.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+c);return r.then(function(){return new Promise(function(d,m){let h=(U,R)=>{if(U)return m(Tf(U));d(R)};u.push(h),p[c].apply(p,u)})})}}function a(c,p,u){return(...d)=>(p[c](...d),u)}}function Tf(e){return e instanceof Error?e:typeof e=="string"?new Error(e):new ce(e)}var go,tr,vf=l({"src/lib/runners/promise-wrapped.ts"(){"use strict";_e(),ho(),go=["customBinary","env","outputHandler","silent"],tr=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:Ef}=(vf(),k(mo)),{esModuleFactory:kf,gitInstanceFactory:Sf,gitExportFactory:Of}=(ho(),k(lo)),ns=kf(Of(Sf));yo.exports=Object.assign(ns,{gitP:Ef,simpleGit:ns})});var To=v((Mp,wo)=>{var _o=bo(),{execSync:Or}=require("node:child_process"),W=require("node:path"),M=require("node:fs"),Cf=require("node:os"),Rf=W.join(Cf.homedir(),".claude-memory","repo"),xf="claude-memory-storage",Cr=class{constructor(t,r=null,n=xf){this.auth=t,this.repoOwner=r,this.repoName=n,this.syncDir=Rf,this._git=null}get git(){return this._git||(this._git=_o(this.syncDir)),this._git}async ensureRepo(){if(M.existsSync(this.syncDir)&&M.existsSync(W.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),n=JSON.parse(Or(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=n.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let t=await this.auth.getToken();return Or(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${t}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let t=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return Or(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${t}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(t){return console.error("Failed to create repository:",t.message),!1}}async cloneRepo(){let t=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=W.dirname(this.syncDir);M.existsSync(r)||M.mkdirSync(r,{recursive:!0}),await _o().clone(t,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(t){let r=new Date(t.created_at),n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,s=String(r.getDate()).padStart(2,"0"),i=W.join(this.syncDir,"memories",t.container_tag,n);M.existsSync(i)||M.mkdirSync(i,{recursive:!0});let o=`${s}-${t.id}.json`,a=W.join(i,o),c={id:t.id,content:t.content,containerTag:t.container_tag,metadata:typeof t.metadata=="string"?JSON.parse(t.metadata):t.metadata,createdAt:t.created_at,updatedAt:t.updated_at};return M.writeFileSync(a,JSON.stringify(c,null,2)),a}exportMemories(t){let r=[];for(let n of t){let s=this.exportMemory(n);r.push(s)}return r}exportProfiles(t){let r=W.join(this.syncDir,"profiles");M.existsSync(r)||M.mkdirSync(r,{recursive:!0});let n=W.join(r,"user-preferences.json");return M.writeFileSync(n,JSON.stringify(t,null,2)),n}async syncToGitHub(t,r=null){try{await this.ensureRepo();let n=this.exportMemories(t);if(r){let o=this.exportProfiles(r);n.push(o)}if(n.length===0)return{success:!0,synced:0};for(let o of n){let a=W.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(t.map(o=>o.container_tag))].join(", ")} (${t.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:t.length}}catch(n){return console.error("GitHub sync failed:",n.message),{success:!1,error:n.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(t){return t.message.includes("conflict")?{success:!1,conflict:!0,error:t.message}:{success:!1,conflict:!1,error:t.message}}}importMemories(){let t=W.join(this.syncDir,"memories");if(!M.existsSync(t))return[];let r=[],n=s=>{let i=M.readdirSync(s,{withFileTypes:!0});for(let o of i){let a=W.join(s,o.name);if(o.isDirectory())n(a);else if(o.name.endsWith(".json"))try{let c=JSON.parse(M.readFileSync(a,"utf8"));r.push({id:c.id,content:c.content,container_tag:c.containerTag,metadata:JSON.stringify(c.metadata||{}),created_at:c.createdAt,updated_at:c.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(c){console.error(`Failed to parse ${a}:`,c.message)}}};return n(t),r}importProfiles(){let t=W.join(this.syncDir,"profiles","user-preferences.json");if(!M.existsSync(t))return{static:[],dynamic:[]};try{return JSON.parse(M.readFileSync(t,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};wo.exports={GitHubSync:Cr}});var xr=v((Np,ko)=>{var{execSync:vo}=require("node:child_process"),Te=require("node:fs"),Eo=require("node:path"),Ff=require("node:os"),Ne=Eo.join(Ff.homedir(),".claude-memory","github-token.json"),Rr=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return vo("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return vo("gh auth token",{encoding:"utf8"}).trim()}catch(t){console.error("Failed to get gh token:",t.message)}if(Te.existsSync(Ne))return JSON.parse(Te.readFileSync(Ne,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(t){let r=Eo.dirname(Ne);Te.existsSync(r)||Te.mkdirSync(r,{recursive:!0}),Te.writeFileSync(Ne,JSON.stringify({token:t}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||Te.existsSync(Ne)}async initiateDeviceFlow(){let t=require("node:https");return new Promise((r,n)=>{let s=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":s.length,Accept:"application/json"}},o=t.request(i,a=>{let c="";a.on("data",p=>{c+=p}),a.on("end",()=>r(JSON.parse(c)))});o.on("error",n),o.write(s),o.end()})}async pollForToken(t,r=5){let n=require("node:https"),s=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:t,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),c={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},p=n.request(c,u=>{let d="";u.on("data",m=>{d+=m}),u.on("end",()=>{let m=JSON.parse(d);m.access_token?i(m.access_token):m.error==="authorization_pending"?i(null):o(new Error(m.error||"Unknown error"))})});p.on("error",o),p.write(a),p.end()});for(let i=0;i<120;i++){let o=await s();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let t=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${t.verification_uri}`),console.log(`Enter code: ${t.user_code}
`);let r=await this.pollForToken(t.device_code,t.interval);return this.saveToken(r),r}};ko.exports={GitHubAuth:Rr}});var Oo=v((Pp,So)=>{var{SqliteManager:Af}=gn(),{GitHubSync:If}=To(),{GitHubAuth:Df}=xr(),Mf=require("node:crypto"),Fr=class{constructor(t=null){this.db=new Af(t),this.auth=new Df,this.sync=null}async initSync(){this.sync||(this.sync=new If(this.auth))}generateId(t="mem"){return`${t}_${Mf.randomBytes(8).toString("hex")}`}async addMemory(t,r,n={},s=null){let i=s||this.generateId("mem");return this.db.addMemory(i,t,r,n),{id:i,status:"saved",containerTag:r}}async search(t,r=null,n={}){let s=this.db.searchMemories(t,r,n.limit||10);return{results:s.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:s.length}}async getProfile(t,r=null){let n=this.db.getProfile(t),s=null;if(r){let i=this.db.searchMemories(r,t,10);s={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:n.static,dynamic:n.dynamic},searchResults:s}}async listMemories(t,r=20){return{memories:this.db.listMemories(t,r)}}async deleteMemory(t){return this.db.deleteMemory(t),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=this.db.getPendingSync();if(t.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(t);if(r.success){let n=t.map(s=>s.id);this.db.markSynced(n)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=await this.sync.pullFromGitHub();if(!t.success)return t;let r=this.sync.importMemories();for(let n of r)this.db.getMemory(n.id)||this.db.addMemory(n.id,n.content,n.container_tag,JSON.parse(n.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};So.exports={StorageClient:Fr}});var{StorageClient:Nf}=Oo(),{GitHubAuth:Pf}=xr();async function Lf(){try{let e=new Nf,t=new Pf,r=e.db,s=r.db.prepare("SELECT COUNT(*) as count FROM memories").get().count,i=e.db.getPendingSync().length,a=r.db.prepare("SELECT MAX(synced_at) as last_sync FROM memories WHERE synced_at IS NOT NULL").get().last_sync;if(console.log(`## Claude Memory Status
`),console.log("**Local Storage:**"),console.log(`- Total memories: ${s}`),console.log(`- Pending sync: ${i}`),console.log(`- Database: ~/.claude-memory/memories.db
`),console.log("**GitHub Sync:**"),t.isAuthenticated()){if(console.log("- Status: Authenticated \u2713"),a){let c=new Date(a);console.log(`- Last sync: ${c.toLocaleString()}`)}else console.log("- Last sync: Never");console.log("- Repository: ~/.claude-memory/repo")}else console.log("- Status: Not authenticated \u2717"),console.log("- Run `gh auth login` to enable GitHub sync");e.close()}catch(e){console.error(`Error: ${e.message}`),process.exit(1)}}Lf();
