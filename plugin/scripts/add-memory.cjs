#!/usr/bin/env node
var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var yr=A((Il,_r)=>{var no=require("better-sqlite3"),pe=require("node:path"),gr=require("node:fs"),io=require("node:os"),oo=pe.join(io.homedir(),".claude-memory"),le=pe.join(oo,"memories.db"),fe=class{constructor(e=le){e||(e=le);let r=pe.dirname(e);gr.existsSync(r)||gr.mkdirSync(r,{recursive:!0}),this.db=new no(e),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(e,r,s,n={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(e,r,s,JSON.stringify(n),i,i),{id:e,createdAt:i}}getMemory(e){let s=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(e);return s?.metadata&&(s.metadata=JSON.parse(s.metadata)),s}updateMemory(e,r,s=null){let n=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,n,"pending"];s!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(s))),o.push(e),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(e){this.db.prepare("DELETE FROM memories WHERE id = ?").run(e)}listMemories(e,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(s=>(s.metadata&&(s.metadata=JSON.parse(s.metadata)),s))}markSynced(e){let r=Date.now(),s=e.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${s})
    `).run(r,...e)}searchMemories(e,r=null,s=10){let n=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[e];return r&&(n+=" AND m.container_tag = ?",i.push(r)),n+=" ORDER BY rank LIMIT ?",i.push(s),this.db.prepare(n).all(...i).map(l=>(l.metadata&&(l.metadata=JSON.parse(l.metadata)),l))}getContextMemories(e,r,s=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,Math.floor(s/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,e,Math.floor(s/2)),l=new Set(i.map(f=>f.id)),g=[...i];for(let f of a)l.has(f.id)||(g.push(f),l.add(f.id));return g.slice(0,s).map(f=>(f.metadata&&(f.metadata=JSON.parse(f.metadata)),f))}addProfileFact(e,r,s,n="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(e,r,s,n,i)}getProfile(e,r=5){let n=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r);return{static:n.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(e){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(e)}close(){this.db.close()}};_r.exports={SqliteManager:fe,DEFAULT_DB_PATH:le}});var Tr=A((Pl,br)=>{var ot=1e3,at=ot*60,ct=at*60,V=ct*24,ao=V*7,co=V*365.25;br.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return uo(t);if(r==="number"&&isFinite(t))return e.long?fo(t):lo(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function uo(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*co;case"weeks":case"week":case"w":return r*ao;case"days":case"day":case"d":return r*V;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ct;case"minutes":case"minute":case"mins":case"min":case"m":return r*at;case"seconds":case"second":case"secs":case"sec":case"s":return r*ot;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function lo(t){var e=Math.abs(t);return e>=V?Math.round(t/V)+"d":e>=ct?Math.round(t/ct)+"h":e>=at?Math.round(t/at)+"m":e>=ot?Math.round(t/ot)+"s":t+"ms"}function fo(t){var e=Math.abs(t);return e>=V?At(t,e,V,"day"):e>=ct?At(t,e,ct,"hour"):e>=at?At(t,e,at,"minute"):e>=ot?At(t,e,ot,"second"):t+" ms"}function At(t,e,r,s){var n=e>=r*1.5;return Math.round(t/r)+" "+s+(n?"s":"")}});var de=A((Dl,vr)=>{function po(t){r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=n,r.enabled=a,r.humanize=Tr(),r.destroy=g,Object.keys(t).forEach(f=>{r[f]=t[f]}),r.names=[],r.skips=[],r.formatters={};function e(f){let p=0;for(let d=0;d<f.length;d++)p=(p<<5)-p+f.charCodeAt(d),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=e;function r(f){let p,d=null,h,U;function R(...I){if(!R.enabled)return;let J=R,nt=Number(new Date),oe=nt-(p||nt);J.diff=oe,J.prev=p,J.curr=nt,p=nt,I[0]=r.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let it=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(mt,ae)=>{if(mt==="%%")return"%";it++;let Ft=r.formatters[ae];if(typeof Ft=="function"){let ce=I[it];mt=Ft.call(J,ce),I.splice(it,1),it--}return mt}),r.formatArgs.call(J,I),(J.log||r.log).apply(J,I)}return R.namespace=f,R.useColors=r.useColors(),R.color=r.selectColor(f),R.extend=s,R.destroy=r.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==r.namespaces&&(h=r.namespaces,U=r.enabled(f)),U),set:I=>{d=I}}),typeof r.init=="function"&&r.init(R),R}function s(f,p){let d=r(this.namespace+(typeof p>"u"?":":p)+f);return d.log=this.log,d}function n(f){r.save(f),r.namespaces=f,r.names=[],r.skips=[];let p=(typeof f=="string"?f:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let d of p)d[0]==="-"?r.skips.push(d.slice(1)):r.names.push(d)}function i(f,p){let d=0,h=0,U=-1,R=0;for(;d<f.length;)if(h<p.length&&(p[h]===f[d]||p[h]==="*"))p[h]==="*"?(U=h,R=d,h++):(d++,h++);else if(U!==-1)h=U+1,R++,d=R;else return!1;for(;h<p.length&&p[h]==="*";)h++;return h===p.length}function o(){let f=[...r.names,...r.skips.map(p=>"-"+p)].join(",");return r.enable(""),f}function a(f){for(let p of r.skips)if(i(f,p))return!1;for(let p of r.names)if(i(f,p))return!0;return!1}function l(f){return f instanceof Error?f.stack||f.message:f}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}vr.exports=po});var kr=A((P,Mt)=>{P.formatArgs=mo;P.save=go;P.load=_o;P.useColors=ho;P.storage=yo();P.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function ho(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function mo(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Mt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(s=r))}),t.splice(s,0,e)}P.log=console.debug||console.log||(()=>{});function go(t){try{t?P.storage.setItem("debug",t):P.storage.removeItem("debug")}catch{}}function _o(){let t;try{t=P.storage.getItem("debug")||P.storage.getItem("DEBUG")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function yo(){try{return localStorage}catch{}}Mt.exports=de()(P);var{formatters:bo}=Mt.exports;bo.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Er=A((O,It)=>{var To=require("tty"),Nt=require("util");O.init=Ro;O.log=Eo;O.formatArgs=ko;O.save=So;O.load=Co;O.useColors=vo;O.destroy=Nt.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");O.colors=[6,2,3,4,5,1];try{let t=require("supports-color");t&&(t.stderr||t).level>=2&&(O.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}O.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),t[r]=s,t},{});function vo(){return"colors"in O.inspectOpts?!!O.inspectOpts.colors:To.isatty(process.stderr.fd)}function ko(t){let{namespace:e,useColors:r}=this;if(r){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${e} \x1B[0m`;t[0]=i+t[0].split(`
`).join(`
`+i),t.push(n+"m+"+It.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=wo()+e+" "+t[0]}function wo(){return O.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Eo(...t){return process.stderr.write(Nt.formatWithOptions(O.inspectOpts,...t)+`
`)}function So(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function Co(){return process.env.DEBUG}function Ro(t){t.inspectOpts={};let e=Object.keys(O.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=O.inspectOpts[e[r]]}It.exports=de()(O);var{formatters:wr}=It.exports;wr.o=function(t){return this.inspectOpts.colors=this.useColors,Nt.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};wr.O=function(t){return this.inspectOpts.colors=this.useColors,Nt.inspect(t,this.inspectOpts)}});var me=A((Ll,he)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?he.exports=kr():he.exports=Er()});var Sr=A(B=>{"use strict";var Oo=B&&B.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(B,"__esModule",{value:!0});var xo=require("fs"),Fo=Oo(me()),ut=Fo.default("@kwsites/file-exists");function Ao(t,e,r){ut("checking %s",t);try{let s=xo.statSync(t);return s.isFile()&&e?(ut("[OK] path represents a file"),!0):s.isDirectory()&&r?(ut("[OK] path represents a directory"),!0):(ut("[FAIL] path represents something other than a file or directory"),!1)}catch(s){if(s.code==="ENOENT")return ut("[FAIL] path is not accessible: %o",s),!1;throw ut("[FATAL] %o",s),s}}function Mo(t,e=B.READABLE){return Ao(t,(e&B.FILE)>0,(e&B.FOLDER)>0)}B.exists=Mo;B.FILE=1;B.FOLDER=2;B.READABLE=B.FILE+B.FOLDER});var Cr=A(Pt=>{"use strict";function No(t){for(var e in t)Pt.hasOwnProperty(e)||(Pt[e]=t[e])}Object.defineProperty(Pt,"__esModule",{value:!0});No(Sr())});var _e=A(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.createDeferred=Z.deferred=void 0;function ge(){let t,e,r="pending";return{promise:new Promise((n,i)=>{t=n,e=i}),done(n){r==="pending"&&(r="resolved",t(n))},fail(n){r==="pending"&&(r="rejected",e(n))},get fulfilled(){return r!=="pending"},get status(){return r}}}Z.deferred=ge;Z.createDeferred=ge;Z.default=ge});var Ti=A((Gl,bi)=>{"use strict";var Io=Object.create,zt=Object.defineProperty,Po=Object.getOwnPropertyDescriptor,Be=Object.getOwnPropertyNames,Do=Object.getPrototypeOf,Lo=Object.prototype.hasOwnProperty,c=(t,e)=>function(){return t&&(e=(0,t[Be(t)[0]])(t=0)),e},jo=(t,e)=>function(){return e||(0,t[Be(t)[0]])((e={exports:{}}).exports,e),e.exports},E=(t,e)=>{for(var r in e)zt(t,r,{get:e[r],enumerable:!0})},os=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Be(e))!Lo.call(t,n)&&n!==r&&zt(t,n,{get:()=>e[n],enumerable:!(s=Po(e,n))||s.enumerable});return t},Bo=(t,e,r)=>(r=t!=null?Io(Do(t)):{},os(e||!t||!t.__esModule?zt(r,"default",{value:t,enumerable:!0}):r,t)),w=t=>os(zt({},"__esModule",{value:!0}),t),z,Q=c({"src/lib/errors/git-error.ts"(){"use strict";z=class extends Error{constructor(t,e){super(e),this.task=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),rt,pt=c({"src/lib/errors/git-response-error.ts"(){"use strict";Q(),rt=class extends z{constructor(t,e){super(void 0,e||String(t)),this.git=t}}}});function as(...t){let e=new String(t);return Yt.set(e,t),e}function Gt(t){return t instanceof String&&Yt.has(t)}function Rr(t){return Yt.get(t)||[]}var Yt,vt=c({"src/lib/args/pathspec.ts"(){"use strict";Yt=new WeakMap}}),$e,$o=c({"src/lib/errors/git-construct-error.ts"(){"use strict";Q(),$e=class extends z{constructor(t,e){super(void 0,e),this.config=t}}}}),X,kt=c({"src/lib/errors/git-plugin-error.ts"(){"use strict";Q(),X=class extends z{constructor(t,e,r){super(t,r),this.task=t,this.plugin=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),Ge,cs=c({"src/lib/errors/task-configuration-error.ts"(){"use strict";Q(),Ge=class extends z{constructor(t){super(void 0,t)}}}});function us(t){return typeof t!="function"?st:t}function ls(t){return typeof t=="function"&&t!==st}function fs(t,e){let r=t.indexOf(e);return r<=0?[t,""]:[t.substr(0,r),t.substr(r+1)]}function ps(t,e=0){return ds(t)&&t.length>e?t[e]:void 0}function et(t,e=0){if(ds(t)&&t.length>e)return t[t.length-1-e]}function ds(t){return Vt(t)}function wt(t="",e=!0,r=`
`){return t.split(r).reduce((s,n)=>{let i=e?n.trim():n;return i&&s.push(i),s},[])}function Ue(t,e){return wt(t,!0).map(r=>e(r))}function qe(t){return(0,Se.exists)(t,Se.FOLDER)}function T(t,e){return Array.isArray(t)?t.includes(e)||t.push(e):t.add(e),e}function hs(t,e){return Array.isArray(t)&&!t.includes(e)&&t.push(e),t}function Jt(t,e){if(Array.isArray(t)){let r=t.indexOf(e);r>=0&&t.splice(r,1)}else t.delete(e);return e}function Y(t){return Array.isArray(t)?t:[t]}function ms(t){return t.replace(/[\s-]+(.)/g,(e,r)=>r.toUpperCase())}function dt(t){return Y(t).map(e=>e instanceof String?e:String(e))}function k(t,e=0){if(t==null)return e;let r=parseInt(t,10);return Number.isNaN(r)?e:r}function bt(t,e){let r=[];for(let s=0,n=t.length;s<n;s++)r.push(e,t[s]);return r}function Tt(t){return(Array.isArray(t)?_s.Buffer.concat(t):t).toString("utf-8")}function gs(t,e){let r={};return e.forEach(s=>{t[s]!==void 0&&(r[s]=t[s])}),r}function we(t=0){return new Promise(e=>setTimeout(e,t))}function Ee(t){if(t!==!1)return t}var _s,Se,ft,st,Et,Kt=c({"src/lib/utils/util.ts"(){"use strict";_s=require("node:buffer"),Se=Cr(),Xe(),ft="\0",st=()=>{},Et=Object.prototype.toString.call.bind(Object.prototype.toString)}});function G(t,e,r){return e(t)?t:arguments.length>2?r:void 0}function Ce(t,e){let r=Gt(t)?"string":typeof t;return/number|string|boolean/.test(r)&&(!e||!e.includes(r))}function Qt(t){return!!t&&Et(t)==="[object Object]"}function ys(t){return typeof t=="function"}var St,bs,x,Ut,Vt,Xe=c({"src/lib/utils/argument-filters.ts"(){"use strict";vt(),Kt(),St=t=>Array.isArray(t),bs=t=>typeof t=="number",x=t=>typeof t=="string",Ut=t=>x(t)||Array.isArray(t)&&t.every(x),Vt=t=>t==null||"number|boolean|function".includes(typeof t)?!1:typeof t.length=="number"}}),Re,Go=c({"src/lib/utils/exit-codes.ts"(){"use strict";Re=(t=>(t[t.SUCCESS=0]="SUCCESS",t[t.ERROR=1]="ERROR",t[t.NOT_FOUND=-2]="NOT_FOUND",t[t.UNCLEAN=128]="UNCLEAN",t))(Re||{})}}),qt,Uo=c({"src/lib/utils/git-output-streams.ts"(){"use strict";qt=class Ts{constructor(e,r){this.stdOut=e,this.stdErr=r}asStrings(){return new Ts(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function qo(){throw new Error("LineParser:useMatches not implemented")}var b,K,Xo=c({"src/lib/utils/line-parser.ts"(){"use strict";b=class{constructor(t,e){this.matches=[],this.useMatches=qo,this.parse=(r,s)=>(this.resetMatches(),this._regExp.every((n,i)=>this.addMatch(n,i,r(i)))?this.useMatches(s,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(t)?t:[t],e&&(this.useMatches=e)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(t,e,r){let s=r&&t.exec(r);return s&&this.pushMatch(e,s),!!s}pushMatch(t,e){this.matches.push(...e.slice(1))}},K=class extends b{addMatch(t,e,r){return/^remote:\s/.test(String(r))&&super.addMatch(t,e,r)}pushMatch(t,e){(t>0||e.length>1)&&super.pushMatch(t,e)}}}});function vs(...t){let e=process.cwd(),r=Object.assign({baseDir:e,...ks},...t.filter(s=>typeof s=="object"&&s));return r.baseDir=r.baseDir||e,r.trimmed=r.trimmed===!0,r}var ks,Ho=c({"src/lib/utils/simple-git-options.ts"(){"use strict";ks={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function He(t,e=[]){return Qt(t)?Object.keys(t).reduce((r,s)=>{let n=t[s];if(Gt(n))r.push(n);else if(Ce(n,["boolean"]))r.push(s+"="+n);else if(Array.isArray(n))for(let i of n)Ce(i,["string","number"])||r.push(s+"="+i);else r.push(s);return r},e):e}function D(t,e=0,r=!1){let s=[];for(let n=0,i=e<0?t.length:e;n<i;n++)"string|number".includes(typeof t[n])&&s.push(String(t[n]));return He(We(t),s),r||s.push(...Wo(t)),s}function Wo(t){let e=typeof et(t)=="function";return dt(G(et(t,e?1:0),St,[]))}function We(t){let e=ys(et(t));return G(et(t,e?1:0),Qt)}function S(t,e=!0){let r=us(et(t));return e||ls(r)?r:void 0}var zo=c({"src/lib/utils/task-options.ts"(){"use strict";Xe(),Kt(),vt()}});function Oe(t,e){return t(e.stdOut,e.stdErr)}function j(t,e,r,s=!0){return Y(r).forEach(n=>{for(let i=wt(n,s),o=0,a=i.length;o<a;o++){let l=(g=0)=>{if(!(o+g>=a))return i[o+g]};e.some(({parse:g})=>g(l,t))}}),t}var Yo=c({"src/lib/utils/task-parser.ts"(){"use strict";Kt()}}),ws={};E(ws,{ExitCodes:()=>Re,GitOutputStreams:()=>qt,LineParser:()=>b,NOOP:()=>st,NULL:()=>ft,RemoteLineParser:()=>K,append:()=>T,appendTaskOptions:()=>He,asArray:()=>Y,asCamelCase:()=>ms,asFunction:()=>us,asNumber:()=>k,asStringArray:()=>dt,bufferToString:()=>Tt,callTaskParser:()=>Oe,createInstanceConfig:()=>vs,delay:()=>we,filterArray:()=>St,filterFunction:()=>ys,filterHasLength:()=>Vt,filterNumber:()=>bs,filterPlainObject:()=>Qt,filterPrimitives:()=>Ce,filterString:()=>x,filterStringOrStringArray:()=>Ut,filterType:()=>G,first:()=>ps,folderExists:()=>qe,forEachLineWithContent:()=>Ue,getTrailingOptions:()=>D,including:()=>hs,isUserFunction:()=>ls,last:()=>et,objectToString:()=>Et,orVoid:()=>Ee,parseStringResponse:()=>j,pick:()=>gs,prefixedArray:()=>bt,remove:()=>Jt,splitOn:()=>fs,toLinesWithContent:()=>wt,trailingFunctionArgument:()=>S,trailingOptionsArgument:()=>We});var y=c({"src/lib/utils/index.ts"(){"use strict";Xe(),Go(),Uo(),Xo(),Ho(),zo(),Yo(),Kt()}}),Es={};E(Es,{CheckRepoActions:()=>Xt,checkIsBareRepoTask:()=>Cs,checkIsRepoRootTask:()=>Ss,checkIsRepoTask:()=>Jo});function Jo(t){switch(t){case"bare":return Cs();case"root":return Ss()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:Zt,parser:ze}}function Ss(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:Zt,parser(e){return/^\.(git)?$/.test(e.trim())}}}function Cs(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:Zt,parser:ze}}function Ko(t){return/(Not a git repository|Kein Git-Repository)/i.test(String(t))}var Xt,Zt,ze,Rs=c({"src/lib/tasks/check-is-repo.ts"(){"use strict";y(),Xt=(t=>(t.BARE="bare",t.IN_TREE="tree",t.IS_REPO_ROOT="root",t))(Xt||{}),Zt=({exitCode:t},e,r,s)=>{if(t===128&&Ko(e))return r(Buffer.from("false"));s(e)},ze=t=>t.trim()==="true"}});function Qo(t,e){let r=new Os(t),s=t?Fs:xs;return wt(e).forEach(n=>{let i=n.replace(s,"");r.paths.push(i),(As.test(i)?r.folders:r.files).push(i)}),r}var Os,xs,Fs,As,Vo=c({"src/lib/responses/CleanSummary.ts"(){"use strict";y(),Os=class{constructor(t){this.dryRun=t,this.paths=[],this.files=[],this.folders=[]}},xs=/^[a-z]+\s*/i,Fs=/^[a-z]+\s+[a-z]+\s*/i,As=/\/$/}}),xe={};E(xe,{EMPTY_COMMANDS:()=>te,adhocExecTask:()=>Ms,configurationErrorTask:()=>L,isBufferTask:()=>Is,isEmptyTask:()=>Ps,straightThroughBufferTask:()=>Ns,straightThroughStringTask:()=>M});function Ms(t){return{commands:te,format:"empty",parser:t}}function L(t){return{commands:te,format:"empty",parser(){throw typeof t=="string"?new Ge(t):t}}}function M(t,e=!1){return{commands:t,format:"utf-8",parser(r){return e?String(r).trim():r}}}function Ns(t){return{commands:t,format:"buffer",parser(e){return e}}}function Is(t){return t.format==="buffer"}function Ps(t){return t.format==="empty"||!t.commands.length}var te,C=c({"src/lib/tasks/task.ts"(){"use strict";cs(),te=[]}}),Ds={};E(Ds,{CONFIG_ERROR_INTERACTIVE_MODE:()=>Ye,CONFIG_ERROR_MODE_REQUIRED:()=>Je,CONFIG_ERROR_UNKNOWN_OPTION:()=>Ke,CleanOptions:()=>_t,cleanTask:()=>Ls,cleanWithOptionsTask:()=>Zo,isCleanOptionsArray:()=>ta});function Zo(t,e){let{cleanMode:r,options:s,valid:n}=ea(t);return r?n.options?(s.push(...e),s.some(na)?L(Ye):Ls(r,s)):L(Ke+JSON.stringify(t)):L(Je)}function Ls(t,e){return{commands:["clean",`-${t}`,...e],format:"utf-8",parser(s){return Qo(t==="n",s)}}}function ta(t){return Array.isArray(t)&&t.every(e=>Qe.has(e))}function ea(t){let e,r=[],s={cleanMode:!1,options:!0};return t.replace(/[^a-z]i/g,"").split("").forEach(n=>{ra(n)?(e=n,s.cleanMode=!0):s.options=s.options&&sa(r[r.length]=`-${n}`)}),{cleanMode:e,options:r,valid:s}}function ra(t){return t==="f"||t==="n"}function sa(t){return/^-[a-z]$/i.test(t)&&Qe.has(t.charAt(1))}function na(t){return/^-[^\-]/.test(t)?t.indexOf("i")>0:t==="--interactive"}var Ye,Je,Ke,_t,Qe,js=c({"src/lib/tasks/clean.ts"(){"use strict";Vo(),y(),C(),Ye="Git clean interactive mode is not supported",Je='Git clean mode parameter ("n" or "f") is required',Ke="Git clean unknown option found in: ",_t=(t=>(t.DRY_RUN="n",t.FORCE="f",t.IGNORED_INCLUDED="x",t.IGNORED_ONLY="X",t.EXCLUDING="e",t.QUIET="q",t.RECURSIVE="d",t))(_t||{}),Qe=new Set(["i",...dt(Object.values(_t))])}});function ia(t){let e=new $s;for(let r of Bs(t))e.addValue(r.file,String(r.key),r.value);return e}function oa(t,e){let r=null,s=[],n=new Map;for(let i of Bs(t,e))i.key===e&&(s.push(r=i.value),n.has(i.file)||n.set(i.file,[]),n.get(i.file).push(r));return{key:e,paths:Array.from(n.keys()),scopes:n,value:r,values:s}}function aa(t){return t.replace(/^(file):/,"")}function*Bs(t,e=null){let r=t.split("\0");for(let s=0,n=r.length-1;s<n;){let i=aa(r[s++]),o=r[s++],a=e;if(o.includes(`
`)){let l=fs(o,`
`);a=l[0],o=l[1]}yield{file:i,key:a,value:o}}}var $s,ca=c({"src/lib/responses/ConfigList.ts"(){"use strict";y(),$s=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((t,e)=>Object.assign(t,this.values[e]),{})),this._all}addFile(t){if(!(t in this.values)){let e=et(this.files);this.values[t]=e?Object.create(this.values[e]):{},this.files.push(t)}return this.values[t]}addValue(t,e,r){let s=this.addFile(t);Object.hasOwn(s,e)?Array.isArray(s[e])?s[e].push(r):s[e]=[s[e],r]:s[e]=r,this._all=void 0}}}});function ye(t,e){return typeof t=="string"&&Object.hasOwn(Ht,t)?t:e}function ua(t,e,r,s){let n=["config",`--${s}`];return r&&n.push("--add"),n.push(t,e),{commands:n,format:"utf-8",parser(i){return i}}}function la(t,e){let r=["config","--null","--show-origin","--get-all",t];return e&&r.splice(1,0,`--${e}`),{commands:r,format:"utf-8",parser(s){return oa(s,t)}}}function fa(t){let e=["config","--list","--show-origin","--null"];return t&&e.push(`--${t}`),{commands:e,format:"utf-8",parser(r){return ia(r)}}}function pa(){return{addConfig(t,e,...r){return this._runTask(ua(t,e,r[0]===!0,ye(r[1],"local")),S(arguments))},getConfig(t,e){return this._runTask(la(t,ye(e,void 0)),S(arguments))},listConfig(...t){return this._runTask(fa(ye(t[0],void 0)),S(arguments))}}}var Ht,Gs=c({"src/lib/tasks/config.ts"(){"use strict";ca(),y(),Ht=(t=>(t.system="system",t.global="global",t.local="local",t.worktree="worktree",t))(Ht||{})}});function da(t){return Us.has(t)}var Lt,Us,qs=c({"src/lib/tasks/diff-name-status.ts"(){"use strict";Lt=(t=>(t.ADDED="A",t.COPIED="C",t.DELETED="D",t.MODIFIED="M",t.RENAMED="R",t.CHANGED="T",t.UNMERGED="U",t.UNKNOWN="X",t.BROKEN="B",t))(Lt||{}),Us=new Set(Object.values(Lt))}});function Xs(...t){return new Ws().param(...t)}function ha(t){let e=new Set,r={};return Ue(t,s=>{let[n,i,o]=s.split(ft);e.add(n),(r[n]=r[n]||[]).push({line:k(i),path:n,preview:o})}),{paths:e,results:r}}function ma(){return{grep(t){let e=S(arguments),r=D(arguments);for(let n of Hs)if(r.includes(n))return this._runTask(L(`git.grep: use of "${n}" is not supported.`),e);typeof t=="string"&&(t=Xs().param(t));let s=["grep","--null","-n","--full-name",...r,...t];return this._runTask({commands:s,format:"utf-8",parser(n){return ha(n)}},e)}}}var Hs,gt,Or,Ws,zs=c({"src/lib/tasks/grep.ts"(){"use strict";y(),C(),Hs=["-h"],gt=Symbol("grepQuery"),Ws=class{constructor(){this[Or]=[]}*[(Or=gt,Symbol.iterator)](){for(let t of this[gt])yield t}and(...t){return t.length&&this[gt].push("--and","(",...bt(t,"-e"),")"),this}param(...t){return this[gt].push(...bt(t,"-e")),this}}}}),Ys={};E(Ys,{ResetMode:()=>yt,getResetMode:()=>_a,resetTask:()=>ga});function ga(t,e){let r=["reset"];return Js(t)&&r.push(`--${t}`),r.push(...e),M(r)}function _a(t){if(Js(t))return t;switch(typeof t){case"string":case"undefined":return"soft"}}function Js(t){return typeof t=="string"&&Ks.includes(t)}var yt,Ks,Qs=c({"src/lib/tasks/reset.ts"(){"use strict";y(),C(),yt=(t=>(t.MIXED="mixed",t.SOFT="soft",t.HARD="hard",t.MERGE="merge",t.KEEP="keep",t))(yt||{}),Ks=dt(Object.values(yt))}}),Vs={};E(Vs,{CheckRepoActions:()=>Xt,CleanOptions:()=>_t,DiffNameStatus:()=>Lt,GitConfigScope:()=>Ht,GitConstructError:()=>$e,GitError:()=>z,GitPluginError:()=>X,GitResponseError:()=>rt,ResetMode:()=>yt,TaskConfigurationError:()=>Ge,grepQueryBuilder:()=>Xs,pathspec:()=>as});var ya=c({"src/lib/api.ts"(){"use strict";vt(),$o(),Q(),kt(),pt(),cs(),Rs(),js(),Gs(),qs(),zs(),Qs()}});function ba(t){return t?[{type:"spawn.before",action(s,n){t.aborted&&n.kill(new X(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(s,n){function i(){n.kill(new X(void 0,"abort","Abort signal received"))}t.addEventListener("abort",i),n.spawned.on("close",()=>t.removeEventListener("abort",i))}}]:void 0}var Ta=c({"src/lib/plugins/abort-plugin.ts"(){"use strict";kt()}});function va(t){return typeof t=="string"&&t.trim().toLowerCase()==="-c"}function ka(t,e){if(va(t)&&/^\s*protocol(.[a-z]+)?.allow/.test(e))throw new X(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function wa(t,e){if(/^\s*--(upload|receive)-pack/.test(t))throw new X(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(e==="clone"&&/^\s*-u\b/.test(t))throw new X(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(e==="push"&&/^\s*--exec\b/.test(t))throw new X(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function Ea({allowUnsafeProtocolOverride:t=!1,allowUnsafePack:e=!1}={}){return{type:"spawn.args",action(r,s){return r.forEach((n,i)=>{let o=i<r.length?r[i+1]:"";t||ka(n,o),e||wa(n,s.method)}),r}}}var Sa=c({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";kt()}});function Ca(t){let e=bt(t,"-c");return{type:"spawn.args",action(r){return[...e,...r]}}}var Ra=c({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";y()}});function Oa({onClose:t=!0,onExit:e=50}={}){function r(){let n=-1,i={close:(0,lt.deferred)(),closeTimeout:(0,lt.deferred)(),exit:(0,lt.deferred)(),exitTimeout:(0,lt.deferred)()},o=Promise.race([t===!1?Fe:i.closeTimeout.promise,e===!1?Fe:i.exitTimeout.promise]);return s(t,i.close,i.closeTimeout),s(e,i.exit,i.exitTimeout),{close(a){n=a,i.close.done()},exit(a){n=a,i.exit.done()},get exitCode(){return n},result:o}}function s(n,i,o){n!==!1&&(n===!0?i.promise:i.promise.then(()=>we(n))).then(o.done)}return{type:"spawn.after",async action(n,{spawned:i,close:o}){let a=r(),l=!0,g=()=>void(l=!1);i.stdout?.on("data",g),i.stderr?.on("data",g),i.on("error",g),i.on("close",f=>a.close(f)),i.on("exit",f=>a.exit(f));try{await a.result,l&&await we(50),o(a.exitCode)}catch(f){o(a.exitCode,f)}}}}var lt,Fe,xa=c({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";lt=_e(),y(),Fe=(0,lt.deferred)().promise}});function Fa(t){return!t||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(t)}function xr(t,e){if(t.length<1||t.length>2)throw new X(void 0,"binary",Zs);if(t.some(Fa))if(e)console.warn(Ae);else throw new X(void 0,"binary",Ae);let[s,n]=t;return{binary:s,prefix:n}}function Aa(t,e=["git"],r=!1){let s=xr(Y(e),r);t.on("binary",n=>{s=xr(Y(n),r)}),t.append("spawn.binary",()=>s.binary),t.append("spawn.args",n=>s.prefix?[s.prefix,...n]:n)}var Zs,Ae,Ma=c({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";kt(),y(),Zs="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",Ae="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function Na(t){return!!(t.exitCode&&t.stdErr.length)}function Ia(t){return Buffer.concat([...t.stdOut,...t.stdErr])}function Pa(t=!1,e=Na,r=Ia){return(s,n)=>!t&&s||!e(n)?s:r(n)}function Fr(t){return{type:"task.error",action(e,r){let s=t(e.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(s)?{error:new z(void 0,s.toString("utf-8"))}:{error:s}}}}var Da=c({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";Q()}}),Ar,tn,La=c({"src/lib/plugins/plugin-store.ts"(){"use strict";Ar=require("node:events"),y(),tn=class{constructor(){this.plugins=new Set,this.events=new Ar.EventEmitter}on(t,e){this.events.on(t,e)}reconfigure(t,e){this.events.emit(t,e)}append(t,e){let r=T(this.plugins,{type:t,action:e});return()=>this.plugins.delete(r)}add(t){let e=[];return Y(t).forEach(r=>r&&this.plugins.add(T(e,r))),()=>{e.forEach(r=>this.plugins.delete(r))}}exec(t,e,r){let s=e,n=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===t&&(s=i.action(s,n));return s}}}});function ja(t){let e="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?hs(i,e):i}},{type:"spawn.after",action(i,o){o.commands.includes(e)&&o.spawned.stderr?.on("data",a=>{let l=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));l&&t({method:o.method,stage:Ba(l[1]),progress:k(l[2]),processed:k(l[3]),total:k(l[4])})})}}]}function Ba(t){return String(t.toLowerCase().split(" ",1))||"unknown"}var $a=c({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";y()}}),Ga=c({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function Ua(t){let e=gs(t,["uid","gid"]);return{type:"spawn.options",action(r){return{...e,...r}}}}var qa=c({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";y()}});function Xa({block:t,stdErr:e=!0,stdOut:r=!0}){if(t>0)return{type:"spawn.after",action(s,n){let i;function o(){i&&clearTimeout(i),i=setTimeout(l,t)}function a(){n.spawned.stdout?.off("data",o),n.spawned.stderr?.off("data",o),n.spawned.off("exit",a),n.spawned.off("close",a),i&&clearTimeout(i)}function l(){a(),n.kill(new X(void 0,"timeout","block timeout reached"))}r&&n.spawned.stdout?.on("data",o),e&&n.spawned.stderr?.on("data",o),n.spawned.on("exit",a),n.spawned.on("close",a),o()}}}var Ha=c({"src/lib/plugins/timout-plugin.ts"(){"use strict";kt()}}),Wa=c({"src/lib/plugins/index.ts"(){"use strict";Ta(),Sa(),Ra(),xa(),Ma(),Da(),La(),$a(),Ga(),qa(),Ha()}});function za(){return{type:"spawn.args",action(t){let e=[],r;function s(n){(r=r||[]).push(...n)}for(let n=0;n<t.length;n++){let i=t[n];if(Gt(i)){s(Rr(i));continue}if(i==="--"){s(t.slice(n+1).flatMap(o=>Gt(o)&&Rr(o)||o));break}e.push(i)}return r?[...e,"--",...r.map(String)]:e}}}var Ya=c({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";vt()}});function Ja(){return(0,jt.default)("simple-git")}function Mr(t,e,r){return!e||!String(e).replace(/\s*/,"")?r?(s,...n)=>{t(s,...n),r(s,...n)}:t:(s,...n)=>{t(`%s ${s}`,e,...n),r&&r(s,...n)}}function Ka(t,e,{namespace:r}){if(typeof t=="string")return t;let s=e&&e.namespace||"";return s.startsWith(r)?s.substr(r.length+1):s||r}function Ve(t,e,r,s=Ja()){let n=t&&`[${t}]`||"",i=[],o=typeof e=="string"?s.extend(e):e,a=Ka(G(e,x),o,s);return g(r);function l(f,p){return T(i,Ve(t,a.replace(/^[^:]+/,f),p,s))}function g(f){let p=f&&`[${f}]`||"",d=o&&Mr(o,p)||st,h=Mr(s,`${n} ${p}`,d);return Object.assign(o?d:h,{label:t,sibling:l,info:h,step:g})}}var jt,en=c({"src/lib/git-logger.ts"(){"use strict";jt=Bo(me()),y(),jt.default.formatters.L=t=>String(Vt(t)?t.length:"-"),jt.default.formatters.B=t=>Buffer.isBuffer(t)?t.toString("utf8"):Et(t)}}),rn,Qa=c({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";Q(),en(),rn=class Me{constructor(e="GitExecutor"){this.logLabel=e,this._queue=new Map}withProgress(e){return this._queue.get(e)}createProgress(e){let r=Me.getName(e.commands[0]),s=Ve(this.logLabel,r);return{task:e,logger:s,name:r}}push(e){let r=this.createProgress(e);return r.logger("Adding task to the queue, commands = %o",e.commands),this._queue.set(e,r),r}fatal(e){for(let[r,{logger:s}]of Array.from(this._queue.entries()))r===e.task?(s.info("Failed %o",e),s("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):s.info("A fatal exception occurred in a previous task, the queue has been purged: %o",e.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(e){this.withProgress(e)&&this._queue.delete(e)}attempt(e){let r=this.withProgress(e);if(!r)throw new z(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(e="empty"){return`task:${e}:${++Me.counter}`}static{this.counter=0}}}});function tt(t,e){return{method:ps(t.commands)||"",commands:e}}function Va(t,e){return r=>{e("[ERROR] child process exception %o",r),t.push(Buffer.from(String(r.stack),"ascii"))}}function Nr(t,e,r,s){return n=>{r("%s received %L bytes",e,n),s("%B",n),t.push(n)}}var Ir,Ne,Za=c({"src/lib/runners/git-executor-chain.ts"(){"use strict";Ir=require("child_process"),Q(),C(),y(),Qa(),Ne=class{constructor(t,e,r){this._executor=t,this._scheduler=e,this._plugins=r,this._chain=Promise.resolve(),this._queue=new rn}get cwd(){return this._cwd||this._executor.cwd}set cwd(t){this._cwd=t}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(t){return this._queue.push(t),this._chain=this._chain.then(()=>this.attemptTask(t))}async attemptTask(t){let e=await this._scheduler.next(),r=()=>this._queue.complete(t);try{let{logger:s}=this._queue.attempt(t);return await(Ps(t)?this.attemptEmptyTask(t,s):this.attemptRemoteTask(t,s))}catch(s){throw this.onFatalException(t,s)}finally{r(),e()}}onFatalException(t,e){let r=e instanceof z?Object.assign(e,{task:t}):new z(t,e&&String(e));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(t,e){let r=this._plugins.exec("spawn.binary","",tt(t,t.commands)),s=this._plugins.exec("spawn.args",[...t.commands],tt(t,t.commands)),n=await this.gitResponse(t,r,s,this.outputHandler,e.step("SPAWN")),i=await this.handleTaskData(t,s,n,e.step("HANDLE"));return e("passing response to task's parser as a %s",t.format),Is(t)?Oe(t.parser,i):Oe(t.parser,i.asStrings())}async attemptEmptyTask(t,e){return e("empty task bypassing child process to call to task's parser"),t.parser(this)}handleTaskData(t,e,r,s){let{exitCode:n,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((l,g)=>{s("Preparing to handle process response exitCode=%d stdOut=",n);let{error:f}=this._plugins.exec("task.error",{error:i},{...tt(t,e),...r});if(f&&t.onError)return s.info("exitCode=%s handling with custom error handler"),t.onError(r,f,p=>{s.info("custom error handler treated as success"),s("custom error returned a %s",Et(p)),l(new qt(Array.isArray(p)?Buffer.concat(p):p,Buffer.concat(a)))},g);if(f)return s.info("handling as error: exitCode=%s stdErr=%s rejection=%o",n,a.length,i),g(f);s.info("retrieving task output complete"),l(new qt(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(t,e,r,s,n){let i=n.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},tt(t,t.commands));return new Promise(a=>{let l=[],g=[];n.info("%s %o",e,r),n("%O",o);let f=this._beforeSpawn(t,r);if(f)return a({stdOut:l,stdErr:g,exitCode:9901,rejection:f});this._plugins.exec("spawn.before",void 0,{...tt(t,r),kill(d){f=d||f}});let p=(0,Ir.spawn)(e,r,o);p.stdout.on("data",Nr(l,"stdOut",n,i.step("stdOut"))),p.stderr.on("data",Nr(g,"stdErr",n,i.step("stdErr"))),p.on("error",Va(g,n)),s&&(n("Passing child process stdOut/stdErr to custom outputHandler"),s(e,p.stdout,p.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...tt(t,r),spawned:p,close(d,h){a({stdOut:l,stdErr:g,exitCode:d,rejection:f||h})},kill(d){p.killed||(f=d,p.kill("SIGINT"))}})})}_beforeSpawn(t,e){let r;return this._plugins.exec("spawn.before",void 0,{...tt(t,e),kill(s){r=s||r}}),r}}}}),sn={};E(sn,{GitExecutor:()=>nn});var nn,tc=c({"src/lib/runners/git-executor.ts"(){"use strict";Za(),nn=class{constructor(t,e,r){this.cwd=t,this._scheduler=e,this._plugins=r,this._chain=new Ne(this,this._scheduler,this._plugins)}chain(){return new Ne(this,this._scheduler,this._plugins)}push(t){return this._chain.push(t)}}}});function ec(t,e,r=st){let s=i=>{r(null,i)},n=i=>{i?.task===t&&r(i instanceof rt?rc(i):i,void 0)};e.then(s,n)}function rc(t){let e=s=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${s} should be GitResponseError.git.${s}, this will no longer be available in version 3`),e=st};return Object.create(t,Object.getOwnPropertyNames(t.git).reduce(r,{}));function r(s,n){return n in t||(s[n]={enumerable:!1,configurable:!1,get(){return e(n),t.git[n]}}),s}}var sc=c({"src/lib/task-callback.ts"(){"use strict";pt(),y()}});function Pr(t,e){return Ms(r=>{if(!qe(t))throw new Error(`Git.cwd: cannot change to non-directory "${t}"`);return(e||r).cwd=t})}var nc=c({"src/lib/tasks/change-working-directory.ts"(){"use strict";y(),C()}});function be(t){let e=["checkout",...t];return e[1]==="-b"&&e.includes("-B")&&(e[1]=Jt(e,"-B")),M(e)}function ic(){return{checkout(){return this._runTask(be(D(arguments,1)),S(arguments))},checkoutBranch(t,e){return this._runTask(be(["-b",t,e,...D(arguments)]),S(arguments))},checkoutLocalBranch(t){return this._runTask(be(["-b",t,...D(arguments)]),S(arguments))}}}var oc=c({"src/lib/tasks/checkout.ts"(){"use strict";y(),C()}});function ac(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function cc(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(t){return j(ac(),[on],t)}})}}}var on,uc=c({"src/lib/tasks/count-objects.ts"(){"use strict";y(),on=new b(/([a-z-]+): (\d+)$/,(t,[e,r])=>{let s=ms(e);Object.hasOwn(t,s)&&(t[s]=k(r))})}});function lc(t){return j({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},an,t)}var an,fc=c({"src/lib/parsers/parse-commit.ts"(){"use strict";y(),an=[new b(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(t,[e,r,s])=>{t.branch=e,t.commit=s,t.root=!!r}),new b(/\s*Author:\s(.+)/i,(t,[e])=>{let r=e.split("<"),s=r.pop();!s||!s.includes("@")||(t.author={email:s.substr(0,s.length-1),name:r.join("<").trim()})}),new b(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0,t.summary.insertions=parseInt(r,10)||0,t.summary.deletions=parseInt(s,10)||0}),new b(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0;let n=parseInt(r,10)||0;s==="-"?t.summary.deletions=n:s==="+"&&(t.summary.insertions=n)})]}});function pc(t,e,r){return{commands:["-c","core.abbrev=40","commit",...bt(t,"-m"),...e,...r],format:"utf-8",parser:lc}}function dc(){return{commit(e,...r){let s=S(arguments),n=t(e)||pc(Y(e),Y(G(r[0],Ut,[])),[...dt(G(r[1],St,[])),...D(arguments,0,!0)]);return this._runTask(n,s)}};function t(e){return!Ut(e)&&L("git.commit: requires the commit message to be supplied as a string/string[]")}}var hc=c({"src/lib/tasks/commit.ts"(){"use strict";fc(),y(),C()}});function mc(){return{firstCommit(){return this._runTask(M(["rev-list","--max-parents=0","HEAD"],!0),S(arguments))}}}var gc=c({"src/lib/tasks/first-commit.ts"(){"use strict";y(),C()}});function _c(t,e){let r=["hash-object",t];return e&&r.push("-w"),M(r,!0)}var yc=c({"src/lib/tasks/hash-object.ts"(){"use strict";C()}});function bc(t,e,r){let s=String(r).trim(),n;if(n=cn.exec(s))return new Bt(t,e,!1,n[1]);if(n=un.exec(s))return new Bt(t,e,!0,n[1]);let i="",o=s.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new Bt(t,e,/^re/i.test(s),i)}var Bt,cn,un,Tc=c({"src/lib/responses/InitSummary.ts"(){"use strict";Bt=class{constructor(t,e,r,s){this.bare=t,this.path=e,this.existing=r,this.gitDir=s}},cn=/^Init.+ repository in (.+)$/,un=/^Rein.+ in (.+)$/}});function vc(t){return t.includes(Ze)}function kc(t=!1,e,r){let s=["init",...r];return t&&!vc(s)&&s.splice(1,0,Ze),{commands:s,format:"utf-8",parser(n){return bc(s.includes("--bare"),e,n)}}}var Ze,wc=c({"src/lib/tasks/init.ts"(){"use strict";Tc(),Ze="--bare"}});function tr(t){for(let e=0;e<t.length;e++){let r=er.exec(t[e]);if(r)return`--${r[1]}`}return""}function Ec(t){return er.test(t)}var er,Ct=c({"src/lib/args/log-format.ts"(){"use strict";er=/^--(stat|numstat|name-only|name-status)(=|$)/}}),ln,Sc=c({"src/lib/responses/DiffSummary.ts"(){"use strict";ln=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function fn(t=""){let e=pn[t];return r=>j(new ln,e,r,!1)}var Te,Dr,Lr,jr,pn,dn=c({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Ct(),Sc(),qs(),y(),Te=[new b(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(t,[e,r,s=""])=>{t.files.push({file:e.trim(),changes:k(r),insertions:s.replace(/[^+]/g,"").length,deletions:s.replace(/[^-]/g,"").length,binary:!1})}),new b(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(t,[e,r,s])=>{t.files.push({file:e.trim(),before:k(r),after:k(s),binary:!0})}),new b(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(t,[e,r])=>{let s=/(\d+) i/.exec(r),n=/(\d+) d/.exec(r);t.changed=k(e),t.insertions=k(s?.[1]),t.deletions=k(n?.[1])})],Dr=[new b(/(\d+)\t(\d+)\t(.+)$/,(t,[e,r,s])=>{let n=k(e),i=k(r);t.changed++,t.insertions+=n,t.deletions+=i,t.files.push({file:s,changes:n+i,insertions:n,deletions:i,binary:!1})}),new b(/-\t-\t(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,after:0,before:0,binary:!0})})],Lr=[new b(/(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,changes:0,insertions:0,deletions:0,binary:!1})})],jr=[new b(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(t,[e,r,s,n,i])=>{t.changed++,t.files.push({file:i??s,changes:0,insertions:0,deletions:0,binary:!1,status:Ee(da(e)&&e),from:Ee(!!i&&s!==i&&s),similarity:k(r)})})],pn={"":Te,"--stat":Te,"--numstat":Dr,"--name-status":jr,"--name-only":Lr}}});function Cc(t,e){return e.reduce((r,s,n)=>(r[s]=t[n]||"",r),Object.create({diff:null}))}function hn(t=nr,e=mn,r=""){let s=fn(r);return function(n){let i=wt(n.trim(),!1,rr).map(function(o){let a=o.split(sr),l=Cc(a[0].split(t),e);return a.length>1&&a[1].trim()&&(l.diff=s(a[1])),l});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var rr,sr,nr,mn,gn=c({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";y(),dn(),Ct(),rr="\xF2\xF2\xF2\xF2\xF2\xF2 ",sr=" \xF2\xF2",nr=" \xF2 ",mn=["hash","date","message","refs","author_name","author_email"]}}),_n={};E(_n,{diffSummaryTask:()=>Rc,validateLogFormatConfig:()=>ee});function Rc(t){let e=tr(t),r=["diff"];return e===""&&(e="--stat",r.push("--stat=4096")),r.push(...t),ee(r)||{commands:r,format:"utf-8",parser:fn(e)}}function ee(t){let e=t.filter(Ec);if(e.length>1)return L(`Summary flags are mutually exclusive - pick one of ${e.join(",")}`);if(e.length&&t.includes("-z"))return L(`Summary flag ${e} parsing is not compatible with null termination option '-z'`)}var ir=c({"src/lib/tasks/diff.ts"(){"use strict";Ct(),dn(),C()}});function Oc(t,e){let r=[],s=[];return Object.keys(t).forEach(n=>{r.push(n),s.push(String(t[n]))}),[r,s.join(e)]}function xc(t){return Object.keys(t).reduce((e,r)=>(r in Ie||(e[r]=t[r]),e),{})}function yn(t={},e=[]){let r=G(t.splitter,x,nr),s=Qt(t.format)?t.format:{hash:"%H",date:t.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:t.multiLine?"%B":"%b",author_name:t.mailMap!==!1?"%aN":"%an",author_email:t.mailMap!==!1?"%aE":"%ae"},[n,i]=Oc(s,r),o=[],a=[`--pretty=format:${rr}${i}${sr}`,...e],l=t.n||t["max-count"]||t.maxCount;if(l&&a.push(`--max-count=${l}`),t.from||t.to){let g=t.symmetric!==!1?"...":"..";o.push(`${t.from||""}${g}${t.to||""}`)}return x(t.file)&&a.push("--follow",as(t.file)),He(xc(t),a),{fields:n,splitter:r,commands:[...a,...o]}}function Fc(t,e,r){let s=hn(t,e,tr(r));return{commands:["log",...r],format:"utf-8",parser:s}}function Ac(){return{log(...r){let s=S(arguments),n=yn(We(arguments),dt(G(arguments[0],St,[]))),i=e(...r)||ee(n.commands)||t(n);return this._runTask(i,s)}};function t(r){return Fc(r.splitter,r.fields,r.commands)}function e(r,s){return x(r)&&x(s)&&L("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var Ie,bn=c({"src/lib/tasks/log.ts"(){"use strict";Ct(),vt(),gn(),y(),C(),ir(),Ie=(t=>(t[t["--pretty"]=0]="--pretty",t[t["max-count"]=1]="max-count",t[t.maxCount=2]="maxCount",t[t.n=3]="n",t[t.file=4]="file",t[t.format=5]="format",t[t.from=6]="from",t[t.to=7]="to",t[t.splitter=8]="splitter",t[t.symmetric=9]="symmetric",t[t.mailMap=10]="mailMap",t[t.multiLine=11]="multiLine",t[t.strictDate=12]="strictDate",t))(Ie||{})}}),$t,Tn,Mc=c({"src/lib/responses/MergeSummary.ts"(){"use strict";$t=class{constructor(t,e=null,r){this.reason=t,this.file=e,this.meta=r}toString(){return`${this.file}:${this.reason}`}},Tn=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),Pe,vn,Nc=c({"src/lib/responses/PullSummary.ts"(){"use strict";Pe=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},vn=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function ve(t){return t.objects=t.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function Br(t){let e=/^\s*(\d+)/.exec(t),r=/delta (\d+)/i.exec(t);return{count:k(e&&e[1]||"0"),delta:k(r&&r[1]||"0")}}var kn,Ic=c({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";y(),kn=[new K(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=ve(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new K(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=ve(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new K(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(t,[e,r,s])=>{let n=ve(t.remoteMessages);n.total=Br(e),n.reused=Br(r),n.packReused=k(s)})]}});function wn(t,e){return j({remoteMessages:new Sn},En,e)}var En,Sn,Cn=c({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";y(),Ic(),En=[new K(/^remote:\s*(.+)$/,(t,[e])=>(t.remoteMessages.all.push(e.trim()),!1)),...kn,new K([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(t,[e])=>{t.remoteMessages.pullRequestUrl=e}),new K([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(t,[e,r,s])=>{t.remoteMessages.vulnerabilities={count:k(e),summary:r,url:s}})],Sn=class{constructor(){this.all=[]}}}});function Pc(t,e){let r=j(new vn,Rn,[t,e]);return r.message&&r}var $r,Gr,Ur,qr,Rn,Xr,or,On=c({"src/lib/parsers/parse-pull.ts"(){"use strict";Nc(),y(),Cn(),$r=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,Gr=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,Ur=/^(create|delete) mode \d+ (.+)/,qr=[new b($r,(t,[e,r,s])=>{t.files.push(e),r&&(t.insertions[e]=r.length),s&&(t.deletions[e]=s.length)}),new b(Gr,(t,[e,,r,,s])=>r!==void 0||s!==void 0?(t.summary.changes=+e||0,t.summary.insertions=+r||0,t.summary.deletions=+s||0,!0):!1),new b(Ur,(t,[e,r])=>{T(t.files,r),T(e==="create"?t.created:t.deleted,r)})],Rn=[new b(/^from\s(.+)$/i,(t,[e])=>void(t.remote=e)),new b(/^fatal:\s(.+)$/,(t,[e])=>void(t.message=e)),new b(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(t,[e,r,s,n])=>{t.branch.local=s,t.hash.local=e,t.branch.remote=n,t.hash.remote=r})],Xr=(t,e)=>j(new Pe,qr,[t,e]),or=(t,e)=>Object.assign(new Pe,Xr(t,e),wn(t,e))}}),Hr,xn,Wr,Dc=c({"src/lib/parsers/parse-merge.ts"(){"use strict";Mc(),y(),On(),Hr=[new b(/^Auto-merging\s+(.+)$/,(t,[e])=>{t.merges.push(e)}),new b(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(t,[e,r])=>{t.conflicts.push(new $t(e,r))}),new b(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(t,[e,r,s])=>{t.conflicts.push(new $t(e,r,{deleteRef:s}))}),new b(/^CONFLICT\s+\((.+)\):/,(t,[e])=>{t.conflicts.push(new $t(e,null))}),new b(/^Automatic merge failed;\s+(.+)$/,(t,[e])=>{t.result=e})],xn=(t,e)=>Object.assign(Wr(t,e),or(t,e)),Wr=t=>j(new Tn,Hr,t)}});function zr(t){return t.length?{commands:["merge",...t],format:"utf-8",parser(e,r){let s=xn(e,r);if(s.failed)throw new rt(s);return s}}:L("Git.merge requires at least one option")}var Lc=c({"src/lib/tasks/merge.ts"(){"use strict";pt(),Dc(),C()}});function jc(t,e,r){let s=r.includes("deleted"),n=r.includes("tag")||/^refs\/tags/.test(t),i=!r.includes("new");return{deleted:s,tag:n,branch:!n,new:!i,alreadyUpdated:i,local:t,remote:e}}var Yr,Fn,Jr,Bc=c({"src/lib/parsers/parse-push.ts"(){"use strict";y(),Cn(),Yr=[new b(/^Pushing to (.+)$/,(t,[e])=>{t.repo=e}),new b(/^updating local tracking ref '(.+)'/,(t,[e])=>{t.ref={...t.ref||{},local:e}}),new b(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(t,[e,r,s])=>{t.pushed.push(jc(e,r,s))}),new b(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(t,[e,r,s])=>{t.branch={...t.branch||{},local:e,remote:r,remoteName:s}}),new b(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(t,[e,r,s,n])=>{t.update={head:{local:e,remote:r},hash:{from:s,to:n}}})],Fn=(t,e)=>{let r=Jr(t,e),s=wn(t,e);return{...r,...s}},Jr=(t,e)=>j({pushed:[]},Yr,[t,e])}}),An={};E(An,{pushTagsTask:()=>$c,pushTask:()=>ar});function $c(t={},e){return T(e,"--tags"),ar(t,e)}function ar(t={},e){let r=["push",...e];return t.branch&&r.splice(1,0,t.branch),t.remote&&r.splice(1,0,t.remote),Jt(r,"-v"),T(r,"--verbose"),T(r,"--porcelain"),{commands:r,format:"utf-8",parser:Fn}}var Mn=c({"src/lib/tasks/push.ts"(){"use strict";Bc(),y()}});function Gc(){return{showBuffer(){let t=["show",...D(arguments,1)];return t.includes("--binary")||t.splice(1,0,"--binary"),this._runTask(Ns(t),S(arguments))},show(){let t=["show",...D(arguments,1)];return this._runTask(M(t),S(arguments))}}}var Uc=c({"src/lib/tasks/show.ts"(){"use strict";y(),C()}}),Kr,Nn,qc=c({"src/lib/responses/FileStatusSummary.ts"(){"use strict";Kr=/^(.+)\0(.+)$/,Nn=class{constructor(t,e,r){if(this.path=t,this.index=e,this.working_dir=r,e==="R"||r==="R"){let s=Kr.exec(t)||[null,t,t];this.from=s[2]||"",this.path=s[1]||""}}}}});function Qr(t){let[e,r]=t.split(ft);return{from:r||e,to:e}}function $(t,e,r){return[`${t}${e}`,r]}function ke(t,...e){return e.map(r=>$(t,r,(s,n)=>T(s.conflicted,n)))}function Xc(t,e){let r=e.trim();switch(" "){case r.charAt(2):return s(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return s(" ",r.charAt(0),r.substr(2));default:return}function s(n,i,o){let a=`${n}${i}`,l=In.get(a);l&&l(t,o),a!=="##"&&a!=="!!"&&t.files.push(new Nn(o,n,i))}}var Vr,In,Pn,Hc=c({"src/lib/responses/StatusSummary.ts"(){"use strict";y(),qc(),Vr=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},In=new Map([$(" ","A",(t,e)=>T(t.created,e)),$(" ","D",(t,e)=>T(t.deleted,e)),$(" ","M",(t,e)=>T(t.modified,e)),$("A"," ",(t,e)=>T(t.created,e)&&T(t.staged,e)),$("A","M",(t,e)=>T(t.created,e)&&T(t.staged,e)&&T(t.modified,e)),$("D"," ",(t,e)=>T(t.deleted,e)&&T(t.staged,e)),$("M"," ",(t,e)=>T(t.modified,e)&&T(t.staged,e)),$("M","M",(t,e)=>T(t.modified,e)&&T(t.staged,e)),$("R"," ",(t,e)=>{T(t.renamed,Qr(e))}),$("R","M",(t,e)=>{let r=Qr(e);T(t.renamed,r),T(t.modified,r.to)}),$("!","!",(t,e)=>{T(t.ignored=t.ignored||[],e)}),$("?","?",(t,e)=>T(t.not_added,e)),...ke("A","A","U"),...ke("D","D","U"),...ke("U","A","D","U"),["##",(t,e)=>{let r=/ahead (\d+)/,s=/behind (\d+)/,n=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(e);t.ahead=a&&+a[1]||0,a=s.exec(e),t.behind=a&&+a[1]||0,a=n.exec(e),t.current=G(a?.[1],x,null),a=i.exec(e),t.tracking=G(a?.[1],x,null),a=o.exec(e),a&&(t.current=G(a?.[1],x,t.current)),t.detached=/\(no branch\)/.test(e)}]]),Pn=function(t){let e=t.split(ft),r=new Vr;for(let s=0,n=e.length;s<n;){let i=e[s++].trim();i&&(i.charAt(0)==="R"&&(i+=ft+(e[s++]||"")),Xc(r,i))}return r}}});function Wc(t){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...t.filter(r=>!Dn.includes(r))],parser(r){return Pn(r)}}}var Dn,zc=c({"src/lib/tasks/status.ts"(){"use strict";Hc(),Dn=["--null","-z"]}});function Wt(t=0,e=0,r=0,s="",n=!0){return Object.defineProperty({major:t,minor:e,patch:r,agent:s,installed:n},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function Yc(){return Wt(0,0,0,"",!1)}function Jc(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:Kc,onError(t,e,r,s){if(t.exitCode===-2)return r(Buffer.from(cr));s(e)}})}}}function Kc(t){return t===cr?Yc():j(Wt(0,0,0,t),Ln,t)}var cr,Ln,Qc=c({"src/lib/tasks/version.ts"(){"use strict";y(),cr="installed=false",Ln=[new b(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(t,[e,r,s,n=""])=>{Object.assign(t,Wt(k(e),k(r),k(s),n))}),new b(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(t,[e,r,s,n=""])=>{Object.assign(t,Wt(k(e),k(r),s,n))})]}}),jn={};E(jn,{SimpleGitApi:()=>De});var De,Vc=c({"src/lib/simple-git-api.ts"(){"use strict";sc(),nc(),oc(),uc(),hc(),Gs(),gc(),zs(),yc(),wc(),bn(),Lc(),Mn(),Uc(),zc(),C(),Qc(),y(),De=class{constructor(t){this._executor=t}_runTask(t,e){let r=this._executor.chain(),s=r.push(t);return e&&ec(t,s,e),Object.create(this,{then:{value:s.then.bind(s)},catch:{value:s.catch.bind(s)},_executor:{value:r}})}add(t){return this._runTask(M(["add",...Y(t)]),S(arguments))}cwd(t){let e=S(arguments);return typeof t=="string"?this._runTask(Pr(t,this._executor),e):typeof t?.path=="string"?this._runTask(Pr(t.path,t.root&&this._executor||void 0),e):this._runTask(L("Git.cwd: workingDirectory must be supplied as a string"),e)}hashObject(t,e){return this._runTask(_c(t,e===!0),S(arguments))}init(t){return this._runTask(kc(t===!0,this._executor.cwd,D(arguments)),S(arguments))}merge(){return this._runTask(zr(D(arguments)),S(arguments))}mergeFromTo(t,e){return x(t)&&x(e)?this._runTask(zr([t,e,...D(arguments)]),S(arguments,!1)):this._runTask(L("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(t){return this._executor.outputHandler=t,this}push(){let t=ar({remote:G(arguments[0],x),branch:G(arguments[1],x)},D(arguments));return this._runTask(t,S(arguments))}stash(){return this._runTask(M(["stash",...D(arguments)]),S(arguments))}status(){return this._runTask(Wc(D(arguments)),S(arguments))}},Object.assign(De.prototype,ic(),dc(),pa(),cc(),mc(),ma(),Ac(),Gc(),Jc())}}),Bn={};E(Bn,{Scheduler:()=>$n});var Zr,ts,$n,Zc=c({"src/lib/runners/scheduler.ts"(){"use strict";y(),Zr=_e(),en(),ts=(()=>{let t=0;return()=>{t++;let{promise:e,done:r}=(0,Zr.createDeferred)();return{promise:e,done:r,id:t}}})(),$n=class{constructor(t=2){this.concurrency=t,this.logger=Ve("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",t)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let t=T(this.running,this.pending.shift());this.logger("Attempting id=%s",t.id),t.done(()=>{this.logger("Completing id=",t.id),Jt(this.running,t),this.schedule()})}next(){let{promise:t,id:e}=T(this.pending,ts());return this.logger("Scheduling id=%s",e),this.schedule(),t}}}}),Gn={};E(Gn,{applyPatchTask:()=>tu});function tu(t,e){return M(["apply",...e,...t])}var eu=c({"src/lib/tasks/apply-patch.ts"(){"use strict";C()}});function ru(t,e){return{branch:t,hash:e,success:!0}}function su(t){return{branch:t,hash:null,success:!1}}var Un,nu=c({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";Un=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function qn(t,e){return e===1&&Le.test(t)}var es,Le,rs,re,iu=c({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";nu(),y(),es=/(\S+)\s+\(\S+\s([^)]+)\)/,Le=/^error[^']+'([^']+)'/m,rs=[new b(es,(t,[e,r])=>{let s=ru(e,r);t.all.push(s),t.branches[e]=s}),new b(Le,(t,[e])=>{let r=su(e);t.errors.push(r),t.all.push(r),t.branches[e]=r})],re=(t,e)=>j(new Un,rs,[t,e])}}),Xn,ou=c({"src/lib/responses/BranchSummary.ts"(){"use strict";Xn=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(t,e,r,s,n){t==="*"&&(this.detached=e,this.current=r),this.all.push(r),this.branches[r]={current:t==="*",linkedWorkTree:t==="+",name:r,commit:s,label:n}}}}});function ss(t){return t?t.charAt(0):""}function Hn(t,e=!1){return j(new Xn,e?[zn]:Wn,t)}var Wn,zn,au=c({"src/lib/parsers/parse-branch.ts"(){"use strict";ou(),y(),Wn=[new b(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(t,[e,r,s,n])=>{t.push(ss(e),!0,r,s,n)}),new b(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(t,[e,r,s,n])=>{t.push(ss(e),!1,r,s,n)})],zn=new b(/^(\S+)$/s,(t,[e])=>{t.push("*",!1,e,"","")})}}),Yn={};E(Yn,{branchLocalTask:()=>uu,branchTask:()=>cu,containsDeleteBranchCommand:()=>Jn,deleteBranchTask:()=>fu,deleteBranchesTask:()=>lu});function Jn(t){let e=["-d","-D","--delete"];return t.some(r=>e.includes(r))}function cu(t){let e=Jn(t),r=t.includes("--show-current"),s=["branch",...t];return s.length===1&&s.push("-a"),s.includes("-v")||s.splice(1,0,"-v"),{format:"utf-8",commands:s,parser(n,i){return e?re(n,i).all[0]:Hn(n,r)}}}function uu(){return{format:"utf-8",commands:["branch","-v"],parser(t){return Hn(t)}}}function lu(t,e=!1){return{format:"utf-8",commands:["branch","-v",e?"-D":"-d",...t],parser(r,s){return re(r,s)},onError({exitCode:r,stdOut:s},n,i,o){if(!qn(String(n),r))return o(n);i(s)}}}function fu(t,e=!1){let r={format:"utf-8",commands:["branch","-v",e?"-D":"-d",t],parser(s,n){return re(s,n).branches[t]},onError({exitCode:s,stdErr:n,stdOut:i},o,a,l){if(!qn(String(o),s))return l(o);throw new rt(r.parser(Tt(i),Tt(n)),String(o))}};return r}var pu=c({"src/lib/tasks/branch.ts"(){"use strict";pt(),iu(),au(),y()}});function du(t){let e=t.trim().replace(/^["']|["']$/g,"");return e&&(0,Kn.normalize)(e)}var Kn,Qn,hu=c({"src/lib/responses/CheckIgnore.ts"(){"use strict";Kn=require("node:path"),Qn=t=>t.split(/\n/g).map(du).filter(Boolean)}}),Vn={};E(Vn,{checkIgnoreTask:()=>mu});function mu(t){return{commands:["check-ignore",...t],format:"utf-8",parser:Qn}}var gu=c({"src/lib/tasks/check-ignore.ts"(){"use strict";hu()}}),Zn={};E(Zn,{cloneMirrorTask:()=>yu,cloneTask:()=>ti});function _u(t){return/^--upload-pack(=|$)/.test(t)}function ti(t,e,r){let s=["clone",...r];return x(t)&&s.push(t),x(e)&&s.push(e),s.find(_u)?L("git.fetch: potential exploit argument blocked."):M(s)}function yu(t,e,r){return T(r,"--mirror"),ti(t,e,r)}var bu=c({"src/lib/tasks/clone.ts"(){"use strict";C(),y()}});function Tu(t,e){return j({raw:t,remote:null,branches:[],tags:[],updated:[],deleted:[]},ei,[t,e])}var ei,vu=c({"src/lib/parsers/parse-fetch.ts"(){"use strict";y(),ei=[new b(/From (.+)$/,(t,[e])=>{t.remote=e}),new b(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.branches.push({name:e,tracking:r})}),new b(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.tags.push({name:e,tracking:r})}),new b(/- \[deleted]\s+\S+\s*-> (.+)$/,(t,[e])=>{t.deleted.push({tracking:e})}),new b(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(t,[e,r,s,n])=>{t.updated.push({name:s,tracking:n,to:r,from:e})})]}}),ri={};E(ri,{fetchTask:()=>wu});function ku(t){return/^--upload-pack(=|$)/.test(t)}function wu(t,e,r){let s=["fetch",...r];return t&&e&&s.push(t,e),s.find(ku)?L("git.fetch: potential exploit argument blocked."):{commands:s,format:"utf-8",parser:Tu}}var Eu=c({"src/lib/tasks/fetch.ts"(){"use strict";vu(),C()}});function Su(t){return j({moves:[]},si,t)}var si,Cu=c({"src/lib/parsers/parse-move.ts"(){"use strict";y(),si=[new b(/^Renaming (.+) to (.+)$/,(t,[e,r])=>{t.moves.push({from:e,to:r})})]}}),ni={};E(ni,{moveTask:()=>Ru});function Ru(t,e){return{commands:["mv","-v",...Y(t),e],format:"utf-8",parser:Su}}var Ou=c({"src/lib/tasks/move.ts"(){"use strict";Cu(),y()}}),ii={};E(ii,{pullTask:()=>xu});function xu(t,e,r){let s=["pull",...r];return t&&e&&s.splice(1,0,t,e),{commands:s,format:"utf-8",parser(n,i){return or(n,i)},onError(n,i,o,a){let l=Pc(Tt(n.stdOut),Tt(n.stdErr));if(l)return a(new rt(l));a(i)}}}var Fu=c({"src/lib/tasks/pull.ts"(){"use strict";pt(),On(),y()}});function Au(t){let e={};return oi(t,([r])=>e[r]={name:r}),Object.values(e)}function Mu(t){let e={};return oi(t,([r,s,n])=>{Object.hasOwn(e,r)||(e[r]={name:r,refs:{fetch:"",push:""}}),n&&s&&(e[r].refs[n.replace(/[^a-z]/g,"")]=s)}),Object.values(e)}function oi(t,e){Ue(t,r=>e(r.split(/\s+/)))}var Nu=c({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";y()}}),ai={};E(ai,{addRemoteTask:()=>Iu,getRemotesTask:()=>Pu,listRemotesTask:()=>Du,remoteTask:()=>Lu,removeRemoteTask:()=>ju});function Iu(t,e,r){return M(["remote","add",...r,t,e])}function Pu(t){let e=["remote"];return t&&e.push("-v"),{commands:e,format:"utf-8",parser:t?Mu:Au}}function Du(t){let e=[...t];return e[0]!=="ls-remote"&&e.unshift("ls-remote"),M(e)}function Lu(t){let e=[...t];return e[0]!=="remote"&&e.unshift("remote"),M(e)}function ju(t){return M(["remote","remove",t])}var Bu=c({"src/lib/tasks/remote.ts"(){"use strict";Nu(),C()}}),ci={};E(ci,{stashListTask:()=>$u});function $u(t={},e){let r=yn(t),s=["stash","list",...r.commands,...e],n=hn(r.splitter,r.fields,tr(s));return ee(s)||{commands:s,format:"utf-8",parser:n}}var Gu=c({"src/lib/tasks/stash-list.ts"(){"use strict";Ct(),gn(),ir(),bn()}}),ui={};E(ui,{addSubModuleTask:()=>Uu,initSubModuleTask:()=>qu,subModuleTask:()=>se,updateSubModuleTask:()=>Xu});function Uu(t,e){return se(["add",t,e])}function qu(t){return se(["init",...t])}function se(t){let e=[...t];return e[0]!=="submodule"&&e.unshift("submodule"),M(e)}function Xu(t){return se(["update",...t])}var Hu=c({"src/lib/tasks/sub-module.ts"(){"use strict";C()}});function Wu(t,e){let r=Number.isNaN(t),s=Number.isNaN(e);return r!==s?r?1:-1:r?li(t,e):0}function li(t,e){return t===e?0:t>e?1:-1}function zu(t){return t.trim()}function Dt(t){return typeof t=="string"&&parseInt(t.replace(/^\D+/g,""),10)||0}var ns,fi,Yu=c({"src/lib/responses/TagList.ts"(){"use strict";ns=class{constructor(t,e){this.all=t,this.latest=e}},fi=function(t,e=!1){let r=t.split(`
`).map(zu).filter(Boolean);e||r.sort(function(n,i){let o=n.split("."),a=i.split(".");if(o.length===1||a.length===1)return Wu(Dt(o[0]),Dt(a[0]));for(let l=0,g=Math.max(o.length,a.length);l<g;l++){let f=li(Dt(o[l]),Dt(a[l]));if(f)return f}return 0});let s=e?r[0]:[...r].reverse().find(n=>n.indexOf(".")>=0);return new ns(r,s)}}}),pi={};E(pi,{addAnnotatedTagTask:()=>Qu,addTagTask:()=>Ku,tagListTask:()=>Ju});function Ju(t=[]){let e=t.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...t],parser(r){return fi(r,e)}}}function Ku(t){return{format:"utf-8",commands:["tag",t],parser(){return{name:t}}}}function Qu(t,e){return{format:"utf-8",commands:["tag","-a","-m",e,t],parser(){return{name:t}}}}var Vu=c({"src/lib/tasks/tag.ts"(){"use strict";Yu()}}),Zu=jo({"src/git.js"(t,e){"use strict";var{GitExecutor:r}=(tc(),w(sn)),{SimpleGitApi:s}=(Vc(),w(jn)),{Scheduler:n}=(Zc(),w(Bn)),{configurationErrorTask:i}=(C(),w(xe)),{asArray:o,filterArray:a,filterPrimitives:l,filterString:g,filterStringOrStringArray:f,filterType:p,getTrailingOptions:d,trailingFunctionArgument:h,trailingOptionsArgument:U}=(y(),w(ws)),{applyPatchTask:R}=(eu(),w(Gn)),{branchTask:I,branchLocalTask:J,deleteBranchesTask:nt,deleteBranchTask:oe}=(pu(),w(Yn)),{checkIgnoreTask:it}=(gu(),w(Vn)),{checkIsRepoTask:hr}=(Rs(),w(Es)),{cloneTask:mt,cloneMirrorTask:ae}=(bu(),w(Zn)),{cleanWithOptionsTask:Ft,isCleanOptionsArray:ce}=(js(),w(Ds)),{diffSummaryTask:Li}=(ir(),w(_n)),{fetchTask:ji}=(Eu(),w(ri)),{moveTask:Bi}=(Ou(),w(ni)),{pullTask:$i}=(Fu(),w(ii)),{pushTagsTask:Gi}=(Mn(),w(An)),{addRemoteTask:Ui,getRemotesTask:qi,listRemotesTask:Xi,remoteTask:Hi,removeRemoteTask:Wi}=(Bu(),w(ai)),{getResetMode:zi,resetTask:Yi}=(Qs(),w(Ys)),{stashListTask:Ji}=(Gu(),w(ci)),{addSubModuleTask:Ki,initSubModuleTask:Qi,subModuleTask:Vi,updateSubModuleTask:Zi}=(Hu(),w(ui)),{addAnnotatedTagTask:to,addTagTask:eo,tagListTask:ro}=(Vu(),w(pi)),{straightThroughBufferTask:so,straightThroughStringTask:W}=(C(),w(xe));function _(u,m){this._plugins=m,this._executor=new r(u.baseDir,new n(u.maxConcurrentProcesses),m),this._trimmed=u.trimmed}(_.prototype=Object.create(s.prototype)).constructor=_,_.prototype.customBinary=function(u){return this._plugins.reconfigure("binary",u),this},_.prototype.env=function(u,m){return arguments.length===1&&typeof u=="object"?this._executor.env=u:(this._executor.env=this._executor.env||{})[u]=m,this},_.prototype.stashList=function(u){return this._runTask(Ji(U(arguments)||{},a(u)&&u||[]),h(arguments))};function mr(u,m,v,F){return typeof v!="string"?i(`git.${u}() requires a string 'repoPath'`):m(v,p(F,g),d(arguments))}_.prototype.clone=function(){return this._runTask(mr("clone",mt,...arguments),h(arguments))},_.prototype.mirror=function(){return this._runTask(mr("mirror",ae,...arguments),h(arguments))},_.prototype.mv=function(u,m){return this._runTask(Bi(u,m),h(arguments))},_.prototype.checkoutLatestTag=function(u){var m=this;return this.pull(function(){m.tags(function(v,F){m.checkout(F.latest,u)})})},_.prototype.pull=function(u,m,v,F){return this._runTask($i(p(u,g),p(m,g),d(arguments)),h(arguments))},_.prototype.fetch=function(u,m){return this._runTask(ji(p(u,g),p(m,g),d(arguments)),h(arguments))},_.prototype.silent=function(u){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},_.prototype.tags=function(u,m){return this._runTask(ro(d(arguments)),h(arguments))},_.prototype.rebase=function(){return this._runTask(W(["rebase",...d(arguments)]),h(arguments))},_.prototype.reset=function(u){return this._runTask(Yi(zi(u),d(arguments)),h(arguments))},_.prototype.revert=function(u){let m=h(arguments);return typeof u!="string"?this._runTask(i("Commit must be a string"),m):this._runTask(W(["revert",...d(arguments,0,!0),u]),m)},_.prototype.addTag=function(u){let m=typeof u=="string"?eo(u):i("Git.addTag requires a tag name");return this._runTask(m,h(arguments))},_.prototype.addAnnotatedTag=function(u,m){return this._runTask(to(u,m),h(arguments))},_.prototype.deleteLocalBranch=function(u,m,v){return this._runTask(oe(u,typeof m=="boolean"?m:!1),h(arguments))},_.prototype.deleteLocalBranches=function(u,m,v){return this._runTask(nt(u,typeof m=="boolean"?m:!1),h(arguments))},_.prototype.branch=function(u,m){return this._runTask(I(d(arguments)),h(arguments))},_.prototype.branchLocal=function(u){return this._runTask(J(),h(arguments))},_.prototype.raw=function(u){let m=!Array.isArray(u),v=[].slice.call(m?arguments:u,0);for(let q=0;q<v.length&&m;q++)if(!l(v[q])){v.splice(q,v.length-q);break}v.push(...d(arguments,0,!0));var F=h(arguments);return v.length?this._runTask(W(v,this._trimmed),F):this._runTask(i("Raw: must supply one or more command to execute"),F)},_.prototype.submoduleAdd=function(u,m,v){return this._runTask(Ki(u,m),h(arguments))},_.prototype.submoduleUpdate=function(u,m){return this._runTask(Zi(d(arguments,!0)),h(arguments))},_.prototype.submoduleInit=function(u,m){return this._runTask(Qi(d(arguments,!0)),h(arguments))},_.prototype.subModule=function(u,m){return this._runTask(Vi(d(arguments)),h(arguments))},_.prototype.listRemote=function(){return this._runTask(Xi(d(arguments)),h(arguments))},_.prototype.addRemote=function(u,m,v){return this._runTask(Ui(u,m,d(arguments)),h(arguments))},_.prototype.removeRemote=function(u,m){return this._runTask(Wi(u),h(arguments))},_.prototype.getRemotes=function(u,m){return this._runTask(qi(u===!0),h(arguments))},_.prototype.remote=function(u,m){return this._runTask(Hi(d(arguments)),h(arguments))},_.prototype.tag=function(u,m){let v=d(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(W(v),h(arguments))},_.prototype.updateServerInfo=function(u){return this._runTask(W(["update-server-info"]),h(arguments))},_.prototype.pushTags=function(u,m){let v=Gi({remote:p(u,g)},d(arguments));return this._runTask(v,h(arguments))},_.prototype.rm=function(u){return this._runTask(W(["rm","-f",...o(u)]),h(arguments))},_.prototype.rmKeepLocal=function(u){return this._runTask(W(["rm","--cached",...o(u)]),h(arguments))},_.prototype.catFile=function(u,m){return this._catFile("utf-8",arguments)},_.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},_.prototype._catFile=function(u,m){var v=h(m),F=["cat-file"],q=m[0];if(typeof q=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(q)&&F.push.apply(F,q);let ue=u==="buffer"?so(F):W(F);return this._runTask(ue,v)},_.prototype.diff=function(u,m){let v=g(u)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):W(["diff",...d(arguments)]);return this._runTask(v,h(arguments))},_.prototype.diffSummary=function(){return this._runTask(Li(d(arguments,1)),h(arguments))},_.prototype.applyPatch=function(u){let m=f(u)?R(o(u),d([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(m,h(arguments))},_.prototype.revparse=function(){let u=["rev-parse",...d(arguments,!0)];return this._runTask(W(u,!0),h(arguments))},_.prototype.clean=function(u,m,v){let F=ce(u),q=F&&u.join("")||p(u,g)||"",ue=d([].slice.call(arguments,F?1:0));return this._runTask(Ft(q,ue),h(arguments))},_.prototype.exec=function(u){let m={commands:[],format:"utf-8",parser(){typeof u=="function"&&u()}};return this._runTask(m)},_.prototype.clearQueue=function(){return this},_.prototype.checkIgnore=function(u,m){return this._runTask(it(o(p(u,f,[]))),h(arguments))},_.prototype.checkIsRepo=function(u,m){return this._runTask(hr(p(u,g)),h(arguments))},e.exports=_}}),di={};E(di,{esModuleFactory:()=>tl,gitExportFactory:()=>el,gitInstanceFactory:()=>hi});function tl(t){return Object.defineProperties(t,{__esModule:{value:!0},default:{value:t}})}function el(t){return Object.assign(t.bind(null),Vs)}function hi(t,e){let r=new tn,s=vs(t&&(typeof t=="string"?{baseDir:t}:t)||{},e);if(!qe(s.baseDir))throw new $e(s,"Cannot use simple-git on a directory that does not exist");return Array.isArray(s.config)&&r.add(Ca(s.config)),r.add(Ea(s.unsafe)),r.add(za()),r.add(Oa(s.completion)),s.abort&&r.add(ba(s.abort)),s.progress&&r.add(ja(s.progress)),s.timeout&&r.add(Xa(s.timeout)),s.spawnOptions&&r.add(Ua(s.spawnOptions)),r.add(Fr(Pa(!0))),s.errors&&r.add(Fr(s.errors)),Aa(r,s.binary,s.unsafe?.allowUnsafeCustomBinary),new mi(s,r)}var mi,gi=c({"src/lib/git-factory.ts"(){"use strict";ya(),Wa(),Ya(),y(),mi=Zu()}}),_i={};E(_i,{gitP:()=>rl});function rl(...t){let e,r=Promise.resolve();try{e=hi(...t)}catch(l){r=Promise.reject(l)}function s(){return i}function n(){return r}let i=[...yi,...je].reduce((l,g)=>{let f=je.includes(g),p=f?o(g,e):a(g,e,l);return Object.defineProperty(l,g,{enumerable:!1,configurable:!1,value:e?p:f?n:s}),l},{});return i;function o(l,g){return function(...f){if(typeof f[f.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+l);return r.then(function(){return new Promise(function(p,d){let h=(U,R)=>{if(U)return d(sl(U));p(R)};f.push(h),g[l].apply(g,f)})})}}function a(l,g,f){return(...p)=>(g[l](...p),f)}}function sl(t){return t instanceof Error?t:typeof t=="string"?new Error(t):new rt(t)}var yi,je,nl=c({"src/lib/runners/promise-wrapped.ts"(){"use strict";pt(),gi(),yi=["customBinary","env","outputHandler","silent"],je=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:il}=(nl(),w(_i)),{esModuleFactory:ol,gitInstanceFactory:al,gitExportFactory:cl}=(gi(),w(di)),is=ol(cl(al));bi.exports=Object.assign(is,{gitP:il,simpleGit:is})});var wi=A((gf,ki)=>{var vi=Ti(),{execSync:ur}=require("node:child_process"),H=require("node:path"),N=require("node:fs"),ul=require("node:os"),ll=H.join(ul.homedir(),".claude-memory","repo"),fl="claude-memory-storage",lr=class{constructor(e,r=null,s=fl){this.auth=e,this.repoOwner=r,this.repoName=s,this.syncDir=ll,this._git=null}get git(){return this._git||(this._git=vi(this.syncDir)),this._git}async ensureRepo(){if(N.existsSync(this.syncDir)&&N.existsSync(H.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),s=JSON.parse(ur(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=s.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let e=await this.auth.getToken();return ur(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${e}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let e=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return ur(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${e}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(e){return console.error("Failed to create repository:",e.message),!1}}async cloneRepo(){let e=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=H.dirname(this.syncDir);N.existsSync(r)||N.mkdirSync(r,{recursive:!0}),await vi().clone(e,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(e){let r=new Date(e.created_at),s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,n=String(r.getDate()).padStart(2,"0"),i=H.join(this.syncDir,"memories",e.container_tag,s);N.existsSync(i)||N.mkdirSync(i,{recursive:!0});let o=`${n}-${e.id}.json`,a=H.join(i,o),l={id:e.id,content:e.content,containerTag:e.container_tag,metadata:typeof e.metadata=="string"?JSON.parse(e.metadata):e.metadata,createdAt:e.created_at,updatedAt:e.updated_at};return N.writeFileSync(a,JSON.stringify(l,null,2)),a}exportMemories(e){let r=[];for(let s of e){let n=this.exportMemory(s);r.push(n)}return r}exportProfiles(e){let r=H.join(this.syncDir,"profiles");N.existsSync(r)||N.mkdirSync(r,{recursive:!0});let s=H.join(r,"user-preferences.json");return N.writeFileSync(s,JSON.stringify(e,null,2)),s}async syncToGitHub(e,r=null){try{await this.ensureRepo();let s=this.exportMemories(e);if(r){let o=this.exportProfiles(r);s.push(o)}if(s.length===0)return{success:!0,synced:0};for(let o of s){let a=H.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(e.map(o=>o.container_tag))].join(", ")} (${e.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:e.length}}catch(s){return console.error("GitHub sync failed:",s.message),{success:!1,error:s.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(e){return e.message.includes("conflict")?{success:!1,conflict:!0,error:e.message}:{success:!1,conflict:!1,error:e.message}}}importMemories(){let e=H.join(this.syncDir,"memories");if(!N.existsSync(e))return[];let r=[],s=n=>{let i=N.readdirSync(n,{withFileTypes:!0});for(let o of i){let a=H.join(n,o.name);if(o.isDirectory())s(a);else if(o.name.endsWith(".json"))try{let l=JSON.parse(N.readFileSync(a,"utf8"));r.push({id:l.id,content:l.content,container_tag:l.containerTag,metadata:JSON.stringify(l.metadata||{}),created_at:l.createdAt,updated_at:l.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(l){console.error(`Failed to parse ${a}:`,l.message)}}};return s(e),r}importProfiles(){let e=H.join(this.syncDir,"profiles","user-preferences.json");if(!N.existsSync(e))return{static:[],dynamic:[]};try{return JSON.parse(N.readFileSync(e,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};ki.exports={GitHubSync:lr}});var Ri=A((_f,Ci)=>{var{execSync:Ei}=require("node:child_process"),ht=require("node:fs"),Si=require("node:path"),pl=require("node:os"),Rt=Si.join(pl.homedir(),".claude-memory","github-token.json"),fr=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return Ei("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return Ei("gh auth token",{encoding:"utf8"}).trim()}catch(e){console.error("Failed to get gh token:",e.message)}if(ht.existsSync(Rt))return JSON.parse(ht.readFileSync(Rt,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(e){let r=Si.dirname(Rt);ht.existsSync(r)||ht.mkdirSync(r,{recursive:!0}),ht.writeFileSync(Rt,JSON.stringify({token:e}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||ht.existsSync(Rt)}async initiateDeviceFlow(){let e=require("node:https");return new Promise((r,s)=>{let n=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":n.length,Accept:"application/json"}},o=e.request(i,a=>{let l="";a.on("data",g=>{l+=g}),a.on("end",()=>r(JSON.parse(l)))});o.on("error",s),o.write(n),o.end()})}async pollForToken(e,r=5){let s=require("node:https"),n=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:e,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),l={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},g=s.request(l,f=>{let p="";f.on("data",d=>{p+=d}),f.on("end",()=>{let d=JSON.parse(p);d.access_token?i(d.access_token):d.error==="authorization_pending"?i(null):o(new Error(d.error||"Unknown error"))})});g.on("error",o),g.write(a),g.end()});for(let i=0;i<120;i++){let o=await n();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let e=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${e.verification_uri}`),console.log(`Enter code: ${e.user_code}
`);let r=await this.pollForToken(e.device_code,e.interval);return this.saveToken(r),r}};Ci.exports={GitHubAuth:fr}});var xi=A((yf,Oi)=>{var{SqliteManager:dl}=yr(),{GitHubSync:hl}=wi(),{GitHubAuth:ml}=Ri(),gl=require("node:crypto"),pr=class{constructor(e=null){this.db=new dl(e),this.auth=new ml,this.sync=null}async initSync(){this.sync||(this.sync=new hl(this.auth))}generateId(e="mem"){return`${e}_${gl.randomBytes(8).toString("hex")}`}async addMemory(e,r,s={},n=null){let i=n||this.generateId("mem");return this.db.addMemory(i,e,r,s),{id:i,status:"saved",containerTag:r}}async search(e,r=null,s={}){let n=this.db.searchMemories(e,r,s.limit||10);return{results:n.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:n.length}}async getProfile(e,r=null){let s=this.db.getProfile(e),n=null;if(r){let i=this.db.searchMemories(r,e,10);n={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:s.static,dynamic:s.dynamic},searchResults:n}}async listMemories(e,r=20){return{memories:this.db.listMemories(e,r)}}async deleteMemory(e){return this.db.deleteMemory(e),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=this.db.getPendingSync();if(e.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(e);if(r.success){let s=e.map(n=>n.id);this.db.markSynced(s)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=await this.sync.pullFromGitHub();if(!e.success)return e;let r=this.sync.importMemories();for(let s of r)this.db.getMemory(s.id)||this.db.addMemory(s.id,s.content,s.container_tag,JSON.parse(s.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};Oi.exports={StorageClient:pr}});var Mi=A((bf,Ai)=>{var{execSync:Fi}=require("node:child_process"),_l=require("node:crypto");function ne(t){return _l.createHash("sha256").update(t).digest("hex").slice(0,16)}function dr(t){try{return Fi("git rev-parse --show-toplevel",{cwd:t,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function yl(t){let r=dr(t)||t;return`claudecode_project_${ne(r)}`}function bl(t){return(dr(t)||t).split("/").pop()||"unknown"}function Tl(){try{let e=Fi("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(e)return`claudecode_user_${ne(e)}`}catch{}let t=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${ne(t)}`}Ai.exports={sha256:ne,getGitRoot:dr,getContainerTag:yl,getProjectName:bl,getUserContainerTag:Tl}});var Di=A((Tf,Pi)=>{var xt=require("node:fs"),Ni=require("node:path"),vl=require("node:os"),ie=Ni.join(vl.homedir(),".supermemory-claude"),Ot=Ni.join(ie,"settings.json"),Ii={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function kl(){xt.existsSync(ie)||xt.mkdirSync(ie,{recursive:!0})}function wl(){let t={...Ii};try{if(xt.existsSync(Ot)){let e=xt.readFileSync(Ot,"utf-8");Object.assign(t,JSON.parse(e))}}catch(e){console.error(`Settings: Failed to load ${Ot}: ${e.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(t.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(t.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(e=>e.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(t.debug=!0),t}function El(t){kl();let e={...t};delete e.apiKey,xt.writeFileSync(Ot,JSON.stringify(e,null,2))}function Sl(t){if(t.apiKey)return t.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function Cl(t,e){return e.skipTools.includes(t)?!1:e.captureTools&&e.captureTools.length>0?e.captureTools.includes(t):!0}function Rl(t,e,r){if(t.debug){let s=new Date().toISOString();console.error(r?`[${s}] ${e}: ${JSON.stringify(r)}`:`[${s}] ${e}`)}}Pi.exports={SETTINGS_DIR:ie,SETTINGS_FILE:Ot,DEFAULT_SETTINGS:Ii,loadSettings:wl,saveSettings:El,getApiKey:Sl,shouldCaptureTool:Cl,debugLog:Rl}});var{StorageClient:Ol}=xi(),{getContainerTag:xl,getProjectName:Fl}=Mi(),{loadSettings:Al}=Di();async function Ml(){let t=process.argv.slice(2).join(" ");if(!t||!t.trim()){console.log('No content provided. Usage: node add-memory.cjs "content to save"');return}let e=Al(),r=process.cwd(),s=xl(r),n=Fl(r);try{let i=new Ol,o=await i.addMemory(t,s,{type:"manual",project:n,timestamp:new Date().toISOString()});console.log(`Memory saved to project: ${n}`),console.log(`ID: ${o.id}`),i.close()}catch(i){console.log(`Error saving memory: ${i.message}`)}}Ml().catch(t=>{console.error(`Fatal error: ${t.message}`),process.exit(1)});
