#!/usr/bin/env node
var je=Object.defineProperty;var cr=Object.getOwnPropertyDescriptor;var ur=Object.getOwnPropertyNames;var lr=Object.prototype.hasOwnProperty;var dr=(e,t)=>()=>(e&&(t=e(e=0)),t);var d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),fr=(e,t)=>{for(var r in t)je(e,r,{get:t[r],enumerable:!0})},pr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ur(t))!lr.call(e,o)&&o!==r&&je(e,o,{get:()=>t[o],enumerable:!(n=cr(t,o))||n.enumerable});return e};var mr=e=>pr(je({},"__esModule",{value:!0}),e);var Te=d(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.__setModuleDefault=v.__createBinding=void 0;v.__classPrivateFieldSet=hr;v.__classPrivateFieldGet=yr;v.__importStar=gr;v.__exportStar=br;function hr(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r}function yr(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}var Me=Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};v.__createBinding=Me;var Rt=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};v.__setModuleDefault=Rt;var qe=function(e){return qe=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},qe(e)};function gr(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=qe(e),n=0;n<r.length;n++)r[n]!=="default"&&Me(t,e,r[n]);return Rt(t,e),t}function br(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&Me(t,e,r)}});var Ot=d(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.uuid4=void 0;var _r=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return L.uuid4=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^r()&15>>+n/4).toString(16))};L.uuid4=_r});var $e=d(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.castToError=void 0;D.isAbortError=wr;function wr(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}var Sr=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){let t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};D.castToError=Sr});var N=d(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.InternalServerError=f.RateLimitError=f.UnprocessableEntityError=f.ConflictError=f.NotFoundError=f.PermissionDeniedError=f.AuthenticationError=f.BadRequestError=f.APIConnectionTimeoutError=f.APIConnectionError=f.APIUserAbortError=f.APIError=f.SupermemoryError=void 0;var Er=$e(),ee=class extends Error{};f.SupermemoryError=ee;var S=class e extends ee{constructor(t,r,n,o){super(`${e.makeMessage(t,r,n)}`),this.status=t,this.headers=o,this.error=r}static makeMessage(t,r,n){let o=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return t&&o?`${t} ${o}`:t?`${t} status code (no body)`:o||"(no status code or body)"}static generate(t,r,n,o){if(!t||!o)return new k({message:n,cause:(0,Er.castToError)(r)});let s=r;return t===400?new te(t,s,n,o):t===401?new re(t,s,n,o):t===403?new ne(t,s,n,o):t===404?new oe(t,s,n,o):t===409?new se(t,s,n,o):t===422?new ie(t,s,n,o):t===429?new ae(t,s,n,o):t>=500?new ce(t,s,n,o):new e(t,s,n,o)}};f.APIError=S;var xe=class extends S{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}};f.APIUserAbortError=xe;var k=class extends S{constructor({message:t,cause:r}){super(void 0,void 0,t||"Connection error.",void 0),r&&(this.cause=r)}};f.APIConnectionError=k;var Ue=class extends k{constructor({message:t}={}){super({message:t??"Request timed out."})}};f.APIConnectionTimeoutError=Ue;var te=class extends S{};f.BadRequestError=te;var re=class extends S{};f.AuthenticationError=re;var ne=class extends S{};f.PermissionDeniedError=ne;var oe=class extends S{};f.NotFoundError=oe;var se=class extends S{};f.ConflictError=se;var ie=class extends S{};f.UnprocessableEntityError=ie;var ae=class extends S{};f.RateLimitError=ae;var ce=class extends S{};f.InternalServerError=ce});var H=d(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.safeJSON=u.maybeCoerceBoolean=u.maybeCoerceFloat=u.maybeCoerceInteger=u.coerceBoolean=u.coerceFloat=u.coerceInteger=u.validatePositiveInteger=u.ensurePresent=u.isReadonlyArray=u.isArray=u.isAbsoluteURL=void 0;u.maybeObj=vr;u.isEmptyObj=Ar;u.hasOwn=Ir;u.isObj=Fr;var B=N(),Pr=/^[a-z][a-z0-9+.-]*:/i,Rr=e=>Pr.test(e);u.isAbsoluteURL=Rr;var Or=e=>(u.isArray=Array.isArray,(0,u.isArray)(e));u.isArray=Or;u.isReadonlyArray=u.isArray;function vr(e){return typeof e!="object"?{}:e??{}}function Ar(e){if(!e)return!0;for(let t in e)return!1;return!0}function Ir(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Fr(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}var jr=e=>{if(e==null)throw new B.SupermemoryError(`Expected a value to be given but received ${e} instead.`);return e};u.ensurePresent=jr;var qr=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new B.SupermemoryError(`${e} must be an integer`);if(t<0)throw new B.SupermemoryError(`${e} must be a positive integer`);return t};u.validatePositiveInteger=qr;var Mr=e=>{if(typeof e=="number")return Math.round(e);if(typeof e=="string")return parseInt(e,10);throw new B.SupermemoryError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};u.coerceInteger=Mr;var Tr=e=>{if(typeof e=="number")return e;if(typeof e=="string")return parseFloat(e);throw new B.SupermemoryError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};u.coerceFloat=Tr;var $r=e=>typeof e=="boolean"?e:typeof e=="string"?e==="true":!!e;u.coerceBoolean=$r;var xr=e=>{if(e!=null)return(0,u.coerceInteger)(e)};u.maybeCoerceInteger=xr;var Ur=e=>{if(e!=null)return(0,u.coerceFloat)(e)};u.maybeCoerceFloat=Ur;var Cr=e=>{if(e!=null)return(0,u.coerceBoolean)(e)};u.maybeCoerceBoolean=Cr;var Lr=e=>{try{return JSON.parse(e)}catch{return}};u.safeJSON=Lr});var vt=d(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.sleep=void 0;var Dr=e=>new Promise(t=>setTimeout(t,e));ue.sleep=Dr});var Ce=d(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.VERSION=void 0;le.VERSION="4.0.0"});var jt=d(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.getPlatformHeaders=T.isRunningInBrowser=void 0;var X=Ce(),kr=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";T.isRunningInBrowser=kr;function Nr(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Br=()=>{let e=Nr();if(e==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":X.VERSION,"X-Stainless-OS":It(Deno.build.os),"X-Stainless-Arch":At(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":X.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(e==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":X.VERSION,"X-Stainless-OS":It(globalThis.process.platform??"unknown"),"X-Stainless-Arch":At(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=Hr();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":X.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":X.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Hr(){if(typeof navigator>"u"||!navigator)return null;let e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:t,pattern:r}of e){let n=r.exec(navigator.userAgent);if(n){let o=n[1]||0,s=n[2]||0,i=n[3]||0;return{browser:t,version:`${o}.${s}.${i}`}}}return null}var At=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",It=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown"),Ft,Xr=()=>Ft??(Ft=Br());T.getPlatformHeaders=Xr});var Le=d(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.getDefaultFetch=Kr;q.makeReadableStream=qt;q.ReadableStreamFrom=Yr;q.ReadableStreamToAsyncIterable=Vr;q.CancelReadableStream=Wr;function Kr(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Supermemory({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function qt(...e){let t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function Yr(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return qt({start(){},async pull(r){let{done:n,value:o}=await t.next();n?r.close():r.enqueue(o)},async cancel(){await t.return?.()}})}function Vr(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let r=await t.read();return r?.done&&t.releaseLock(),r}catch(r){throw t.releaseLock(),r}},async return(){let r=t.cancel();return t.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Wr(e){if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}});var Mt=d(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.FallbackEncoder=void 0;var Jr=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});de.FallbackEncoder=Jr});var K=d(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.createForm=y.multipartFormRequestOptions=y.maybeMultipartFormRequestOptions=y.isAsyncIterable=y.checkFileSupport=void 0;y.makeFile=De;y.getName=fe;var Gr=Le(),zr=()=>{if(typeof File>"u"){let{process:e}=globalThis,t=typeof e?.versions?.node=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};y.checkFileSupport=zr;function De(e,t,r){return(0,y.checkFileSupport)(),new File(e,t??"unknown_file",r)}function fe(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}var Qr=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";y.isAsyncIterable=Qr;var Zr=async(e,t)=>ke(e.body)?{...e,body:await(0,y.createForm)(e.body,t)}:e;y.maybeMultipartFormRequestOptions=Zr;var en=async(e,t)=>({...e,body:await(0,y.createForm)(e.body,t)});y.multipartFormRequestOptions=en;var Tt=new WeakMap;function tn(e){let t=typeof e=="function"?e:e.fetch,r=Tt.get(t);if(r)return r;let n=(async()=>{try{let o="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new o(s).text()}catch{return!0}})();return Tt.set(t,n),n}var rn=async(e,t)=>{if(!await tn(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([n,o])=>Ne(r,n,o))),r};y.createForm=rn;var $t=e=>e instanceof Blob&&"name"in e,nn=e=>typeof e=="object"&&e!==null&&(e instanceof Response||(0,y.isAsyncIterable)(e)||$t(e)),ke=e=>{if(nn(e))return!0;if(Array.isArray(e))return e.some(ke);if(e&&typeof e=="object"){for(let t in e)if(ke(e[t]))return!0}return!1},Ne=async(e,t,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")e.append(t,String(r));else if(r instanceof Response)e.append(t,De([await r.blob()],fe(r)));else if((0,y.isAsyncIterable)(r))e.append(t,De([await new Response((0,Gr.ReadableStreamFrom)(r)).blob()],fe(r)));else if($t(r))e.append(t,r,fe(r));else if(Array.isArray(r))await Promise.all(r.map(n=>Ne(e,t+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,o])=>Ne(e,`${t}[${n}]`,o)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}}});var Ut=d(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});He.toFile=cn;var Y=K(),on=K(),xt=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",sn=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&xt(e),an=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function cn(e,t,r){if((0,on.checkFileSupport)(),e=await e,sn(e))return e instanceof File?e:(0,Y.makeFile)([await e.arrayBuffer()],e.name);if(an(e)){let o=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),(0,Y.makeFile)(await Be(o),t,r)}let n=await Be(e);if(t||(t=(0,Y.getName)(e)),!r?.type){let o=n.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof o=="string"&&(r={...r,type:o})}return(0,Y.makeFile)(n,t,r)}async function Be(e){let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(xt(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if((0,Y.isAsyncIterable)(e))for await(let r of e)t.push(...await Be(r));else{let r=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${r?`; constructor: ${r}`:""}${un(e)}`)}return t}function un(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(r=>`"${r}"`).join(", ")}]`}});var Xe=d(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.toFile=void 0;var ln=Ut();Object.defineProperty(pe,"toFile",{enumerable:!0,get:function(){return ln.toFile}})});var $=d(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.APIResource=void 0;var Ke=class{constructor(t){this._client=t}};me.APIResource=Ke});var V=d(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.isEmptyHeaders=x.buildHeaders=void 0;var Ct=H(),Lt=Symbol("brand.privateNullableHeaders");function*Dt(e){if(!e)return;if(Lt in e){let{values:n,nulls:o}=e;yield*n.entries();for(let s of o)yield[s,null];return}let t=!1,r;e instanceof Headers?r=e.entries():(0,Ct.isReadonlyArray)(e)?r=e:(t=!0,r=Object.entries(e??{}));for(let n of r){let o=n[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let s=(0,Ct.isReadonlyArray)(n[1])?n[1]:[n[1]],i=!1;for(let l of s)l!==void 0&&(t&&!i&&(i=!0,yield[o,null]),yield[o,l])}}var dn=e=>{let t=new Headers,r=new Set;for(let n of e){let o=new Set;for(let[s,i]of Dt(n)){let l=s.toLowerCase();o.has(l)||(t.delete(s),o.add(l)),i===null?(t.delete(s),r.add(l)):(t.append(s,i),r.delete(l))}}return{[Lt]:!0,values:t,nulls:r}};x.buildHeaders=dn;var fn=e=>{for(let t of Dt(e))return!1;return!0};x.isEmptyHeaders=fn});var he=d(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.path=F.createPathTagFunction=void 0;F.encodeURIPath=Ye;var pn=N();function Ye(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var kt=Object.freeze(Object.create(null)),mn=(e=Ye)=>function(r,...n){if(r.length===1)return r[0];let o=!1,s=[],i=r.reduce((w,_,R)=>{/[?#]/.test(_)&&(o=!0);let a=n[R],O=(o?encodeURIComponent:e)(""+a);return R!==n.length&&(a==null||typeof a=="object"&&a.toString===Object.getPrototypeOf(Object.getPrototypeOf(a.hasOwnProperty??kt)??kt)?.toString)&&(O=a+"",s.push({start:w.length+_.length,length:O.length,error:`Value of type ${Object.prototype.toString.call(a).slice(8,-1)} is not a valid path parameter`})),w+_+(R===n.length?"":O)},""),l=i.split(/[?#]/,1)[0],b=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,m;for(;(m=b.exec(l))!==null;)s.push({start:m.index,length:m[0].length,error:`Value "${m[0]}" can't be safely passed as a path parameter`});if(s.sort((w,_)=>w.start-_.start),s.length>0){let w=0,_=s.reduce((R,a)=>{let O=" ".repeat(a.start-w),U="^".repeat(a.length);return w=a.start+a.length,R+O+U},"");throw new pn.SupermemoryError(`Path parameters result in path with invalid segments:
${s.map(R=>R.error).join(`
`)}
${i}
${_}`)}return i};F.createPathTagFunction=mn;F.path=(0,F.createPathTagFunction)(Ye)});var We=d(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.Connections=void 0;var hn=$(),yn=V(),A=he(),Ve=class extends hn.APIResource{create(t,r={},n){return this._client.post((0,A.path)`/v3/connections/${t}`,{body:r,...n})}list(t={},r){return this._client.post("/v3/connections/list",{body:t,...r})}configure(t,r,n){return this._client.post((0,A.path)`/v3/connections/${t}/configure`,{body:r,...n})}deleteByID(t,r){return this._client.delete((0,A.path)`/v3/connections/${t}`,r)}deleteByProvider(t,r,n){return this._client.delete((0,A.path)`/v3/connections/${t}`,{body:r,...n})}getByID(t,r){return this._client.get((0,A.path)`/v3/connections/${t}`,r)}getByTag(t,r,n){return this._client.post((0,A.path)`/v3/connections/${t}/connection`,{body:r,...n})}import(t,r={},n){return this._client.post((0,A.path)`/v3/connections/${t}/import`,{body:r,...n,headers:(0,yn.buildHeaders)([{Accept:"text/plain"},n?.headers])})}listDocuments(t,r={},n){return this._client.post((0,A.path)`/v3/connections/${t}/documents`,{body:r,...n})}resources(t,r={},n){return this._client.get((0,A.path)`/v3/connections/${t}/resources`,{query:r,...n})}};ye.Connections=Ve});var ze=d(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.Documents=void 0;var gn=$(),bn=V(),_n=K(),Je=he(),Ge=class extends gn.APIResource{update(t,r={},n){return this._client.patch((0,Je.path)`/v3/documents/${t}`,{body:r,...n})}list(t={},r){return this._client.post("/v3/documents/list",{body:t,...r})}delete(t,r){return this._client.delete((0,Je.path)`/v3/documents/${t}`,{...r,headers:(0,bn.buildHeaders)([{Accept:"*/*"},r?.headers])})}add(t,r){return this._client.post("/v3/documents",{body:t,...r})}batchAdd(t,r){return this._client.post("/v3/documents/batch",{body:t,...r})}deleteBulk(t={},r){return this._client.delete("/v3/documents/bulk",{body:t,...r})}get(t,r){return this._client.get((0,Je.path)`/v3/documents/${t}`,r)}listProcessing(t){return this._client.get("/v3/documents/processing",t)}uploadFile(t,r){return this._client.post("/v3/documents/file",(0,_n.multipartFormRequestOptions)({body:t,...r},this._client))}};ge.Documents=Ge});var et=d(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.Memories=void 0;var wn=$(),Sn=V(),En=K(),Qe=he(),Ze=class extends wn.APIResource{update(t,r={},n){return this._client.patch((0,Qe.path)`/v3/documents/${t}`,{body:r,...n})}list(t={},r){return this._client.post("/v3/documents/list",{body:t,...r})}delete(t,r){return this._client.delete((0,Qe.path)`/v3/documents/${t}`,{...r,headers:(0,Sn.buildHeaders)([{Accept:"*/*"},r?.headers])})}add(t,r){return this._client.post("/v3/documents",{body:t,...r})}forget(t,r){return this._client.delete("/v4/memories",{body:t,...r})}get(t,r){return this._client.get((0,Qe.path)`/v3/documents/${t}`,r)}updateMemory(t,r){return this._client.patch("/v4/memories",{body:t,...r})}uploadFile(t,r){return this._client.post("/v3/documents/file",(0,En.multipartFormRequestOptions)({body:t,...r},this._client))}};be.Memories=Ze});var rt=d(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.Search=void 0;var Pn=$(),tt=class extends Pn.APIResource{documents(t,r){return this._client.post("/v3/search",{body:t,...r})}execute(t,r){return this._client.post("/v3/search",{body:t,...r})}memories(t,r){return this._client.post("/v4/search",{body:t,...r})}};_e.Search=tt});var ot=d(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.Settings=void 0;var Rn=$(),nt=class extends Rn.APIResource{update(t={},r){return this._client.patch("/v3/settings",{body:t,...r})}get(t){return this._client.get("/v3/settings",t)}};we.Settings=nt});var Nt=d(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.Settings=P.Search=P.Memories=P.Documents=P.Connections=void 0;var On=We();Object.defineProperty(P,"Connections",{enumerable:!0,get:function(){return On.Connections}});var vn=ze();Object.defineProperty(P,"Documents",{enumerable:!0,get:function(){return vn.Documents}});var An=et();Object.defineProperty(P,"Memories",{enumerable:!0,get:function(){return An.Memories}});var In=rt();Object.defineProperty(P,"Search",{enumerable:!0,get:function(){return In.Search}});var Fn=ot();Object.defineProperty(P,"Settings",{enumerable:!0,get:function(){return Fn.Settings}})});var st=d(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.formatRequestDetails=M.parseLogLevel=void 0;M.loggerFor=Ht;var jn=H(),Ee={off:0,error:200,warn:300,info:400,debug:500},qn=(e,t,r)=>{if(e){if((0,jn.hasOwn)(Ee,e))return e;Ht(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(Ee))}`)}};M.parseLogLevel=qn;function W(){}function Se(e,t,r){return!t||Ee[e]>Ee[r]?W:t[e].bind(t)}var Mn={error:W,warn:W,info:W,debug:W},Bt=new WeakMap;function Ht(e){let t=e.logger,r=e.logLevel??"off";if(!t)return Mn;let n=Bt.get(t);if(n&&n[0]===r)return n[1];let o={error:Se("error",t,r),warn:Se("warn",t,r),info:Se("info",t,r),debug:Se("debug",t,r)};return Bt.set(t,[r,o]),o}var Tn=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,r])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":r]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);M.formatRequestDetails=Tn});var Kt=d(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.defaultParseResponse=$n;var Xt=st();async function $n(e,t){let{response:r,requestLogID:n,retryOfRequestLogID:o,startTime:s}=t,i=await(async()=>{if(r.status===204)return null;if(t.options.__binaryResponse)return r;let b=r.headers.get("content-type")?.split(";")[0]?.trim();return b?.includes("application/json")||b?.endsWith("+json")?await r.json():await r.text()})();return(0,Xt.loggerFor)(e).debug(`[${n}] response parsed`,(0,Xt.formatRequestDetails)({retryOfRequestLogID:o,url:r.url,status:r.status,body:i,durationMs:Date.now()-s})),i}});var ut=d(Pe=>{"use strict";var J;Object.defineProperty(Pe,"__esModule",{value:!0});Pe.APIPromise=void 0;var at=Te(),xn=Kt(),ct=class e extends Promise{constructor(t,r,n=xn.defaultParseResponse){super(o=>{o(null)}),this.responsePromise=r,this.parseResponse=n,J.set(this,void 0),at.__classPrivateFieldSet(this,J,t,"f")}_thenUnwrap(t){return new e(at.__classPrivateFieldGet(this,J,"f"),this.responsePromise,async(r,n)=>t(await this.parseResponse(r,n),n))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:r}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(at.__classPrivateFieldGet(this,J,"f"),t))),this.parsedPromise}then(t,r){return this.parse().then(t,r)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}};Pe.APIPromise=ct;J=new WeakMap});var Yt=d(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.readEnv=void 0;var Un=e=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[e]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(e)?.trim()};Re.readEnv=Un});var gt=d(ve=>{"use strict";var ht,yt,Oe,Vt;Object.defineProperty(ve,"__esModule",{value:!0});ve.Supermemory=void 0;var j=Te(),Cn=Ot(),lt=H(),Ln=vt(),dt=$e(),Dn=jt(),ft=j.__importStar(Le()),kn=j.__importStar(Mt()),Nn=Ce(),h=j.__importStar(N()),Bn=j.__importStar(Xe()),G=j.__importStar(Nt()),Hn=ut(),Xn=We(),Kn=ze(),Yn=et(),Vn=rt(),Wn=ot(),pt=V(),mt=Yt(),g=st(),Jn=H(),p=class{constructor({baseURL:t=(0,mt.readEnv)("SUPERMEMORY_BASE_URL"),apiKey:r=(0,mt.readEnv)("SUPERMEMORY_API_KEY"),...n}={}){if(ht.add(this),Oe.set(this,void 0),this.memories=new G.Memories(this),this.documents=new G.Documents(this),this.search=new G.Search(this),this.settings=new G.Settings(this),this.connections=new G.Connections(this),r===void 0)throw new h.SupermemoryError("The SUPERMEMORY_API_KEY environment variable is missing or empty; either provide it, or instantiate the Supermemory client with an apiKey option, like new Supermemory({ apiKey: 'My API Key' }).");let o={apiKey:r,...n,baseURL:t||"https://api.supermemory.ai"};this.baseURL=o.baseURL,this.timeout=o.timeout??yt.DEFAULT_TIMEOUT,this.logger=o.logger??console;let s="warn";this.logLevel=s,this.logLevel=(0,g.parseLogLevel)(o.logLevel,"ClientOptions.logLevel",this)??(0,g.parseLogLevel)((0,mt.readEnv)("SUPERMEMORY_LOG"),"process.env['SUPERMEMORY_LOG']",this)??s,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??ft.getDefaultFetch(),j.__classPrivateFieldSet(this,Oe,kn.FallbackEncoder,"f"),this._options=o,this.apiKey=r}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,...t})}add(t,r){return this.post("/v3/documents",{body:t,...r})}profile(t,r){return this.post("/v4/profile",{body:t,...r})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:r}){}async authHeaders(t){return(0,pt.buildHeaders)([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return Object.entries(t).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new h.SupermemoryError(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Nn.VERSION}`}defaultIdempotencyKey(){return`stainless-node-retry-${(0,Cn.uuid4)()}`}makeStatusError(t,r,n,o){return h.APIError.generate(t,r,n,o)}buildURL(t,r,n){let o=!j.__classPrivateFieldGet(this,ht,"m",Vt).call(this)&&n||this.baseURL,s=(0,lt.isAbsoluteURL)(t)?new URL(t):new URL(o+(o.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),i=this.defaultQuery();return(0,Jn.isEmptyObj)(i)||(r={...i,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(s.search=this.stringifyQuery(r)),s.toString()}async prepareOptions(t){}async prepareRequest(t,{url:r,options:n}){}get(t,r){return this.methodRequest("get",t,r)}post(t,r){return this.methodRequest("post",t,r)}patch(t,r){return this.methodRequest("patch",t,r)}put(t,r){return this.methodRequest("put",t,r)}delete(t,r){return this.methodRequest("delete",t,r)}methodRequest(t,r,n){return this.request(Promise.resolve(n).then(o=>({method:t,path:r,...o})))}request(t,r=null){return new Hn.APIPromise(this,this.makeRequest(t,r,void 0))}async makeRequest(t,r,n){let o=await t,s=o.maxRetries??this.maxRetries;r==null&&(r=s),await this.prepareOptions(o);let{req:i,url:l,timeout:b}=await this.buildRequest(o,{retryCount:s-r});await this.prepareRequest(i,{url:l,options:o});let m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),w=n===void 0?"":`, retryOf: ${n}`,_=Date.now();if((0,g.loggerFor)(this).debug(`[${m}] sending request`,(0,g.formatRequestDetails)({retryOfRequestLogID:n,method:o.method,url:l,options:o,headers:i.headers})),o.signal?.aborted)throw new h.APIUserAbortError;let R=new AbortController,a=await this.fetchWithTimeout(l,i,b,R).catch(dt.castToError),O=Date.now();if(a instanceof globalThis.Error){let C=`retrying, ${r} attempts remaining`;if(o.signal?.aborted)throw new h.APIUserAbortError;let I=(0,dt.isAbortError)(a)||/timed? ?out/i.test(String(a)+("cause"in a?String(a.cause):""));if(r)return(0,g.loggerFor)(this).info(`[${m}] connection ${I?"timed out":"failed"} - ${C}`),(0,g.loggerFor)(this).debug(`[${m}] connection ${I?"timed out":"failed"} (${C})`,(0,g.formatRequestDetails)({retryOfRequestLogID:n,url:l,durationMs:O-_,message:a.message})),this.retryRequest(o,r,n??m);throw(0,g.loggerFor)(this).info(`[${m}] connection ${I?"timed out":"failed"} - error; no more retries left`),(0,g.loggerFor)(this).debug(`[${m}] connection ${I?"timed out":"failed"} (error; no more retries left)`,(0,g.formatRequestDetails)({retryOfRequestLogID:n,url:l,durationMs:O-_,message:a.message})),I?new h.APIConnectionTimeoutError:new h.APIConnectionError({cause:a})}let U=`[${m}${w}] ${i.method} ${l} ${a.ok?"succeeded":"failed"} with status ${a.status} in ${O-_}ms`;if(!a.ok){let C=await this.shouldRetry(a);if(r&&C){let Z=`retrying, ${r} attempts remaining`;return await ft.CancelReadableStream(a.body),(0,g.loggerFor)(this).info(`${U} - ${Z}`),(0,g.loggerFor)(this).debug(`[${m}] response error (${Z})`,(0,g.formatRequestDetails)({retryOfRequestLogID:n,url:a.url,status:a.status,headers:a.headers,durationMs:O-_})),this.retryRequest(o,r,n??m,a.headers)}let I=C?"error; no more retries left":"error; not retryable";(0,g.loggerFor)(this).info(`${U} - ${I}`);let St=await a.text().catch(Z=>(0,dt.castToError)(Z).message),Et=(0,lt.safeJSON)(St),Pt=Et?void 0:St;throw(0,g.loggerFor)(this).debug(`[${m}] response error (${I})`,(0,g.formatRequestDetails)({retryOfRequestLogID:n,url:a.url,status:a.status,headers:a.headers,message:Pt,durationMs:Date.now()-_})),this.makeStatusError(a.status,Et,Pt,a.headers)}return(0,g.loggerFor)(this).info(U),(0,g.loggerFor)(this).debug(`[${m}] response start`,(0,g.formatRequestDetails)({retryOfRequestLogID:n,url:a.url,status:a.status,headers:a.headers,durationMs:O-_})),{response:a,options:o,controller:R,requestLogID:m,retryOfRequestLogID:n,startTime:_}}async fetchWithTimeout(t,r,n,o){let{signal:s,method:i,...l}=r||{};s&&s.addEventListener("abort",()=>o.abort());let b=setTimeout(()=>o.abort(),n),m=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,w={signal:o.signal,...m?{duplex:"half"}:{},method:"GET",...l};i&&(w.method=i.toUpperCase());try{return await this.fetch.call(void 0,t,w)}finally{clearTimeout(b)}}async shouldRetry(t){let r=t.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,r,n,o){let s,i=o?.get("retry-after-ms");if(i){let b=parseFloat(i);Number.isNaN(b)||(s=b)}let l=o?.get("retry-after");if(l&&!s){let b=parseFloat(l);Number.isNaN(b)?s=Date.parse(l)-Date.now():s=b*1e3}if(!(s&&0<=s&&s<60*1e3)){let b=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,b)}return await(0,Ln.sleep)(s),this.makeRequest(t,r-1,n)}calculateDefaultRetryTimeoutMillis(t,r){let s=r-t,i=Math.min(.5*Math.pow(2,s),8),l=1-Math.random()*.25;return i*l*1e3}async buildRequest(t,{retryCount:r=0}={}){let n={...t},{method:o,path:s,query:i,defaultBaseURL:l}=n,b=this.buildURL(s,i,l);"timeout"in n&&(0,lt.validatePositiveInteger)("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:m,body:w}=this.buildBody({options:n}),_=await this.buildHeaders({options:t,method:o,bodyHeaders:m,retryCount:r});return{req:{method:o,headers:_,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&w instanceof globalThis.ReadableStream&&{duplex:"half"},...w&&{body:w},...this.fetchOptions??{},...n.fetchOptions??{}},url:b,timeout:n.timeout}}async buildHeaders({options:t,method:r,bodyHeaders:n,retryCount:o}){let s={};this.idempotencyHeader&&r!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=t.idempotencyKey);let i=(0,pt.buildHeaders)([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...(0,Dn.getPlatformHeaders)()},await this.authHeaders(t),this._options.defaultHeaders,n,t.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:t,headers:r}}){if(!t)return{bodyHeaders:void 0,body:void 0};let n=(0,pt.buildHeaders)([r]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:ft.ReadableStreamFrom(t)}:j.__classPrivateFieldGet(this,Oe,"f").call(this,{body:t,headers:n})}};ve.Supermemory=p;yt=p,Oe=new WeakMap,ht=new WeakSet,Vt=function(){return this.baseURL!=="https://api.supermemory.ai"};p.Supermemory=yt;p.DEFAULT_TIMEOUT=6e4;p.SupermemoryError=h.SupermemoryError;p.APIError=h.APIError;p.APIConnectionError=h.APIConnectionError;p.APIConnectionTimeoutError=h.APIConnectionTimeoutError;p.APIUserAbortError=h.APIUserAbortError;p.NotFoundError=h.NotFoundError;p.ConflictError=h.ConflictError;p.RateLimitError=h.RateLimitError;p.BadRequestError=h.BadRequestError;p.AuthenticationError=h.AuthenticationError;p.InternalServerError=h.InternalServerError;p.PermissionDeniedError=h.PermissionDeniedError;p.UnprocessableEntityError=h.UnprocessableEntityError;p.toFile=Bn.toFile;p.Memories=Yn.Memories;p.Documents=Kn.Documents;p.Search=Vn.Search;p.Settings=Wn.Settings;p.Connections=Xn.Connections});var Jt=d((c,Wt)=>{"use strict";c=Wt.exports=function(...e){return new c.default(...e)};Object.defineProperty(c,"__esModule",{value:!0});c.UnprocessableEntityError=c.PermissionDeniedError=c.InternalServerError=c.AuthenticationError=c.BadRequestError=c.RateLimitError=c.ConflictError=c.NotFoundError=c.APIUserAbortError=c.APIConnectionTimeoutError=c.APIConnectionError=c.APIError=c.SupermemoryError=c.Supermemory=c.APIPromise=c.toFile=c.default=void 0;var Gn=gt();Object.defineProperty(c,"default",{enumerable:!0,get:function(){return Gn.Supermemory}});var zn=Xe();Object.defineProperty(c,"toFile",{enumerable:!0,get:function(){return zn.toFile}});var Qn=ut();Object.defineProperty(c,"APIPromise",{enumerable:!0,get:function(){return Qn.APIPromise}});var Zn=gt();Object.defineProperty(c,"Supermemory",{enumerable:!0,get:function(){return Zn.Supermemory}});var E=N();Object.defineProperty(c,"SupermemoryError",{enumerable:!0,get:function(){return E.SupermemoryError}});Object.defineProperty(c,"APIError",{enumerable:!0,get:function(){return E.APIError}});Object.defineProperty(c,"APIConnectionError",{enumerable:!0,get:function(){return E.APIConnectionError}});Object.defineProperty(c,"APIConnectionTimeoutError",{enumerable:!0,get:function(){return E.APIConnectionTimeoutError}});Object.defineProperty(c,"APIUserAbortError",{enumerable:!0,get:function(){return E.APIUserAbortError}});Object.defineProperty(c,"NotFoundError",{enumerable:!0,get:function(){return E.NotFoundError}});Object.defineProperty(c,"ConflictError",{enumerable:!0,get:function(){return E.ConflictError}});Object.defineProperty(c,"RateLimitError",{enumerable:!0,get:function(){return E.RateLimitError}});Object.defineProperty(c,"BadRequestError",{enumerable:!0,get:function(){return E.BadRequestError}});Object.defineProperty(c,"AuthenticationError",{enumerable:!0,get:function(){return E.AuthenticationError}});Object.defineProperty(c,"InternalServerError",{enumerable:!0,get:function(){return E.InternalServerError}});Object.defineProperty(c,"PermissionDeniedError",{enumerable:!0,get:function(){return E.PermissionDeniedError}});Object.defineProperty(c,"UnprocessableEntityError",{enumerable:!0,get:function(){return E.UnprocessableEntityError}})});var zt={};fr(zt,{getRequestIntegrity:()=>po,sanitizeContent:()=>no,sanitizeMetadata:()=>co,validateApiKeyFormat:()=>eo,validateContainerTag:()=>to,validateContentLength:()=>oo,validateRecallConfig:()=>uo});function eo(e){return!e||typeof e!="string"?{valid:!1,reason:"key is empty or not a string"}:e.startsWith("sm_")?e.length<20?{valid:!1,reason:"key is too short"}:/\s/.test(e)?{valid:!1,reason:"key contains whitespace"}:{valid:!0}:{valid:!1,reason:"key must start with sm_ prefix"}}function to(e){return!e||typeof e!="string"?{valid:!1,reason:"tag is empty"}:e.length>100?{valid:!1,reason:"tag exceeds 100 characters"}:/^[a-zA-Z0-9_-]+$/.test(e)?/^[-_]|[-_]$/.test(e)?{valid:!1,reason:"tag must not start or end with - or _"}:{valid:!0}:{valid:!1,reason:"tag contains invalid characters (only alphanumeric, underscore, hyphen allowed)"}}function no(e,t=1e5){if(!e||typeof e!="string")return"";let r=e;for(let n of ro)r=r.replace(n,"");return r.length>t&&(r=r.slice(0,t)),r}function oo(e,t=1,r=1e5){return e.length<t?{valid:!1,reason:`content below minimum length (${t})`}:e.length>r?{valid:!1,reason:`content exceeds maximum length (${r})`}:{valid:!0}}function co(e){let t={},r=0;for(let[n,o]of Object.entries(e)){if(r>=so)break;n.length>io||/[^\w.-]/.test(n)||(typeof o=="string"?(t[n]=o.slice(0,ao),r++):(typeof o=="number"&&Number.isFinite(o)||typeof o=="boolean")&&(t[n]=o,r++))}return t}function uo(e,t){let r=[];return(!Number.isInteger(e)||e<1||e>20)&&r.push("maxRecallResults must be an integer between 1 and 20"),(!Number.isInteger(t)||t<1||t>500)&&r.push("profileFrequency must be an integer between 1 and 500"),r}function bt(e){return(0,Ae.createHash)("sha256").update(e).digest("hex")}function fo(e,t){let r=[bt(e),bt(t),Gt].join(":");return(0,Ae.createHmac)("sha256",lo).update(r).digest("base64url")}function po(e,t){let r=bt(t),n=fo(e,t);return{"X-Content-Hash":r,"X-Request-Integrity":[`v${Gt}`,n].join(".")}}var Ae,ro,so,io,ao,Gt,lo,Qt=dr(()=>{Ae=require("node:crypto");ro=[/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,/\uFEFF/g,/[\uFFF0-\uFFFF]/g];so=50,io=128,ao=1024;Gt=1,lo="7f2a9c4b8e1d6f3a5c0b9d8e7f6a5b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9f8a"});var er=d((fs,Zt)=>{var mo=Jt().default,{getRequestIntegrity:ho,validateApiKeyFormat:yo,validateContainerTag:go}=(Qt(),mr(zt)),bo="claudecode_default",_o=process.env.SUPERMEMORY_API_URL||"https://api.supermemory.ai",_t=class{constructor(t,r){if(!t)throw new Error("SUPERMEMORY_CC_API_KEY is required");let n=yo(t);if(!n.valid)throw new Error(`Invalid API key: ${n.reason}`);let o=r||bo,s=go(o);s.valid||console.warn(`Container tag warning: ${s.reason}`);let i=ho(t,o);this.client=new mo({apiKey:t,baseURL:_o,defaultHeaders:i}),this.containerTag=o}async addMemory(t,r,n={},o=null){let s={content:t,containerTag:r||this.containerTag,metadata:{sm_source:"claude-code-plugin",...n}};o&&(s.customId=o);let i=await this.client.add(s);return{id:i.id,status:i.status,containerTag:r||this.containerTag}}async search(t,r,n={}){let o=await this.client.search.memories({q:t,containerTag:r||this.containerTag,limit:n.limit||10,searchMode:n.searchMode||"hybrid"});return{results:o.results.map(s=>({id:s.id,memory:s.content||s.memory||s.context||"",similarity:s.similarity,title:s.title,content:s.content})),total:o.total,timing:o.timing}}async getProfile(t,r){let n=await this.client.profile({containerTag:t||this.containerTag,q:r});return{profile:{static:n.profile?.static||[],dynamic:n.profile?.dynamic||[]},searchResults:n.searchResults?{results:n.searchResults.results.map(o=>({id:o.id,memory:o.content||o.context||"",similarity:o.similarity,title:o.title})),total:n.searchResults.total,timing:n.searchResults.timing}:void 0}}async listMemories(t,r=20){let n=await this.client.memories.list({containerTags:t||this.containerTag,limit:r,order:"desc",sort:"createdAt"});return{memories:n.memories||n.results||[]}}async deleteMemory(t){return this.client.memories.delete(t)}};Zt.exports={SupermemoryClient:_t}});var nr=d((ps,rr)=>{var{execSync:tr}=require("node:child_process"),wo=require("node:crypto");function Ie(e){return wo.createHash("sha256").update(e).digest("hex").slice(0,16)}function wt(e){try{return tr("git rev-parse --show-toplevel",{cwd:e,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function So(e){let r=wt(e)||e;return`claudecode_project_${Ie(r)}`}function Eo(e){return(wt(e)||e).split("/").pop()||"unknown"}function Po(){try{let t=tr("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(t)return`claudecode_user_${Ie(t)}`}catch{}let e=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${Ie(e)}`}rr.exports={sha256:Ie,getGitRoot:wt,getContainerTag:So,getProjectName:Eo,getUserContainerTag:Po}});var ar=d((ms,ir)=>{var Q=require("node:fs"),or=require("node:path"),Ro=require("node:os"),Fe=or.join(Ro.homedir(),".supermemory-claude"),z=or.join(Fe,"settings.json"),sr={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function Oo(){Q.existsSync(Fe)||Q.mkdirSync(Fe,{recursive:!0})}function vo(){let e={...sr};try{if(Q.existsSync(z)){let t=Q.readFileSync(z,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${z}: ${t.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function Ao(e){Oo();let t={...e};delete t.apiKey,Q.writeFileSync(z,JSON.stringify(t,null,2))}function Io(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function Fo(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function jo(e,t,r){if(e.debug){let n=new Date().toISOString();console.error(r?`[${n}] ${t}: ${JSON.stringify(r)}`:`[${n}] ${t}`)}}ir.exports={SETTINGS_DIR:Fe,SETTINGS_FILE:z,DEFAULT_SETTINGS:sr,loadSettings:vo,saveSettings:Ao,getApiKey:Io,shouldCaptureTool:Fo,debugLog:jo}});var{SupermemoryClient:qo}=er(),{getContainerTag:Mo,getProjectName:To}=nr(),{loadSettings:$o,getApiKey:xo}=ar();async function Uo(){let e=process.argv.slice(2).join(" ");if(!e||!e.trim()){console.log('No content provided. Usage: node add-memory.cjs "content to save"');return}let t=$o(),r;try{r=xo(t)}catch{console.log("Supermemory API key not configured."),console.log("Set SUPERMEMORY_CC_API_KEY environment variable.");return}let n=process.cwd(),o=Mo(n),s=To(n);try{let l=await new qo(r,o).addMemory(e,o,{type:"manual",project:s,timestamp:new Date().toISOString()});console.log(`Memory saved to project: ${s}`),console.log(`ID: ${l.id}`)}catch(i){console.log(`Error saving memory: ${i.message}`)}}Uo().catch(e=>{console.error(`Fatal error: ${e.message}`),process.exit(1)});
