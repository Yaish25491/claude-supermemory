#!/usr/bin/env node
var x=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var wr=x((Jl,kr)=>{var ho=require("better-sqlite3"),ge=require("node:path"),vr=require("node:fs"),mo=require("node:os"),go=ge.join(mo.homedir(),".claude-memory"),he=ge.join(go,"memories.db"),me=class{constructor(e=he){e||(e=he);let r=ge.dirname(e);vr.existsSync(r)||vr.mkdirSync(r,{recursive:!0}),this.db=new ho(e),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(e,r,s,n={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(e,r,s,JSON.stringify(n),i,i),{id:e,createdAt:i}}getMemory(e){let s=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(e);return s?.metadata&&(s.metadata=JSON.parse(s.metadata)),s}updateMemory(e,r,s=null){let n=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,n,"pending"];s!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(s))),o.push(e),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(e){this.db.prepare("DELETE FROM memories WHERE id = ?").run(e)}listMemories(e,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(s=>(s.metadata&&(s.metadata=JSON.parse(s.metadata)),s))}markSynced(e){let r=Date.now(),s=e.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${s})
    `).run(r,...e)}searchMemories(e,r=null,s=10){let n=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[e];return r&&(n+=" AND m.container_tag = ?",i.push(r)),n+=" ORDER BY rank LIMIT ?",i.push(s),this.db.prepare(n).all(...i).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}getContextMemories(e,r,s=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,Math.floor(s/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,e,Math.floor(s/2)),u=new Set(i.map(p=>p.id)),g=[...i];for(let p of a)u.has(p.id)||(g.push(p),u.add(p.id));return g.slice(0,s).map(p=>(p.metadata&&(p.metadata=JSON.parse(p.metadata)),p))}addProfileFact(e,r,s,n="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(e,r,s,n,i)}getProfile(e,r=5){let n=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(e,r);return{static:n.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(e){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(e)}close(){this.db.close()}};kr.exports={SqliteManager:me,DEFAULT_DB_PATH:he}});var Sr=x((Kl,Er)=>{var ct=1e3,ut=ct*60,lt=ut*60,tt=lt*24,_o=tt*7,yo=tt*365.25;Er.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return bo(t);if(r==="number"&&isFinite(t))return e.long?vo(t):To(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function bo(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),s=(e[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*yo;case"weeks":case"week":case"w":return r*_o;case"days":case"day":case"d":return r*tt;case"hours":case"hour":case"hrs":case"hr":case"h":return r*lt;case"minutes":case"minute":case"mins":case"min":case"m":return r*ut;case"seconds":case"second":case"secs":case"sec":case"s":return r*ct;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function To(t){var e=Math.abs(t);return e>=tt?Math.round(t/tt)+"d":e>=lt?Math.round(t/lt)+"h":e>=ut?Math.round(t/ut)+"m":e>=ct?Math.round(t/ct)+"s":t+"ms"}function vo(t){var e=Math.abs(t);return e>=tt?It(t,e,tt,"day"):e>=lt?It(t,e,lt,"hour"):e>=ut?It(t,e,ut,"minute"):e>=ct?It(t,e,ct,"second"):t+" ms"}function It(t,e,r,s){var n=e>=r*1.5;return Math.round(t/r)+" "+s+(n?"s":"")}});var _e=x((Ql,Cr)=>{function ko(t){r.debug=r,r.default=r,r.coerce=u,r.disable=o,r.enable=n,r.enabled=a,r.humanize=Sr(),r.destroy=g,Object.keys(t).forEach(p=>{r[p]=t[p]}),r.names=[],r.skips=[],r.formatters={};function e(p){let f=0;for(let d=0;d<p.length;d++)f=(f<<5)-f+p.charCodeAt(d),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=e;function r(p){let f,d=null,h,U;function O(...I){if(!O.enabled)return;let K=O,ot=Number(new Date),le=ot-(f||ot);K.diff=le,K.prev=f,K.curr=ot,f=ot,I[0]=r.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let at=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(_t,pe)=>{if(_t==="%%")return"%";at++;let Nt=r.formatters[pe];if(typeof Nt=="function"){let fe=I[at];_t=Nt.call(K,fe),I.splice(at,1),at--}return _t}),r.formatArgs.call(K,I),(K.log||r.log).apply(K,I)}return O.namespace=p,O.useColors=r.useColors(),O.color=r.selectColor(p),O.extend=s,O.destroy=r.destroy,Object.defineProperty(O,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==r.namespaces&&(h=r.namespaces,U=r.enabled(p)),U),set:I=>{d=I}}),typeof r.init=="function"&&r.init(O),O}function s(p,f){let d=r(this.namespace+(typeof f>"u"?":":f)+p);return d.log=this.log,d}function n(p){r.save(p),r.namespaces=p,r.names=[],r.skips=[];let f=(typeof p=="string"?p:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let d of f)d[0]==="-"?r.skips.push(d.slice(1)):r.names.push(d)}function i(p,f){let d=0,h=0,U=-1,O=0;for(;d<p.length;)if(h<f.length&&(f[h]===p[d]||f[h]==="*"))f[h]==="*"?(U=h,O=d,h++):(d++,h++);else if(U!==-1)h=U+1,O++,d=O;else return!1;for(;h<f.length&&f[h]==="*";)h++;return h===f.length}function o(){let p=[...r.names,...r.skips.map(f=>"-"+f)].join(",");return r.enable(""),p}function a(p){for(let f of r.skips)if(i(p,f))return!1;for(let f of r.names)if(i(p,f))return!0;return!1}function u(p){return p instanceof Error?p.stack||p.message:p}function g(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Cr.exports=ko});var Or=x((P,Pt)=>{P.formatArgs=Eo;P.save=So;P.load=Co;P.useColors=wo;P.storage=Oo();P.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();P.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function wo(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Eo(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Pt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(r++,n==="%c"&&(s=r))}),t.splice(s,0,e)}P.log=console.debug||console.log||(()=>{});function So(t){try{t?P.storage.setItem("debug",t):P.storage.removeItem("debug")}catch{}}function Co(){let t;try{t=P.storage.getItem("debug")||P.storage.getItem("DEBUG")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function Oo(){try{return localStorage}catch{}}Pt.exports=_e()(P);var{formatters:Ro}=Pt.exports;Ro.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Fr=x((R,Lt)=>{var Fo=require("tty"),Dt=require("util");R.init=Do;R.log=No;R.formatArgs=Ao;R.save=Io;R.load=Po;R.useColors=xo;R.destroy=Dt.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");R.colors=[6,2,3,4,5,1];try{let t=require("supports-color");t&&(t.stderr||t).level>=2&&(R.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}R.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),s=process.env[e];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),t[r]=s,t},{});function xo(){return"colors"in R.inspectOpts?!!R.inspectOpts.colors:Fo.isatty(process.stderr.fd)}function Ao(t){let{namespace:e,useColors:r}=this;if(r){let s=this.color,n="\x1B[3"+(s<8?s:"8;5;"+s),i=`  ${n};1m${e} \x1B[0m`;t[0]=i+t[0].split(`
`).join(`
`+i),t.push(n+"m+"+Lt.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=Mo()+e+" "+t[0]}function Mo(){return R.inspectOpts.hideDate?"":new Date().toISOString()+" "}function No(...t){return process.stderr.write(Dt.formatWithOptions(R.inspectOpts,...t)+`
`)}function Io(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function Po(){return process.env.DEBUG}function Do(t){t.inspectOpts={};let e=Object.keys(R.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=R.inspectOpts[e[r]]}Lt.exports=_e()(R);var{formatters:Rr}=Lt.exports;Rr.o=function(t){return this.inspectOpts.colors=this.useColors,Dt.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Rr.O=function(t){return this.inspectOpts.colors=this.useColors,Dt.inspect(t,this.inspectOpts)}});var be=x((Vl,ye)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?ye.exports=Or():ye.exports=Fr()});var xr=x(j=>{"use strict";var Lo=j&&j.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(j,"__esModule",{value:!0});var $o=require("fs"),jo=Lo(be()),pt=jo.default("@kwsites/file-exists");function Bo(t,e,r){pt("checking %s",t);try{let s=$o.statSync(t);return s.isFile()&&e?(pt("[OK] path represents a file"),!0):s.isDirectory()&&r?(pt("[OK] path represents a directory"),!0):(pt("[FAIL] path represents something other than a file or directory"),!1)}catch(s){if(s.code==="ENOENT")return pt("[FAIL] path is not accessible: %o",s),!1;throw pt("[FATAL] %o",s),s}}function Go(t,e=j.READABLE){return Bo(t,(e&j.FILE)>0,(e&j.FOLDER)>0)}j.exists=Go;j.FILE=1;j.FOLDER=2;j.READABLE=j.FILE+j.FOLDER});var Ar=x($t=>{"use strict";function Uo(t){for(var e in t)$t.hasOwnProperty(e)||($t[e]=t[e])}Object.defineProperty($t,"__esModule",{value:!0});Uo(xr())});var ve=x(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.createDeferred=et.deferred=void 0;function Te(){let t,e,r="pending";return{promise:new Promise((n,i)=>{t=n,e=i}),done(n){r==="pending"&&(r="resolved",t(n))},fail(n){r==="pending"&&(r="rejected",e(n))},get fulfilled(){return r!=="pending"},get status(){return r}}}et.deferred=Te;et.createDeferred=Te;et.default=Te});var Si=x((rp,Ei)=>{"use strict";var qo=Object.create,Kt=Object.defineProperty,Xo=Object.getOwnPropertyDescriptor,qe=Object.getOwnPropertyNames,Ho=Object.getPrototypeOf,Wo=Object.prototype.hasOwnProperty,c=(t,e)=>function(){return t&&(e=(0,t[qe(t)[0]])(t=0)),e},zo=(t,e)=>function(){return e||(0,t[qe(t)[0]])((e={exports:{}}).exports,e),e.exports},E=(t,e)=>{for(var r in e)Kt(t,r,{get:e[r],enumerable:!0})},ps=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of qe(e))!Wo.call(t,n)&&n!==r&&Kt(t,n,{get:()=>e[n],enumerable:!(s=Xo(e,n))||s.enumerable});return t},Yo=(t,e,r)=>(r=t!=null?qo(Ho(t)):{},ps(e||!t||!t.__esModule?Kt(r,"default",{value:t,enumerable:!0}):r,t)),w=t=>ps(Kt({},"__esModule",{value:!0}),t),Y,Z=c({"src/lib/errors/git-error.ts"(){"use strict";Y=class extends Error{constructor(t,e){super(e),this.task=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),nt,ht=c({"src/lib/errors/git-response-error.ts"(){"use strict";Z(),nt=class extends Y{constructor(t,e){super(void 0,e||String(t)),this.git=t}}}});function fs(...t){let e=new String(t);return Qt.set(e,t),e}function Xt(t){return t instanceof String&&Qt.has(t)}function Mr(t){return Qt.get(t)||[]}var Qt,wt=c({"src/lib/args/pathspec.ts"(){"use strict";Qt=new WeakMap}}),Xe,Jo=c({"src/lib/errors/git-construct-error.ts"(){"use strict";Z(),Xe=class extends Y{constructor(t,e){super(void 0,e),this.config=t}}}}),X,Et=c({"src/lib/errors/git-plugin-error.ts"(){"use strict";Z(),X=class extends Y{constructor(t,e,r){super(t,r),this.task=t,this.plugin=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),He,ds=c({"src/lib/errors/task-configuration-error.ts"(){"use strict";Z(),He=class extends Y{constructor(t){super(void 0,t)}}}});function hs(t){return typeof t!="function"?it:t}function ms(t){return typeof t=="function"&&t!==it}function gs(t,e){let r=t.indexOf(e);return r<=0?[t,""]:[t.substr(0,r),t.substr(r+1)]}function _s(t,e=0){return ys(t)&&t.length>e?t[e]:void 0}function st(t,e=0){if(ys(t)&&t.length>e)return t[t.length-1-e]}function ys(t){return ee(t)}function St(t="",e=!0,r=`
`){return t.split(r).reduce((s,n)=>{let i=e?n.trim():n;return i&&s.push(i),s},[])}function We(t,e){return St(t,!0).map(r=>e(r))}function ze(t){return(0,Fe.exists)(t,Fe.FOLDER)}function T(t,e){return Array.isArray(t)?t.includes(e)||t.push(e):t.add(e),e}function bs(t,e){return Array.isArray(t)&&!t.includes(e)&&t.push(e),t}function Vt(t,e){if(Array.isArray(t)){let r=t.indexOf(e);r>=0&&t.splice(r,1)}else t.delete(e);return e}function J(t){return Array.isArray(t)?t:[t]}function Ts(t){return t.replace(/[\s-]+(.)/g,(e,r)=>r.toUpperCase())}function mt(t){return J(t).map(e=>e instanceof String?e:String(e))}function k(t,e=0){if(t==null)return e;let r=parseInt(t,10);return Number.isNaN(r)?e:r}function vt(t,e){let r=[];for(let s=0,n=t.length;s<n;s++)r.push(e,t[s]);return r}function kt(t){return(Array.isArray(t)?ks.Buffer.concat(t):t).toString("utf-8")}function vs(t,e){let r={};return e.forEach(s=>{t[s]!==void 0&&(r[s]=t[s])}),r}function Oe(t=0){return new Promise(e=>setTimeout(e,t))}function Re(t){if(t!==!1)return t}var ks,Fe,dt,it,Ct,Zt=c({"src/lib/utils/util.ts"(){"use strict";ks=require("node:buffer"),Fe=Ar(),Ye(),dt="\0",it=()=>{},Ct=Object.prototype.toString.call.bind(Object.prototype.toString)}});function G(t,e,r){return e(t)?t:arguments.length>2?r:void 0}function xe(t,e){let r=Xt(t)?"string":typeof t;return/number|string|boolean/.test(r)&&(!e||!e.includes(r))}function te(t){return!!t&&Ct(t)==="[object Object]"}function ws(t){return typeof t=="function"}var Ot,Es,F,Ht,ee,Ye=c({"src/lib/utils/argument-filters.ts"(){"use strict";wt(),Zt(),Ot=t=>Array.isArray(t),Es=t=>typeof t=="number",F=t=>typeof t=="string",Ht=t=>F(t)||Array.isArray(t)&&t.every(F),ee=t=>t==null||"number|boolean|function".includes(typeof t)?!1:typeof t.length=="number"}}),Ae,Ko=c({"src/lib/utils/exit-codes.ts"(){"use strict";Ae=(t=>(t[t.SUCCESS=0]="SUCCESS",t[t.ERROR=1]="ERROR",t[t.NOT_FOUND=-2]="NOT_FOUND",t[t.UNCLEAN=128]="UNCLEAN",t))(Ae||{})}}),Wt,Qo=c({"src/lib/utils/git-output-streams.ts"(){"use strict";Wt=class Ss{constructor(e,r){this.stdOut=e,this.stdErr=r}asStrings(){return new Ss(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function Vo(){throw new Error("LineParser:useMatches not implemented")}var b,V,Zo=c({"src/lib/utils/line-parser.ts"(){"use strict";b=class{constructor(t,e){this.matches=[],this.useMatches=Vo,this.parse=(r,s)=>(this.resetMatches(),this._regExp.every((n,i)=>this.addMatch(n,i,r(i)))?this.useMatches(s,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(t)?t:[t],e&&(this.useMatches=e)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(t,e,r){let s=r&&t.exec(r);return s&&this.pushMatch(e,s),!!s}pushMatch(t,e){this.matches.push(...e.slice(1))}},V=class extends b{addMatch(t,e,r){return/^remote:\s/.test(String(r))&&super.addMatch(t,e,r)}pushMatch(t,e){(t>0||e.length>1)&&super.pushMatch(t,e)}}}});function Cs(...t){let e=process.cwd(),r=Object.assign({baseDir:e,...Os},...t.filter(s=>typeof s=="object"&&s));return r.baseDir=r.baseDir||e,r.trimmed=r.trimmed===!0,r}var Os,ta=c({"src/lib/utils/simple-git-options.ts"(){"use strict";Os={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function Je(t,e=[]){return te(t)?Object.keys(t).reduce((r,s)=>{let n=t[s];if(Xt(n))r.push(n);else if(xe(n,["boolean"]))r.push(s+"="+n);else if(Array.isArray(n))for(let i of n)xe(i,["string","number"])||r.push(s+"="+i);else r.push(s);return r},e):e}function D(t,e=0,r=!1){let s=[];for(let n=0,i=e<0?t.length:e;n<i;n++)"string|number".includes(typeof t[n])&&s.push(String(t[n]));return Je(Ke(t),s),r||s.push(...ea(t)),s}function ea(t){let e=typeof st(t)=="function";return mt(G(st(t,e?1:0),Ot,[]))}function Ke(t){let e=ws(st(t));return G(st(t,e?1:0),te)}function S(t,e=!0){let r=hs(st(t));return e||ms(r)?r:void 0}var ra=c({"src/lib/utils/task-options.ts"(){"use strict";Ye(),Zt(),wt()}});function Me(t,e){return t(e.stdOut,e.stdErr)}function $(t,e,r,s=!0){return J(r).forEach(n=>{for(let i=St(n,s),o=0,a=i.length;o<a;o++){let u=(g=0)=>{if(!(o+g>=a))return i[o+g]};e.some(({parse:g})=>g(u,t))}}),t}var sa=c({"src/lib/utils/task-parser.ts"(){"use strict";Zt()}}),Rs={};E(Rs,{ExitCodes:()=>Ae,GitOutputStreams:()=>Wt,LineParser:()=>b,NOOP:()=>it,NULL:()=>dt,RemoteLineParser:()=>V,append:()=>T,appendTaskOptions:()=>Je,asArray:()=>J,asCamelCase:()=>Ts,asFunction:()=>hs,asNumber:()=>k,asStringArray:()=>mt,bufferToString:()=>kt,callTaskParser:()=>Me,createInstanceConfig:()=>Cs,delay:()=>Oe,filterArray:()=>Ot,filterFunction:()=>ws,filterHasLength:()=>ee,filterNumber:()=>Es,filterPlainObject:()=>te,filterPrimitives:()=>xe,filterString:()=>F,filterStringOrStringArray:()=>Ht,filterType:()=>G,first:()=>_s,folderExists:()=>ze,forEachLineWithContent:()=>We,getTrailingOptions:()=>D,including:()=>bs,isUserFunction:()=>ms,last:()=>st,objectToString:()=>Ct,orVoid:()=>Re,parseStringResponse:()=>$,pick:()=>vs,prefixedArray:()=>vt,remove:()=>Vt,splitOn:()=>gs,toLinesWithContent:()=>St,trailingFunctionArgument:()=>S,trailingOptionsArgument:()=>Ke});var y=c({"src/lib/utils/index.ts"(){"use strict";Ye(),Ko(),Qo(),Zo(),ta(),ra(),sa(),Zt()}}),Fs={};E(Fs,{CheckRepoActions:()=>zt,checkIsBareRepoTask:()=>As,checkIsRepoRootTask:()=>xs,checkIsRepoTask:()=>na});function na(t){switch(t){case"bare":return As();case"root":return xs()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:re,parser:Qe}}function xs(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:re,parser(e){return/^\.(git)?$/.test(e.trim())}}}function As(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:re,parser:Qe}}function ia(t){return/(Not a git repository|Kein Git-Repository)/i.test(String(t))}var zt,re,Qe,Ms=c({"src/lib/tasks/check-is-repo.ts"(){"use strict";y(),zt=(t=>(t.BARE="bare",t.IN_TREE="tree",t.IS_REPO_ROOT="root",t))(zt||{}),re=({exitCode:t},e,r,s)=>{if(t===128&&ia(e))return r(Buffer.from("false"));s(e)},Qe=t=>t.trim()==="true"}});function oa(t,e){let r=new Ns(t),s=t?Ps:Is;return St(e).forEach(n=>{let i=n.replace(s,"");r.paths.push(i),(Ds.test(i)?r.folders:r.files).push(i)}),r}var Ns,Is,Ps,Ds,aa=c({"src/lib/responses/CleanSummary.ts"(){"use strict";y(),Ns=class{constructor(t){this.dryRun=t,this.paths=[],this.files=[],this.folders=[]}},Is=/^[a-z]+\s*/i,Ps=/^[a-z]+\s+[a-z]+\s*/i,Ds=/\/$/}}),Ne={};E(Ne,{EMPTY_COMMANDS:()=>se,adhocExecTask:()=>Ls,configurationErrorTask:()=>L,isBufferTask:()=>js,isEmptyTask:()=>Bs,straightThroughBufferTask:()=>$s,straightThroughStringTask:()=>M});function Ls(t){return{commands:se,format:"empty",parser:t}}function L(t){return{commands:se,format:"empty",parser(){throw typeof t=="string"?new He(t):t}}}function M(t,e=!1){return{commands:t,format:"utf-8",parser(r){return e?String(r).trim():r}}}function $s(t){return{commands:t,format:"buffer",parser(e){return e}}}function js(t){return t.format==="buffer"}function Bs(t){return t.format==="empty"||!t.commands.length}var se,C=c({"src/lib/tasks/task.ts"(){"use strict";ds(),se=[]}}),Gs={};E(Gs,{CONFIG_ERROR_INTERACTIVE_MODE:()=>Ve,CONFIG_ERROR_MODE_REQUIRED:()=>Ze,CONFIG_ERROR_UNKNOWN_OPTION:()=>tr,CleanOptions:()=>bt,cleanTask:()=>Us,cleanWithOptionsTask:()=>ca,isCleanOptionsArray:()=>ua});function ca(t,e){let{cleanMode:r,options:s,valid:n}=la(t);return r?n.options?(s.push(...e),s.some(da)?L(Ve):Us(r,s)):L(tr+JSON.stringify(t)):L(Ze)}function Us(t,e){return{commands:["clean",`-${t}`,...e],format:"utf-8",parser(s){return oa(t==="n",s)}}}function ua(t){return Array.isArray(t)&&t.every(e=>er.has(e))}function la(t){let e,r=[],s={cleanMode:!1,options:!0};return t.replace(/[^a-z]i/g,"").split("").forEach(n=>{pa(n)?(e=n,s.cleanMode=!0):s.options=s.options&&fa(r[r.length]=`-${n}`)}),{cleanMode:e,options:r,valid:s}}function pa(t){return t==="f"||t==="n"}function fa(t){return/^-[a-z]$/i.test(t)&&er.has(t.charAt(1))}function da(t){return/^-[^\-]/.test(t)?t.indexOf("i")>0:t==="--interactive"}var Ve,Ze,tr,bt,er,qs=c({"src/lib/tasks/clean.ts"(){"use strict";aa(),y(),C(),Ve="Git clean interactive mode is not supported",Ze='Git clean mode parameter ("n" or "f") is required',tr="Git clean unknown option found in: ",bt=(t=>(t.DRY_RUN="n",t.FORCE="f",t.IGNORED_INCLUDED="x",t.IGNORED_ONLY="X",t.EXCLUDING="e",t.QUIET="q",t.RECURSIVE="d",t))(bt||{}),er=new Set(["i",...mt(Object.values(bt))])}});function ha(t){let e=new Hs;for(let r of Xs(t))e.addValue(r.file,String(r.key),r.value);return e}function ma(t,e){let r=null,s=[],n=new Map;for(let i of Xs(t,e))i.key===e&&(s.push(r=i.value),n.has(i.file)||n.set(i.file,[]),n.get(i.file).push(r));return{key:e,paths:Array.from(n.keys()),scopes:n,value:r,values:s}}function ga(t){return t.replace(/^(file):/,"")}function*Xs(t,e=null){let r=t.split("\0");for(let s=0,n=r.length-1;s<n;){let i=ga(r[s++]),o=r[s++],a=e;if(o.includes(`
`)){let u=gs(o,`
`);a=u[0],o=u[1]}yield{file:i,key:a,value:o}}}var Hs,_a=c({"src/lib/responses/ConfigList.ts"(){"use strict";y(),Hs=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((t,e)=>Object.assign(t,this.values[e]),{})),this._all}addFile(t){if(!(t in this.values)){let e=st(this.files);this.values[t]=e?Object.create(this.values[e]):{},this.files.push(t)}return this.values[t]}addValue(t,e,r){let s=this.addFile(t);Object.hasOwn(s,e)?Array.isArray(s[e])?s[e].push(r):s[e]=[s[e],r]:s[e]=r,this._all=void 0}}}});function ke(t,e){return typeof t=="string"&&Object.hasOwn(Yt,t)?t:e}function ya(t,e,r,s){let n=["config",`--${s}`];return r&&n.push("--add"),n.push(t,e),{commands:n,format:"utf-8",parser(i){return i}}}function ba(t,e){let r=["config","--null","--show-origin","--get-all",t];return e&&r.splice(1,0,`--${e}`),{commands:r,format:"utf-8",parser(s){return ma(s,t)}}}function Ta(t){let e=["config","--list","--show-origin","--null"];return t&&e.push(`--${t}`),{commands:e,format:"utf-8",parser(r){return ha(r)}}}function va(){return{addConfig(t,e,...r){return this._runTask(ya(t,e,r[0]===!0,ke(r[1],"local")),S(arguments))},getConfig(t,e){return this._runTask(ba(t,ke(e,void 0)),S(arguments))},listConfig(...t){return this._runTask(Ta(ke(t[0],void 0)),S(arguments))}}}var Yt,Ws=c({"src/lib/tasks/config.ts"(){"use strict";_a(),y(),Yt=(t=>(t.system="system",t.global="global",t.local="local",t.worktree="worktree",t))(Yt||{})}});function ka(t){return zs.has(t)}var Bt,zs,Ys=c({"src/lib/tasks/diff-name-status.ts"(){"use strict";Bt=(t=>(t.ADDED="A",t.COPIED="C",t.DELETED="D",t.MODIFIED="M",t.RENAMED="R",t.CHANGED="T",t.UNMERGED="U",t.UNKNOWN="X",t.BROKEN="B",t))(Bt||{}),zs=new Set(Object.values(Bt))}});function Js(...t){return new Qs().param(...t)}function wa(t){let e=new Set,r={};return We(t,s=>{let[n,i,o]=s.split(dt);e.add(n),(r[n]=r[n]||[]).push({line:k(i),path:n,preview:o})}),{paths:e,results:r}}function Ea(){return{grep(t){let e=S(arguments),r=D(arguments);for(let n of Ks)if(r.includes(n))return this._runTask(L(`git.grep: use of "${n}" is not supported.`),e);typeof t=="string"&&(t=Js().param(t));let s=["grep","--null","-n","--full-name",...r,...t];return this._runTask({commands:s,format:"utf-8",parser(n){return wa(n)}},e)}}}var Ks,yt,Nr,Qs,Vs=c({"src/lib/tasks/grep.ts"(){"use strict";y(),C(),Ks=["-h"],yt=Symbol("grepQuery"),Qs=class{constructor(){this[Nr]=[]}*[(Nr=yt,Symbol.iterator)](){for(let t of this[yt])yield t}and(...t){return t.length&&this[yt].push("--and","(",...vt(t,"-e"),")"),this}param(...t){return this[yt].push(...vt(t,"-e")),this}}}}),Zs={};E(Zs,{ResetMode:()=>Tt,getResetMode:()=>Ca,resetTask:()=>Sa});function Sa(t,e){let r=["reset"];return tn(t)&&r.push(`--${t}`),r.push(...e),M(r)}function Ca(t){if(tn(t))return t;switch(typeof t){case"string":case"undefined":return"soft"}}function tn(t){return typeof t=="string"&&en.includes(t)}var Tt,en,rn=c({"src/lib/tasks/reset.ts"(){"use strict";y(),C(),Tt=(t=>(t.MIXED="mixed",t.SOFT="soft",t.HARD="hard",t.MERGE="merge",t.KEEP="keep",t))(Tt||{}),en=mt(Object.values(Tt))}}),sn={};E(sn,{CheckRepoActions:()=>zt,CleanOptions:()=>bt,DiffNameStatus:()=>Bt,GitConfigScope:()=>Yt,GitConstructError:()=>Xe,GitError:()=>Y,GitPluginError:()=>X,GitResponseError:()=>nt,ResetMode:()=>Tt,TaskConfigurationError:()=>He,grepQueryBuilder:()=>Js,pathspec:()=>fs});var Oa=c({"src/lib/api.ts"(){"use strict";wt(),Jo(),Z(),Et(),ht(),ds(),Ms(),qs(),Ws(),Ys(),Vs(),rn()}});function Ra(t){return t?[{type:"spawn.before",action(s,n){t.aborted&&n.kill(new X(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(s,n){function i(){n.kill(new X(void 0,"abort","Abort signal received"))}t.addEventListener("abort",i),n.spawned.on("close",()=>t.removeEventListener("abort",i))}}]:void 0}var Fa=c({"src/lib/plugins/abort-plugin.ts"(){"use strict";Et()}});function xa(t){return typeof t=="string"&&t.trim().toLowerCase()==="-c"}function Aa(t,e){if(xa(t)&&/^\s*protocol(.[a-z]+)?.allow/.test(e))throw new X(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function Ma(t,e){if(/^\s*--(upload|receive)-pack/.test(t))throw new X(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(e==="clone"&&/^\s*-u\b/.test(t))throw new X(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(e==="push"&&/^\s*--exec\b/.test(t))throw new X(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function Na({allowUnsafeProtocolOverride:t=!1,allowUnsafePack:e=!1}={}){return{type:"spawn.args",action(r,s){return r.forEach((n,i)=>{let o=i<r.length?r[i+1]:"";t||Aa(n,o),e||Ma(n,s.method)}),r}}}var Ia=c({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";Et()}});function Pa(t){let e=vt(t,"-c");return{type:"spawn.args",action(r){return[...e,...r]}}}var Da=c({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";y()}});function La({onClose:t=!0,onExit:e=50}={}){function r(){let n=-1,i={close:(0,ft.deferred)(),closeTimeout:(0,ft.deferred)(),exit:(0,ft.deferred)(),exitTimeout:(0,ft.deferred)()},o=Promise.race([t===!1?Ie:i.closeTimeout.promise,e===!1?Ie:i.exitTimeout.promise]);return s(t,i.close,i.closeTimeout),s(e,i.exit,i.exitTimeout),{close(a){n=a,i.close.done()},exit(a){n=a,i.exit.done()},get exitCode(){return n},result:o}}function s(n,i,o){n!==!1&&(n===!0?i.promise:i.promise.then(()=>Oe(n))).then(o.done)}return{type:"spawn.after",async action(n,{spawned:i,close:o}){let a=r(),u=!0,g=()=>void(u=!1);i.stdout?.on("data",g),i.stderr?.on("data",g),i.on("error",g),i.on("close",p=>a.close(p)),i.on("exit",p=>a.exit(p));try{await a.result,u&&await Oe(50),o(a.exitCode)}catch(p){o(a.exitCode,p)}}}}var ft,Ie,$a=c({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";ft=ve(),y(),Ie=(0,ft.deferred)().promise}});function ja(t){return!t||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(t)}function Ir(t,e){if(t.length<1||t.length>2)throw new X(void 0,"binary",nn);if(t.some(ja))if(e)console.warn(Pe);else throw new X(void 0,"binary",Pe);let[s,n]=t;return{binary:s,prefix:n}}function Ba(t,e=["git"],r=!1){let s=Ir(J(e),r);t.on("binary",n=>{s=Ir(J(n),r)}),t.append("spawn.binary",()=>s.binary),t.append("spawn.args",n=>s.prefix?[s.prefix,...n]:n)}var nn,Pe,Ga=c({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";Et(),y(),nn="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",Pe="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function Ua(t){return!!(t.exitCode&&t.stdErr.length)}function qa(t){return Buffer.concat([...t.stdOut,...t.stdErr])}function Xa(t=!1,e=Ua,r=qa){return(s,n)=>!t&&s||!e(n)?s:r(n)}function Pr(t){return{type:"task.error",action(e,r){let s=t(e.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(s)?{error:new Y(void 0,s.toString("utf-8"))}:{error:s}}}}var Ha=c({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";Z()}}),Dr,on,Wa=c({"src/lib/plugins/plugin-store.ts"(){"use strict";Dr=require("node:events"),y(),on=class{constructor(){this.plugins=new Set,this.events=new Dr.EventEmitter}on(t,e){this.events.on(t,e)}reconfigure(t,e){this.events.emit(t,e)}append(t,e){let r=T(this.plugins,{type:t,action:e});return()=>this.plugins.delete(r)}add(t){let e=[];return J(t).forEach(r=>r&&this.plugins.add(T(e,r))),()=>{e.forEach(r=>this.plugins.delete(r))}}exec(t,e,r){let s=e,n=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===t&&(s=i.action(s,n));return s}}}});function za(t){let e="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?bs(i,e):i}},{type:"spawn.after",action(i,o){o.commands.includes(e)&&o.spawned.stderr?.on("data",a=>{let u=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));u&&t({method:o.method,stage:Ya(u[1]),progress:k(u[2]),processed:k(u[3]),total:k(u[4])})})}}]}function Ya(t){return String(t.toLowerCase().split(" ",1))||"unknown"}var Ja=c({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";y()}}),Ka=c({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function Qa(t){let e=vs(t,["uid","gid"]);return{type:"spawn.options",action(r){return{...e,...r}}}}var Va=c({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";y()}});function Za({block:t,stdErr:e=!0,stdOut:r=!0}){if(t>0)return{type:"spawn.after",action(s,n){let i;function o(){i&&clearTimeout(i),i=setTimeout(u,t)}function a(){n.spawned.stdout?.off("data",o),n.spawned.stderr?.off("data",o),n.spawned.off("exit",a),n.spawned.off("close",a),i&&clearTimeout(i)}function u(){a(),n.kill(new X(void 0,"timeout","block timeout reached"))}r&&n.spawned.stdout?.on("data",o),e&&n.spawned.stderr?.on("data",o),n.spawned.on("exit",a),n.spawned.on("close",a),o()}}}var tc=c({"src/lib/plugins/timout-plugin.ts"(){"use strict";Et()}}),ec=c({"src/lib/plugins/index.ts"(){"use strict";Fa(),Ia(),Da(),$a(),Ga(),Ha(),Wa(),Ja(),Ka(),Va(),tc()}});function rc(){return{type:"spawn.args",action(t){let e=[],r;function s(n){(r=r||[]).push(...n)}for(let n=0;n<t.length;n++){let i=t[n];if(Xt(i)){s(Mr(i));continue}if(i==="--"){s(t.slice(n+1).flatMap(o=>Xt(o)&&Mr(o)||o));break}e.push(i)}return r?[...e,"--",...r.map(String)]:e}}}var sc=c({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";wt()}});function nc(){return(0,Gt.default)("simple-git")}function Lr(t,e,r){return!e||!String(e).replace(/\s*/,"")?r?(s,...n)=>{t(s,...n),r(s,...n)}:t:(s,...n)=>{t(`%s ${s}`,e,...n),r&&r(s,...n)}}function ic(t,e,{namespace:r}){if(typeof t=="string")return t;let s=e&&e.namespace||"";return s.startsWith(r)?s.substr(r.length+1):s||r}function rr(t,e,r,s=nc()){let n=t&&`[${t}]`||"",i=[],o=typeof e=="string"?s.extend(e):e,a=ic(G(e,F),o,s);return g(r);function u(p,f){return T(i,rr(t,a.replace(/^[^:]+/,p),f,s))}function g(p){let f=p&&`[${p}]`||"",d=o&&Lr(o,f)||it,h=Lr(s,`${n} ${f}`,d);return Object.assign(o?d:h,{label:t,sibling:u,info:h,step:g})}}var Gt,an=c({"src/lib/git-logger.ts"(){"use strict";Gt=Yo(be()),y(),Gt.default.formatters.L=t=>String(ee(t)?t.length:"-"),Gt.default.formatters.B=t=>Buffer.isBuffer(t)?t.toString("utf8"):Ct(t)}}),cn,oc=c({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";Z(),an(),cn=class De{constructor(e="GitExecutor"){this.logLabel=e,this._queue=new Map}withProgress(e){return this._queue.get(e)}createProgress(e){let r=De.getName(e.commands[0]),s=rr(this.logLabel,r);return{task:e,logger:s,name:r}}push(e){let r=this.createProgress(e);return r.logger("Adding task to the queue, commands = %o",e.commands),this._queue.set(e,r),r}fatal(e){for(let[r,{logger:s}]of Array.from(this._queue.entries()))r===e.task?(s.info("Failed %o",e),s("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):s.info("A fatal exception occurred in a previous task, the queue has been purged: %o",e.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(e){this.withProgress(e)&&this._queue.delete(e)}attempt(e){let r=this.withProgress(e);if(!r)throw new Y(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(e="empty"){return`task:${e}:${++De.counter}`}static{this.counter=0}}}});function rt(t,e){return{method:_s(t.commands)||"",commands:e}}function ac(t,e){return r=>{e("[ERROR] child process exception %o",r),t.push(Buffer.from(String(r.stack),"ascii"))}}function $r(t,e,r,s){return n=>{r("%s received %L bytes",e,n),s("%B",n),t.push(n)}}var jr,Le,cc=c({"src/lib/runners/git-executor-chain.ts"(){"use strict";jr=require("child_process"),Z(),C(),y(),oc(),Le=class{constructor(t,e,r){this._executor=t,this._scheduler=e,this._plugins=r,this._chain=Promise.resolve(),this._queue=new cn}get cwd(){return this._cwd||this._executor.cwd}set cwd(t){this._cwd=t}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(t){return this._queue.push(t),this._chain=this._chain.then(()=>this.attemptTask(t))}async attemptTask(t){let e=await this._scheduler.next(),r=()=>this._queue.complete(t);try{let{logger:s}=this._queue.attempt(t);return await(Bs(t)?this.attemptEmptyTask(t,s):this.attemptRemoteTask(t,s))}catch(s){throw this.onFatalException(t,s)}finally{r(),e()}}onFatalException(t,e){let r=e instanceof Y?Object.assign(e,{task:t}):new Y(t,e&&String(e));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(t,e){let r=this._plugins.exec("spawn.binary","",rt(t,t.commands)),s=this._plugins.exec("spawn.args",[...t.commands],rt(t,t.commands)),n=await this.gitResponse(t,r,s,this.outputHandler,e.step("SPAWN")),i=await this.handleTaskData(t,s,n,e.step("HANDLE"));return e("passing response to task's parser as a %s",t.format),js(t)?Me(t.parser,i):Me(t.parser,i.asStrings())}async attemptEmptyTask(t,e){return e("empty task bypassing child process to call to task's parser"),t.parser(this)}handleTaskData(t,e,r,s){let{exitCode:n,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((u,g)=>{s("Preparing to handle process response exitCode=%d stdOut=",n);let{error:p}=this._plugins.exec("task.error",{error:i},{...rt(t,e),...r});if(p&&t.onError)return s.info("exitCode=%s handling with custom error handler"),t.onError(r,p,f=>{s.info("custom error handler treated as success"),s("custom error returned a %s",Ct(f)),u(new Wt(Array.isArray(f)?Buffer.concat(f):f,Buffer.concat(a)))},g);if(p)return s.info("handling as error: exitCode=%s stdErr=%s rejection=%o",n,a.length,i),g(p);s.info("retrieving task output complete"),u(new Wt(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(t,e,r,s,n){let i=n.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},rt(t,t.commands));return new Promise(a=>{let u=[],g=[];n.info("%s %o",e,r),n("%O",o);let p=this._beforeSpawn(t,r);if(p)return a({stdOut:u,stdErr:g,exitCode:9901,rejection:p});this._plugins.exec("spawn.before",void 0,{...rt(t,r),kill(d){p=d||p}});let f=(0,jr.spawn)(e,r,o);f.stdout.on("data",$r(u,"stdOut",n,i.step("stdOut"))),f.stderr.on("data",$r(g,"stdErr",n,i.step("stdErr"))),f.on("error",ac(g,n)),s&&(n("Passing child process stdOut/stdErr to custom outputHandler"),s(e,f.stdout,f.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...rt(t,r),spawned:f,close(d,h){a({stdOut:u,stdErr:g,exitCode:d,rejection:p||h})},kill(d){f.killed||(p=d,f.kill("SIGINT"))}})})}_beforeSpawn(t,e){let r;return this._plugins.exec("spawn.before",void 0,{...rt(t,e),kill(s){r=s||r}}),r}}}}),un={};E(un,{GitExecutor:()=>ln});var ln,uc=c({"src/lib/runners/git-executor.ts"(){"use strict";cc(),ln=class{constructor(t,e,r){this.cwd=t,this._scheduler=e,this._plugins=r,this._chain=new Le(this,this._scheduler,this._plugins)}chain(){return new Le(this,this._scheduler,this._plugins)}push(t){return this._chain.push(t)}}}});function lc(t,e,r=it){let s=i=>{r(null,i)},n=i=>{i?.task===t&&r(i instanceof nt?pc(i):i,void 0)};e.then(s,n)}function pc(t){let e=s=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${s} should be GitResponseError.git.${s}, this will no longer be available in version 3`),e=it};return Object.create(t,Object.getOwnPropertyNames(t.git).reduce(r,{}));function r(s,n){return n in t||(s[n]={enumerable:!1,configurable:!1,get(){return e(n),t.git[n]}}),s}}var fc=c({"src/lib/task-callback.ts"(){"use strict";ht(),y()}});function Br(t,e){return Ls(r=>{if(!ze(t))throw new Error(`Git.cwd: cannot change to non-directory "${t}"`);return(e||r).cwd=t})}var dc=c({"src/lib/tasks/change-working-directory.ts"(){"use strict";y(),C()}});function we(t){let e=["checkout",...t];return e[1]==="-b"&&e.includes("-B")&&(e[1]=Vt(e,"-B")),M(e)}function hc(){return{checkout(){return this._runTask(we(D(arguments,1)),S(arguments))},checkoutBranch(t,e){return this._runTask(we(["-b",t,e,...D(arguments)]),S(arguments))},checkoutLocalBranch(t){return this._runTask(we(["-b",t,...D(arguments)]),S(arguments))}}}var mc=c({"src/lib/tasks/checkout.ts"(){"use strict";y(),C()}});function gc(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function _c(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(t){return $(gc(),[pn],t)}})}}}var pn,yc=c({"src/lib/tasks/count-objects.ts"(){"use strict";y(),pn=new b(/([a-z-]+): (\d+)$/,(t,[e,r])=>{let s=Ts(e);Object.hasOwn(t,s)&&(t[s]=k(r))})}});function bc(t){return $({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},fn,t)}var fn,Tc=c({"src/lib/parsers/parse-commit.ts"(){"use strict";y(),fn=[new b(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(t,[e,r,s])=>{t.branch=e,t.commit=s,t.root=!!r}),new b(/\s*Author:\s(.+)/i,(t,[e])=>{let r=e.split("<"),s=r.pop();!s||!s.includes("@")||(t.author={email:s.substr(0,s.length-1),name:r.join("<").trim()})}),new b(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0,t.summary.insertions=parseInt(r,10)||0,t.summary.deletions=parseInt(s,10)||0}),new b(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(t,[e,r,s])=>{t.summary.changes=parseInt(e,10)||0;let n=parseInt(r,10)||0;s==="-"?t.summary.deletions=n:s==="+"&&(t.summary.insertions=n)})]}});function vc(t,e,r){return{commands:["-c","core.abbrev=40","commit",...vt(t,"-m"),...e,...r],format:"utf-8",parser:bc}}function kc(){return{commit(e,...r){let s=S(arguments),n=t(e)||vc(J(e),J(G(r[0],Ht,[])),[...mt(G(r[1],Ot,[])),...D(arguments,0,!0)]);return this._runTask(n,s)}};function t(e){return!Ht(e)&&L("git.commit: requires the commit message to be supplied as a string/string[]")}}var wc=c({"src/lib/tasks/commit.ts"(){"use strict";Tc(),y(),C()}});function Ec(){return{firstCommit(){return this._runTask(M(["rev-list","--max-parents=0","HEAD"],!0),S(arguments))}}}var Sc=c({"src/lib/tasks/first-commit.ts"(){"use strict";y(),C()}});function Cc(t,e){let r=["hash-object",t];return e&&r.push("-w"),M(r,!0)}var Oc=c({"src/lib/tasks/hash-object.ts"(){"use strict";C()}});function Rc(t,e,r){let s=String(r).trim(),n;if(n=dn.exec(s))return new Ut(t,e,!1,n[1]);if(n=hn.exec(s))return new Ut(t,e,!0,n[1]);let i="",o=s.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new Ut(t,e,/^re/i.test(s),i)}var Ut,dn,hn,Fc=c({"src/lib/responses/InitSummary.ts"(){"use strict";Ut=class{constructor(t,e,r,s){this.bare=t,this.path=e,this.existing=r,this.gitDir=s}},dn=/^Init.+ repository in (.+)$/,hn=/^Rein.+ in (.+)$/}});function xc(t){return t.includes(sr)}function Ac(t=!1,e,r){let s=["init",...r];return t&&!xc(s)&&s.splice(1,0,sr),{commands:s,format:"utf-8",parser(n){return Rc(s.includes("--bare"),e,n)}}}var sr,Mc=c({"src/lib/tasks/init.ts"(){"use strict";Fc(),sr="--bare"}});function nr(t){for(let e=0;e<t.length;e++){let r=ir.exec(t[e]);if(r)return`--${r[1]}`}return""}function Nc(t){return ir.test(t)}var ir,Rt=c({"src/lib/args/log-format.ts"(){"use strict";ir=/^--(stat|numstat|name-only|name-status)(=|$)/}}),mn,Ic=c({"src/lib/responses/DiffSummary.ts"(){"use strict";mn=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function gn(t=""){let e=_n[t];return r=>$(new mn,e,r,!1)}var Ee,Gr,Ur,qr,_n,yn=c({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Rt(),Ic(),Ys(),y(),Ee=[new b(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(t,[e,r,s=""])=>{t.files.push({file:e.trim(),changes:k(r),insertions:s.replace(/[^+]/g,"").length,deletions:s.replace(/[^-]/g,"").length,binary:!1})}),new b(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(t,[e,r,s])=>{t.files.push({file:e.trim(),before:k(r),after:k(s),binary:!0})}),new b(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(t,[e,r])=>{let s=/(\d+) i/.exec(r),n=/(\d+) d/.exec(r);t.changed=k(e),t.insertions=k(s?.[1]),t.deletions=k(n?.[1])})],Gr=[new b(/(\d+)\t(\d+)\t(.+)$/,(t,[e,r,s])=>{let n=k(e),i=k(r);t.changed++,t.insertions+=n,t.deletions+=i,t.files.push({file:s,changes:n+i,insertions:n,deletions:i,binary:!1})}),new b(/-\t-\t(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,after:0,before:0,binary:!0})})],Ur=[new b(/(.+)$/,(t,[e])=>{t.changed++,t.files.push({file:e,changes:0,insertions:0,deletions:0,binary:!1})})],qr=[new b(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(t,[e,r,s,n,i])=>{t.changed++,t.files.push({file:i??s,changes:0,insertions:0,deletions:0,binary:!1,status:Re(ka(e)&&e),from:Re(!!i&&s!==i&&s),similarity:k(r)})})],_n={"":Ee,"--stat":Ee,"--numstat":Gr,"--name-status":qr,"--name-only":Ur}}});function Pc(t,e){return e.reduce((r,s,n)=>(r[s]=t[n]||"",r),Object.create({diff:null}))}function bn(t=cr,e=Tn,r=""){let s=gn(r);return function(n){let i=St(n.trim(),!1,or).map(function(o){let a=o.split(ar),u=Pc(a[0].split(t),e);return a.length>1&&a[1].trim()&&(u.diff=s(a[1])),u});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var or,ar,cr,Tn,vn=c({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";y(),yn(),Rt(),or="\xF2\xF2\xF2\xF2\xF2\xF2 ",ar=" \xF2\xF2",cr=" \xF2 ",Tn=["hash","date","message","refs","author_name","author_email"]}}),kn={};E(kn,{diffSummaryTask:()=>Dc,validateLogFormatConfig:()=>ne});function Dc(t){let e=nr(t),r=["diff"];return e===""&&(e="--stat",r.push("--stat=4096")),r.push(...t),ne(r)||{commands:r,format:"utf-8",parser:gn(e)}}function ne(t){let e=t.filter(Nc);if(e.length>1)return L(`Summary flags are mutually exclusive - pick one of ${e.join(",")}`);if(e.length&&t.includes("-z"))return L(`Summary flag ${e} parsing is not compatible with null termination option '-z'`)}var ur=c({"src/lib/tasks/diff.ts"(){"use strict";Rt(),yn(),C()}});function Lc(t,e){let r=[],s=[];return Object.keys(t).forEach(n=>{r.push(n),s.push(String(t[n]))}),[r,s.join(e)]}function $c(t){return Object.keys(t).reduce((e,r)=>(r in $e||(e[r]=t[r]),e),{})}function wn(t={},e=[]){let r=G(t.splitter,F,cr),s=te(t.format)?t.format:{hash:"%H",date:t.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:t.multiLine?"%B":"%b",author_name:t.mailMap!==!1?"%aN":"%an",author_email:t.mailMap!==!1?"%aE":"%ae"},[n,i]=Lc(s,r),o=[],a=[`--pretty=format:${or}${i}${ar}`,...e],u=t.n||t["max-count"]||t.maxCount;if(u&&a.push(`--max-count=${u}`),t.from||t.to){let g=t.symmetric!==!1?"...":"..";o.push(`${t.from||""}${g}${t.to||""}`)}return F(t.file)&&a.push("--follow",fs(t.file)),Je($c(t),a),{fields:n,splitter:r,commands:[...a,...o]}}function jc(t,e,r){let s=bn(t,e,nr(r));return{commands:["log",...r],format:"utf-8",parser:s}}function Bc(){return{log(...r){let s=S(arguments),n=wn(Ke(arguments),mt(G(arguments[0],Ot,[]))),i=e(...r)||ne(n.commands)||t(n);return this._runTask(i,s)}};function t(r){return jc(r.splitter,r.fields,r.commands)}function e(r,s){return F(r)&&F(s)&&L("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var $e,En=c({"src/lib/tasks/log.ts"(){"use strict";Rt(),wt(),vn(),y(),C(),ur(),$e=(t=>(t[t["--pretty"]=0]="--pretty",t[t["max-count"]=1]="max-count",t[t.maxCount=2]="maxCount",t[t.n=3]="n",t[t.file=4]="file",t[t.format=5]="format",t[t.from=6]="from",t[t.to=7]="to",t[t.splitter=8]="splitter",t[t.symmetric=9]="symmetric",t[t.mailMap=10]="mailMap",t[t.multiLine=11]="multiLine",t[t.strictDate=12]="strictDate",t))($e||{})}}),qt,Sn,Gc=c({"src/lib/responses/MergeSummary.ts"(){"use strict";qt=class{constructor(t,e=null,r){this.reason=t,this.file=e,this.meta=r}toString(){return`${this.file}:${this.reason}`}},Sn=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),je,Cn,Uc=c({"src/lib/responses/PullSummary.ts"(){"use strict";je=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},Cn=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function Se(t){return t.objects=t.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function Xr(t){let e=/^\s*(\d+)/.exec(t),r=/delta (\d+)/i.exec(t);return{count:k(e&&e[1]||"0"),delta:k(r&&r[1]||"0")}}var On,qc=c({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";y(),On=[new V(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=Se(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new V(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(t,[e,r])=>{let s=e.toLowerCase(),n=Se(t.remoteMessages);Object.assign(n,{[s]:k(r)})}),new V(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(t,[e,r,s])=>{let n=Se(t.remoteMessages);n.total=Xr(e),n.reused=Xr(r),n.packReused=k(s)})]}});function Rn(t,e){return $({remoteMessages:new xn},Fn,e)}var Fn,xn,An=c({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";y(),qc(),Fn=[new V(/^remote:\s*(.+)$/,(t,[e])=>(t.remoteMessages.all.push(e.trim()),!1)),...On,new V([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(t,[e])=>{t.remoteMessages.pullRequestUrl=e}),new V([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(t,[e,r,s])=>{t.remoteMessages.vulnerabilities={count:k(e),summary:r,url:s}})],xn=class{constructor(){this.all=[]}}}});function Xc(t,e){let r=$(new Cn,Mn,[t,e]);return r.message&&r}var Hr,Wr,zr,Yr,Mn,Jr,lr,Nn=c({"src/lib/parsers/parse-pull.ts"(){"use strict";Uc(),y(),An(),Hr=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,Wr=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,zr=/^(create|delete) mode \d+ (.+)/,Yr=[new b(Hr,(t,[e,r,s])=>{t.files.push(e),r&&(t.insertions[e]=r.length),s&&(t.deletions[e]=s.length)}),new b(Wr,(t,[e,,r,,s])=>r!==void 0||s!==void 0?(t.summary.changes=+e||0,t.summary.insertions=+r||0,t.summary.deletions=+s||0,!0):!1),new b(zr,(t,[e,r])=>{T(t.files,r),T(e==="create"?t.created:t.deleted,r)})],Mn=[new b(/^from\s(.+)$/i,(t,[e])=>void(t.remote=e)),new b(/^fatal:\s(.+)$/,(t,[e])=>void(t.message=e)),new b(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(t,[e,r,s,n])=>{t.branch.local=s,t.hash.local=e,t.branch.remote=n,t.hash.remote=r})],Jr=(t,e)=>$(new je,Yr,[t,e]),lr=(t,e)=>Object.assign(new je,Jr(t,e),Rn(t,e))}}),Kr,In,Qr,Hc=c({"src/lib/parsers/parse-merge.ts"(){"use strict";Gc(),y(),Nn(),Kr=[new b(/^Auto-merging\s+(.+)$/,(t,[e])=>{t.merges.push(e)}),new b(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(t,[e,r])=>{t.conflicts.push(new qt(e,r))}),new b(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(t,[e,r,s])=>{t.conflicts.push(new qt(e,r,{deleteRef:s}))}),new b(/^CONFLICT\s+\((.+)\):/,(t,[e])=>{t.conflicts.push(new qt(e,null))}),new b(/^Automatic merge failed;\s+(.+)$/,(t,[e])=>{t.result=e})],In=(t,e)=>Object.assign(Qr(t,e),lr(t,e)),Qr=t=>$(new Sn,Kr,t)}});function Vr(t){return t.length?{commands:["merge",...t],format:"utf-8",parser(e,r){let s=In(e,r);if(s.failed)throw new nt(s);return s}}:L("Git.merge requires at least one option")}var Wc=c({"src/lib/tasks/merge.ts"(){"use strict";ht(),Hc(),C()}});function zc(t,e,r){let s=r.includes("deleted"),n=r.includes("tag")||/^refs\/tags/.test(t),i=!r.includes("new");return{deleted:s,tag:n,branch:!n,new:!i,alreadyUpdated:i,local:t,remote:e}}var Zr,Pn,ts,Yc=c({"src/lib/parsers/parse-push.ts"(){"use strict";y(),An(),Zr=[new b(/^Pushing to (.+)$/,(t,[e])=>{t.repo=e}),new b(/^updating local tracking ref '(.+)'/,(t,[e])=>{t.ref={...t.ref||{},local:e}}),new b(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(t,[e,r,s])=>{t.pushed.push(zc(e,r,s))}),new b(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(t,[e,r,s])=>{t.branch={...t.branch||{},local:e,remote:r,remoteName:s}}),new b(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(t,[e,r,s,n])=>{t.update={head:{local:e,remote:r},hash:{from:s,to:n}}})],Pn=(t,e)=>{let r=ts(t,e),s=Rn(t,e);return{...r,...s}},ts=(t,e)=>$({pushed:[]},Zr,[t,e])}}),Dn={};E(Dn,{pushTagsTask:()=>Jc,pushTask:()=>pr});function Jc(t={},e){return T(e,"--tags"),pr(t,e)}function pr(t={},e){let r=["push",...e];return t.branch&&r.splice(1,0,t.branch),t.remote&&r.splice(1,0,t.remote),Vt(r,"-v"),T(r,"--verbose"),T(r,"--porcelain"),{commands:r,format:"utf-8",parser:Pn}}var Ln=c({"src/lib/tasks/push.ts"(){"use strict";Yc(),y()}});function Kc(){return{showBuffer(){let t=["show",...D(arguments,1)];return t.includes("--binary")||t.splice(1,0,"--binary"),this._runTask($s(t),S(arguments))},show(){let t=["show",...D(arguments,1)];return this._runTask(M(t),S(arguments))}}}var Qc=c({"src/lib/tasks/show.ts"(){"use strict";y(),C()}}),es,$n,Vc=c({"src/lib/responses/FileStatusSummary.ts"(){"use strict";es=/^(.+)\0(.+)$/,$n=class{constructor(t,e,r){if(this.path=t,this.index=e,this.working_dir=r,e==="R"||r==="R"){let s=es.exec(t)||[null,t,t];this.from=s[2]||"",this.path=s[1]||""}}}}});function rs(t){let[e,r]=t.split(dt);return{from:r||e,to:e}}function B(t,e,r){return[`${t}${e}`,r]}function Ce(t,...e){return e.map(r=>B(t,r,(s,n)=>T(s.conflicted,n)))}function Zc(t,e){let r=e.trim();switch(" "){case r.charAt(2):return s(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return s(" ",r.charAt(0),r.substr(2));default:return}function s(n,i,o){let a=`${n}${i}`,u=jn.get(a);u&&u(t,o),a!=="##"&&a!=="!!"&&t.files.push(new $n(o,n,i))}}var ss,jn,Bn,tu=c({"src/lib/responses/StatusSummary.ts"(){"use strict";y(),Vc(),ss=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},jn=new Map([B(" ","A",(t,e)=>T(t.created,e)),B(" ","D",(t,e)=>T(t.deleted,e)),B(" ","M",(t,e)=>T(t.modified,e)),B("A"," ",(t,e)=>T(t.created,e)&&T(t.staged,e)),B("A","M",(t,e)=>T(t.created,e)&&T(t.staged,e)&&T(t.modified,e)),B("D"," ",(t,e)=>T(t.deleted,e)&&T(t.staged,e)),B("M"," ",(t,e)=>T(t.modified,e)&&T(t.staged,e)),B("M","M",(t,e)=>T(t.modified,e)&&T(t.staged,e)),B("R"," ",(t,e)=>{T(t.renamed,rs(e))}),B("R","M",(t,e)=>{let r=rs(e);T(t.renamed,r),T(t.modified,r.to)}),B("!","!",(t,e)=>{T(t.ignored=t.ignored||[],e)}),B("?","?",(t,e)=>T(t.not_added,e)),...Ce("A","A","U"),...Ce("D","D","U"),...Ce("U","A","D","U"),["##",(t,e)=>{let r=/ahead (\d+)/,s=/behind (\d+)/,n=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(e);t.ahead=a&&+a[1]||0,a=s.exec(e),t.behind=a&&+a[1]||0,a=n.exec(e),t.current=G(a?.[1],F,null),a=i.exec(e),t.tracking=G(a?.[1],F,null),a=o.exec(e),a&&(t.current=G(a?.[1],F,t.current)),t.detached=/\(no branch\)/.test(e)}]]),Bn=function(t){let e=t.split(dt),r=new ss;for(let s=0,n=e.length;s<n;){let i=e[s++].trim();i&&(i.charAt(0)==="R"&&(i+=dt+(e[s++]||"")),Zc(r,i))}return r}}});function eu(t){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...t.filter(r=>!Gn.includes(r))],parser(r){return Bn(r)}}}var Gn,ru=c({"src/lib/tasks/status.ts"(){"use strict";tu(),Gn=["--null","-z"]}});function Jt(t=0,e=0,r=0,s="",n=!0){return Object.defineProperty({major:t,minor:e,patch:r,agent:s,installed:n},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function su(){return Jt(0,0,0,"",!1)}function nu(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:iu,onError(t,e,r,s){if(t.exitCode===-2)return r(Buffer.from(fr));s(e)}})}}}function iu(t){return t===fr?su():$(Jt(0,0,0,t),Un,t)}var fr,Un,ou=c({"src/lib/tasks/version.ts"(){"use strict";y(),fr="installed=false",Un=[new b(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(t,[e,r,s,n=""])=>{Object.assign(t,Jt(k(e),k(r),k(s),n))}),new b(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(t,[e,r,s,n=""])=>{Object.assign(t,Jt(k(e),k(r),s,n))})]}}),qn={};E(qn,{SimpleGitApi:()=>Be});var Be,au=c({"src/lib/simple-git-api.ts"(){"use strict";fc(),dc(),mc(),yc(),wc(),Ws(),Sc(),Vs(),Oc(),Mc(),En(),Wc(),Ln(),Qc(),ru(),C(),ou(),y(),Be=class{constructor(t){this._executor=t}_runTask(t,e){let r=this._executor.chain(),s=r.push(t);return e&&lc(t,s,e),Object.create(this,{then:{value:s.then.bind(s)},catch:{value:s.catch.bind(s)},_executor:{value:r}})}add(t){return this._runTask(M(["add",...J(t)]),S(arguments))}cwd(t){let e=S(arguments);return typeof t=="string"?this._runTask(Br(t,this._executor),e):typeof t?.path=="string"?this._runTask(Br(t.path,t.root&&this._executor||void 0),e):this._runTask(L("Git.cwd: workingDirectory must be supplied as a string"),e)}hashObject(t,e){return this._runTask(Cc(t,e===!0),S(arguments))}init(t){return this._runTask(Ac(t===!0,this._executor.cwd,D(arguments)),S(arguments))}merge(){return this._runTask(Vr(D(arguments)),S(arguments))}mergeFromTo(t,e){return F(t)&&F(e)?this._runTask(Vr([t,e,...D(arguments)]),S(arguments,!1)):this._runTask(L("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(t){return this._executor.outputHandler=t,this}push(){let t=pr({remote:G(arguments[0],F),branch:G(arguments[1],F)},D(arguments));return this._runTask(t,S(arguments))}stash(){return this._runTask(M(["stash",...D(arguments)]),S(arguments))}status(){return this._runTask(eu(D(arguments)),S(arguments))}},Object.assign(Be.prototype,hc(),kc(),va(),_c(),Ec(),Ea(),Bc(),Kc(),nu())}}),Xn={};E(Xn,{Scheduler:()=>Hn});var ns,is,Hn,cu=c({"src/lib/runners/scheduler.ts"(){"use strict";y(),ns=ve(),an(),is=(()=>{let t=0;return()=>{t++;let{promise:e,done:r}=(0,ns.createDeferred)();return{promise:e,done:r,id:t}}})(),Hn=class{constructor(t=2){this.concurrency=t,this.logger=rr("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",t)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let t=T(this.running,this.pending.shift());this.logger("Attempting id=%s",t.id),t.done(()=>{this.logger("Completing id=",t.id),Vt(this.running,t),this.schedule()})}next(){let{promise:t,id:e}=T(this.pending,is());return this.logger("Scheduling id=%s",e),this.schedule(),t}}}}),Wn={};E(Wn,{applyPatchTask:()=>uu});function uu(t,e){return M(["apply",...e,...t])}var lu=c({"src/lib/tasks/apply-patch.ts"(){"use strict";C()}});function pu(t,e){return{branch:t,hash:e,success:!0}}function fu(t){return{branch:t,hash:null,success:!1}}var zn,du=c({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";zn=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Yn(t,e){return e===1&&Ge.test(t)}var os,Ge,as,ie,hu=c({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";du(),y(),os=/(\S+)\s+\(\S+\s([^)]+)\)/,Ge=/^error[^']+'([^']+)'/m,as=[new b(os,(t,[e,r])=>{let s=pu(e,r);t.all.push(s),t.branches[e]=s}),new b(Ge,(t,[e])=>{let r=fu(e);t.errors.push(r),t.all.push(r),t.branches[e]=r})],ie=(t,e)=>$(new zn,as,[t,e])}}),Jn,mu=c({"src/lib/responses/BranchSummary.ts"(){"use strict";Jn=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(t,e,r,s,n){t==="*"&&(this.detached=e,this.current=r),this.all.push(r),this.branches[r]={current:t==="*",linkedWorkTree:t==="+",name:r,commit:s,label:n}}}}});function cs(t){return t?t.charAt(0):""}function Kn(t,e=!1){return $(new Jn,e?[Vn]:Qn,t)}var Qn,Vn,gu=c({"src/lib/parsers/parse-branch.ts"(){"use strict";mu(),y(),Qn=[new b(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(t,[e,r,s,n])=>{t.push(cs(e),!0,r,s,n)}),new b(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(t,[e,r,s,n])=>{t.push(cs(e),!1,r,s,n)})],Vn=new b(/^(\S+)$/s,(t,[e])=>{t.push("*",!1,e,"","")})}}),Zn={};E(Zn,{branchLocalTask:()=>yu,branchTask:()=>_u,containsDeleteBranchCommand:()=>ti,deleteBranchTask:()=>Tu,deleteBranchesTask:()=>bu});function ti(t){let e=["-d","-D","--delete"];return t.some(r=>e.includes(r))}function _u(t){let e=ti(t),r=t.includes("--show-current"),s=["branch",...t];return s.length===1&&s.push("-a"),s.includes("-v")||s.splice(1,0,"-v"),{format:"utf-8",commands:s,parser(n,i){return e?ie(n,i).all[0]:Kn(n,r)}}}function yu(){return{format:"utf-8",commands:["branch","-v"],parser(t){return Kn(t)}}}function bu(t,e=!1){return{format:"utf-8",commands:["branch","-v",e?"-D":"-d",...t],parser(r,s){return ie(r,s)},onError({exitCode:r,stdOut:s},n,i,o){if(!Yn(String(n),r))return o(n);i(s)}}}function Tu(t,e=!1){let r={format:"utf-8",commands:["branch","-v",e?"-D":"-d",t],parser(s,n){return ie(s,n).branches[t]},onError({exitCode:s,stdErr:n,stdOut:i},o,a,u){if(!Yn(String(o),s))return u(o);throw new nt(r.parser(kt(i),kt(n)),String(o))}};return r}var vu=c({"src/lib/tasks/branch.ts"(){"use strict";ht(),hu(),gu(),y()}});function ku(t){let e=t.trim().replace(/^["']|["']$/g,"");return e&&(0,ei.normalize)(e)}var ei,ri,wu=c({"src/lib/responses/CheckIgnore.ts"(){"use strict";ei=require("node:path"),ri=t=>t.split(/\n/g).map(ku).filter(Boolean)}}),si={};E(si,{checkIgnoreTask:()=>Eu});function Eu(t){return{commands:["check-ignore",...t],format:"utf-8",parser:ri}}var Su=c({"src/lib/tasks/check-ignore.ts"(){"use strict";wu()}}),ni={};E(ni,{cloneMirrorTask:()=>Ou,cloneTask:()=>ii});function Cu(t){return/^--upload-pack(=|$)/.test(t)}function ii(t,e,r){let s=["clone",...r];return F(t)&&s.push(t),F(e)&&s.push(e),s.find(Cu)?L("git.fetch: potential exploit argument blocked."):M(s)}function Ou(t,e,r){return T(r,"--mirror"),ii(t,e,r)}var Ru=c({"src/lib/tasks/clone.ts"(){"use strict";C(),y()}});function Fu(t,e){return $({raw:t,remote:null,branches:[],tags:[],updated:[],deleted:[]},oi,[t,e])}var oi,xu=c({"src/lib/parsers/parse-fetch.ts"(){"use strict";y(),oi=[new b(/From (.+)$/,(t,[e])=>{t.remote=e}),new b(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.branches.push({name:e,tracking:r})}),new b(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(t,[e,r])=>{t.tags.push({name:e,tracking:r})}),new b(/- \[deleted]\s+\S+\s*-> (.+)$/,(t,[e])=>{t.deleted.push({tracking:e})}),new b(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(t,[e,r,s,n])=>{t.updated.push({name:s,tracking:n,to:r,from:e})})]}}),ai={};E(ai,{fetchTask:()=>Mu});function Au(t){return/^--upload-pack(=|$)/.test(t)}function Mu(t,e,r){let s=["fetch",...r];return t&&e&&s.push(t,e),s.find(Au)?L("git.fetch: potential exploit argument blocked."):{commands:s,format:"utf-8",parser:Fu}}var Nu=c({"src/lib/tasks/fetch.ts"(){"use strict";xu(),C()}});function Iu(t){return $({moves:[]},ci,t)}var ci,Pu=c({"src/lib/parsers/parse-move.ts"(){"use strict";y(),ci=[new b(/^Renaming (.+) to (.+)$/,(t,[e,r])=>{t.moves.push({from:e,to:r})})]}}),ui={};E(ui,{moveTask:()=>Du});function Du(t,e){return{commands:["mv","-v",...J(t),e],format:"utf-8",parser:Iu}}var Lu=c({"src/lib/tasks/move.ts"(){"use strict";Pu(),y()}}),li={};E(li,{pullTask:()=>$u});function $u(t,e,r){let s=["pull",...r];return t&&e&&s.splice(1,0,t,e),{commands:s,format:"utf-8",parser(n,i){return lr(n,i)},onError(n,i,o,a){let u=Xc(kt(n.stdOut),kt(n.stdErr));if(u)return a(new nt(u));a(i)}}}var ju=c({"src/lib/tasks/pull.ts"(){"use strict";ht(),Nn(),y()}});function Bu(t){let e={};return pi(t,([r])=>e[r]={name:r}),Object.values(e)}function Gu(t){let e={};return pi(t,([r,s,n])=>{Object.hasOwn(e,r)||(e[r]={name:r,refs:{fetch:"",push:""}}),n&&s&&(e[r].refs[n.replace(/[^a-z]/g,"")]=s)}),Object.values(e)}function pi(t,e){We(t,r=>e(r.split(/\s+/)))}var Uu=c({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";y()}}),fi={};E(fi,{addRemoteTask:()=>qu,getRemotesTask:()=>Xu,listRemotesTask:()=>Hu,remoteTask:()=>Wu,removeRemoteTask:()=>zu});function qu(t,e,r){return M(["remote","add",...r,t,e])}function Xu(t){let e=["remote"];return t&&e.push("-v"),{commands:e,format:"utf-8",parser:t?Gu:Bu}}function Hu(t){let e=[...t];return e[0]!=="ls-remote"&&e.unshift("ls-remote"),M(e)}function Wu(t){let e=[...t];return e[0]!=="remote"&&e.unshift("remote"),M(e)}function zu(t){return M(["remote","remove",t])}var Yu=c({"src/lib/tasks/remote.ts"(){"use strict";Uu(),C()}}),di={};E(di,{stashListTask:()=>Ju});function Ju(t={},e){let r=wn(t),s=["stash","list",...r.commands,...e],n=bn(r.splitter,r.fields,nr(s));return ne(s)||{commands:s,format:"utf-8",parser:n}}var Ku=c({"src/lib/tasks/stash-list.ts"(){"use strict";Rt(),vn(),ur(),En()}}),hi={};E(hi,{addSubModuleTask:()=>Qu,initSubModuleTask:()=>Vu,subModuleTask:()=>oe,updateSubModuleTask:()=>Zu});function Qu(t,e){return oe(["add",t,e])}function Vu(t){return oe(["init",...t])}function oe(t){let e=[...t];return e[0]!=="submodule"&&e.unshift("submodule"),M(e)}function Zu(t){return oe(["update",...t])}var tl=c({"src/lib/tasks/sub-module.ts"(){"use strict";C()}});function el(t,e){let r=Number.isNaN(t),s=Number.isNaN(e);return r!==s?r?1:-1:r?mi(t,e):0}function mi(t,e){return t===e?0:t>e?1:-1}function rl(t){return t.trim()}function jt(t){return typeof t=="string"&&parseInt(t.replace(/^\D+/g,""),10)||0}var us,gi,sl=c({"src/lib/responses/TagList.ts"(){"use strict";us=class{constructor(t,e){this.all=t,this.latest=e}},gi=function(t,e=!1){let r=t.split(`
`).map(rl).filter(Boolean);e||r.sort(function(n,i){let o=n.split("."),a=i.split(".");if(o.length===1||a.length===1)return el(jt(o[0]),jt(a[0]));for(let u=0,g=Math.max(o.length,a.length);u<g;u++){let p=mi(jt(o[u]),jt(a[u]));if(p)return p}return 0});let s=e?r[0]:[...r].reverse().find(n=>n.indexOf(".")>=0);return new us(r,s)}}}),_i={};E(_i,{addAnnotatedTagTask:()=>ol,addTagTask:()=>il,tagListTask:()=>nl});function nl(t=[]){let e=t.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...t],parser(r){return gi(r,e)}}}function il(t){return{format:"utf-8",commands:["tag",t],parser(){return{name:t}}}}function ol(t,e){return{format:"utf-8",commands:["tag","-a","-m",e,t],parser(){return{name:t}}}}var al=c({"src/lib/tasks/tag.ts"(){"use strict";sl()}}),cl=zo({"src/git.js"(t,e){"use strict";var{GitExecutor:r}=(uc(),w(un)),{SimpleGitApi:s}=(au(),w(qn)),{Scheduler:n}=(cu(),w(Xn)),{configurationErrorTask:i}=(C(),w(Ne)),{asArray:o,filterArray:a,filterPrimitives:u,filterString:g,filterStringOrStringArray:p,filterType:f,getTrailingOptions:d,trailingFunctionArgument:h,trailingOptionsArgument:U}=(y(),w(Rs)),{applyPatchTask:O}=(lu(),w(Wn)),{branchTask:I,branchLocalTask:K,deleteBranchesTask:ot,deleteBranchTask:le}=(vu(),w(Zn)),{checkIgnoreTask:at}=(Su(),w(si)),{checkIsRepoTask:br}=(Ms(),w(Fs)),{cloneTask:_t,cloneMirrorTask:pe}=(Ru(),w(ni)),{cleanWithOptionsTask:Nt,isCleanOptionsArray:fe}=(qs(),w(Gs)),{diffSummaryTask:Wi}=(ur(),w(kn)),{fetchTask:zi}=(Nu(),w(ai)),{moveTask:Yi}=(Lu(),w(ui)),{pullTask:Ji}=(ju(),w(li)),{pushTagsTask:Ki}=(Ln(),w(Dn)),{addRemoteTask:Qi,getRemotesTask:Vi,listRemotesTask:Zi,remoteTask:to,removeRemoteTask:eo}=(Yu(),w(fi)),{getResetMode:ro,resetTask:so}=(rn(),w(Zs)),{stashListTask:no}=(Ku(),w(di)),{addSubModuleTask:io,initSubModuleTask:oo,subModuleTask:ao,updateSubModuleTask:co}=(tl(),w(hi)),{addAnnotatedTagTask:uo,addTagTask:lo,tagListTask:po}=(al(),w(_i)),{straightThroughBufferTask:fo,straightThroughStringTask:z}=(C(),w(Ne));function _(l,m){this._plugins=m,this._executor=new r(l.baseDir,new n(l.maxConcurrentProcesses),m),this._trimmed=l.trimmed}(_.prototype=Object.create(s.prototype)).constructor=_,_.prototype.customBinary=function(l){return this._plugins.reconfigure("binary",l),this},_.prototype.env=function(l,m){return arguments.length===1&&typeof l=="object"?this._executor.env=l:(this._executor.env=this._executor.env||{})[l]=m,this},_.prototype.stashList=function(l){return this._runTask(no(U(arguments)||{},a(l)&&l||[]),h(arguments))};function Tr(l,m,v,A){return typeof v!="string"?i(`git.${l}() requires a string 'repoPath'`):m(v,f(A,g),d(arguments))}_.prototype.clone=function(){return this._runTask(Tr("clone",_t,...arguments),h(arguments))},_.prototype.mirror=function(){return this._runTask(Tr("mirror",pe,...arguments),h(arguments))},_.prototype.mv=function(l,m){return this._runTask(Yi(l,m),h(arguments))},_.prototype.checkoutLatestTag=function(l){var m=this;return this.pull(function(){m.tags(function(v,A){m.checkout(A.latest,l)})})},_.prototype.pull=function(l,m,v,A){return this._runTask(Ji(f(l,g),f(m,g),d(arguments)),h(arguments))},_.prototype.fetch=function(l,m){return this._runTask(zi(f(l,g),f(m,g),d(arguments)),h(arguments))},_.prototype.silent=function(l){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},_.prototype.tags=function(l,m){return this._runTask(po(d(arguments)),h(arguments))},_.prototype.rebase=function(){return this._runTask(z(["rebase",...d(arguments)]),h(arguments))},_.prototype.reset=function(l){return this._runTask(so(ro(l),d(arguments)),h(arguments))},_.prototype.revert=function(l){let m=h(arguments);return typeof l!="string"?this._runTask(i("Commit must be a string"),m):this._runTask(z(["revert",...d(arguments,0,!0),l]),m)},_.prototype.addTag=function(l){let m=typeof l=="string"?lo(l):i("Git.addTag requires a tag name");return this._runTask(m,h(arguments))},_.prototype.addAnnotatedTag=function(l,m){return this._runTask(uo(l,m),h(arguments))},_.prototype.deleteLocalBranch=function(l,m,v){return this._runTask(le(l,typeof m=="boolean"?m:!1),h(arguments))},_.prototype.deleteLocalBranches=function(l,m,v){return this._runTask(ot(l,typeof m=="boolean"?m:!1),h(arguments))},_.prototype.branch=function(l,m){return this._runTask(I(d(arguments)),h(arguments))},_.prototype.branchLocal=function(l){return this._runTask(K(),h(arguments))},_.prototype.raw=function(l){let m=!Array.isArray(l),v=[].slice.call(m?arguments:l,0);for(let q=0;q<v.length&&m;q++)if(!u(v[q])){v.splice(q,v.length-q);break}v.push(...d(arguments,0,!0));var A=h(arguments);return v.length?this._runTask(z(v,this._trimmed),A):this._runTask(i("Raw: must supply one or more command to execute"),A)},_.prototype.submoduleAdd=function(l,m,v){return this._runTask(io(l,m),h(arguments))},_.prototype.submoduleUpdate=function(l,m){return this._runTask(co(d(arguments,!0)),h(arguments))},_.prototype.submoduleInit=function(l,m){return this._runTask(oo(d(arguments,!0)),h(arguments))},_.prototype.subModule=function(l,m){return this._runTask(ao(d(arguments)),h(arguments))},_.prototype.listRemote=function(){return this._runTask(Zi(d(arguments)),h(arguments))},_.prototype.addRemote=function(l,m,v){return this._runTask(Qi(l,m,d(arguments)),h(arguments))},_.prototype.removeRemote=function(l,m){return this._runTask(eo(l),h(arguments))},_.prototype.getRemotes=function(l,m){return this._runTask(Vi(l===!0),h(arguments))},_.prototype.remote=function(l,m){return this._runTask(to(d(arguments)),h(arguments))},_.prototype.tag=function(l,m){let v=d(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(z(v),h(arguments))},_.prototype.updateServerInfo=function(l){return this._runTask(z(["update-server-info"]),h(arguments))},_.prototype.pushTags=function(l,m){let v=Ki({remote:f(l,g)},d(arguments));return this._runTask(v,h(arguments))},_.prototype.rm=function(l){return this._runTask(z(["rm","-f",...o(l)]),h(arguments))},_.prototype.rmKeepLocal=function(l){return this._runTask(z(["rm","--cached",...o(l)]),h(arguments))},_.prototype.catFile=function(l,m){return this._catFile("utf-8",arguments)},_.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},_.prototype._catFile=function(l,m){var v=h(m),A=["cat-file"],q=m[0];if(typeof q=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(q)&&A.push.apply(A,q);let de=l==="buffer"?fo(A):z(A);return this._runTask(de,v)},_.prototype.diff=function(l,m){let v=g(l)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):z(["diff",...d(arguments)]);return this._runTask(v,h(arguments))},_.prototype.diffSummary=function(){return this._runTask(Wi(d(arguments,1)),h(arguments))},_.prototype.applyPatch=function(l){let m=p(l)?O(o(l),d([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(m,h(arguments))},_.prototype.revparse=function(){let l=["rev-parse",...d(arguments,!0)];return this._runTask(z(l,!0),h(arguments))},_.prototype.clean=function(l,m,v){let A=fe(l),q=A&&l.join("")||f(l,g)||"",de=d([].slice.call(arguments,A?1:0));return this._runTask(Nt(q,de),h(arguments))},_.prototype.exec=function(l){let m={commands:[],format:"utf-8",parser(){typeof l=="function"&&l()}};return this._runTask(m)},_.prototype.clearQueue=function(){return this},_.prototype.checkIgnore=function(l,m){return this._runTask(at(o(f(l,p,[]))),h(arguments))},_.prototype.checkIsRepo=function(l,m){return this._runTask(br(f(l,g)),h(arguments))},e.exports=_}}),yi={};E(yi,{esModuleFactory:()=>ul,gitExportFactory:()=>ll,gitInstanceFactory:()=>bi});function ul(t){return Object.defineProperties(t,{__esModule:{value:!0},default:{value:t}})}function ll(t){return Object.assign(t.bind(null),sn)}function bi(t,e){let r=new on,s=Cs(t&&(typeof t=="string"?{baseDir:t}:t)||{},e);if(!ze(s.baseDir))throw new Xe(s,"Cannot use simple-git on a directory that does not exist");return Array.isArray(s.config)&&r.add(Pa(s.config)),r.add(Na(s.unsafe)),r.add(rc()),r.add(La(s.completion)),s.abort&&r.add(Ra(s.abort)),s.progress&&r.add(za(s.progress)),s.timeout&&r.add(Za(s.timeout)),s.spawnOptions&&r.add(Qa(s.spawnOptions)),r.add(Pr(Xa(!0))),s.errors&&r.add(Pr(s.errors)),Ba(r,s.binary,s.unsafe?.allowUnsafeCustomBinary),new Ti(s,r)}var Ti,vi=c({"src/lib/git-factory.ts"(){"use strict";Oa(),ec(),sc(),y(),Ti=cl()}}),ki={};E(ki,{gitP:()=>pl});function pl(...t){let e,r=Promise.resolve();try{e=bi(...t)}catch(u){r=Promise.reject(u)}function s(){return i}function n(){return r}let i=[...wi,...Ue].reduce((u,g)=>{let p=Ue.includes(g),f=p?o(g,e):a(g,e,u);return Object.defineProperty(u,g,{enumerable:!1,configurable:!1,value:e?f:p?n:s}),u},{});return i;function o(u,g){return function(...p){if(typeof p[p.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+u);return r.then(function(){return new Promise(function(f,d){let h=(U,O)=>{if(U)return d(fl(U));f(O)};p.push(h),g[u].apply(g,p)})})}}function a(u,g,p){return(...f)=>(g[u](...f),p)}}function fl(t){return t instanceof Error?t:typeof t=="string"?new Error(t):new nt(t)}var wi,Ue,dl=c({"src/lib/runners/promise-wrapped.ts"(){"use strict";ht(),vi(),wi=["customBinary","env","outputHandler","silent"],Ue=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:hl}=(dl(),w(ki)),{esModuleFactory:ml,gitInstanceFactory:gl,gitExportFactory:_l}=(vi(),w(yi)),ls=ml(_l(gl));Ei.exports=Object.assign(ls,{gitP:hl,simpleGit:ls})});var Ri=x((xp,Oi)=>{var Ci=Si(),{execSync:dr}=require("node:child_process"),H=require("node:path"),N=require("node:fs"),yl=require("node:os"),bl=H.join(yl.homedir(),".claude-memory","repo"),Tl="claude-memory-storage",hr=class{constructor(e,r=null,s=Tl){this.auth=e,this.repoOwner=r,this.repoName=s,this.syncDir=bl,this._git=null}get git(){return this._git||(this._git=Ci(this.syncDir)),this._git}async ensureRepo(){if(N.existsSync(this.syncDir)&&N.existsSync(H.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),s=JSON.parse(dr(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=s.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let e=await this.auth.getToken();return dr(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${e}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let e=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return dr(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${e}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(e){return console.error("Failed to create repository:",e.message),!1}}async cloneRepo(){let e=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=H.dirname(this.syncDir);N.existsSync(r)||N.mkdirSync(r,{recursive:!0}),await Ci().clone(e,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(e){let r=new Date(e.created_at),s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,n=String(r.getDate()).padStart(2,"0"),i=H.join(this.syncDir,"memories",e.container_tag,s);N.existsSync(i)||N.mkdirSync(i,{recursive:!0});let o=`${n}-${e.id}.json`,a=H.join(i,o),u={id:e.id,content:e.content,containerTag:e.container_tag,metadata:typeof e.metadata=="string"?JSON.parse(e.metadata):e.metadata,createdAt:e.created_at,updatedAt:e.updated_at};return N.writeFileSync(a,JSON.stringify(u,null,2)),a}exportMemories(e){let r=[];for(let s of e){let n=this.exportMemory(s);r.push(n)}return r}exportProfiles(e){let r=H.join(this.syncDir,"profiles");N.existsSync(r)||N.mkdirSync(r,{recursive:!0});let s=H.join(r,"user-preferences.json");return N.writeFileSync(s,JSON.stringify(e,null,2)),s}async syncToGitHub(e,r=null){try{await this.ensureRepo();let s=this.exportMemories(e);if(r){let o=this.exportProfiles(r);s.push(o)}if(s.length===0)return{success:!0,synced:0};for(let o of s){let a=H.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(e.map(o=>o.container_tag))].join(", ")} (${e.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:e.length}}catch(s){return console.error("GitHub sync failed:",s.message),{success:!1,error:s.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(e){return e.message.includes("conflict")?{success:!1,conflict:!0,error:e.message}:{success:!1,conflict:!1,error:e.message}}}importMemories(){let e=H.join(this.syncDir,"memories");if(!N.existsSync(e))return[];let r=[],s=n=>{let i=N.readdirSync(n,{withFileTypes:!0});for(let o of i){let a=H.join(n,o.name);if(o.isDirectory())s(a);else if(o.name.endsWith(".json"))try{let u=JSON.parse(N.readFileSync(a,"utf8"));r.push({id:u.id,content:u.content,container_tag:u.containerTag,metadata:JSON.stringify(u.metadata||{}),created_at:u.createdAt,updated_at:u.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(u){console.error(`Failed to parse ${a}:`,u.message)}}};return s(e),r}importProfiles(){let e=H.join(this.syncDir,"profiles","user-preferences.json");if(!N.existsSync(e))return{static:[],dynamic:[]};try{return JSON.parse(N.readFileSync(e,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};Oi.exports={GitHubSync:hr}});var Mi=x((Ap,Ai)=>{var{execSync:Fi}=require("node:child_process"),gt=require("node:fs"),xi=require("node:path"),vl=require("node:os"),Ft=xi.join(vl.homedir(),".claude-memory","github-token.json"),mr=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return Fi("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return Fi("gh auth token",{encoding:"utf8"}).trim()}catch(e){console.error("Failed to get gh token:",e.message)}if(gt.existsSync(Ft))return JSON.parse(gt.readFileSync(Ft,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(e){let r=xi.dirname(Ft);gt.existsSync(r)||gt.mkdirSync(r,{recursive:!0}),gt.writeFileSync(Ft,JSON.stringify({token:e}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||gt.existsSync(Ft)}async initiateDeviceFlow(){let e=require("node:https");return new Promise((r,s)=>{let n=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":n.length,Accept:"application/json"}},o=e.request(i,a=>{let u="";a.on("data",g=>{u+=g}),a.on("end",()=>r(JSON.parse(u)))});o.on("error",s),o.write(n),o.end()})}async pollForToken(e,r=5){let s=require("node:https"),n=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:e,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),u={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},g=s.request(u,p=>{let f="";p.on("data",d=>{f+=d}),p.on("end",()=>{let d=JSON.parse(f);d.access_token?i(d.access_token):d.error==="authorization_pending"?i(null):o(new Error(d.error||"Unknown error"))})});g.on("error",o),g.write(a),g.end()});for(let i=0;i<120;i++){let o=await n();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let e=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${e.verification_uri}`),console.log(`Enter code: ${e.user_code}
`);let r=await this.pollForToken(e.device_code,e.interval);return this.saveToken(r),r}};Ai.exports={GitHubAuth:mr}});var Ii=x((Mp,Ni)=>{var{SqliteManager:kl}=wr(),{GitHubSync:wl}=Ri(),{GitHubAuth:El}=Mi(),Sl=require("node:crypto"),gr=class{constructor(e=null){this.db=new kl(e),this.auth=new El,this.sync=null}async initSync(){this.sync||(this.sync=new wl(this.auth))}generateId(e="mem"){return`${e}_${Sl.randomBytes(8).toString("hex")}`}async addMemory(e,r,s={},n=null){let i=n||this.generateId("mem");return this.db.addMemory(i,e,r,s),{id:i,status:"saved",containerTag:r}}async search(e,r=null,s={}){let n=this.db.searchMemories(e,r,s.limit||10);return{results:n.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:n.length}}async getProfile(e,r=null){let s=this.db.getProfile(e),n=null;if(r){let i=this.db.searchMemories(r,e,10);n={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:s.static,dynamic:s.dynamic},searchResults:n}}async listMemories(e,r=20){return{memories:this.db.listMemories(e,r)}}async deleteMemory(e){return this.db.deleteMemory(e),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=this.db.getPendingSync();if(e.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(e);if(r.success){let s=e.map(n=>n.id);this.db.markSynced(s)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let e=await this.sync.pullFromGitHub();if(!e.success)return e;let r=this.sync.importMemories();for(let s of r)this.db.getMemory(s.id)||this.db.addMemory(s.id,s.content,s.container_tag,JSON.parse(s.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};Ni.exports={StorageClient:gr}});var Li=x((Np,Di)=>{var{execSync:Pi}=require("node:child_process"),Cl=require("node:crypto");function ae(t){return Cl.createHash("sha256").update(t).digest("hex").slice(0,16)}function _r(t){try{return Pi("git rev-parse --show-toplevel",{cwd:t,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function Ol(t){let r=_r(t)||t;return`claudecode_project_${ae(r)}`}function Rl(t){return(_r(t)||t).split("/").pop()||"unknown"}function Fl(){try{let e=Pi("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(e)return`claudecode_user_${ae(e)}`}catch{}let t=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${ae(t)}`}Di.exports={sha256:ae,getGitRoot:_r,getContainerTag:Ol,getProjectName:Rl,getUserContainerTag:Fl}});var Gi=x((Ip,Bi)=>{var At=require("node:fs"),$i=require("node:path"),xl=require("node:os"),ce=$i.join(xl.homedir(),".supermemory-claude"),xt=$i.join(ce,"settings.json"),ji={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function Al(){At.existsSync(ce)||At.mkdirSync(ce,{recursive:!0})}function Ml(){let t={...ji};try{if(At.existsSync(xt)){let e=At.readFileSync(xt,"utf-8");Object.assign(t,JSON.parse(e))}}catch(e){console.error(`Settings: Failed to load ${xt}: ${e.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(t.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(t.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(e=>e.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(t.debug=!0),t}function Nl(t){Al();let e={...t};delete e.apiKey,At.writeFileSync(xt,JSON.stringify(e,null,2))}function Il(t){if(t.apiKey)return t.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function Pl(t,e){return e.skipTools.includes(t)?!1:e.captureTools&&e.captureTools.length>0?e.captureTools.includes(t):!0}function Dl(t,e,r){if(t.debug){let s=new Date().toISOString();console.error(r?`[${s}] ${e}: ${JSON.stringify(r)}`:`[${s}] ${e}`)}}Bi.exports={SETTINGS_DIR:ce,SETTINGS_FILE:xt,DEFAULT_SETTINGS:ji,loadSettings:Ml,saveSettings:Nl,getApiKey:Il,shouldCaptureTool:Pl,debugLog:Dl}});var qi=x((Pp,Ui)=>{async function Ll(){return new Promise((t,e)=>{let r="";process.stdin.setEncoding("utf8"),process.stdin.on("data",s=>{r+=s}),process.stdin.on("end",()=>{try{t(r.trim()?JSON.parse(r):{})}catch(s){e(new Error(`Failed to parse stdin JSON: ${s.message}`))}}),process.stdin.on("error",e),process.stdin.isTTY&&t({})})}function ue(t){console.log(JSON.stringify(t))}function $l(t=null){ue(t?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:t}}:{continue:!0,suppressOutput:!0})}function jl(t){console.error(`Supermemory: ${t}`),ue({continue:!0,suppressOutput:!0})}Ui.exports={readStdin:Ll,writeOutput:ue,outputSuccess:$l,outputError:jl}});var Hi=x((Dp,Xi)=>{function Q(t){return t?t.split("/").slice(-2).join("/"):"unknown"}function W(t,e=50){return t?t.length<=e?t:`${t.slice(0,e)}...`:""}function Bl(t,e,r){let s=e||{},n=r||{};switch(t){case"Edit":{let i=Q(s.file_path),o=W(s.old_string,30),a=W(s.new_string,30);return s.replace_all?`Replaced all "${o}" with "${a}" in ${i}`:`Edited ${i}: "${o}" \u2192 "${a}"`}case"Write":{let i=Q(s.file_path),o=(s.content||"").length;return`Created ${i} (${o} chars)`}case"Bash":{let i=W(s.command,80),o=!n.error&&n.exitCode!==1,a=s.description?` - ${W(s.description,40)}`:"";return`Ran: ${i}${a}${o?"":" [FAILED]"}`}case"Task":{let i=s.description||W(s.prompt,60)||"subtask";return`Spawned ${s.subagent_type||"agent"}: ${i}`}case"Read":{let i=Q(s.file_path),o=s.limit?` (${s.limit} lines)`:"";return`Read ${i}${o}`}case"Glob":{let i=s.pattern||"*",o=s.path?` in ${Q(s.path)}`:"";return`Glob: ${i}${o}`}case"Grep":{let i=W(s.pattern,40),o=s.path?` in ${Q(s.path)}`:"";return`Grep: "${i}"${o}`}case"WebFetch":return`Fetched: ${W(s.url,60)}`;case"WebSearch":return`Searched web: "${W(s.query,60)}"`;case"NotebookEdit":{let i=Q(s.notebook_path);return`${s.edit_mode||"edit"} notebook cell in ${i}`}default:return`Used ${t}`}}function Gl(t,e){let r=e||{},s={tool:t};return r.file_path&&(s.file=Q(r.file_path)),r.notebook_path&&(s.file=Q(r.notebook_path)),t==="Bash"&&r.command&&(s.command=W(r.command,100)),r.pattern&&(s.pattern=W(r.pattern,50)),s}Xi.exports={compressObservation:Bl,getObservationMetadata:Gl,getRelativePath:Q,truncate:W}});var{StorageClient:Ul}=Ii(),{getContainerTag:ql}=Li(),{loadSettings:Xl,debugLog:Mt}=Gi(),{readStdin:Hl,writeOutput:yr}=qi(),{compressTranscript:Wl}=Hi();async function zl(){let t=Xl();try{let e=await Hl(),r=e.transcript||[];if(r.length===0){Mt(t,"No transcript to save"),yr({});return}let s=e.cwd||process.cwd(),n=ql(s);Mt(t,"Stop",{cwd:s,containerTag:n,turns:r.length});let i=new Ul,o=Wl(r,t),a=`session_${Date.now()}`;await i.addMemory(o,n,{sm_source:"claude-code-plugin",sessionId:a,turns:r.length},a);let u=await i.syncToGitHub().catch(()=>({success:!1}));u.success?Mt(t,"Synced to GitHub",{count:u.synced}):Mt(t,"GitHub sync failed, will retry later"),i.close(),yr({})}catch(e){Mt(t,"Error",{error:e.message}),console.error(`Claude Memory: ${e.message}`),yr({})}}zl().catch(t=>{console.error(`Claude Memory fatal: ${t.message}`),process.exit(1)});
