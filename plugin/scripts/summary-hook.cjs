#!/usr/bin/env node
var w=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var V=w(Ge=>{"use strict";Ge.getBooleanOption=(e,t)=>{let r=!1;if(t in e&&typeof(r=e[t])!="boolean")throw new TypeError(`Expected the "${t}" option to be a boolean`);return r};Ge.cppdb=Symbol();Ge.inspect=Symbol.for("nodejs.util.inspect.custom")});var At=w((Of,Gr)=>{"use strict";var Ft={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function se(e,t){if(new.target!==se)return new se(e,t);if(typeof t!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,e),Ft.value=""+e,Object.defineProperty(this,"message",Ft),Error.captureStackTrace(this,se),this.code=t}Object.setPrototypeOf(se,Error);Object.setPrototypeOf(se.prototype,Error.prototype);Object.defineProperty(se.prototype,"name",Ft);Gr.exports=se});var Xr=w((Cf,Ur)=>{var Ue=require("path").sep||"/";Ur.exports=ma;function ma(e){if(typeof e!="string"||e.length<=7||e.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var t=decodeURI(e.substring(7)),r=t.indexOf("/"),n=t.substring(0,r),s=t.substring(r+1);return n=="localhost"&&(n=""),n&&(n=Ue+Ue+n),s=s.replace(/^(.+)\|/,"$1:"),Ue=="\\"&&(s=s.replace(/\//g,"\\")),/^.+\:/.test(s)||(s=Ue+s),n+s}});var Yr=w((he,Wr)=>{var It=require("fs"),He=require("path"),ga=Xr(),Xe=He.join,ya=He.dirname,Hr=It.accessSync&&function(e){try{It.accessSync(e)}catch{return!1}return!0}||It.existsSync||He.existsSync,zr={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function ba(e){typeof e=="string"?e={bindings:e}:e||(e={}),Object.keys(zr).map(function(c){c in e||(e[c]=zr[c])}),e.module_root||(e.module_root=he.getRoot(he.getFileName())),He.extname(e.bindings)!=".node"&&(e.bindings+=".node");for(var t=typeof __webpack_require__=="function"?__non_webpack_require__:require,r=[],n=0,s=e.try.length,i,o,a;n<s;n++){i=Xe.apply(null,e.try[n].map(function(c){return e[c]||c})),r.push(i);try{return o=e.path?t.resolve(i):t(i),e.path||(o.path=i),o}catch(c){if(c.code!=="MODULE_NOT_FOUND"&&c.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(c.message))throw c}}throw a=new Error(`Could not locate the bindings file. Tried:
`+r.map(function(c){return e.arrow+c}).join(`
`)),a.tries=r,a}Wr.exports=he=ba;he.getFileName=function(t){var r=Error.prepareStackTrace,n=Error.stackTraceLimit,s={},i;Error.stackTraceLimit=10,Error.prepareStackTrace=function(a,c){for(var f=0,u=c.length;f<u;f++)if(i=c[f].getFileName(),i!==__filename)if(t){if(i!==t)return}else return},Error.captureStackTrace(s),s.stack,Error.prepareStackTrace=r,Error.stackTraceLimit=n;var o="file://";return i.indexOf(o)===0&&(i=ga(i)),i};he.getRoot=function(t){for(var r=ya(t),n;;){if(r==="."&&(r=process.cwd()),Hr(Xe(r,"package.json"))||Hr(Xe(r,"node_modules")))return r;if(n===r)throw new Error('Could not find module root given file: "'+t+'". Do you have a `package.json` file? ');n=r,r=Xe(r,"..")}}});var Jr=w(te=>{"use strict";var{cppdb:H}=V();te.prepare=function(t){return this[H].prepare(t,this,!1)};te.exec=function(t){return this[H].exec(t),this};te.close=function(){return this[H].close(),this};te.loadExtension=function(...t){return this[H].loadExtension(...t),this};te.defaultSafeIntegers=function(...t){return this[H].defaultSafeIntegers(...t),this};te.unsafeMode=function(...t){return this[H].unsafeMode(...t),this};te.getters={name:{get:function(){return this[H].name},enumerable:!0},open:{get:function(){return this[H].open},enumerable:!0},inTransaction:{get:function(){return this[H].inTransaction},enumerable:!0},readonly:{get:function(){return this[H].readonly},enumerable:!0},memory:{get:function(){return this[H].memory},enumerable:!0}}});var Qr=w((xf,Kr)=>{"use strict";var{cppdb:_a}=V(),Vr=new WeakMap;Kr.exports=function(t){if(typeof t!="function")throw new TypeError("Expected first argument to be a function");let r=this[_a],n=wa(r,this),{apply:s}=Function.prototype,i={default:{value:ze(s,t,r,n.default)},deferred:{value:ze(s,t,r,n.deferred)},immediate:{value:ze(s,t,r,n.immediate)},exclusive:{value:ze(s,t,r,n.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(i.default.value,i),Object.defineProperties(i.deferred.value,i),Object.defineProperties(i.immediate.value,i),Object.defineProperties(i.exclusive.value,i),i.default.value};var wa=(e,t)=>{let r=Vr.get(e);if(!r){let n={commit:e.prepare("COMMIT",t,!1),rollback:e.prepare("ROLLBACK",t,!1),savepoint:e.prepare("SAVEPOINT `	_bs3.	`",t,!1),release:e.prepare("RELEASE `	_bs3.	`",t,!1),rollbackTo:e.prepare("ROLLBACK TO `	_bs3.	`",t,!1)};Vr.set(e,r={default:Object.assign({begin:e.prepare("BEGIN",t,!1)},n),deferred:Object.assign({begin:e.prepare("BEGIN DEFERRED",t,!1)},n),immediate:Object.assign({begin:e.prepare("BEGIN IMMEDIATE",t,!1)},n),exclusive:Object.assign({begin:e.prepare("BEGIN EXCLUSIVE",t,!1)},n)})}return r},ze=(e,t,r,{begin:n,commit:s,rollback:i,savepoint:o,release:a,rollbackTo:c})=>function(){let u,d,m;r.inTransaction?(u=o,d=a,m=c):(u=n,d=s,m=i),u.run();try{let h=e.call(t,this,arguments);if(h&&typeof h.then=="function")throw new TypeError("Transaction function cannot return a promise");return d.run(),h}catch(h){throw r.inTransaction&&(m.run(),m!==i&&d.run()),h}}});var en=w((Ff,Zr)=>{"use strict";var{getBooleanOption:Ta,cppdb:va}=V();Zr.exports=function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");let n=Ta(r,"simple"),s=this[va].prepare(`PRAGMA ${t}`,this,!0);return n?s.pluck().get():s.all()}});var nn=w((Af,rn)=>{"use strict";var Ea=require("fs"),ka=require("path"),{promisify:Sa}=require("util"),{cppdb:Oa}=V(),tn=Sa(Ea.access);rn.exports=async function(t,r){if(r==null&&(r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");t=t.trim();let n="attached"in r?r.attached:"main",s="progress"in r?r.progress:null;if(!t)throw new TypeError("Backup filename cannot be an empty string");if(t===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof n!="string")throw new TypeError('Expected the "attached" option to be a string');if(!n)throw new TypeError('The "attached" option cannot be an empty string');if(s!=null&&typeof s!="function")throw new TypeError('Expected the "progress" option to be a function');await tn(ka.dirname(t)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let i=await tn(t).then(()=>!1,()=>!0);return Ca(this[Oa].backup(this,n,t,i),s||null)};var Ca=(e,t)=>{let r=0,n=!0;return new Promise((s,i)=>{setImmediate(function o(){try{let a=e.transfer(r);if(!a.remainingPages){e.close(),s(a);return}if(n&&(n=!1,r=100),t){let c=t(a);if(c!==void 0)if(typeof c=="number"&&c===c)r=Math.max(0,Math.min(2147483647,Math.round(c)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(o)}catch(a){e.close(),i(a)}})})}});var on=w((If,sn)=>{"use strict";var{cppdb:Ra}=V();sn.exports=function(t){if(t==null&&(t={}),typeof t!="object")throw new TypeError("Expected first argument to be an options object");let r="attached"in t?t.attached:"main";if(typeof r!="string")throw new TypeError('Expected the "attached" option to be a string');if(!r)throw new TypeError('The "attached" option cannot be an empty string');return this[Ra].serialize(r)}});var cn=w((Mf,an)=>{"use strict";var{getBooleanOption:We,cppdb:xa}=V();an.exports=function(t,r,n){if(r==null&&(r={}),typeof r=="function"&&(n=r,r={}),typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof n!="function")throw new TypeError("Expected last argument to be a function");if(typeof r!="object")throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let s="safeIntegers"in r?+We(r,"safeIntegers"):2,i=We(r,"deterministic"),o=We(r,"directOnly"),a=We(r,"varargs"),c=-1;if(!a){if(c=n.length,!Number.isInteger(c)||c<0)throw new TypeError("Expected function.length to be a positive integer");if(c>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[xa].function(n,t,c,s,i,o),this}});var pn=w((Df,ln)=>{"use strict";var{getBooleanOption:Ye,cppdb:Fa}=V();ln.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(typeof r!="object"||r===null)throw new TypeError("Expected second argument to be an options object");if(!t)throw new TypeError("User-defined function name cannot be an empty string");let n="start"in r?r.start:null,s=Mt(r,"step",!0),i=Mt(r,"inverse",!1),o=Mt(r,"result",!1),a="safeIntegers"in r?+Ye(r,"safeIntegers"):2,c=Ye(r,"deterministic"),f=Ye(r,"directOnly"),u=Ye(r,"varargs"),d=-1;if(!u&&(d=Math.max(un(s),i?un(i):0),d>0&&(d-=1),d>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[Fa].aggregate(n,s,i,o,t,d,a,c,f),this};var Mt=(e,t,r)=>{let n=t in e?e[t]:null;if(typeof n=="function")return n;if(n!=null)throw new TypeError(`Expected the "${t}" option to be a function`);if(r)throw new TypeError(`Missing required option "${t}"`);return null},un=({length:e})=>{if(Number.isInteger(e)&&e>=0)return e;throw new TypeError("Expected function.length to be a positive integer")}});var mn=w((Pf,hn)=>{"use strict";var{cppdb:Aa}=V();hn.exports=function(t,r){if(typeof t!="string")throw new TypeError("Expected first argument to be a string");if(!t)throw new TypeError("Virtual table module name cannot be an empty string");let n=!1;if(typeof r=="object"&&r!==null)n=!0,r=ja(dn(r,"used",t));else{if(typeof r!="function")throw new TypeError("Expected second argument to be a function or a table definition object");r=Ia(r)}return this[Aa].table(r,t,n),this};function Ia(e){return function(r,n,s,...i){let o={module:r,database:n,table:s},a=$a.call(e,o,i);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${r}" did not return a table definition object`);return dn(a,"returned",r)}}function dn(e,t,r){if(!Se.call(e,"rows"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "rows" property`);if(!Se.call(e,"columns"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition without a "columns" property`);let n=e.rows;if(typeof n!="function"||Object.getPrototypeOf(n)!==La)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "rows" property (should be a generator function)`);let s=e.columns;if(!Array.isArray(s)||!(s=[...s]).every(f=>typeof f=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "columns" property (should be an array of strings)`);if(s.length!==new Set(s).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate column names`);if(!s.length)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with zero columns`);let i;if(Se.call(e,"parameters")){if(i=e.parameters,!Array.isArray(i)||!(i=[...i]).every(f=>typeof f=="string"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "parameters" property (should be an array of strings)`)}else i=Na(n);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${r}" ${t} a table definition with duplicate parameter names`);if(i.length>32)throw new RangeError(`Virtual table module "${r}" ${t} a table definition with more than the maximum number of 32 parameters`);for(let f of i)if(s.includes(f))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with column "${f}" which was ambiguously defined as both a column and parameter`);let o=2;if(Se.call(e,"safeIntegers")){let f=e.safeIntegers;if(typeof f!="boolean")throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "safeIntegers" property (should be a boolean)`);o=+f}let a=!1;if(Se.call(e,"directOnly")&&(a=e.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${r}" ${t} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...i.map(fn).map(f=>`${f} HIDDEN`),...s.map(fn)].join(", ")});`,Ma(n,new Map(s.map((f,u)=>[f,i.length+u])),r),i,o,a]}function Ma(e,t,r){return function*(...s){let i=s.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);for(let o=0;o<t.size;++o)i.push(null);for(let o of e(...s))if(Array.isArray(o))Da(o,i,t.size,r),yield i;else if(typeof o=="object"&&o!==null)Pa(o,i,t,r),yield i;else throw new TypeError(`Virtual table module "${r}" yielded something that isn't a valid row object`)}}function Da(e,t,r,n){if(e.length!==r)throw new TypeError(`Virtual table module "${n}" yielded a row with an incorrect number of columns`);let s=t.length-r;for(let i=0;i<r;++i)t[i+s]=e[i]}function Pa(e,t,r,n){let s=0;for(let i of Object.keys(e)){let o=r.get(i);if(o===void 0)throw new TypeError(`Virtual table module "${n}" yielded a row with an undeclared column "${i}"`);t[o]=e[i],s+=1}if(s!==r.size)throw new TypeError(`Virtual table module "${n}" yielded a row with missing columns`)}function Na({length:e}){if(!Number.isInteger(e)||e<0)throw new TypeError("Expected function.length to be a positive integer");let t=[];for(let r=0;r<e;++r)t.push(`$${r+1}`);return t}var{hasOwnProperty:Se}=Object.prototype,{apply:$a}=Function.prototype,La=Object.getPrototypeOf(function*(){}),fn=e=>`"${e.replace(/"/g,'""')}"`,ja=e=>()=>e});var yn=w((Nf,gn)=>{"use strict";var Ba=function(){};gn.exports=function(t,r){return Object.assign(new Ba,this)}});var Tn=w(($f,wn)=>{"use strict";var qa=require("fs"),bn=require("path"),Je=V(),Ga=At(),_n;function A(e,t){if(new.target==null)return new A(e,t);let r;if(Buffer.isBuffer(e)&&(r=e,e=":memory:"),e==null&&(e=""),t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in t)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in t)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let n=e.trim(),s=n===""||n===":memory:",i=Je.getBooleanOption(t,"readonly"),o=Je.getBooleanOption(t,"fileMustExist"),a="timeout"in t?t.timeout:5e3,c="verbose"in t?t.verbose:null,f="nativeBinding"in t?t.nativeBinding:null;if(i&&s&&!r)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(c!=null&&typeof c!="function")throw new TypeError('Expected the "verbose" option to be a function');if(f!=null&&typeof f!="string"&&typeof f!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let u;if(f==null?u=_n||(_n=Yr()("better_sqlite3.node")):typeof f=="string"?u=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(bn.resolve(f).replace(/(\.node)?$/,".node")):u=f,u.isInitialized||(u.setErrorConstructor(Ga),u.isInitialized=!0),!s&&!qa.existsSync(bn.dirname(n)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[Je.cppdb]:{value:new u.Database(n,e,s,i,o,a,c||null,r||null)},...ie.getters})}var ie=Jr();A.prototype.prepare=ie.prepare;A.prototype.transaction=Qr();A.prototype.pragma=en();A.prototype.backup=nn();A.prototype.serialize=on();A.prototype.function=cn();A.prototype.aggregate=pn();A.prototype.table=mn();A.prototype.loadExtension=ie.loadExtension;A.prototype.exec=ie.exec;A.prototype.close=ie.close;A.prototype.defaultSafeIntegers=ie.defaultSafeIntegers;A.prototype.unsafeMode=ie.unsafeMode;A.prototype[Je.inspect]=yn();wn.exports=A});var vn=w((Lf,Dt)=>{"use strict";Dt.exports=Tn();Dt.exports.SqliteError=At()});var Sn=w((jf,kn)=>{var Ua=vn(),$t=require("node:path"),En=require("node:fs"),Xa=require("node:os"),Ha=$t.join(Xa.homedir(),".claude-memory"),Pt=$t.join(Ha,"memories.db"),Nt=class{constructor(t=Pt){t||(t=Pt);let r=$t.dirname(t);En.existsSync(r)||En.mkdirSync(r,{recursive:!0}),this.db=new Ua(t),this.db.pragma("journal_mode = WAL"),this.initSchema()}initSchema(){this.db.exec(`
      CREATE TABLE IF NOT EXISTS memories (
        id TEXT PRIMARY KEY,
        content TEXT NOT NULL,
        container_tag TEXT NOT NULL,
        metadata TEXT,
        created_at INTEGER NOT NULL,
        updated_at INTEGER NOT NULL,
        synced_at INTEGER,
        sync_status TEXT DEFAULT 'pending'
      );

      CREATE TABLE IF NOT EXISTS profiles (
        id TEXT PRIMARY KEY,
        container_tag TEXT NOT NULL,
        fact TEXT NOT NULL,
        type TEXT DEFAULT 'static',
        created_at INTEGER NOT NULL,
        synced_at INTEGER
      );

      CREATE TABLE IF NOT EXISTS sync_state (
        key TEXT PRIMARY KEY,
        value TEXT,
        updated_at INTEGER
      );

      CREATE INDEX IF NOT EXISTS idx_memories_container ON memories(container_tag);
      CREATE INDEX IF NOT EXISTS idx_memories_created ON memories(created_at);
      CREATE INDEX IF NOT EXISTS idx_memories_sync_status ON memories(sync_status);
      CREATE INDEX IF NOT EXISTS idx_profiles_container ON profiles(container_tag);

      CREATE VIRTUAL TABLE IF NOT EXISTS memories_fts USING fts5(
        content,
        container_tag,
        content=memories,
        content_rowid=rowid
      );

      CREATE TRIGGER IF NOT EXISTS memories_ai AFTER INSERT ON memories BEGIN
        INSERT INTO memories_fts(rowid, content, container_tag)
        VALUES (new.rowid, new.content, new.container_tag);
      END;

      CREATE TRIGGER IF NOT EXISTS memories_ad AFTER DELETE ON memories BEGIN
        DELETE FROM memories_fts WHERE rowid = old.rowid;
      END;

      CREATE TRIGGER IF NOT EXISTS memories_au AFTER UPDATE ON memories BEGIN
        UPDATE memories_fts SET content = new.content, container_tag = new.container_tag
        WHERE rowid = new.rowid;
      END;
    `)}addMemory(t,r,n,s={}){let i=Date.now();return this.db.prepare(`
      INSERT INTO memories (id, content, container_tag, metadata, created_at, updated_at, sync_status)
      VALUES (?, ?, ?, ?, ?, ?, 'pending')
    `).run(t,r,n,JSON.stringify(s),i,i),{id:t,createdAt:i}}getMemory(t){let n=this.db.prepare("SELECT * FROM memories WHERE id = ?").get(t);return n?.metadata&&(n.metadata=JSON.parse(n.metadata)),n}updateMemory(t,r,n=null){let s=Date.now(),i=["content = ?","updated_at = ?","sync_status = ?"],o=[r,s,"pending"];n!==null&&(i.push("metadata = ?"),o.push(JSON.stringify(n))),o.push(t),this.db.prepare(`UPDATE memories SET ${i.join(", ")} WHERE id = ?`).run(...o)}deleteMemory(t){this.db.prepare("DELETE FROM memories WHERE id = ?").run(t)}listMemories(t,r=20){return this.db.prepare(`
      SELECT * FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r).map(i=>(i.metadata&&(i.metadata=JSON.parse(i.metadata)),i))}getPendingSync(){return this.db.prepare("SELECT * FROM memories WHERE sync_status = 'pending'").all().map(n=>(n.metadata&&(n.metadata=JSON.parse(n.metadata)),n))}markSynced(t){let r=Date.now(),n=t.map(()=>"?").join(",");this.db.prepare(`
      UPDATE memories
      SET sync_status = 'synced', synced_at = ?
      WHERE id IN (${n})
    `).run(r,...t)}searchMemories(t,r=null,n=10){let s=`
      SELECT m.*, rank * -1 as relevance_score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ?
    `,i=[t];return r&&(s+=" AND m.container_tag = ?",i.push(r)),s+=" ORDER BY rank LIMIT ?",i.push(n),this.db.prepare(s).all(...i).map(c=>(c.metadata&&(c.metadata=JSON.parse(c.metadata)),c))}getContextMemories(t,r,n=10){let i=this.db.prepare(`
      SELECT *, 1.0 as score FROM memories
      WHERE container_tag = ?
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,Math.floor(n/2)),a=this.db.prepare(`
      SELECT m.*, rank * -1 as score
      FROM memories_fts f
      JOIN memories m ON f.rowid = m.rowid
      WHERE memories_fts MATCH ? AND m.container_tag = ?
      ORDER BY rank
      LIMIT ?
    `).all(r,t,Math.floor(n/2)),c=new Set(i.map(u=>u.id)),f=[...i];for(let u of a)c.has(u.id)||(f.push(u),c.add(u.id));return f.slice(0,n).map(u=>(u.metadata&&(u.metadata=JSON.parse(u.metadata)),u))}addProfileFact(t,r,n,s="static"){let i=Date.now();this.db.prepare(`
      INSERT OR REPLACE INTO profiles (id, container_tag, fact, type, created_at)
      VALUES (?, ?, ?, ?, ?)
    `).run(t,r,n,s,i)}getProfile(t,r=5){let s=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'static'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r),o=this.db.prepare(`
      SELECT fact FROM profiles
      WHERE container_tag = ? AND type = 'dynamic'
      ORDER BY created_at DESC
      LIMIT ?
    `).all(t,r);return{static:s.map(a=>a.fact),dynamic:o.map(a=>a.fact)}}deleteProfileFact(t){this.db.prepare("DELETE FROM profiles WHERE id = ?").run(t)}close(){this.db.close()}};kn.exports={SqliteManager:Nt,DEFAULT_DB_PATH:Pt}});var Cn=w((Bf,On)=>{var me=1e3,ge=me*60,ye=ge*60,oe=ye*24,za=oe*7,Wa=oe*365.25;On.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return Ya(e);if(r==="number"&&isFinite(e))return t.long?Va(e):Ja(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Ya(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*Wa;case"weeks":case"week":case"w":return r*za;case"days":case"day":case"d":return r*oe;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ye;case"minutes":case"minute":case"mins":case"min":case"m":return r*ge;case"seconds":case"second":case"secs":case"sec":case"s":return r*me;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function Ja(e){var t=Math.abs(e);return t>=oe?Math.round(e/oe)+"d":t>=ye?Math.round(e/ye)+"h":t>=ge?Math.round(e/ge)+"m":t>=me?Math.round(e/me)+"s":e+"ms"}function Va(e){var t=Math.abs(e);return t>=oe?Ve(e,t,oe,"day"):t>=ye?Ve(e,t,ye,"hour"):t>=ge?Ve(e,t,ge,"minute"):t>=me?Ve(e,t,me,"second"):e+" ms"}function Ve(e,t,r,n){var s=t>=r*1.5;return Math.round(e/r)+" "+n+(s?"s":"")}});var Lt=w((qf,Rn)=>{function Ka(e){r.debug=r,r.default=r,r.coerce=c,r.disable=o,r.enable=s,r.enabled=a,r.humanize=Cn(),r.destroy=f,Object.keys(e).forEach(u=>{r[u]=e[u]}),r.names=[],r.skips=[],r.formatters={};function t(u){let d=0;for(let m=0;m<u.length;m++)d=(d<<5)-d+u.charCodeAt(m),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=t;function r(u){let d,m=null,h,U;function R(...P){if(!R.enabled)return;let Z=R,fe=Number(new Date),Ot=fe-(d||fe);Z.diff=Ot,Z.prev=d,Z.curr=fe,d=fe,P[0]=r.coerce(P[0]),typeof P[0]!="string"&&P.unshift("%O");let de=0;P[0]=P[0].replace(/%([a-zA-Z%])/g,(ke,Ct)=>{if(ke==="%%")return"%";de++;let qe=r.formatters[Ct];if(typeof qe=="function"){let Rt=P[de];ke=qe.call(Z,Rt),P.splice(de,1),de--}return ke}),r.formatArgs.call(Z,P),(Z.log||r.log).apply(Z,P)}return R.namespace=u,R.useColors=r.useColors(),R.color=r.selectColor(u),R.extend=n,R.destroy=r.destroy,Object.defineProperty(R,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==r.namespaces&&(h=r.namespaces,U=r.enabled(u)),U),set:P=>{m=P}}),typeof r.init=="function"&&r.init(R),R}function n(u,d){let m=r(this.namespace+(typeof d>"u"?":":d)+u);return m.log=this.log,m}function s(u){r.save(u),r.namespaces=u,r.names=[],r.skips=[];let d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let m of d)m[0]==="-"?r.skips.push(m.slice(1)):r.names.push(m)}function i(u,d){let m=0,h=0,U=-1,R=0;for(;m<u.length;)if(h<d.length&&(d[h]===u[m]||d[h]==="*"))d[h]==="*"?(U=h,R=m,h++):(m++,h++);else if(U!==-1)h=U+1,R++,m=R;else return!1;for(;h<d.length&&d[h]==="*";)h++;return h===d.length}function o(){let u=[...r.names,...r.skips.map(d=>"-"+d)].join(",");return r.enable(""),u}function a(u){for(let d of r.skips)if(i(u,d))return!1;for(let d of r.names)if(i(u,d))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Rn.exports=Ka});var xn=w((N,Ke)=>{N.formatArgs=Za;N.save=ec;N.load=tc;N.useColors=Qa;N.storage=rc();N.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();N.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Qa(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Za(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Ke.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),e.splice(n,0,t)}N.log=console.debug||console.log||(()=>{});function ec(e){try{e?N.storage.setItem("debug",e):N.storage.removeItem("debug")}catch{}}function tc(){let e;try{e=N.storage.getItem("debug")||N.storage.getItem("DEBUG")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function rc(){try{return localStorage}catch{}}Ke.exports=Lt()(N);var{formatters:nc}=Ke.exports;nc.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var An=w((x,Ze)=>{var sc=require("tty"),Qe=require("util");x.init=pc;x.log=cc;x.formatArgs=oc;x.save=uc;x.load=lc;x.useColors=ic;x.destroy=Qe.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");x.colors=[6,2,3,4,5,1];try{let e=require("supports-color");e&&(e.stderr||e).level>=2&&(x.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}x.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(s,i)=>i.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),e[r]=n,e},{});function ic(){return"colors"in x.inspectOpts?!!x.inspectOpts.colors:sc.isatty(process.stderr.fd)}function oc(e){let{namespace:t,useColors:r}=this;if(r){let n=this.color,s="\x1B[3"+(n<8?n:"8;5;"+n),i=`  ${s};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(s+"m+"+Ze.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=ac()+t+" "+e[0]}function ac(){return x.inspectOpts.hideDate?"":new Date().toISOString()+" "}function cc(...e){return process.stderr.write(Qe.formatWithOptions(x.inspectOpts,...e)+`
`)}function uc(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function lc(){return process.env.DEBUG}function pc(e){e.inspectOpts={};let t=Object.keys(x.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=x.inspectOpts[t[r]]}Ze.exports=Lt()(x);var{formatters:Fn}=Ze.exports;Fn.o=function(e){return this.inspectOpts.colors=this.useColors,Qe.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Fn.O=function(e){return this.inspectOpts.colors=this.useColors,Qe.inspect(e,this.inspectOpts)}});var Bt=w((Gf,jt)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?jt.exports=xn():jt.exports=An()});var In=w(B=>{"use strict";var fc=B&&B.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(B,"__esModule",{value:!0});var dc=require("fs"),hc=fc(Bt()),be=hc.default("@kwsites/file-exists");function mc(e,t,r){be("checking %s",e);try{let n=dc.statSync(e);return n.isFile()&&t?(be("[OK] path represents a file"),!0):n.isDirectory()&&r?(be("[OK] path represents a directory"),!0):(be("[FAIL] path represents something other than a file or directory"),!1)}catch(n){if(n.code==="ENOENT")return be("[FAIL] path is not accessible: %o",n),!1;throw be("[FATAL] %o",n),n}}function gc(e,t=B.READABLE){return mc(e,(t&B.FILE)>0,(t&B.FOLDER)>0)}B.exists=gc;B.FILE=1;B.FOLDER=2;B.READABLE=B.FILE+B.FOLDER});var Mn=w(et=>{"use strict";function yc(e){for(var t in e)et.hasOwnProperty(t)||(et[t]=e[t])}Object.defineProperty(et,"__esModule",{value:!0});yc(In())});var Gt=w(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.createDeferred=ae.deferred=void 0;function qt(){let e,t,r="pending";return{promise:new Promise((s,i)=>{e=s,t=i}),done(s){r==="pending"&&(r="resolved",e(s))},fail(s){r==="pending"&&(r="rejected",t(s))},get fulfilled(){return r!=="pending"},get status(){return r}}}ae.deferred=qt;ae.createDeferred=qt;ae.default=qt});var Co=w((zf,Oo)=>{"use strict";var bc=Object.create,ft=Object.defineProperty,_c=Object.getOwnPropertyDescriptor,lr=Object.getOwnPropertyNames,wc=Object.getPrototypeOf,Tc=Object.prototype.hasOwnProperty,l=(e,t)=>function(){return e&&(t=(0,e[lr(e)[0]])(e=0)),t},vc=(e,t)=>function(){return t||(0,e[lr(e)[0]])((t={exports:{}}).exports,t),t.exports},S=(e,t)=>{for(var r in t)ft(e,r,{get:t[r],enumerable:!0})},ds=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of lr(t))!Tc.call(e,s)&&s!==r&&ft(e,s,{get:()=>t[s],enumerable:!(n=_c(t,s))||n.enumerable});return e},Ec=(e,t,r)=>(r=e!=null?bc(wc(e)):{},ds(t||!e||!e.__esModule?ft(r,"default",{value:e,enumerable:!0}):r,e)),k=e=>ds(ft({},"__esModule",{value:!0}),e),K,ne=l({"src/lib/errors/git-error.ts"(){"use strict";K=class extends Error{constructor(e,t){super(t),this.task=e,Object.setPrototypeOf(this,new.target.prototype)}}}}),le,Te=l({"src/lib/errors/git-response-error.ts"(){"use strict";ne(),le=class extends K{constructor(e,t){super(void 0,t||String(e)),this.git=e}}}});function hs(...e){let t=new String(e);return dt.set(t,e),t}function ot(e){return e instanceof String&&dt.has(e)}function Dn(e){return dt.get(e)||[]}var dt,Ae=l({"src/lib/args/pathspec.ts"(){"use strict";dt=new WeakMap}}),pr,kc=l({"src/lib/errors/git-construct-error.ts"(){"use strict";ne(),pr=class extends K{constructor(e,t){super(void 0,t),this.config=e}}}}),z,Ie=l({"src/lib/errors/git-plugin-error.ts"(){"use strict";ne(),z=class extends K{constructor(e,t,r){super(e,r),this.task=e,this.plugin=t,Object.setPrototypeOf(this,new.target.prototype)}}}}),fr,ms=l({"src/lib/errors/task-configuration-error.ts"(){"use strict";ne(),fr=class extends K{constructor(e){super(void 0,e)}}}});function gs(e){return typeof e!="function"?pe:e}function ys(e){return typeof e=="function"&&e!==pe}function bs(e,t){let r=e.indexOf(t);return r<=0?[e,""]:[e.substr(0,r),e.substr(r+1)]}function _s(e,t=0){return ws(e)&&e.length>t?e[t]:void 0}function ue(e,t=0){if(ws(e)&&e.length>t)return e[e.length-1-t]}function ws(e){return yt(e)}function Me(e="",t=!0,r=`
`){return e.split(r).reduce((n,s)=>{let i=t?s.trim():s;return i&&n.push(i),n},[])}function dr(e,t){return Me(e,!0).map(r=>t(r))}function hr(e){return(0,Vt.exists)(e,Vt.FOLDER)}function T(e,t){return Array.isArray(e)?e.includes(t)||e.push(t):e.add(t),t}function Ts(e,t){return Array.isArray(e)&&!e.includes(t)&&e.push(t),e}function ht(e,t){if(Array.isArray(e)){let r=e.indexOf(t);r>=0&&e.splice(r,1)}else e.delete(t);return t}function Q(e){return Array.isArray(e)?e:[e]}function vs(e){return e.replace(/[\s-]+(.)/g,(t,r)=>r.toUpperCase())}function ve(e){return Q(e).map(t=>t instanceof String?t:String(t))}function E(e,t=0){if(e==null)return t;let r=parseInt(e,10);return Number.isNaN(r)?t:r}function xe(e,t){let r=[];for(let n=0,s=e.length;n<s;n++)r.push(t,e[n]);return r}function Fe(e){return(Array.isArray(e)?ks.Buffer.concat(e):e).toString("utf-8")}function Es(e,t){let r={};return t.forEach(n=>{e[n]!==void 0&&(r[n]=e[n])}),r}function Yt(e=0){return new Promise(t=>setTimeout(t,e))}function Jt(e){if(e!==!1)return e}var ks,Vt,we,pe,De,mt=l({"src/lib/utils/util.ts"(){"use strict";ks=require("node:buffer"),Vt=Mn(),mr(),we="\0",pe=()=>{},De=Object.prototype.toString.call.bind(Object.prototype.toString)}});function G(e,t,r){return t(e)?e:arguments.length>2?r:void 0}function Kt(e,t){let r=ot(e)?"string":typeof e;return/number|string|boolean/.test(r)&&(!t||!t.includes(r))}function gt(e){return!!e&&De(e)==="[object Object]"}function Ss(e){return typeof e=="function"}var Pe,Os,F,at,yt,mr=l({"src/lib/utils/argument-filters.ts"(){"use strict";Ae(),mt(),Pe=e=>Array.isArray(e),Os=e=>typeof e=="number",F=e=>typeof e=="string",at=e=>F(e)||Array.isArray(e)&&e.every(F),yt=e=>e==null||"number|boolean|function".includes(typeof e)?!1:typeof e.length=="number"}}),Qt,Sc=l({"src/lib/utils/exit-codes.ts"(){"use strict";Qt=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR",e[e.NOT_FOUND=-2]="NOT_FOUND",e[e.UNCLEAN=128]="UNCLEAN",e))(Qt||{})}}),ct,Oc=l({"src/lib/utils/git-output-streams.ts"(){"use strict";ct=class Cs{constructor(t,r){this.stdOut=t,this.stdErr=r}asStrings(){return new Cs(this.stdOut.toString("utf8"),this.stdErr.toString("utf8"))}}}});function Cc(){throw new Error("LineParser:useMatches not implemented")}var _,re,Rc=l({"src/lib/utils/line-parser.ts"(){"use strict";_=class{constructor(e,t){this.matches=[],this.useMatches=Cc,this.parse=(r,n)=>(this.resetMatches(),this._regExp.every((s,i)=>this.addMatch(s,i,r(i)))?this.useMatches(n,this.prepareMatches())!==!1:!1),this._regExp=Array.isArray(e)?e:[e],t&&(this.useMatches=t)}resetMatches(){this.matches.length=0}prepareMatches(){return this.matches}addMatch(e,t,r){let n=r&&e.exec(r);return n&&this.pushMatch(t,n),!!n}pushMatch(e,t){this.matches.push(...t.slice(1))}},re=class extends _{addMatch(e,t,r){return/^remote:\s/.test(String(r))&&super.addMatch(e,t,r)}pushMatch(e,t){(e>0||t.length>1)&&super.pushMatch(e,t)}}}});function Rs(...e){let t=process.cwd(),r=Object.assign({baseDir:t,...xs},...e.filter(n=>typeof n=="object"&&n));return r.baseDir=r.baseDir||t,r.trimmed=r.trimmed===!0,r}var xs,xc=l({"src/lib/utils/simple-git-options.ts"(){"use strict";xs={binary:"git",maxConcurrentProcesses:5,config:[],trimmed:!1}}});function gr(e,t=[]){return gt(e)?Object.keys(e).reduce((r,n)=>{let s=e[n];if(ot(s))r.push(s);else if(Kt(s,["boolean"]))r.push(n+"="+s);else if(Array.isArray(s))for(let i of s)Kt(i,["string","number"])||r.push(n+"="+i);else r.push(n);return r},t):t}function $(e,t=0,r=!1){let n=[];for(let s=0,i=t<0?e.length:t;s<i;s++)"string|number".includes(typeof e[s])&&n.push(String(e[s]));return gr(yr(e),n),r||n.push(...Fc(e)),n}function Fc(e){let t=typeof ue(e)=="function";return ve(G(ue(e,t?1:0),Pe,[]))}function yr(e){let t=Ss(ue(e));return G(ue(e,t?1:0),gt)}function O(e,t=!0){let r=gs(ue(e));return t||ys(r)?r:void 0}var Ac=l({"src/lib/utils/task-options.ts"(){"use strict";mr(),mt(),Ae()}});function Zt(e,t){return e(t.stdOut,t.stdErr)}function j(e,t,r,n=!0){return Q(r).forEach(s=>{for(let i=Me(s,n),o=0,a=i.length;o<a;o++){let c=(f=0)=>{if(!(o+f>=a))return i[o+f]};t.some(({parse:f})=>f(c,e))}}),e}var Ic=l({"src/lib/utils/task-parser.ts"(){"use strict";mt()}}),Fs={};S(Fs,{ExitCodes:()=>Qt,GitOutputStreams:()=>ct,LineParser:()=>_,NOOP:()=>pe,NULL:()=>we,RemoteLineParser:()=>re,append:()=>T,appendTaskOptions:()=>gr,asArray:()=>Q,asCamelCase:()=>vs,asFunction:()=>gs,asNumber:()=>E,asStringArray:()=>ve,bufferToString:()=>Fe,callTaskParser:()=>Zt,createInstanceConfig:()=>Rs,delay:()=>Yt,filterArray:()=>Pe,filterFunction:()=>Ss,filterHasLength:()=>yt,filterNumber:()=>Os,filterPlainObject:()=>gt,filterPrimitives:()=>Kt,filterString:()=>F,filterStringOrStringArray:()=>at,filterType:()=>G,first:()=>_s,folderExists:()=>hr,forEachLineWithContent:()=>dr,getTrailingOptions:()=>$,including:()=>Ts,isUserFunction:()=>ys,last:()=>ue,objectToString:()=>De,orVoid:()=>Jt,parseStringResponse:()=>j,pick:()=>Es,prefixedArray:()=>xe,remove:()=>ht,splitOn:()=>bs,toLinesWithContent:()=>Me,trailingFunctionArgument:()=>O,trailingOptionsArgument:()=>yr});var b=l({"src/lib/utils/index.ts"(){"use strict";mr(),Sc(),Oc(),Rc(),xc(),Ac(),Ic(),mt()}}),As={};S(As,{CheckRepoActions:()=>ut,checkIsBareRepoTask:()=>Ms,checkIsRepoRootTask:()=>Is,checkIsRepoTask:()=>Mc});function Mc(e){switch(e){case"bare":return Ms();case"root":return Is()}return{commands:["rev-parse","--is-inside-work-tree"],format:"utf-8",onError:bt,parser:br}}function Is(){return{commands:["rev-parse","--git-dir"],format:"utf-8",onError:bt,parser(t){return/^\.(git)?$/.test(t.trim())}}}function Ms(){return{commands:["rev-parse","--is-bare-repository"],format:"utf-8",onError:bt,parser:br}}function Dc(e){return/(Not a git repository|Kein Git-Repository)/i.test(String(e))}var ut,bt,br,Ds=l({"src/lib/tasks/check-is-repo.ts"(){"use strict";b(),ut=(e=>(e.BARE="bare",e.IN_TREE="tree",e.IS_REPO_ROOT="root",e))(ut||{}),bt=({exitCode:e},t,r,n)=>{if(e===128&&Dc(t))return r(Buffer.from("false"));n(t)},br=e=>e.trim()==="true"}});function Pc(e,t){let r=new Ps(e),n=e?$s:Ns;return Me(t).forEach(s=>{let i=s.replace(n,"");r.paths.push(i),(Ls.test(i)?r.folders:r.files).push(i)}),r}var Ps,Ns,$s,Ls,Nc=l({"src/lib/responses/CleanSummary.ts"(){"use strict";b(),Ps=class{constructor(e){this.dryRun=e,this.paths=[],this.files=[],this.folders=[]}},Ns=/^[a-z]+\s*/i,$s=/^[a-z]+\s+[a-z]+\s*/i,Ls=/\/$/}}),er={};S(er,{EMPTY_COMMANDS:()=>_t,adhocExecTask:()=>js,configurationErrorTask:()=>L,isBufferTask:()=>qs,isEmptyTask:()=>Gs,straightThroughBufferTask:()=>Bs,straightThroughStringTask:()=>M});function js(e){return{commands:_t,format:"empty",parser:e}}function L(e){return{commands:_t,format:"empty",parser(){throw typeof e=="string"?new fr(e):e}}}function M(e,t=!1){return{commands:e,format:"utf-8",parser(r){return t?String(r).trim():r}}}function Bs(e){return{commands:e,format:"buffer",parser(t){return t}}}function qs(e){return e.format==="buffer"}function Gs(e){return e.format==="empty"||!e.commands.length}var _t,C=l({"src/lib/tasks/task.ts"(){"use strict";ms(),_t=[]}}),Us={};S(Us,{CONFIG_ERROR_INTERACTIVE_MODE:()=>_r,CONFIG_ERROR_MODE_REQUIRED:()=>wr,CONFIG_ERROR_UNKNOWN_OPTION:()=>Tr,CleanOptions:()=>Ce,cleanTask:()=>Xs,cleanWithOptionsTask:()=>$c,isCleanOptionsArray:()=>Lc});function $c(e,t){let{cleanMode:r,options:n,valid:s}=jc(e);return r?s.options?(n.push(...t),n.some(Gc)?L(_r):Xs(r,n)):L(Tr+JSON.stringify(e)):L(wr)}function Xs(e,t){return{commands:["clean",`-${e}`,...t],format:"utf-8",parser(n){return Pc(e==="n",n)}}}function Lc(e){return Array.isArray(e)&&e.every(t=>vr.has(t))}function jc(e){let t,r=[],n={cleanMode:!1,options:!0};return e.replace(/[^a-z]i/g,"").split("").forEach(s=>{Bc(s)?(t=s,n.cleanMode=!0):n.options=n.options&&qc(r[r.length]=`-${s}`)}),{cleanMode:t,options:r,valid:n}}function Bc(e){return e==="f"||e==="n"}function qc(e){return/^-[a-z]$/i.test(e)&&vr.has(e.charAt(1))}function Gc(e){return/^-[^\-]/.test(e)?e.indexOf("i")>0:e==="--interactive"}var _r,wr,Tr,Ce,vr,Hs=l({"src/lib/tasks/clean.ts"(){"use strict";Nc(),b(),C(),_r="Git clean interactive mode is not supported",wr='Git clean mode parameter ("n" or "f") is required',Tr="Git clean unknown option found in: ",Ce=(e=>(e.DRY_RUN="n",e.FORCE="f",e.IGNORED_INCLUDED="x",e.IGNORED_ONLY="X",e.EXCLUDING="e",e.QUIET="q",e.RECURSIVE="d",e))(Ce||{}),vr=new Set(["i",...ve(Object.values(Ce))])}});function Uc(e){let t=new Ws;for(let r of zs(e))t.addValue(r.file,String(r.key),r.value);return t}function Xc(e,t){let r=null,n=[],s=new Map;for(let i of zs(e,t))i.key===t&&(n.push(r=i.value),s.has(i.file)||s.set(i.file,[]),s.get(i.file).push(r));return{key:t,paths:Array.from(s.keys()),scopes:s,value:r,values:n}}function Hc(e){return e.replace(/^(file):/,"")}function*zs(e,t=null){let r=e.split("\0");for(let n=0,s=r.length-1;n<s;){let i=Hc(r[n++]),o=r[n++],a=t;if(o.includes(`
`)){let c=bs(o,`
`);a=c[0],o=c[1]}yield{file:i,key:a,value:o}}}var Ws,zc=l({"src/lib/responses/ConfigList.ts"(){"use strict";b(),Ws=class{constructor(){this.files=[],this.values=Object.create(null)}get all(){return this._all||(this._all=this.files.reduce((e,t)=>Object.assign(e,this.values[t]),{})),this._all}addFile(e){if(!(e in this.values)){let t=ue(this.files);this.values[e]=t?Object.create(this.values[t]):{},this.files.push(e)}return this.values[e]}addValue(e,t,r){let n=this.addFile(e);Object.hasOwn(n,t)?Array.isArray(n[t])?n[t].push(r):n[t]=[n[t],r]:n[t]=r,this._all=void 0}}}});function Ut(e,t){return typeof e=="string"&&Object.hasOwn(lt,e)?e:t}function Wc(e,t,r,n){let s=["config",`--${n}`];return r&&s.push("--add"),s.push(e,t),{commands:s,format:"utf-8",parser(i){return i}}}function Yc(e,t){let r=["config","--null","--show-origin","--get-all",e];return t&&r.splice(1,0,`--${t}`),{commands:r,format:"utf-8",parser(n){return Xc(n,e)}}}function Jc(e){let t=["config","--list","--show-origin","--null"];return e&&t.push(`--${e}`),{commands:t,format:"utf-8",parser(r){return Uc(r)}}}function Vc(){return{addConfig(e,t,...r){return this._runTask(Wc(e,t,r[0]===!0,Ut(r[1],"local")),O(arguments))},getConfig(e,t){return this._runTask(Yc(e,Ut(t,void 0)),O(arguments))},listConfig(...e){return this._runTask(Jc(Ut(e[0],void 0)),O(arguments))}}}var lt,Ys=l({"src/lib/tasks/config.ts"(){"use strict";zc(),b(),lt=(e=>(e.system="system",e.global="global",e.local="local",e.worktree="worktree",e))(lt||{})}});function Kc(e){return Js.has(e)}var rt,Js,Vs=l({"src/lib/tasks/diff-name-status.ts"(){"use strict";rt=(e=>(e.ADDED="A",e.COPIED="C",e.DELETED="D",e.MODIFIED="M",e.RENAMED="R",e.CHANGED="T",e.UNMERGED="U",e.UNKNOWN="X",e.BROKEN="B",e))(rt||{}),Js=new Set(Object.values(rt))}});function Ks(...e){return new Zs().param(...e)}function Qc(e){let t=new Set,r={};return dr(e,n=>{let[s,i,o]=n.split(we);t.add(s),(r[s]=r[s]||[]).push({line:E(i),path:s,preview:o})}),{paths:t,results:r}}function Zc(){return{grep(e){let t=O(arguments),r=$(arguments);for(let s of Qs)if(r.includes(s))return this._runTask(L(`git.grep: use of "${s}" is not supported.`),t);typeof e=="string"&&(e=Ks().param(e));let n=["grep","--null","-n","--full-name",...r,...e];return this._runTask({commands:n,format:"utf-8",parser(s){return Qc(s)}},t)}}}var Qs,Oe,Pn,Zs,ei=l({"src/lib/tasks/grep.ts"(){"use strict";b(),C(),Qs=["-h"],Oe=Symbol("grepQuery"),Zs=class{constructor(){this[Pn]=[]}*[(Pn=Oe,Symbol.iterator)](){for(let e of this[Oe])yield e}and(...e){return e.length&&this[Oe].push("--and","(",...xe(e,"-e"),")"),this}param(...e){return this[Oe].push(...xe(e,"-e")),this}}}}),ti={};S(ti,{ResetMode:()=>Re,getResetMode:()=>tu,resetTask:()=>eu});function eu(e,t){let r=["reset"];return ri(e)&&r.push(`--${e}`),r.push(...t),M(r)}function tu(e){if(ri(e))return e;switch(typeof e){case"string":case"undefined":return"soft"}}function ri(e){return typeof e=="string"&&ni.includes(e)}var Re,ni,si=l({"src/lib/tasks/reset.ts"(){"use strict";b(),C(),Re=(e=>(e.MIXED="mixed",e.SOFT="soft",e.HARD="hard",e.MERGE="merge",e.KEEP="keep",e))(Re||{}),ni=ve(Object.values(Re))}}),ii={};S(ii,{CheckRepoActions:()=>ut,CleanOptions:()=>Ce,DiffNameStatus:()=>rt,GitConfigScope:()=>lt,GitConstructError:()=>pr,GitError:()=>K,GitPluginError:()=>z,GitResponseError:()=>le,ResetMode:()=>Re,TaskConfigurationError:()=>fr,grepQueryBuilder:()=>Ks,pathspec:()=>hs});var ru=l({"src/lib/api.ts"(){"use strict";Ae(),kc(),ne(),Ie(),Te(),ms(),Ds(),Hs(),Ys(),Vs(),ei(),si()}});function nu(e){return e?[{type:"spawn.before",action(n,s){e.aborted&&s.kill(new z(void 0,"abort","Abort already signaled"))}},{type:"spawn.after",action(n,s){function i(){s.kill(new z(void 0,"abort","Abort signal received"))}e.addEventListener("abort",i),s.spawned.on("close",()=>e.removeEventListener("abort",i))}}]:void 0}var su=l({"src/lib/plugins/abort-plugin.ts"(){"use strict";Ie()}});function iu(e){return typeof e=="string"&&e.trim().toLowerCase()==="-c"}function ou(e,t){if(iu(e)&&/^\s*protocol(.[a-z]+)?.allow/.test(t))throw new z(void 0,"unsafe","Configuring protocol.allow is not permitted without enabling allowUnsafeExtProtocol")}function au(e,t){if(/^\s*--(upload|receive)-pack/.test(e))throw new z(void 0,"unsafe","Use of --upload-pack or --receive-pack is not permitted without enabling allowUnsafePack");if(t==="clone"&&/^\s*-u\b/.test(e))throw new z(void 0,"unsafe","Use of clone with option -u is not permitted without enabling allowUnsafePack");if(t==="push"&&/^\s*--exec\b/.test(e))throw new z(void 0,"unsafe","Use of push with option --exec is not permitted without enabling allowUnsafePack")}function cu({allowUnsafeProtocolOverride:e=!1,allowUnsafePack:t=!1}={}){return{type:"spawn.args",action(r,n){return r.forEach((s,i)=>{let o=i<r.length?r[i+1]:"";e||ou(s,o),t||au(s,n.method)}),r}}}var uu=l({"src/lib/plugins/block-unsafe-operations-plugin.ts"(){"use strict";Ie()}});function lu(e){let t=xe(e,"-c");return{type:"spawn.args",action(r){return[...t,...r]}}}var pu=l({"src/lib/plugins/command-config-prefixing-plugin.ts"(){"use strict";b()}});function fu({onClose:e=!0,onExit:t=50}={}){function r(){let s=-1,i={close:(0,_e.deferred)(),closeTimeout:(0,_e.deferred)(),exit:(0,_e.deferred)(),exitTimeout:(0,_e.deferred)()},o=Promise.race([e===!1?tr:i.closeTimeout.promise,t===!1?tr:i.exitTimeout.promise]);return n(e,i.close,i.closeTimeout),n(t,i.exit,i.exitTimeout),{close(a){s=a,i.close.done()},exit(a){s=a,i.exit.done()},get exitCode(){return s},result:o}}function n(s,i,o){s!==!1&&(s===!0?i.promise:i.promise.then(()=>Yt(s))).then(o.done)}return{type:"spawn.after",async action(s,{spawned:i,close:o}){let a=r(),c=!0,f=()=>void(c=!1);i.stdout?.on("data",f),i.stderr?.on("data",f),i.on("error",f),i.on("close",u=>a.close(u)),i.on("exit",u=>a.exit(u));try{await a.result,c&&await Yt(50),o(a.exitCode)}catch(u){o(a.exitCode,u)}}}}var _e,tr,du=l({"src/lib/plugins/completion-detection.plugin.ts"(){"use strict";_e=Gt(),b(),tr=(0,_e.deferred)().promise}});function hu(e){return!e||!/^([a-z]:)?([a-z0-9/.\\_-]+)$/i.test(e)}function Nn(e,t){if(e.length<1||e.length>2)throw new z(void 0,"binary",oi);if(e.some(hu))if(t)console.warn(rr);else throw new z(void 0,"binary",rr);let[n,s]=e;return{binary:n,prefix:s}}function mu(e,t=["git"],r=!1){let n=Nn(Q(t),r);e.on("binary",s=>{n=Nn(Q(s),r)}),e.append("spawn.binary",()=>n.binary),e.append("spawn.args",s=>n.prefix?[n.prefix,...s]:s)}var oi,rr,gu=l({"src/lib/plugins/custom-binary.plugin.ts"(){"use strict";Ie(),b(),oi="Invalid value supplied for custom binary, requires a single string or an array containing either one or two strings",rr="Invalid value supplied for custom binary, restricted characters must be removed or supply the unsafe.allowUnsafeCustomBinary option"}});function yu(e){return!!(e.exitCode&&e.stdErr.length)}function bu(e){return Buffer.concat([...e.stdOut,...e.stdErr])}function _u(e=!1,t=yu,r=bu){return(n,s)=>!e&&n||!t(s)?n:r(s)}function $n(e){return{type:"task.error",action(t,r){let n=e(t.error,{stdErr:r.stdErr,stdOut:r.stdOut,exitCode:r.exitCode});return Buffer.isBuffer(n)?{error:new K(void 0,n.toString("utf-8"))}:{error:n}}}}var wu=l({"src/lib/plugins/error-detection.plugin.ts"(){"use strict";ne()}}),Ln,ai,Tu=l({"src/lib/plugins/plugin-store.ts"(){"use strict";Ln=require("node:events"),b(),ai=class{constructor(){this.plugins=new Set,this.events=new Ln.EventEmitter}on(e,t){this.events.on(e,t)}reconfigure(e,t){this.events.emit(e,t)}append(e,t){let r=T(this.plugins,{type:e,action:t});return()=>this.plugins.delete(r)}add(e){let t=[];return Q(e).forEach(r=>r&&this.plugins.add(T(t,r))),()=>{t.forEach(r=>this.plugins.delete(r))}}exec(e,t,r){let n=t,s=Object.freeze(Object.create(r));for(let i of this.plugins)i.type===e&&(n=i.action(n,s));return n}}}});function vu(e){let t="--progress",r=["checkout","clone","fetch","pull","push"];return[{type:"spawn.args",action(i,o){return r.includes(o.method)?Ts(i,t):i}},{type:"spawn.after",action(i,o){o.commands.includes(t)&&o.spawned.stderr?.on("data",a=>{let c=/^([\s\S]+?):\s*(\d+)% \((\d+)\/(\d+)\)/.exec(a.toString("utf8"));c&&e({method:o.method,stage:Eu(c[1]),progress:E(c[2]),processed:E(c[3]),total:E(c[4])})})}}]}function Eu(e){return String(e.toLowerCase().split(" ",1))||"unknown"}var ku=l({"src/lib/plugins/progress-monitor-plugin.ts"(){"use strict";b()}}),Su=l({"src/lib/plugins/simple-git-plugin.ts"(){"use strict"}});function Ou(e){let t=Es(e,["uid","gid"]);return{type:"spawn.options",action(r){return{...t,...r}}}}var Cu=l({"src/lib/plugins/spawn-options-plugin.ts"(){"use strict";b()}});function Ru({block:e,stdErr:t=!0,stdOut:r=!0}){if(e>0)return{type:"spawn.after",action(n,s){let i;function o(){i&&clearTimeout(i),i=setTimeout(c,e)}function a(){s.spawned.stdout?.off("data",o),s.spawned.stderr?.off("data",o),s.spawned.off("exit",a),s.spawned.off("close",a),i&&clearTimeout(i)}function c(){a(),s.kill(new z(void 0,"timeout","block timeout reached"))}r&&s.spawned.stdout?.on("data",o),t&&s.spawned.stderr?.on("data",o),s.spawned.on("exit",a),s.spawned.on("close",a),o()}}}var xu=l({"src/lib/plugins/timout-plugin.ts"(){"use strict";Ie()}}),Fu=l({"src/lib/plugins/index.ts"(){"use strict";su(),uu(),pu(),du(),gu(),wu(),Tu(),ku(),Su(),Cu(),xu()}});function Au(){return{type:"spawn.args",action(e){let t=[],r;function n(s){(r=r||[]).push(...s)}for(let s=0;s<e.length;s++){let i=e[s];if(ot(i)){n(Dn(i));continue}if(i==="--"){n(e.slice(s+1).flatMap(o=>ot(o)&&Dn(o)||o));break}t.push(i)}return r?[...t,"--",...r.map(String)]:t}}}var Iu=l({"src/lib/plugins/suffix-paths.plugin.ts"(){"use strict";Ae()}});function Mu(){return(0,nt.default)("simple-git")}function jn(e,t,r){return!t||!String(t).replace(/\s*/,"")?r?(n,...s)=>{e(n,...s),r(n,...s)}:e:(n,...s)=>{e(`%s ${n}`,t,...s),r&&r(n,...s)}}function Du(e,t,{namespace:r}){if(typeof e=="string")return e;let n=t&&t.namespace||"";return n.startsWith(r)?n.substr(r.length+1):n||r}function Er(e,t,r,n=Mu()){let s=e&&`[${e}]`||"",i=[],o=typeof t=="string"?n.extend(t):t,a=Du(G(t,F),o,n);return f(r);function c(u,d){return T(i,Er(e,a.replace(/^[^:]+/,u),d,n))}function f(u){let d=u&&`[${u}]`||"",m=o&&jn(o,d)||pe,h=jn(n,`${s} ${d}`,m);return Object.assign(o?m:h,{label:e,sibling:c,info:h,step:f})}}var nt,ci=l({"src/lib/git-logger.ts"(){"use strict";nt=Ec(Bt()),b(),nt.default.formatters.L=e=>String(yt(e)?e.length:"-"),nt.default.formatters.B=e=>Buffer.isBuffer(e)?e.toString("utf8"):De(e)}}),ui,Pu=l({"src/lib/runners/tasks-pending-queue.ts"(){"use strict";ne(),ci(),ui=class nr{constructor(t="GitExecutor"){this.logLabel=t,this._queue=new Map}withProgress(t){return this._queue.get(t)}createProgress(t){let r=nr.getName(t.commands[0]),n=Er(this.logLabel,r);return{task:t,logger:n,name:r}}push(t){let r=this.createProgress(t);return r.logger("Adding task to the queue, commands = %o",t.commands),this._queue.set(t,r),r}fatal(t){for(let[r,{logger:n}]of Array.from(this._queue.entries()))r===t.task?(n.info("Failed %o",t),n("Fatal exception, any as-yet un-started tasks run through this executor will not be attempted")):n.info("A fatal exception occurred in a previous task, the queue has been purged: %o",t.message),this.complete(r);if(this._queue.size!==0)throw new Error(`Queue size should be zero after fatal: ${this._queue.size}`)}complete(t){this.withProgress(t)&&this._queue.delete(t)}attempt(t){let r=this.withProgress(t);if(!r)throw new K(void 0,"TasksPendingQueue: attempt called for an unknown task");return r.logger("Starting task"),r}static getName(t="empty"){return`task:${t}:${++nr.counter}`}static{this.counter=0}}}});function ce(e,t){return{method:_s(e.commands)||"",commands:t}}function Nu(e,t){return r=>{t("[ERROR] child process exception %o",r),e.push(Buffer.from(String(r.stack),"ascii"))}}function Bn(e,t,r,n){return s=>{r("%s received %L bytes",t,s),n("%B",s),e.push(s)}}var qn,sr,$u=l({"src/lib/runners/git-executor-chain.ts"(){"use strict";qn=require("child_process"),ne(),C(),b(),Pu(),sr=class{constructor(e,t,r){this._executor=e,this._scheduler=t,this._plugins=r,this._chain=Promise.resolve(),this._queue=new ui}get cwd(){return this._cwd||this._executor.cwd}set cwd(e){this._cwd=e}get env(){return this._executor.env}get outputHandler(){return this._executor.outputHandler}chain(){return this}push(e){return this._queue.push(e),this._chain=this._chain.then(()=>this.attemptTask(e))}async attemptTask(e){let t=await this._scheduler.next(),r=()=>this._queue.complete(e);try{let{logger:n}=this._queue.attempt(e);return await(Gs(e)?this.attemptEmptyTask(e,n):this.attemptRemoteTask(e,n))}catch(n){throw this.onFatalException(e,n)}finally{r(),t()}}onFatalException(e,t){let r=t instanceof K?Object.assign(t,{task:e}):new K(e,t&&String(t));return this._chain=Promise.resolve(),this._queue.fatal(r),r}async attemptRemoteTask(e,t){let r=this._plugins.exec("spawn.binary","",ce(e,e.commands)),n=this._plugins.exec("spawn.args",[...e.commands],ce(e,e.commands)),s=await this.gitResponse(e,r,n,this.outputHandler,t.step("SPAWN")),i=await this.handleTaskData(e,n,s,t.step("HANDLE"));return t("passing response to task's parser as a %s",e.format),qs(e)?Zt(e.parser,i):Zt(e.parser,i.asStrings())}async attemptEmptyTask(e,t){return t("empty task bypassing child process to call to task's parser"),e.parser(this)}handleTaskData(e,t,r,n){let{exitCode:s,rejection:i,stdOut:o,stdErr:a}=r;return new Promise((c,f)=>{n("Preparing to handle process response exitCode=%d stdOut=",s);let{error:u}=this._plugins.exec("task.error",{error:i},{...ce(e,t),...r});if(u&&e.onError)return n.info("exitCode=%s handling with custom error handler"),e.onError(r,u,d=>{n.info("custom error handler treated as success"),n("custom error returned a %s",De(d)),c(new ct(Array.isArray(d)?Buffer.concat(d):d,Buffer.concat(a)))},f);if(u)return n.info("handling as error: exitCode=%s stdErr=%s rejection=%o",s,a.length,i),f(u);n.info("retrieving task output complete"),c(new ct(Buffer.concat(o),Buffer.concat(a)))})}async gitResponse(e,t,r,n,s){let i=s.sibling("output"),o=this._plugins.exec("spawn.options",{cwd:this.cwd,env:this.env,windowsHide:!0},ce(e,e.commands));return new Promise(a=>{let c=[],f=[];s.info("%s %o",t,r),s("%O",o);let u=this._beforeSpawn(e,r);if(u)return a({stdOut:c,stdErr:f,exitCode:9901,rejection:u});this._plugins.exec("spawn.before",void 0,{...ce(e,r),kill(m){u=m||u}});let d=(0,qn.spawn)(t,r,o);d.stdout.on("data",Bn(c,"stdOut",s,i.step("stdOut"))),d.stderr.on("data",Bn(f,"stdErr",s,i.step("stdErr"))),d.on("error",Nu(f,s)),n&&(s("Passing child process stdOut/stdErr to custom outputHandler"),n(t,d.stdout,d.stderr,[...r])),this._plugins.exec("spawn.after",void 0,{...ce(e,r),spawned:d,close(m,h){a({stdOut:c,stdErr:f,exitCode:m,rejection:u||h})},kill(m){d.killed||(u=m,d.kill("SIGINT"))}})})}_beforeSpawn(e,t){let r;return this._plugins.exec("spawn.before",void 0,{...ce(e,t),kill(n){r=n||r}}),r}}}}),li={};S(li,{GitExecutor:()=>pi});var pi,Lu=l({"src/lib/runners/git-executor.ts"(){"use strict";$u(),pi=class{constructor(e,t,r){this.cwd=e,this._scheduler=t,this._plugins=r,this._chain=new sr(this,this._scheduler,this._plugins)}chain(){return new sr(this,this._scheduler,this._plugins)}push(e){return this._chain.push(e)}}}});function ju(e,t,r=pe){let n=i=>{r(null,i)},s=i=>{i?.task===e&&r(i instanceof le?Bu(i):i,void 0)};t.then(n,s)}function Bu(e){let t=n=>{console.warn(`simple-git deprecation notice: accessing GitResponseError.${n} should be GitResponseError.git.${n}, this will no longer be available in version 3`),t=pe};return Object.create(e,Object.getOwnPropertyNames(e.git).reduce(r,{}));function r(n,s){return s in e||(n[s]={enumerable:!1,configurable:!1,get(){return t(s),e.git[s]}}),n}}var qu=l({"src/lib/task-callback.ts"(){"use strict";Te(),b()}});function Gn(e,t){return js(r=>{if(!hr(e))throw new Error(`Git.cwd: cannot change to non-directory "${e}"`);return(t||r).cwd=e})}var Gu=l({"src/lib/tasks/change-working-directory.ts"(){"use strict";b(),C()}});function Xt(e){let t=["checkout",...e];return t[1]==="-b"&&t.includes("-B")&&(t[1]=ht(t,"-B")),M(t)}function Uu(){return{checkout(){return this._runTask(Xt($(arguments,1)),O(arguments))},checkoutBranch(e,t){return this._runTask(Xt(["-b",e,t,...$(arguments)]),O(arguments))},checkoutLocalBranch(e){return this._runTask(Xt(["-b",e,...$(arguments)]),O(arguments))}}}var Xu=l({"src/lib/tasks/checkout.ts"(){"use strict";b(),C()}});function Hu(){return{count:0,garbage:0,inPack:0,packs:0,prunePackable:0,size:0,sizeGarbage:0,sizePack:0}}function zu(){return{countObjects(){return this._runTask({commands:["count-objects","--verbose"],format:"utf-8",parser(e){return j(Hu(),[fi],e)}})}}}var fi,Wu=l({"src/lib/tasks/count-objects.ts"(){"use strict";b(),fi=new _(/([a-z-]+): (\d+)$/,(e,[t,r])=>{let n=vs(t);Object.hasOwn(e,n)&&(e[n]=E(r))})}});function Yu(e){return j({author:null,branch:"",commit:"",root:!1,summary:{changes:0,insertions:0,deletions:0}},di,e)}var di,Ju=l({"src/lib/parsers/parse-commit.ts"(){"use strict";b(),di=[new _(/^\[([^\s]+)( \([^)]+\))? ([^\]]+)/,(e,[t,r,n])=>{e.branch=t,e.commit=n,e.root=!!r}),new _(/\s*Author:\s(.+)/i,(e,[t])=>{let r=t.split("<"),n=r.pop();!n||!n.includes("@")||(e.author={email:n.substr(0,n.length-1),name:r.join("<").trim()})}),new _(/(\d+)[^,]*(?:,\s*(\d+)[^,]*)(?:,\s*(\d+))/g,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0,e.summary.insertions=parseInt(r,10)||0,e.summary.deletions=parseInt(n,10)||0}),new _(/^(\d+)[^,]*(?:,\s*(\d+)[^(]+\(([+-]))?/,(e,[t,r,n])=>{e.summary.changes=parseInt(t,10)||0;let s=parseInt(r,10)||0;n==="-"?e.summary.deletions=s:n==="+"&&(e.summary.insertions=s)})]}});function Vu(e,t,r){return{commands:["-c","core.abbrev=40","commit",...xe(e,"-m"),...t,...r],format:"utf-8",parser:Yu}}function Ku(){return{commit(t,...r){let n=O(arguments),s=e(t)||Vu(Q(t),Q(G(r[0],at,[])),[...ve(G(r[1],Pe,[])),...$(arguments,0,!0)]);return this._runTask(s,n)}};function e(t){return!at(t)&&L("git.commit: requires the commit message to be supplied as a string/string[]")}}var Qu=l({"src/lib/tasks/commit.ts"(){"use strict";Ju(),b(),C()}});function Zu(){return{firstCommit(){return this._runTask(M(["rev-list","--max-parents=0","HEAD"],!0),O(arguments))}}}var el=l({"src/lib/tasks/first-commit.ts"(){"use strict";b(),C()}});function tl(e,t){let r=["hash-object",e];return t&&r.push("-w"),M(r,!0)}var rl=l({"src/lib/tasks/hash-object.ts"(){"use strict";C()}});function nl(e,t,r){let n=String(r).trim(),s;if(s=hi.exec(n))return new st(e,t,!1,s[1]);if(s=mi.exec(n))return new st(e,t,!0,s[1]);let i="",o=n.split(" ");for(;o.length;)if(o.shift()==="in"){i=o.join(" ");break}return new st(e,t,/^re/i.test(n),i)}var st,hi,mi,sl=l({"src/lib/responses/InitSummary.ts"(){"use strict";st=class{constructor(e,t,r,n){this.bare=e,this.path=t,this.existing=r,this.gitDir=n}},hi=/^Init.+ repository in (.+)$/,mi=/^Rein.+ in (.+)$/}});function il(e){return e.includes(kr)}function ol(e=!1,t,r){let n=["init",...r];return e&&!il(n)&&n.splice(1,0,kr),{commands:n,format:"utf-8",parser(s){return nl(n.includes("--bare"),t,s)}}}var kr,al=l({"src/lib/tasks/init.ts"(){"use strict";sl(),kr="--bare"}});function Sr(e){for(let t=0;t<e.length;t++){let r=Or.exec(e[t]);if(r)return`--${r[1]}`}return""}function cl(e){return Or.test(e)}var Or,Ne=l({"src/lib/args/log-format.ts"(){"use strict";Or=/^--(stat|numstat|name-only|name-status)(=|$)/}}),gi,ul=l({"src/lib/responses/DiffSummary.ts"(){"use strict";gi=class{constructor(){this.changed=0,this.deletions=0,this.insertions=0,this.files=[]}}}});function yi(e=""){let t=bi[e];return r=>j(new gi,t,r,!1)}var Ht,Un,Xn,Hn,bi,_i=l({"src/lib/parsers/parse-diff-summary.ts"(){"use strict";Ne(),ul(),Vs(),b(),Ht=[new _(/^(.+)\s+\|\s+(\d+)(\s+[+\-]+)?$/,(e,[t,r,n=""])=>{e.files.push({file:t.trim(),changes:E(r),insertions:n.replace(/[^+]/g,"").length,deletions:n.replace(/[^-]/g,"").length,binary:!1})}),new _(/^(.+) \|\s+Bin ([0-9.]+) -> ([0-9.]+) ([a-z]+)/,(e,[t,r,n])=>{e.files.push({file:t.trim(),before:E(r),after:E(n),binary:!0})}),new _(/(\d+) files? changed\s*((?:, \d+ [^,]+){0,2})/,(e,[t,r])=>{let n=/(\d+) i/.exec(r),s=/(\d+) d/.exec(r);e.changed=E(t),e.insertions=E(n?.[1]),e.deletions=E(s?.[1])})],Un=[new _(/(\d+)\t(\d+)\t(.+)$/,(e,[t,r,n])=>{let s=E(t),i=E(r);e.changed++,e.insertions+=s,e.deletions+=i,e.files.push({file:n,changes:s+i,insertions:s,deletions:i,binary:!1})}),new _(/-\t-\t(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,after:0,before:0,binary:!0})})],Xn=[new _(/(.+)$/,(e,[t])=>{e.changed++,e.files.push({file:t,changes:0,insertions:0,deletions:0,binary:!1})})],Hn=[new _(/([ACDMRTUXB])([0-9]{0,3})\t(.[^\t]*)(\t(.[^\t]*))?$/,(e,[t,r,n,s,i])=>{e.changed++,e.files.push({file:i??n,changes:0,insertions:0,deletions:0,binary:!1,status:Jt(Kc(t)&&t),from:Jt(!!i&&n!==i&&n),similarity:E(r)})})],bi={"":Ht,"--stat":Ht,"--numstat":Un,"--name-status":Hn,"--name-only":Xn}}});function ll(e,t){return t.reduce((r,n,s)=>(r[n]=e[s]||"",r),Object.create({diff:null}))}function wi(e=xr,t=Ti,r=""){let n=yi(r);return function(s){let i=Me(s.trim(),!1,Cr).map(function(o){let a=o.split(Rr),c=ll(a[0].split(e),t);return a.length>1&&a[1].trim()&&(c.diff=n(a[1])),c});return{all:i,latest:i.length&&i[0]||null,total:i.length}}}var Cr,Rr,xr,Ti,vi=l({"src/lib/parsers/parse-list-log-summary.ts"(){"use strict";b(),_i(),Ne(),Cr="\xF2\xF2\xF2\xF2\xF2\xF2 ",Rr=" \xF2\xF2",xr=" \xF2 ",Ti=["hash","date","message","refs","author_name","author_email"]}}),Ei={};S(Ei,{diffSummaryTask:()=>pl,validateLogFormatConfig:()=>wt});function pl(e){let t=Sr(e),r=["diff"];return t===""&&(t="--stat",r.push("--stat=4096")),r.push(...e),wt(r)||{commands:r,format:"utf-8",parser:yi(t)}}function wt(e){let t=e.filter(cl);if(t.length>1)return L(`Summary flags are mutually exclusive - pick one of ${t.join(",")}`);if(t.length&&e.includes("-z"))return L(`Summary flag ${t} parsing is not compatible with null termination option '-z'`)}var Fr=l({"src/lib/tasks/diff.ts"(){"use strict";Ne(),_i(),C()}});function fl(e,t){let r=[],n=[];return Object.keys(e).forEach(s=>{r.push(s),n.push(String(e[s]))}),[r,n.join(t)]}function dl(e){return Object.keys(e).reduce((t,r)=>(r in ir||(t[r]=e[r]),t),{})}function ki(e={},t=[]){let r=G(e.splitter,F,xr),n=gt(e.format)?e.format:{hash:"%H",date:e.strictDate===!1?"%ai":"%aI",message:"%s",refs:"%D",body:e.multiLine?"%B":"%b",author_name:e.mailMap!==!1?"%aN":"%an",author_email:e.mailMap!==!1?"%aE":"%ae"},[s,i]=fl(n,r),o=[],a=[`--pretty=format:${Cr}${i}${Rr}`,...t],c=e.n||e["max-count"]||e.maxCount;if(c&&a.push(`--max-count=${c}`),e.from||e.to){let f=e.symmetric!==!1?"...":"..";o.push(`${e.from||""}${f}${e.to||""}`)}return F(e.file)&&a.push("--follow",hs(e.file)),gr(dl(e),a),{fields:s,splitter:r,commands:[...a,...o]}}function hl(e,t,r){let n=wi(e,t,Sr(r));return{commands:["log",...r],format:"utf-8",parser:n}}function ml(){return{log(...r){let n=O(arguments),s=ki(yr(arguments),ve(G(arguments[0],Pe,[]))),i=t(...r)||wt(s.commands)||e(s);return this._runTask(i,n)}};function e(r){return hl(r.splitter,r.fields,r.commands)}function t(r,n){return F(r)&&F(n)&&L("git.log(string, string) should be replaced with git.log({ from: string, to: string })")}}var ir,Si=l({"src/lib/tasks/log.ts"(){"use strict";Ne(),Ae(),vi(),b(),C(),Fr(),ir=(e=>(e[e["--pretty"]=0]="--pretty",e[e["max-count"]=1]="max-count",e[e.maxCount=2]="maxCount",e[e.n=3]="n",e[e.file=4]="file",e[e.format=5]="format",e[e.from=6]="from",e[e.to=7]="to",e[e.splitter=8]="splitter",e[e.symmetric=9]="symmetric",e[e.mailMap=10]="mailMap",e[e.multiLine=11]="multiLine",e[e.strictDate=12]="strictDate",e))(ir||{})}}),it,Oi,gl=l({"src/lib/responses/MergeSummary.ts"(){"use strict";it=class{constructor(e,t=null,r){this.reason=e,this.file=t,this.meta=r}toString(){return`${this.file}:${this.reason}`}},Oi=class{constructor(){this.conflicts=[],this.merges=[],this.result="success"}get failed(){return this.conflicts.length>0}get reason(){return this.result}toString(){return this.conflicts.length?`CONFLICTS: ${this.conflicts.join(", ")}`:"OK"}}}}),or,Ci,yl=l({"src/lib/responses/PullSummary.ts"(){"use strict";or=class{constructor(){this.remoteMessages={all:[]},this.created=[],this.deleted=[],this.files=[],this.deletions={},this.insertions={},this.summary={changes:0,deletions:0,insertions:0}}},Ci=class{constructor(){this.remote="",this.hash={local:"",remote:""},this.branch={local:"",remote:""},this.message=""}toString(){return this.message}}}});function zt(e){return e.objects=e.objects||{compressing:0,counting:0,enumerating:0,packReused:0,reused:{count:0,delta:0},total:{count:0,delta:0}}}function zn(e){let t=/^\s*(\d+)/.exec(e),r=/delta (\d+)/i.exec(e);return{count:E(t&&t[1]||"0"),delta:E(r&&r[1]||"0")}}var Ri,bl=l({"src/lib/parsers/parse-remote-objects.ts"(){"use strict";b(),Ri=[new re(/^remote:\s*(enumerating|counting|compressing) objects: (\d+),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=zt(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new re(/^remote:\s*(enumerating|counting|compressing) objects: \d+% \(\d+\/(\d+)\),/i,(e,[t,r])=>{let n=t.toLowerCase(),s=zt(e.remoteMessages);Object.assign(s,{[n]:E(r)})}),new re(/total ([^,]+), reused ([^,]+), pack-reused (\d+)/i,(e,[t,r,n])=>{let s=zt(e.remoteMessages);s.total=zn(t),s.reused=zn(r),s.packReused=E(n)})]}});function xi(e,t){return j({remoteMessages:new Ai},Fi,t)}var Fi,Ai,Ii=l({"src/lib/parsers/parse-remote-messages.ts"(){"use strict";b(),bl(),Fi=[new re(/^remote:\s*(.+)$/,(e,[t])=>(e.remoteMessages.all.push(t.trim()),!1)),...Ri,new re([/create a (?:pull|merge) request/i,/\s(https?:\/\/\S+)$/],(e,[t])=>{e.remoteMessages.pullRequestUrl=t}),new re([/found (\d+) vulnerabilities.+\(([^)]+)\)/i,/\s(https?:\/\/\S+)$/],(e,[t,r,n])=>{e.remoteMessages.vulnerabilities={count:E(t),summary:r,url:n}})],Ai=class{constructor(){this.all=[]}}}});function _l(e,t){let r=j(new Ci,Mi,[e,t]);return r.message&&r}var Wn,Yn,Jn,Vn,Mi,Kn,Ar,Di=l({"src/lib/parsers/parse-pull.ts"(){"use strict";yl(),b(),Ii(),Wn=/^\s*(.+?)\s+\|\s+\d+\s*(\+*)(-*)/,Yn=/(\d+)\D+((\d+)\D+\(\+\))?(\D+(\d+)\D+\(-\))?/,Jn=/^(create|delete) mode \d+ (.+)/,Vn=[new _(Wn,(e,[t,r,n])=>{e.files.push(t),r&&(e.insertions[t]=r.length),n&&(e.deletions[t]=n.length)}),new _(Yn,(e,[t,,r,,n])=>r!==void 0||n!==void 0?(e.summary.changes=+t||0,e.summary.insertions=+r||0,e.summary.deletions=+n||0,!0):!1),new _(Jn,(e,[t,r])=>{T(e.files,r),T(t==="create"?e.created:e.deleted,r)})],Mi=[new _(/^from\s(.+)$/i,(e,[t])=>void(e.remote=t)),new _(/^fatal:\s(.+)$/,(e,[t])=>void(e.message=t)),new _(/([a-z0-9]+)\.\.([a-z0-9]+)\s+(\S+)\s+->\s+(\S+)$/,(e,[t,r,n,s])=>{e.branch.local=n,e.hash.local=t,e.branch.remote=s,e.hash.remote=r})],Kn=(e,t)=>j(new or,Vn,[e,t]),Ar=(e,t)=>Object.assign(new or,Kn(e,t),xi(e,t))}}),Qn,Pi,Zn,wl=l({"src/lib/parsers/parse-merge.ts"(){"use strict";gl(),b(),Di(),Qn=[new _(/^Auto-merging\s+(.+)$/,(e,[t])=>{e.merges.push(t)}),new _(/^CONFLICT\s+\((.+)\): Merge conflict in (.+)$/,(e,[t,r])=>{e.conflicts.push(new it(t,r))}),new _(/^CONFLICT\s+\((.+\/delete)\): (.+) deleted in (.+) and/,(e,[t,r,n])=>{e.conflicts.push(new it(t,r,{deleteRef:n}))}),new _(/^CONFLICT\s+\((.+)\):/,(e,[t])=>{e.conflicts.push(new it(t,null))}),new _(/^Automatic merge failed;\s+(.+)$/,(e,[t])=>{e.result=t})],Pi=(e,t)=>Object.assign(Zn(e,t),Ar(e,t)),Zn=e=>j(new Oi,Qn,e)}});function es(e){return e.length?{commands:["merge",...e],format:"utf-8",parser(t,r){let n=Pi(t,r);if(n.failed)throw new le(n);return n}}:L("Git.merge requires at least one option")}var Tl=l({"src/lib/tasks/merge.ts"(){"use strict";Te(),wl(),C()}});function vl(e,t,r){let n=r.includes("deleted"),s=r.includes("tag")||/^refs\/tags/.test(e),i=!r.includes("new");return{deleted:n,tag:s,branch:!s,new:!i,alreadyUpdated:i,local:e,remote:t}}var ts,Ni,rs,El=l({"src/lib/parsers/parse-push.ts"(){"use strict";b(),Ii(),ts=[new _(/^Pushing to (.+)$/,(e,[t])=>{e.repo=t}),new _(/^updating local tracking ref '(.+)'/,(e,[t])=>{e.ref={...e.ref||{},local:t}}),new _(/^[=*-]\s+([^:]+):(\S+)\s+\[(.+)]$/,(e,[t,r,n])=>{e.pushed.push(vl(t,r,n))}),new _(/^Branch '([^']+)' set up to track remote branch '([^']+)' from '([^']+)'/,(e,[t,r,n])=>{e.branch={...e.branch||{},local:t,remote:r,remoteName:n}}),new _(/^([^:]+):(\S+)\s+([a-z0-9]+)\.\.([a-z0-9]+)$/,(e,[t,r,n,s])=>{e.update={head:{local:t,remote:r},hash:{from:n,to:s}}})],Ni=(e,t)=>{let r=rs(e,t),n=xi(e,t);return{...r,...n}},rs=(e,t)=>j({pushed:[]},ts,[e,t])}}),$i={};S($i,{pushTagsTask:()=>kl,pushTask:()=>Ir});function kl(e={},t){return T(t,"--tags"),Ir(e,t)}function Ir(e={},t){let r=["push",...t];return e.branch&&r.splice(1,0,e.branch),e.remote&&r.splice(1,0,e.remote),ht(r,"-v"),T(r,"--verbose"),T(r,"--porcelain"),{commands:r,format:"utf-8",parser:Ni}}var Li=l({"src/lib/tasks/push.ts"(){"use strict";El(),b()}});function Sl(){return{showBuffer(){let e=["show",...$(arguments,1)];return e.includes("--binary")||e.splice(1,0,"--binary"),this._runTask(Bs(e),O(arguments))},show(){let e=["show",...$(arguments,1)];return this._runTask(M(e),O(arguments))}}}var Ol=l({"src/lib/tasks/show.ts"(){"use strict";b(),C()}}),ns,ji,Cl=l({"src/lib/responses/FileStatusSummary.ts"(){"use strict";ns=/^(.+)\0(.+)$/,ji=class{constructor(e,t,r){if(this.path=e,this.index=t,this.working_dir=r,t==="R"||r==="R"){let n=ns.exec(e)||[null,e,e];this.from=n[2]||"",this.path=n[1]||""}}}}});function ss(e){let[t,r]=e.split(we);return{from:r||t,to:t}}function q(e,t,r){return[`${e}${t}`,r]}function Wt(e,...t){return t.map(r=>q(e,r,(n,s)=>T(n.conflicted,s)))}function Rl(e,t){let r=t.trim();switch(" "){case r.charAt(2):return n(r.charAt(0),r.charAt(1),r.substr(3));case r.charAt(1):return n(" ",r.charAt(0),r.substr(2));default:return}function n(s,i,o){let a=`${s}${i}`,c=Bi.get(a);c&&c(e,o),a!=="##"&&a!=="!!"&&e.files.push(new ji(o,s,i))}}var is,Bi,qi,xl=l({"src/lib/responses/StatusSummary.ts"(){"use strict";b(),Cl(),is=class{constructor(){this.not_added=[],this.conflicted=[],this.created=[],this.deleted=[],this.ignored=void 0,this.modified=[],this.renamed=[],this.files=[],this.staged=[],this.ahead=0,this.behind=0,this.current=null,this.tracking=null,this.detached=!1,this.isClean=()=>!this.files.length}},Bi=new Map([q(" ","A",(e,t)=>T(e.created,t)),q(" ","D",(e,t)=>T(e.deleted,t)),q(" ","M",(e,t)=>T(e.modified,t)),q("A"," ",(e,t)=>T(e.created,t)&&T(e.staged,t)),q("A","M",(e,t)=>T(e.created,t)&&T(e.staged,t)&&T(e.modified,t)),q("D"," ",(e,t)=>T(e.deleted,t)&&T(e.staged,t)),q("M"," ",(e,t)=>T(e.modified,t)&&T(e.staged,t)),q("M","M",(e,t)=>T(e.modified,t)&&T(e.staged,t)),q("R"," ",(e,t)=>{T(e.renamed,ss(t))}),q("R","M",(e,t)=>{let r=ss(t);T(e.renamed,r),T(e.modified,r.to)}),q("!","!",(e,t)=>{T(e.ignored=e.ignored||[],t)}),q("?","?",(e,t)=>T(e.not_added,t)),...Wt("A","A","U"),...Wt("D","D","U"),...Wt("U","A","D","U"),["##",(e,t)=>{let r=/ahead (\d+)/,n=/behind (\d+)/,s=/^(.+?(?=(?:\.{3}|\s|$)))/,i=/\.{3}(\S*)/,o=/\son\s(\S+?)(?=\.{3}|$)/,a=r.exec(t);e.ahead=a&&+a[1]||0,a=n.exec(t),e.behind=a&&+a[1]||0,a=s.exec(t),e.current=G(a?.[1],F,null),a=i.exec(t),e.tracking=G(a?.[1],F,null),a=o.exec(t),a&&(e.current=G(a?.[1],F,e.current)),e.detached=/\(no branch\)/.test(t)}]]),qi=function(e){let t=e.split(we),r=new is;for(let n=0,s=t.length;n<s;){let i=t[n++].trim();i&&(i.charAt(0)==="R"&&(i+=we+(t[n++]||"")),Rl(r,i))}return r}}});function Fl(e){return{format:"utf-8",commands:["status","--porcelain","-b","-u","--null",...e.filter(r=>!Gi.includes(r))],parser(r){return qi(r)}}}var Gi,Al=l({"src/lib/tasks/status.ts"(){"use strict";xl(),Gi=["--null","-z"]}});function pt(e=0,t=0,r=0,n="",s=!0){return Object.defineProperty({major:e,minor:t,patch:r,agent:n,installed:s},"toString",{value(){return`${this.major}.${this.minor}.${this.patch}`},configurable:!1,enumerable:!1})}function Il(){return pt(0,0,0,"",!1)}function Ml(){return{version(){return this._runTask({commands:["--version"],format:"utf-8",parser:Dl,onError(e,t,r,n){if(e.exitCode===-2)return r(Buffer.from(Mr));n(t)}})}}}function Dl(e){return e===Mr?Il():j(pt(0,0,0,e),Ui,e)}var Mr,Ui,Pl=l({"src/lib/tasks/version.ts"(){"use strict";b(),Mr="installed=false",Ui=[new _(/version (\d+)\.(\d+)\.(\d+)(?:\s*\((.+)\))?/,(e,[t,r,n,s=""])=>{Object.assign(e,pt(E(t),E(r),E(n),s))}),new _(/version (\d+)\.(\d+)\.(\D+)(.+)?$/,(e,[t,r,n,s=""])=>{Object.assign(e,pt(E(t),E(r),n,s))})]}}),Xi={};S(Xi,{SimpleGitApi:()=>ar});var ar,Nl=l({"src/lib/simple-git-api.ts"(){"use strict";qu(),Gu(),Xu(),Wu(),Qu(),Ys(),el(),ei(),rl(),al(),Si(),Tl(),Li(),Ol(),Al(),C(),Pl(),b(),ar=class{constructor(e){this._executor=e}_runTask(e,t){let r=this._executor.chain(),n=r.push(e);return t&&ju(e,n,t),Object.create(this,{then:{value:n.then.bind(n)},catch:{value:n.catch.bind(n)},_executor:{value:r}})}add(e){return this._runTask(M(["add",...Q(e)]),O(arguments))}cwd(e){let t=O(arguments);return typeof e=="string"?this._runTask(Gn(e,this._executor),t):typeof e?.path=="string"?this._runTask(Gn(e.path,e.root&&this._executor||void 0),t):this._runTask(L("Git.cwd: workingDirectory must be supplied as a string"),t)}hashObject(e,t){return this._runTask(tl(e,t===!0),O(arguments))}init(e){return this._runTask(ol(e===!0,this._executor.cwd,$(arguments)),O(arguments))}merge(){return this._runTask(es($(arguments)),O(arguments))}mergeFromTo(e,t){return F(e)&&F(t)?this._runTask(es([e,t,...$(arguments)]),O(arguments,!1)):this._runTask(L("Git.mergeFromTo requires that the 'remote' and 'branch' arguments are supplied as strings"))}outputHandler(e){return this._executor.outputHandler=e,this}push(){let e=Ir({remote:G(arguments[0],F),branch:G(arguments[1],F)},$(arguments));return this._runTask(e,O(arguments))}stash(){return this._runTask(M(["stash",...$(arguments)]),O(arguments))}status(){return this._runTask(Fl($(arguments)),O(arguments))}},Object.assign(ar.prototype,Uu(),Ku(),Vc(),zu(),Zu(),Zc(),ml(),Sl(),Ml())}}),Hi={};S(Hi,{Scheduler:()=>zi});var os,as,zi,$l=l({"src/lib/runners/scheduler.ts"(){"use strict";b(),os=Gt(),ci(),as=(()=>{let e=0;return()=>{e++;let{promise:t,done:r}=(0,os.createDeferred)();return{promise:t,done:r,id:e}}})(),zi=class{constructor(e=2){this.concurrency=e,this.logger=Er("","scheduler"),this.pending=[],this.running=[],this.logger("Constructed, concurrency=%s",e)}schedule(){if(!this.pending.length||this.running.length>=this.concurrency){this.logger("Schedule attempt ignored, pending=%s running=%s concurrency=%s",this.pending.length,this.running.length,this.concurrency);return}let e=T(this.running,this.pending.shift());this.logger("Attempting id=%s",e.id),e.done(()=>{this.logger("Completing id=",e.id),ht(this.running,e),this.schedule()})}next(){let{promise:e,id:t}=T(this.pending,as());return this.logger("Scheduling id=%s",t),this.schedule(),e}}}}),Wi={};S(Wi,{applyPatchTask:()=>Ll});function Ll(e,t){return M(["apply",...t,...e])}var jl=l({"src/lib/tasks/apply-patch.ts"(){"use strict";C()}});function Bl(e,t){return{branch:e,hash:t,success:!0}}function ql(e){return{branch:e,hash:null,success:!1}}var Yi,Gl=l({"src/lib/responses/BranchDeleteSummary.ts"(){"use strict";Yi=class{constructor(){this.all=[],this.branches={},this.errors=[]}get success(){return!this.errors.length}}}});function Ji(e,t){return t===1&&cr.test(e)}var cs,cr,us,Tt,Ul=l({"src/lib/parsers/parse-branch-delete.ts"(){"use strict";Gl(),b(),cs=/(\S+)\s+\(\S+\s([^)]+)\)/,cr=/^error[^']+'([^']+)'/m,us=[new _(cs,(e,[t,r])=>{let n=Bl(t,r);e.all.push(n),e.branches[t]=n}),new _(cr,(e,[t])=>{let r=ql(t);e.errors.push(r),e.all.push(r),e.branches[t]=r})],Tt=(e,t)=>j(new Yi,us,[e,t])}}),Vi,Xl=l({"src/lib/responses/BranchSummary.ts"(){"use strict";Vi=class{constructor(){this.all=[],this.branches={},this.current="",this.detached=!1}push(e,t,r,n,s){e==="*"&&(this.detached=t,this.current=r),this.all.push(r),this.branches[r]={current:e==="*",linkedWorkTree:e==="+",name:r,commit:n,label:s}}}}});function ls(e){return e?e.charAt(0):""}function Ki(e,t=!1){return j(new Vi,t?[Zi]:Qi,e)}var Qi,Zi,Hl=l({"src/lib/parsers/parse-branch.ts"(){"use strict";Xl(),b(),Qi=[new _(/^([*+]\s)?\((?:HEAD )?detached (?:from|at) (\S+)\)\s+([a-z0-9]+)\s(.*)$/,(e,[t,r,n,s])=>{e.push(ls(t),!0,r,n,s)}),new _(/^([*+]\s)?(\S+)\s+([a-z0-9]+)\s?(.*)$/s,(e,[t,r,n,s])=>{e.push(ls(t),!1,r,n,s)})],Zi=new _(/^(\S+)$/s,(e,[t])=>{e.push("*",!1,t,"","")})}}),eo={};S(eo,{branchLocalTask:()=>Wl,branchTask:()=>zl,containsDeleteBranchCommand:()=>to,deleteBranchTask:()=>Jl,deleteBranchesTask:()=>Yl});function to(e){let t=["-d","-D","--delete"];return e.some(r=>t.includes(r))}function zl(e){let t=to(e),r=e.includes("--show-current"),n=["branch",...e];return n.length===1&&n.push("-a"),n.includes("-v")||n.splice(1,0,"-v"),{format:"utf-8",commands:n,parser(s,i){return t?Tt(s,i).all[0]:Ki(s,r)}}}function Wl(){return{format:"utf-8",commands:["branch","-v"],parser(e){return Ki(e)}}}function Yl(e,t=!1){return{format:"utf-8",commands:["branch","-v",t?"-D":"-d",...e],parser(r,n){return Tt(r,n)},onError({exitCode:r,stdOut:n},s,i,o){if(!Ji(String(s),r))return o(s);i(n)}}}function Jl(e,t=!1){let r={format:"utf-8",commands:["branch","-v",t?"-D":"-d",e],parser(n,s){return Tt(n,s).branches[e]},onError({exitCode:n,stdErr:s,stdOut:i},o,a,c){if(!Ji(String(o),n))return c(o);throw new le(r.parser(Fe(i),Fe(s)),String(o))}};return r}var Vl=l({"src/lib/tasks/branch.ts"(){"use strict";Te(),Ul(),Hl(),b()}});function Kl(e){let t=e.trim().replace(/^["']|["']$/g,"");return t&&(0,ro.normalize)(t)}var ro,no,Ql=l({"src/lib/responses/CheckIgnore.ts"(){"use strict";ro=require("node:path"),no=e=>e.split(/\n/g).map(Kl).filter(Boolean)}}),so={};S(so,{checkIgnoreTask:()=>Zl});function Zl(e){return{commands:["check-ignore",...e],format:"utf-8",parser:no}}var ep=l({"src/lib/tasks/check-ignore.ts"(){"use strict";Ql()}}),io={};S(io,{cloneMirrorTask:()=>rp,cloneTask:()=>oo});function tp(e){return/^--upload-pack(=|$)/.test(e)}function oo(e,t,r){let n=["clone",...r];return F(e)&&n.push(e),F(t)&&n.push(t),n.find(tp)?L("git.fetch: potential exploit argument blocked."):M(n)}function rp(e,t,r){return T(r,"--mirror"),oo(e,t,r)}var np=l({"src/lib/tasks/clone.ts"(){"use strict";C(),b()}});function sp(e,t){return j({raw:e,remote:null,branches:[],tags:[],updated:[],deleted:[]},ao,[e,t])}var ao,ip=l({"src/lib/parsers/parse-fetch.ts"(){"use strict";b(),ao=[new _(/From (.+)$/,(e,[t])=>{e.remote=t}),new _(/\* \[new branch]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.branches.push({name:t,tracking:r})}),new _(/\* \[new tag]\s+(\S+)\s*-> (.+)$/,(e,[t,r])=>{e.tags.push({name:t,tracking:r})}),new _(/- \[deleted]\s+\S+\s*-> (.+)$/,(e,[t])=>{e.deleted.push({tracking:t})}),new _(/\s*([^.]+)\.\.(\S+)\s+(\S+)\s*-> (.+)$/,(e,[t,r,n,s])=>{e.updated.push({name:n,tracking:s,to:r,from:t})})]}}),co={};S(co,{fetchTask:()=>ap});function op(e){return/^--upload-pack(=|$)/.test(e)}function ap(e,t,r){let n=["fetch",...r];return e&&t&&n.push(e,t),n.find(op)?L("git.fetch: potential exploit argument blocked."):{commands:n,format:"utf-8",parser:sp}}var cp=l({"src/lib/tasks/fetch.ts"(){"use strict";ip(),C()}});function up(e){return j({moves:[]},uo,e)}var uo,lp=l({"src/lib/parsers/parse-move.ts"(){"use strict";b(),uo=[new _(/^Renaming (.+) to (.+)$/,(e,[t,r])=>{e.moves.push({from:t,to:r})})]}}),lo={};S(lo,{moveTask:()=>pp});function pp(e,t){return{commands:["mv","-v",...Q(e),t],format:"utf-8",parser:up}}var fp=l({"src/lib/tasks/move.ts"(){"use strict";lp(),b()}}),po={};S(po,{pullTask:()=>dp});function dp(e,t,r){let n=["pull",...r];return e&&t&&n.splice(1,0,e,t),{commands:n,format:"utf-8",parser(s,i){return Ar(s,i)},onError(s,i,o,a){let c=_l(Fe(s.stdOut),Fe(s.stdErr));if(c)return a(new le(c));a(i)}}}var hp=l({"src/lib/tasks/pull.ts"(){"use strict";Te(),Di(),b()}});function mp(e){let t={};return fo(e,([r])=>t[r]={name:r}),Object.values(t)}function gp(e){let t={};return fo(e,([r,n,s])=>{Object.hasOwn(t,r)||(t[r]={name:r,refs:{fetch:"",push:""}}),s&&n&&(t[r].refs[s.replace(/[^a-z]/g,"")]=n)}),Object.values(t)}function fo(e,t){dr(e,r=>t(r.split(/\s+/)))}var yp=l({"src/lib/responses/GetRemoteSummary.ts"(){"use strict";b()}}),ho={};S(ho,{addRemoteTask:()=>bp,getRemotesTask:()=>_p,listRemotesTask:()=>wp,remoteTask:()=>Tp,removeRemoteTask:()=>vp});function bp(e,t,r){return M(["remote","add",...r,e,t])}function _p(e){let t=["remote"];return e&&t.push("-v"),{commands:t,format:"utf-8",parser:e?gp:mp}}function wp(e){let t=[...e];return t[0]!=="ls-remote"&&t.unshift("ls-remote"),M(t)}function Tp(e){let t=[...e];return t[0]!=="remote"&&t.unshift("remote"),M(t)}function vp(e){return M(["remote","remove",e])}var Ep=l({"src/lib/tasks/remote.ts"(){"use strict";yp(),C()}}),mo={};S(mo,{stashListTask:()=>kp});function kp(e={},t){let r=ki(e),n=["stash","list",...r.commands,...t],s=wi(r.splitter,r.fields,Sr(n));return wt(n)||{commands:n,format:"utf-8",parser:s}}var Sp=l({"src/lib/tasks/stash-list.ts"(){"use strict";Ne(),vi(),Fr(),Si()}}),go={};S(go,{addSubModuleTask:()=>Op,initSubModuleTask:()=>Cp,subModuleTask:()=>vt,updateSubModuleTask:()=>Rp});function Op(e,t){return vt(["add",e,t])}function Cp(e){return vt(["init",...e])}function vt(e){let t=[...e];return t[0]!=="submodule"&&t.unshift("submodule"),M(t)}function Rp(e){return vt(["update",...e])}var xp=l({"src/lib/tasks/sub-module.ts"(){"use strict";C()}});function Fp(e,t){let r=Number.isNaN(e),n=Number.isNaN(t);return r!==n?r?1:-1:r?yo(e,t):0}function yo(e,t){return e===t?0:e>t?1:-1}function Ap(e){return e.trim()}function tt(e){return typeof e=="string"&&parseInt(e.replace(/^\D+/g,""),10)||0}var ps,bo,Ip=l({"src/lib/responses/TagList.ts"(){"use strict";ps=class{constructor(e,t){this.all=e,this.latest=t}},bo=function(e,t=!1){let r=e.split(`
`).map(Ap).filter(Boolean);t||r.sort(function(s,i){let o=s.split("."),a=i.split(".");if(o.length===1||a.length===1)return Fp(tt(o[0]),tt(a[0]));for(let c=0,f=Math.max(o.length,a.length);c<f;c++){let u=yo(tt(o[c]),tt(a[c]));if(u)return u}return 0});let n=t?r[0]:[...r].reverse().find(s=>s.indexOf(".")>=0);return new ps(r,n)}}}),_o={};S(_o,{addAnnotatedTagTask:()=>Pp,addTagTask:()=>Dp,tagListTask:()=>Mp});function Mp(e=[]){let t=e.some(r=>/^--sort=/.test(r));return{format:"utf-8",commands:["tag","-l",...e],parser(r){return bo(r,t)}}}function Dp(e){return{format:"utf-8",commands:["tag",e],parser(){return{name:e}}}}function Pp(e,t){return{format:"utf-8",commands:["tag","-a","-m",t,e],parser(){return{name:e}}}}var Np=l({"src/lib/tasks/tag.ts"(){"use strict";Ip()}}),$p=vc({"src/git.js"(e,t){"use strict";var{GitExecutor:r}=(Lu(),k(li)),{SimpleGitApi:n}=(Nl(),k(Xi)),{Scheduler:s}=($l(),k(Hi)),{configurationErrorTask:i}=(C(),k(er)),{asArray:o,filterArray:a,filterPrimitives:c,filterString:f,filterStringOrStringArray:u,filterType:d,getTrailingOptions:m,trailingFunctionArgument:h,trailingOptionsArgument:U}=(b(),k(Fs)),{applyPatchTask:R}=(jl(),k(Wi)),{branchTask:P,branchLocalTask:Z,deleteBranchesTask:fe,deleteBranchTask:Ot}=(Vl(),k(eo)),{checkIgnoreTask:de}=(ep(),k(so)),{checkIsRepoTask:Br}=(Ds(),k(As)),{cloneTask:ke,cloneMirrorTask:Ct}=(np(),k(io)),{cleanWithOptionsTask:qe,isCleanOptionsArray:Rt}=(Hs(),k(Us)),{diffSummaryTask:Yo}=(Fr(),k(Ei)),{fetchTask:Jo}=(cp(),k(co)),{moveTask:Vo}=(fp(),k(lo)),{pullTask:Ko}=(hp(),k(po)),{pushTagsTask:Qo}=(Li(),k($i)),{addRemoteTask:Zo,getRemotesTask:ea,listRemotesTask:ta,remoteTask:ra,removeRemoteTask:na}=(Ep(),k(ho)),{getResetMode:sa,resetTask:ia}=(si(),k(ti)),{stashListTask:oa}=(Sp(),k(mo)),{addSubModuleTask:aa,initSubModuleTask:ca,subModuleTask:ua,updateSubModuleTask:la}=(xp(),k(go)),{addAnnotatedTagTask:pa,addTagTask:fa,tagListTask:da}=(Np(),k(_o)),{straightThroughBufferTask:ha,straightThroughStringTask:J}=(C(),k(er));function y(p,g){this._plugins=g,this._executor=new r(p.baseDir,new s(p.maxConcurrentProcesses),g),this._trimmed=p.trimmed}(y.prototype=Object.create(n.prototype)).constructor=y,y.prototype.customBinary=function(p){return this._plugins.reconfigure("binary",p),this},y.prototype.env=function(p,g){return arguments.length===1&&typeof p=="object"?this._executor.env=p:(this._executor.env=this._executor.env||{})[p]=g,this},y.prototype.stashList=function(p){return this._runTask(oa(U(arguments)||{},a(p)&&p||[]),h(arguments))};function qr(p,g,v,I){return typeof v!="string"?i(`git.${p}() requires a string 'repoPath'`):g(v,d(I,f),m(arguments))}y.prototype.clone=function(){return this._runTask(qr("clone",ke,...arguments),h(arguments))},y.prototype.mirror=function(){return this._runTask(qr("mirror",Ct,...arguments),h(arguments))},y.prototype.mv=function(p,g){return this._runTask(Vo(p,g),h(arguments))},y.prototype.checkoutLatestTag=function(p){var g=this;return this.pull(function(){g.tags(function(v,I){g.checkout(I.latest,p)})})},y.prototype.pull=function(p,g,v,I){return this._runTask(Ko(d(p,f),d(g,f),m(arguments)),h(arguments))},y.prototype.fetch=function(p,g){return this._runTask(Jo(d(p,f),d(g,f),m(arguments)),h(arguments))},y.prototype.silent=function(p){return console.warn("simple-git deprecation notice: git.silent: logging should be configured using the `debug` library / `DEBUG` environment variable, this will be an error in version 3"),this},y.prototype.tags=function(p,g){return this._runTask(da(m(arguments)),h(arguments))},y.prototype.rebase=function(){return this._runTask(J(["rebase",...m(arguments)]),h(arguments))},y.prototype.reset=function(p){return this._runTask(ia(sa(p),m(arguments)),h(arguments))},y.prototype.revert=function(p){let g=h(arguments);return typeof p!="string"?this._runTask(i("Commit must be a string"),g):this._runTask(J(["revert",...m(arguments,0,!0),p]),g)},y.prototype.addTag=function(p){let g=typeof p=="string"?fa(p):i("Git.addTag requires a tag name");return this._runTask(g,h(arguments))},y.prototype.addAnnotatedTag=function(p,g){return this._runTask(pa(p,g),h(arguments))},y.prototype.deleteLocalBranch=function(p,g,v){return this._runTask(Ot(p,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.deleteLocalBranches=function(p,g,v){return this._runTask(fe(p,typeof g=="boolean"?g:!1),h(arguments))},y.prototype.branch=function(p,g){return this._runTask(P(m(arguments)),h(arguments))},y.prototype.branchLocal=function(p){return this._runTask(Z(),h(arguments))},y.prototype.raw=function(p){let g=!Array.isArray(p),v=[].slice.call(g?arguments:p,0);for(let X=0;X<v.length&&g;X++)if(!c(v[X])){v.splice(X,v.length-X);break}v.push(...m(arguments,0,!0));var I=h(arguments);return v.length?this._runTask(J(v,this._trimmed),I):this._runTask(i("Raw: must supply one or more command to execute"),I)},y.prototype.submoduleAdd=function(p,g,v){return this._runTask(aa(p,g),h(arguments))},y.prototype.submoduleUpdate=function(p,g){return this._runTask(la(m(arguments,!0)),h(arguments))},y.prototype.submoduleInit=function(p,g){return this._runTask(ca(m(arguments,!0)),h(arguments))},y.prototype.subModule=function(p,g){return this._runTask(ua(m(arguments)),h(arguments))},y.prototype.listRemote=function(){return this._runTask(ta(m(arguments)),h(arguments))},y.prototype.addRemote=function(p,g,v){return this._runTask(Zo(p,g,m(arguments)),h(arguments))},y.prototype.removeRemote=function(p,g){return this._runTask(na(p),h(arguments))},y.prototype.getRemotes=function(p,g){return this._runTask(ea(p===!0),h(arguments))},y.prototype.remote=function(p,g){return this._runTask(ra(m(arguments)),h(arguments))},y.prototype.tag=function(p,g){let v=m(arguments);return v[0]!=="tag"&&v.unshift("tag"),this._runTask(J(v),h(arguments))},y.prototype.updateServerInfo=function(p){return this._runTask(J(["update-server-info"]),h(arguments))},y.prototype.pushTags=function(p,g){let v=Qo({remote:d(p,f)},m(arguments));return this._runTask(v,h(arguments))},y.prototype.rm=function(p){return this._runTask(J(["rm","-f",...o(p)]),h(arguments))},y.prototype.rmKeepLocal=function(p){return this._runTask(J(["rm","--cached",...o(p)]),h(arguments))},y.prototype.catFile=function(p,g){return this._catFile("utf-8",arguments)},y.prototype.binaryCatFile=function(){return this._catFile("buffer",arguments)},y.prototype._catFile=function(p,g){var v=h(g),I=["cat-file"],X=g[0];if(typeof X=="string")return this._runTask(i("Git.catFile: options must be supplied as an array of strings"),v);Array.isArray(X)&&I.push.apply(I,X);let xt=p==="buffer"?ha(I):J(I);return this._runTask(xt,v)},y.prototype.diff=function(p,g){let v=f(p)?i("git.diff: supplying options as a single string is no longer supported, switch to an array of strings"):J(["diff",...m(arguments)]);return this._runTask(v,h(arguments))},y.prototype.diffSummary=function(){return this._runTask(Yo(m(arguments,1)),h(arguments))},y.prototype.applyPatch=function(p){let g=u(p)?R(o(p),m([].slice.call(arguments,1))):i("git.applyPatch requires one or more string patches as the first argument");return this._runTask(g,h(arguments))},y.prototype.revparse=function(){let p=["rev-parse",...m(arguments,!0)];return this._runTask(J(p,!0),h(arguments))},y.prototype.clean=function(p,g,v){let I=Rt(p),X=I&&p.join("")||d(p,f)||"",xt=m([].slice.call(arguments,I?1:0));return this._runTask(qe(X,xt),h(arguments))},y.prototype.exec=function(p){let g={commands:[],format:"utf-8",parser(){typeof p=="function"&&p()}};return this._runTask(g)},y.prototype.clearQueue=function(){return this},y.prototype.checkIgnore=function(p,g){return this._runTask(de(o(d(p,u,[]))),h(arguments))},y.prototype.checkIsRepo=function(p,g){return this._runTask(Br(d(p,f)),h(arguments))},t.exports=y}}),wo={};S(wo,{esModuleFactory:()=>Lp,gitExportFactory:()=>jp,gitInstanceFactory:()=>To});function Lp(e){return Object.defineProperties(e,{__esModule:{value:!0},default:{value:e}})}function jp(e){return Object.assign(e.bind(null),ii)}function To(e,t){let r=new ai,n=Rs(e&&(typeof e=="string"?{baseDir:e}:e)||{},t);if(!hr(n.baseDir))throw new pr(n,"Cannot use simple-git on a directory that does not exist");return Array.isArray(n.config)&&r.add(lu(n.config)),r.add(cu(n.unsafe)),r.add(Au()),r.add(fu(n.completion)),n.abort&&r.add(nu(n.abort)),n.progress&&r.add(vu(n.progress)),n.timeout&&r.add(Ru(n.timeout)),n.spawnOptions&&r.add(Ou(n.spawnOptions)),r.add($n(_u(!0))),n.errors&&r.add($n(n.errors)),mu(r,n.binary,n.unsafe?.allowUnsafeCustomBinary),new vo(n,r)}var vo,Eo=l({"src/lib/git-factory.ts"(){"use strict";ru(),Fu(),Iu(),b(),vo=$p()}}),ko={};S(ko,{gitP:()=>Bp});function Bp(...e){let t,r=Promise.resolve();try{t=To(...e)}catch(c){r=Promise.reject(c)}function n(){return i}function s(){return r}let i=[...So,...ur].reduce((c,f)=>{let u=ur.includes(f),d=u?o(f,t):a(f,t,c);return Object.defineProperty(c,f,{enumerable:!1,configurable:!1,value:t?d:u?s:n}),c},{});return i;function o(c,f){return function(...u){if(typeof u[u.length]=="function")throw new TypeError("Promise interface requires that handlers are not supplied inline, trailing function not allowed in call to "+c);return r.then(function(){return new Promise(function(d,m){let h=(U,R)=>{if(U)return m(qp(U));d(R)};u.push(h),f[c].apply(f,u)})})}}function a(c,f,u){return(...d)=>(f[c](...d),u)}}function qp(e){return e instanceof Error?e:typeof e=="string"?new Error(e):new le(e)}var So,ur,Gp=l({"src/lib/runners/promise-wrapped.ts"(){"use strict";Te(),Eo(),So=["customBinary","env","outputHandler","silent"],ur=["add","addAnnotatedTag","addConfig","addRemote","addTag","applyPatch","binaryCatFile","branch","branchLocal","catFile","checkIgnore","checkIsRepo","checkout","checkoutBranch","checkoutLatestTag","checkoutLocalBranch","clean","clone","commit","cwd","deleteLocalBranch","deleteLocalBranches","diff","diffSummary","exec","fetch","getRemotes","init","listConfig","listRemote","log","merge","mergeFromTo","mirror","mv","pull","push","pushTags","raw","rebase","remote","removeRemote","reset","revert","revparse","rm","rmKeepLocal","show","stash","stashList","status","subModule","submoduleAdd","submoduleInit","submoduleUpdate","tag","tags","updateServerInfo"]}}),{gitP:Up}=(Gp(),k(ko)),{esModuleFactory:Xp,gitInstanceFactory:Hp,gitExportFactory:zp}=(Eo(),k(wo)),fs=Xp(zp(Hp));Oo.exports=Object.assign(fs,{gitP:Up,simpleGit:fs})});var Fo=w((wd,xo)=>{var Ro=Co(),{execSync:Dr}=require("node:child_process"),W=require("node:path"),D=require("node:fs"),Wp=require("node:os"),Yp=W.join(Wp.homedir(),".claude-memory","repo"),Jp="claude-memory-storage",Pr=class{constructor(t,r=null,n=Jp){this.auth=t,this.repoOwner=r,this.repoName=n,this.syncDir=Yp,this._git=null}get git(){return this._git||(this._git=Ro(this.syncDir)),this._git}async ensureRepo(){if(D.existsSync(this.syncDir)&&D.existsSync(W.join(this.syncDir,".git")))return!0;if(!this.repoOwner){let r=await this.auth.getToken(),n=JSON.parse(Dr(`gh api user --header "Authorization: Bearer ${r}"`,{encoding:"utf8"}));this.repoOwner=n.login}return!await this.checkRepoExists()&&!await this.createRepo()?!1:(await this.cloneRepo(),!0)}async checkRepoExists(){try{let t=await this.auth.getToken();return Dr(`gh api repos/${this.repoOwner}/${this.repoName} --header "Authorization: Bearer ${t}"`,{stdio:"pipe"}),!0}catch{return!1}}async createRepo(){try{let t=await this.auth.getToken(),r=JSON.stringify({name:this.repoName,private:!0,description:"Claude Code memory storage - persistent context across sessions",auto_init:!0});return Dr(`gh api user/repos --method POST --input - --header "Authorization: Bearer ${t}"`,{input:r,stdio:"pipe"}),console.log(`Created private repository: ${this.repoOwner}/${this.repoName}`),!0}catch(t){return console.error("Failed to create repository:",t.message),!1}}async cloneRepo(){let t=`https://github.com/${this.repoOwner}/${this.repoName}.git`,r=W.dirname(this.syncDir);D.existsSync(r)||D.mkdirSync(r,{recursive:!0}),await Ro().clone(t,this.syncDir),await this.git.addConfig("user.name","Claude Code"),await this.git.addConfig("user.email","noreply@anthropic.com")}exportMemory(t){let r=new Date(t.created_at),n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,s=String(r.getDate()).padStart(2,"0"),i=W.join(this.syncDir,"memories",t.container_tag,n);D.existsSync(i)||D.mkdirSync(i,{recursive:!0});let o=`${s}-${t.id}.json`,a=W.join(i,o),c={id:t.id,content:t.content,containerTag:t.container_tag,metadata:typeof t.metadata=="string"?JSON.parse(t.metadata):t.metadata,createdAt:t.created_at,updatedAt:t.updated_at};return D.writeFileSync(a,JSON.stringify(c,null,2)),a}exportMemories(t){let r=[];for(let n of t){let s=this.exportMemory(n);r.push(s)}return r}exportProfiles(t){let r=W.join(this.syncDir,"profiles");D.existsSync(r)||D.mkdirSync(r,{recursive:!0});let n=W.join(r,"user-preferences.json");return D.writeFileSync(n,JSON.stringify(t,null,2)),n}async syncToGitHub(t,r=null){try{await this.ensureRepo();let n=this.exportMemories(t);if(r){let o=this.exportProfiles(r);n.push(o)}if(n.length===0)return{success:!0,synced:0};for(let o of n){let a=W.relative(this.syncDir,o);await this.git.add(a)}let i=`Session memories: ${[...new Set(t.map(o=>o.container_tag))].join(", ")} (${t.length} new)`;return await this.git.commit(i),await this.git.push("origin","main"),{success:!0,synced:t.length}}catch(n){return console.error("GitHub sync failed:",n.message),{success:!1,error:n.message}}}async pullFromGitHub(){try{return await this.ensureRepo(),await this.git.pull("origin","main"),{success:!0}}catch(t){return t.message.includes("conflict")?{success:!1,conflict:!0,error:t.message}:{success:!1,conflict:!1,error:t.message}}}importMemories(){let t=W.join(this.syncDir,"memories");if(!D.existsSync(t))return[];let r=[],n=s=>{let i=D.readdirSync(s,{withFileTypes:!0});for(let o of i){let a=W.join(s,o.name);if(o.isDirectory())n(a);else if(o.name.endsWith(".json"))try{let c=JSON.parse(D.readFileSync(a,"utf8"));r.push({id:c.id,content:c.content,container_tag:c.containerTag,metadata:JSON.stringify(c.metadata||{}),created_at:c.createdAt,updated_at:c.updatedAt,sync_status:"synced",synced_at:Date.now()})}catch(c){console.error(`Failed to parse ${a}:`,c.message)}}};return n(t),r}importProfiles(){let t=W.join(this.syncDir,"profiles","user-preferences.json");if(!D.existsSync(t))return{static:[],dynamic:[]};try{return JSON.parse(D.readFileSync(t,"utf8"))}catch(r){return console.error("Failed to parse profiles:",r.message),{static:[],dynamic:[]}}}};xo.exports={GitHubSync:Pr}});var Do=w((Td,Mo)=>{var{execSync:Ao}=require("node:child_process"),Ee=require("node:fs"),Io=require("node:path"),Vp=require("node:os"),$e=Io.join(Vp.homedir(),".claude-memory","github-token.json"),Nr=class{constructor(){this.ghAvailable=this.checkGhCli()}checkGhCli(){try{return Ao("gh auth status",{stdio:"pipe"}),!0}catch{return!1}}async getToken(){if(process.env.CLAUDE_MEMORY_GITHUB_TOKEN)return process.env.CLAUDE_MEMORY_GITHUB_TOKEN;if(this.ghAvailable)try{return Ao("gh auth token",{encoding:"utf8"}).trim()}catch(t){console.error("Failed to get gh token:",t.message)}if(Ee.existsSync($e))return JSON.parse(Ee.readFileSync($e,"utf8")).token;throw new Error("No GitHub authentication found. Please authenticate with gh CLI or set CLAUDE_MEMORY_GITHUB_TOKEN")}saveToken(t){let r=Io.dirname($e);Ee.existsSync(r)||Ee.mkdirSync(r,{recursive:!0}),Ee.writeFileSync($e,JSON.stringify({token:t}),{mode:384})}isAuthenticated(){return this.ghAvailable||process.env.CLAUDE_MEMORY_GITHUB_TOKEN||Ee.existsSync($e)}async initiateDeviceFlow(){let t=require("node:https");return new Promise((r,n)=>{let s=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",scope:"repo"}),i={hostname:"github.com",port:443,path:"/login/device/code",method:"POST",headers:{"Content-Type":"application/json","Content-Length":s.length,Accept:"application/json"}},o=t.request(i,a=>{let c="";a.on("data",f=>{c+=f}),a.on("end",()=>r(JSON.parse(c)))});o.on("error",n),o.write(s),o.end()})}async pollForToken(t,r=5){let n=require("node:https"),s=()=>new Promise((i,o)=>{let a=JSON.stringify({client_id:"Ov23liXXXXXXXXXXXXXX",device_code:t,grant_type:"urn:ietf:params:oauth:grant-type:device_code"}),c={hostname:"github.com",port:443,path:"/login/oauth/access_token",method:"POST",headers:{"Content-Type":"application/json","Content-Length":a.length,Accept:"application/json"}},f=n.request(c,u=>{let d="";u.on("data",m=>{d+=m}),u.on("end",()=>{let m=JSON.parse(d);m.access_token?i(m.access_token):m.error==="authorization_pending"?i(null):o(new Error(m.error||"Unknown error"))})});f.on("error",o),f.write(a),f.end()});for(let i=0;i<120;i++){let o=await s();if(o)return o;await new Promise(a=>setTimeout(a,r*1e3))}throw new Error("Device flow timed out")}async startDeviceFlow(){let t=await this.initiateDeviceFlow();console.log(`
GitHub Authentication Required:`),console.log(`Visit: ${t.verification_uri}`),console.log(`Enter code: ${t.user_code}
`);let r=await this.pollForToken(t.device_code,t.interval);return this.saveToken(r),r}};Mo.exports={GitHubAuth:Nr}});var No=w((vd,Po)=>{var{SqliteManager:Kp}=Sn(),{GitHubSync:Qp}=Fo(),{GitHubAuth:Zp}=Do(),ef=require("node:crypto"),$r=class{constructor(t=null){this.db=new Kp(t),this.auth=new Zp,this.sync=null}async initSync(){this.sync||(this.sync=new Qp(this.auth))}generateId(t="mem"){return`${t}_${ef.randomBytes(8).toString("hex")}`}async addMemory(t,r,n={},s=null){let i=s||this.generateId("mem");return this.db.addMemory(i,t,r,n),{id:i,status:"saved",containerTag:r}}async search(t,r=null,n={}){let s=this.db.searchMemories(t,r,n.limit||10);return{results:s.map(i=>({id:i.id,memory:i.content,content:i.content,similarity:i.relevance_score||.5,title:i.metadata?.title||null})),total:s.length}}async getProfile(t,r=null){let n=this.db.getProfile(t),s=null;if(r){let i=this.db.searchMemories(r,t,10);s={results:i.map(o=>({id:o.id,memory:o.content,content:o.content,similarity:o.relevance_score||.5,title:o.metadata?.title||null})),total:i.length}}return{profile:{static:n.static,dynamic:n.dynamic},searchResults:s}}async listMemories(t,r=20){return{memories:this.db.listMemories(t,r)}}async deleteMemory(t){return this.db.deleteMemory(t),{success:!0}}async syncToGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=this.db.getPendingSync();if(t.length===0)return{success:!0,synced:0};let r=await this.sync.syncToGitHub(t);if(r.success){let n=t.map(s=>s.id);this.db.markSynced(n)}return r}async syncFromGitHub(){if(!this.auth.isAuthenticated())return{success:!1,error:"Not authenticated"};await this.initSync();let t=await this.sync.pullFromGitHub();if(!t.success)return t;let r=this.sync.importMemories();for(let n of r)this.db.getMemory(n.id)||this.db.addMemory(n.id,n.content,n.container_tag,JSON.parse(n.metadata));return{success:!0,imported:r.length}}close(){this.db.close()}};Po.exports={StorageClient:$r}});var jo=w((Ed,Lo)=>{var{execSync:$o}=require("node:child_process"),tf=require("node:crypto");function Et(e){return tf.createHash("sha256").update(e).digest("hex").slice(0,16)}function Lr(e){try{return $o("git rev-parse --show-toplevel",{cwd:e,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function rf(e){let r=Lr(e)||e;return`claudecode_project_${Et(r)}`}function nf(e){return(Lr(e)||e).split("/").pop()||"unknown"}function sf(){try{let t=$o("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(t)return`claudecode_user_${Et(t)}`}catch{}let e=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${Et(e)}`}Lo.exports={sha256:Et,getGitRoot:Lr,getContainerTag:rf,getProjectName:nf,getUserContainerTag:sf}});var Uo=w((kd,Go)=>{var je=require("node:fs"),Bo=require("node:path"),of=require("node:os"),kt=Bo.join(of.homedir(),".supermemory-claude"),Le=Bo.join(kt,"settings.json"),qo={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxProfileItems:5,debug:!1,injectProfile:!0};function af(){je.existsSync(kt)||je.mkdirSync(kt,{recursive:!0})}function cf(){let e={...qo};try{if(je.existsSync(Le)){let t=je.readFileSync(Le,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${Le}: ${t.message}`)}return process.env.SUPERMEMORY_CC_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_CC_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function uf(e){af();let t={...e};delete t.apiKey,je.writeFileSync(Le,JSON.stringify(t,null,2))}function lf(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_CC_API_KEY)return process.env.SUPERMEMORY_CC_API_KEY;throw new Error("NO_API_KEY")}function pf(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function ff(e,t,r){if(e.debug){let n=new Date().toISOString();console.error(r?`[${n}] ${t}: ${JSON.stringify(r)}`:`[${n}] ${t}`)}}Go.exports={SETTINGS_DIR:kt,SETTINGS_FILE:Le,DEFAULT_SETTINGS:qo,loadSettings:cf,saveSettings:uf,getApiKey:lf,shouldCaptureTool:pf,debugLog:ff}});var Ho=w((Sd,Xo)=>{async function df(){return new Promise((e,t)=>{let r="";process.stdin.setEncoding("utf8"),process.stdin.on("data",n=>{r+=n}),process.stdin.on("end",()=>{try{e(r.trim()?JSON.parse(r):{})}catch(n){t(new Error(`Failed to parse stdin JSON: ${n.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function St(e){console.log(JSON.stringify(e))}function hf(e=null){St(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function mf(e){console.error(`Supermemory: ${e}`),St({continue:!0,suppressOutput:!0})}Xo.exports={readStdin:df,writeOutput:St,outputSuccess:hf,outputError:mf}});var Wo=w((Od,zo)=>{function ee(e){return e?e.split("/").slice(-2).join("/"):"unknown"}function Y(e,t=50){return e?e.length<=t?e:`${e.slice(0,t)}...`:""}function gf(e,t,r){let n=t||{},s=r||{};switch(e){case"Edit":{let i=ee(n.file_path),o=Y(n.old_string,30),a=Y(n.new_string,30);return n.replace_all?`Replaced all "${o}" with "${a}" in ${i}`:`Edited ${i}: "${o}" \u2192 "${a}"`}case"Write":{let i=ee(n.file_path),o=(n.content||"").length;return`Created ${i} (${o} chars)`}case"Bash":{let i=Y(n.command,80),o=!s.error&&s.exitCode!==1,a=n.description?` - ${Y(n.description,40)}`:"";return`Ran: ${i}${a}${o?"":" [FAILED]"}`}case"Task":{let i=n.description||Y(n.prompt,60)||"subtask";return`Spawned ${n.subagent_type||"agent"}: ${i}`}case"Read":{let i=ee(n.file_path),o=n.limit?` (${n.limit} lines)`:"";return`Read ${i}${o}`}case"Glob":{let i=n.pattern||"*",o=n.path?` in ${ee(n.path)}`:"";return`Glob: ${i}${o}`}case"Grep":{let i=Y(n.pattern,40),o=n.path?` in ${ee(n.path)}`:"";return`Grep: "${i}"${o}`}case"WebFetch":return`Fetched: ${Y(n.url,60)}`;case"WebSearch":return`Searched web: "${Y(n.query,60)}"`;case"NotebookEdit":{let i=ee(n.notebook_path);return`${n.edit_mode||"edit"} notebook cell in ${i}`}default:return`Used ${e}`}}function yf(e,t){let r=t||{},n={tool:e};return r.file_path&&(n.file=ee(r.file_path)),r.notebook_path&&(n.file=ee(r.notebook_path)),e==="Bash"&&r.command&&(n.command=Y(r.command,100)),r.pattern&&(n.pattern=Y(r.pattern,50)),n}zo.exports={compressObservation:gf,getObservationMetadata:yf,getRelativePath:ee,truncate:Y}});var{StorageClient:bf}=No(),{getContainerTag:_f}=jo(),{loadSettings:wf,debugLog:Be}=Uo(),{readStdin:Tf,writeOutput:jr}=Ho(),{compressTranscript:vf}=Wo();async function Ef(){let e=wf();try{let t=await Tf(),r=t.transcript||[];if(r.length===0){Be(e,"No transcript to save"),jr({});return}let n=t.cwd||process.cwd(),s=_f(n);Be(e,"Stop",{cwd:n,containerTag:s,turns:r.length});let i=new bf,o=vf(r,e),a=`session_${Date.now()}`;await i.addMemory(o,s,{sm_source:"claude-code-plugin",sessionId:a,turns:r.length},a);let c=await i.syncToGitHub().catch(()=>({success:!1}));c.success?Be(e,"Synced to GitHub",{count:c.synced}):Be(e,"GitHub sync failed, will retry later"),i.close(),jr({})}catch(t){Be(e,"Error",{error:t.message}),console.error(`Claude Memory: ${t.message}`),jr({})}}Ef().catch(e=>{console.error(`Claude Memory fatal: ${e.message}`),process.exit(1)});
